# HTB: Guardian

## Host: Linux
## IP: 10.10.11.84

## Procedimiento y comandos
#### Paso 1: Enumeracion

* Nmap

```bash
PORT      STATE    SERVICE     REASON         VERSION
22/tcp    open     ssh         syn-ack ttl 63 OpenSSH 8.9p1 Ubuntu 3ubuntu0.13 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   256 9c:69:53:e1:38:3b:de:cd:42:0a:c8:6b:f8:95:b3:62 (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBEtPLvoTptmr4MsrtI0K/4A73jlDROsZk5pUpkv1rb2VUfEDKmiArBppPYZhUo+Fopcqr4j90edXV+4Usda76kI=
|   256 3c:aa:b9:be:17:2d:5e:99:cc:ff:e1:91:90:38:b7:39 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIHTkehIuVT04tJc00jcFVYdmQYDY3RuiImpFenWc9Yi6
80/tcp    open     http        syn-ack ttl 63 Apache httpd 2.4.52
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-title: Did not follow redirect to http://guardian.htb/
|_http-server-header: Apache/2.4.52 (Ubuntu)
4023/tcp  filtered esnm-zoning no-response
5612/tcp  filtered unknown     no-response
5644/tcp  filtered unknown     no-response
6447/tcp  filtered unknown     no-response
6484/tcp  filtered sun-sr-jms  no-response
7139/tcp  filtered unknown     no-response
7920/tcp  filtered unknown     no-response
8354/tcp  filtered unknown     no-response
10522/tcp filtered unknown     no-response
10991/tcp filtered unknown     no-response
11290/tcp filtered unknown     no-response
12185/tcp filtered unknown     no-response
12985/tcp filtered unknown     no-response
14710/tcp filtered unknown     no-response
15482/tcp filtered unknown     no-response
16799/tcp filtered unknown     no-response
19511/tcp filtered unknown     no-response
19858/tcp filtered unknown     no-response
19885/tcp filtered unknown     no-response
20932/tcp filtered unknown     no-response
22896/tcp filtered unknown     no-response
24318/tcp filtered unknown     no-response
24579/tcp filtered unknown     no-response
24935/tcp filtered unknown     no-response
27531/tcp filtered unknown     no-response
33428/tcp filtered unknown     no-response
33605/tcp filtered unknown     no-response
37135/tcp filtered unknown     no-response
37856/tcp filtered unknown     no-response
44110/tcp filtered unknown     no-response
44146/tcp filtered unknown     no-response
44369/tcp filtered unknown     no-response
45197/tcp filtered unknown     no-response
46536/tcp filtered unknown     no-response
48504/tcp filtered unknown     no-response
49110/tcp filtered unknown     no-response
49754/tcp filtered unknown     no-response
52108/tcp filtered unknown     no-response
54992/tcp filtered unknown     no-response
55607/tcp filtered unknown     no-response
56515/tcp filtered unknown     no-response
56651/tcp filtered unknown     no-response
56995/tcp filtered unknown     no-response
58128/tcp filtered unknown     no-response
60917/tcp filtered unknown     no-response
64059/tcp filtered unknown     no-response
Device type: general purpose|router
Running: Linux 5.X, MikroTik RouterOS 7.X
OS CPE: cpe:/o:linux:linux_kernel:5 cpe:/o:mikrotik:routeros:7 cpe:/o:linux:linux_kernel:5.6.3
OS details: Linux 5.0 - 5.14, MikroTik RouterOS 7.2 - 7.5 (Linux 5.6.3)
TCP/IP fingerprint:
OS:SCAN(V=7.95%E=4%D=9/27%OT=22%CT=1%CU=34897%PV=Y%DS=2%DC=T%G=Y%TM=68D80E2
OS:B%P=x86_64-pc-linux-gnu)SEQ(SP=107%GCD=1%ISR=10E%TI=Z%CI=Z%II=I%TS=A)OPS
OS:(O1=M552ST11NW7%O2=M552ST11NW7%O3=M552NNT11NW7%O4=M552ST11NW7%O5=M552ST1
OS:1NW7%O6=M552ST11)WIN(W1=FE88%W2=FE88%W3=FE88%W4=FE88%W5=FE88%W6=FE88)ECN
OS:(R=Y%DF=Y%T=40%W=FAF0%O=M552NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O%A=S+%F=A
OS:S%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T5(R
OS:=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F
OS:=R%O=%RD=0%Q=)T7(R=N)U1(R=Y%DF=N%T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%
OS:RUCK=G%RUD=G)IE(R=Y%DFI=N%T=40%CD=S)

Uptime guess: 31.673 days (since Tue Aug 26 21:09:05 2025)
Network Distance: 2 hops
TCP Sequence Prediction: Difficulty=263 (Good luck!)
IP ID Sequence Generation: All zeros
Service Info: Host: _default_; OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE (using port 8888/tcp)
HOP RTT       ADDRESS
1   232.39 ms 10.10.14.1
2   232.77 ms 10.10.11.84

NSE: Script Post-scanning.
NSE: Starting runlevel 1 (of 3) scan.
Initiating NSE at 13:17
Completed NSE at 13:17, 0.00s elapsed
NSE: Starting runlevel 2 (of 3) scan.
Initiating NSE at 13:17
Completed NSE at 13:17, 0.00s elapsed
NSE: Starting runlevel 3 (of 3) scan.
Initiating NSE at 13:17
Completed NSE at 13:17, 0.00s elapsed
Read data files from: /usr/share/nmap
OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 853.34 seconds
           Raw packets sent: 73804 (3.248MB) | Rcvd: 87051 (7.146MB)
```

* Directory: dirsearch

```bash
dirsearch -u http://guardian.htb

/usr/lib/python3/dist-packages/dirsearch/dirsearch.py:23: DeprecationWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html
  from pkg_resources import DistributionNotFound, VersionConflict

  _|. _ _  _  _  _ _|_    v0.4.3
 (_||| _) (/_(_|| (_| )

Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 25 | Wordlist size: 11460

Output File: /home/kali/HTB/Guardian/reports/http_guardian.htb/_25-09-27_13-12-55.txt

Target: http://guardian.htb/

[13:12:55] Starting: 
[13:12:58] 301 -  309B  - /js  ->  http://guardian.htb/js/                  
[13:13:06] 403 -  277B  - /.ht_wsr.txt                                      
[13:13:06] 403 -  277B  - /.htaccess.bak1                                   
[13:13:06] 403 -  277B  - /.htaccess.orig                                   
[13:13:06] 403 -  277B  - /.htaccess.sample
[13:13:06] 403 -  277B  - /.htaccess.save                                   
[13:13:06] 403 -  277B  - /.htaccess_extra
[13:13:06] 403 -  277B  - /.htaccess_sc
[13:13:06] 403 -  277B  - /.htaccess_orig
[13:13:06] 403 -  277B  - /.htaccessOLD
[13:13:06] 403 -  277B  - /.htaccessBAK
[13:13:06] 403 -  277B  - /.htaccessOLD2
[13:13:06] 403 -  277B  - /.htm                                             
[13:13:06] 403 -  277B  - /.html                                            
[13:13:06] 403 -  277B  - /.htpasswd_test                                   
[13:13:06] 403 -  277B  - /.htpasswds
[13:13:06] 403 -  277B  - /.httr-oauth
[13:13:13] 403 -  277B  - /.php                                             
[13:14:07] 403 -  277B  - /cgi-bin/                                         
[13:14:17] 301 -  310B  - /css  ->  http://guardian.htb/css/                
[13:14:40] 301 -  313B  - /images  ->  http://guardian.htb/images/          
[13:14:40] 403 -  277B  - /images/                                          
[13:14:43] 404 -   16B  - /index.php/login/                                 
[13:14:48] 301 -  317B  - /javascript  ->  http://guardian.htb/javascript/  
[13:14:50] 403 -  277B  - /js/                                              
[13:15:13] 403 -  277B  - /php5.fcgi                                        
[13:15:38] 403 -  277B  - /server-status/                                   
[13:15:38] 403 -  277B  - /server-status                                    
                                                                             
Task Completed 
```

* Subdomains: 

> Ni FFuf ni gobuster devuelven el subdominio a pesar de que este se encuentra en la wordlist

Al inspeccionar los links de la pagina web notamos **portal.guardian.htb** lo agregamos a nuestros hosts y navegamos ahi

Interactuando con el sitio vemos una notificacion que nos indica que revisemos la guia de usuario del sitio, por lo tanto inferimos que debe haber un pdf por ahi:

```bash
feroxbuster -u http://portal.guardian.htb -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt -x php,pdf,html,txt,js,txt,log --dont-filter --status-codes 200,204,301,302,307,403,401 --threads 50
                                                                                                                                                                                                                                            
 ___  ___  __   __     __      __         __   ___
|__  |__  |__) |__) | /  `    /  \ \_/ | |  \ |__
|    |___ |  \ |  \ | \__,    \__/ / \ | |__/ |___
by Ben "epi" Risher 🤓                 ver: 2.11.0
───────────────────────────┬──────────────────────
 🎯  Target Url            │ http://portal.guardian.htb
 🚀  Threads               │ 50
 📖  Wordlist              │ /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt
 👌  Status Codes          │ [200, 204, 301, 302, 307, 403, 401]
 💥  Timeout (secs)        │ 7
 🦡  User-Agent            │ feroxbuster/2.11.0
 💉  Config File           │ /etc/feroxbuster/ferox-config.toml
 🔎  Extract Links         │ true
 💲  Extensions            │ [php, pdf, html, txt, js, txt, log]
 🏁  HTTP methods          │ [GET]
 🤪  Filter Wildcards      │ false
 🔃  Recursion Depth       │ 4
 🎉  New Version Available │ https://github.com/epi052/feroxbuster/releases/latest
───────────────────────────┴──────────────────────
 🏁  Press [ENTER] to use the Scan Management Menu™
──────────────────────────────────────────────────
301      GET        9l       28w      329c http://portal.guardian.htb/includes => http://portal.guardian.htb/includes/
200      GET      168l      310w     3201c http://portal.guardian.htb/static/styles/login.css
200      GET       38l       92w     1383c http://portal.guardian.htb/forgot.php
200      GET        9l      125w    73890c http://portal.guardian.htb/static/vendor/fontawesome/css/all.min.css
403      GET        9l       28w      284c http://portal.guardian.htb/static/
302      GET        0l        0w        0c http://portal.guardian.htb/ => http://portal.guardian.htb/login.php
403      GET        9l       28w      284c http://portal.guardian.htb/static/styles/
200      GET      607l     3253w   210067c http://portal.guardian.htb/static/downloads/Guardian_University_Student_Portal_Guide.pdf
301      GET        9l       28w      326c http://portal.guardian.htb/admin => http://portal.guardian.htb/admin/
302      GET        0l        0w        0c http://portal.guardian.htb/logout.php => http://portal.guardian.htb/login.php
403      GET        9l       28w      284c http://portal.guardian.htb/.php
301      GET        9l       28w      335c http://portal.guardian.htb/includes/admin => http://portal.guardian.htb/includes/admin/
403      GET        9l       28w      284c http://portal.guardian.htb/includes/.php
403      GET        9l       28w      284c http://portal.guardian.htb/includes/.html
403      GET        9l       28w      284c http://portal.guardian.htb/.html
200      GET       84l      184w     2900c http://portal.guardian.htb/login.php
301      GET        9l       28w      349c http://portal.guardian.htb/static/vendor/fontawesome/js => http://portal.guardian.htb/static/vendor/fontawesome/js/
301      GET        9l       28w      327c http://portal.guardian.htb/config => http://portal.guardian.htb/config/
301      GET        9l       28w      331c http://portal.guardian.htb/javascript => http://portal.guardian.htb/javascript/
200      GET        0l        0w        0c http://portal.guardian.htb/config/config.php
301      GET        9l       28w      334c http://portal.guardian.htb/static/styles => http://portal.guardian.htb/static/styles/
301      GET        9l       28w      327c http://portal.guardian.htb/static => http://portal.guardian.htb/static/
200      GET        0l        0w        0c http://portal.guardian.htb/config/db.php
302      GET        0l        0w        0c http://portal.guardian.htb/admin/users.php => http://portal.guardian.htb/login.php
302      GET        0l        0w        0c http://portal.guardian.htb/admin/chat.php => http://portal.guardian.htb/login.php
200      GET        0l        0w        0c http://portal.guardian.htb/includes/auth.php
302      GET        0l        0w        0c http://portal.guardian.htb/admin/profile.php => http://portal.guardian.htb/login.php
200      GET      173l      316w     3286c http://portal.guardian.htb/static/styles/forgot.css
403      GET        9l       28w      284c http://portal.guardian.htb/server-status
301      GET        9l       28w      334c http://portal.guardian.htb/admin/notices => http://portal.guardian.htb/admin/notices/
403      GET        9l       28w      284c http://portal.guardian.htb/admin/.php
403      GET        9l       28w      284c http://portal.guardian.htb/admin/.html
200      GET        0l        0w        0c http://portal.guardian.htb/admin/notices/delete.php
302      GET        0l        0w        0c http://portal.guardian.htb/admin/notices/approve.php => http://portal.guardian.htb/login.php
[##>-----------------] - 9m    286236/2552352 78m     found:34      errors:77636  
[##>-----------------] - 9m    286242/2552352 78m     found:34      errors:77636  
[######>-------------] - 9m     69080/212672  132/s   http://portal.guardian.htb/ 
[######>-------------] - 9m     71664/212672  137/s   http://portal.guardian.htb/includes/ 
[##>-----------------] - 9m    286250/2552352 78m     found:34      errors:77636  
[######>-------------] - 9m     69080/212672  132/s   http://portal.guardian.htb/ 
[######>-------------] - 9m     71664/212672  137/s   http://portal.guardian.htb/includes/ 
[##>-----------------] - 9m    286261/2552352 78m     found:34      errors:77637  
[######>-------------] - 9m     69080/212672  132/s   http://portal.guardian.htb/ 
[######>-------------] - 9m     71664/212672  137/s   http://portal.guardian.htb/includes/ 
[######>-------------] - 9m     71272/212672  137/s   http://portal.guardian.htb/static/ 
[######>-------------] - 9m     69544/212672  134/s   http://portal.guardian.htb/static/styles/ 
[######>-------------] - 9m     65136/212672  126/s   http://portal.guardian.htb/admin/ 
[######>-------------] - 9m     66384/212672  128/s   http://portal.guardian.htb/includes/admin/ 
[##>-----------------] - 9m    286294/2552352 78m     found:34      errors:77637  
[######>-------------] - 9m     69088/212672  131/s   http://portal.guardian.htb/ 
[######>-------------] - 9m     71664/212672  137/s   http://portal.guardian.htb/includes/ 
[###>----------------] - 11m   408462/2552352 57m     found:34      errors:125400 
🚨 Caught ctrl+c 🚨 saving scan state to ferox-http_portal_guardian_htb-1758993573.state ...
[###>----------------] - 11m   408469/2552352 57m     found:34      errors:125400 
[#########>----------] - 11m   105256/212672  153/s   http://portal.guardian.htb/ 
[#########>----------] - 11m   106224/212672  155/s   http://portal.guardian.htb/includes/ 
[#########>----------] - 11m   103696/212672  152/s   http://portal.guardian.htb/static/ 
[#########>----------] - 11m   105896/212672  155/s   http://portal.guardian.htb/static/styles/ 
[#########>----------] - 11m   100680/212672  148/s   http://portal.guardian.htb/admin/ 
[#########>----------] - 11m   105416/212672  155/s   http://portal.guardian.htb/includes/admin/ 
[##########>---------] - 11m   112328/212672  166/s   http://portal.guardian.htb/static/downloads/ 
[#########>----------] - 11m    99480/212672  147/s   http://portal.guardian.htb/static/vendor/ 
[#########>----------] - 11m    97536/212672  144/s   http://portal.guardian.htb/static/vendor/fontawesome/ 
[##########>---------] - 11m   108512/212672  161/s   http://portal.guardian.htb/config/ 
[##########>---------] - 11m   113040/212672  169/s   http://portal.guardian.htb/javascript/ 
[######>-------------] - 9m     70888/212672  133/s   http://portal.guardian.htb/admin/notices/  
```

Vemos un par de cosas interesantes:

1. http://portal.guardian.htb/static/downloads/Guardian_University_Student_Portal_Guide.pdf

2. Vemos en el sitio en la seccon "Student Testimonials" ejecmplos de usuarios:

```bash
GU0142023@guardian.htb
GU6262023@guardian.htb
GU0702025@guardian.htb
```
3. Dentro del pdf encontramos un password por defecto **GU1234**


A partir de aqui tenemos dos bias.

1. Podemos generar una lista de usuarios con una regla que agregue GU adelante de un digito aleatorio de 3 numeros + un year 2025 2024 2023 etc..

> **Lento** pero quizas encontramos usuarios de mayor valor o con mas privilegios

2. Podemos intentar con los usuarios que tenemos.

> **rapido** son solo 3 usuarios se pruban y se corrobora.

```bash
GU0142023
GU6262023
GU0702025
```
Vamos por la bia rapida e intentamos con GU0142023 obtenieendo acceso: http://portal.guardian.htb/student/home.php

Navegando por el portal encontramos varios usuarios internos, generamos una lista.

Luego buscamos inputs que nos permitan cargar documentos. La seccion Assignments provee asignacions o tareas que el usuario debe entregar.
La unica que no esta vencida contiene un input de tipo file. (docx y xlsx)

Ponemos el foco en las url que en las distintas secciones del sitio.

Chats:

1. Con => GU6262023
```bash
http://portal.guardian.htb/student/chat.php?chat_users[0]=13&chat_users[1]=14
```

2. Con => mireille.feek

```bash
http://portal.guardian.htb/student/chat.php?chat_users[0]=13&chat_users[1]=11
```

Parece ser que nuestro id es [13]

3. Probamos chatear con admin:

```bash
http://portal.guardian.htb/student/chat.php?chat_users[0]=13&chat_users[1]=1
```

y su id es [1]

manipulamos los valores de nuestro id con burp para ver posibles respuestas y obtenemos una respuesta positiva con el valor [2]

```bash
/student/chat.php?chat_users[0]=2&chat_users[1]=1 
```

El usuario jamil.enockson recibio el siguiente mensage de admin:

```bash
Here is your password for gitea: DHsNnk3V503
```
Hay mas mensages pero no resultan reelevantes

asumimos un subdominio gitea.guardian.htb, agregamos el host a nuestro /etc/hosts y nos logueamos con las credenciales:

* jamil.enockson@guardian.htb / DHsNnk3V503

Del repo obtenemos:

/config.php

```bash
<?php
return [
    'db' => [
        'dsn' => 'mysql:host=localhost;dbname=guardiandb',
        'username' => 'root',
        'password' => 'Gu4rd14n_un1_1s_th3_b3st',
        'options' => []
    ],
    'salt' => '8Sb)tM1vs1SS'
];
```

/composer.json

```bash
# Dependencias
{
    "require": {
        "phpoffice/phpspreadsheet": "3.7.0",
        "phpoffice/phpword": "^1.3"
    }
}
```
