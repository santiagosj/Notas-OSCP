# HTB: Fluffy - CVE-2025-24071 - Kerberos

## Host: windows
## IP: 10.10.11.69

## Procedimiento y comandos

> Se nos proveen las credenciales en la maquina

* user: ** j.fleischman **
* password: ** J0elTHEM4n1990! **

#### Paso 1: Enumeracion

* Nmap

```bash
  cat Fluffy-nmap.txt 
# Nmap 7.95 scan initiated Wed Sep 10 13:18:55 2025 as: /usr/lib/nmap/nmap -A -oN Fluffy-nmap.txt 10.10.11.69
Nmap scan report for 10.10.11.69
Host is up (0.22s latency).
Not shown: 989 filtered tcp ports (no-response)
PORT     STATE SERVICE       VERSION
53/tcp   open  domain        Simple DNS Plus
88/tcp   open  kerberos-sec  Microsoft Windows Kerberos (server time: 2025-09-10 23:19:15Z)
139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: fluffy.htb0., Site: Default-First-Site-Name)
| ssl-cert: Subject: commonName=DC01.fluffy.htb
| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:<unsupported>, DNS:DC01.fluffy.htb
| Not valid before: 2025-04-17T16:04:17
|_Not valid after:  2026-04-17T16:04:17
|_ssl-date: 2025-09-10T23:20:45+00:00; +6h59m59s from scanner time.
445/tcp  open  microsoft-ds?
464/tcp  open  kpasswd5?
593/tcp  open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp  open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: fluffy.htb0., Site: Default-First-Site-Name)
|_ssl-date: 2025-09-10T23:20:46+00:00; +6h59m59s from scanner time.
| ssl-cert: Subject: commonName=DC01.fluffy.htb
| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:<unsupported>, DNS:DC01.fluffy.htb
| Not valid before: 2025-04-17T16:04:17
|_Not valid after:  2026-04-17T16:04:17
3268/tcp open  ldap          Microsoft Windows Active Directory LDAP (Domain: fluffy.htb0., Site: Default-First-Site-Name)
|_ssl-date: 2025-09-10T23:20:45+00:00; +6h59m59s from scanner time.
| ssl-cert: Subject: commonName=DC01.fluffy.htb
| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:<unsupported>, DNS:DC01.fluffy.htb
| Not valid before: 2025-04-17T16:04:17
|_Not valid after:  2026-04-17T16:04:17
3269/tcp open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: fluffy.htb0., Site: Default-First-Site-Name)
|_ssl-date: 2025-09-10T23:20:46+00:00; +6h59m59s from scanner time.
| ssl-cert: Subject: commonName=DC01.fluffy.htb
| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1:<unsupported>, DNS:DC01.fluffy.htb
| Not valid before: 2025-04-17T16:04:17
|_Not valid after:  2026-04-17T16:04:17
5985/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose
Running (JUST GUESSING): Microsoft Windows 2019|10 (97%)
OS CPE: cpe:/o:microsoft:windows_server_2019 cpe:/o:microsoft:windows_10
Aggressive OS guesses: Windows Server 2019 (97%), Microsoft Windows 10 1903 - 21H1 (91%)
No exact OS matches for host (test conditions non-ideal).
Network Distance: 2 hops
Service Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled and required
|_clock-skew: mean: 6h59m58s, deviation: 0s, median: 6h59m58s
| smb2-time: 
|   date: 2025-09-10T23:20:06
|_  start_date: N/A

TRACEROUTE (using port 53/tcp)
HOP RTT       ADDRESS
1   268.49 ms 10.10.14.1
2   269.04 ms 10.10.11.69

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Wed Sep 10 13:20:48 2025 -- 1 IP address (1 host up) scanned in 113.25 seconds
```
* SMB:

```bash
  nxc smb 10.10.11.69 -u users.txt -p passwords.txt --continue-on-success
SMB         10.10.11.69     445    DC01             [*] Windows 10 / Server 2019 Build 17763 (name:DC01) (domain:fluffy.htb) (signing:True) (SMBv1:False) 
SMB         10.10.11.69     445    DC01             [+] fluffy.htb\j.fleischman:J0elTHEM4n1990! 
```

Descargamos todos los archivos en nuestro kali y revisamos:

```bash
  impacket-smbclient fluffy.htb/j.fleischman:'J0elTHEM4n1990!'@10.10.11.69 

Impacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies 

Type help for list of commands
# shares
ADMIN$
C$
IPC$
IT
NETLOGON
SYSVOL
# use IT
# ls
drw-rw-rw-          0  Thu Sep 11 00:54:40 2025 .
drw-rw-rw-          0  Thu Sep 11 00:54:40 2025 ..
-rw-rw-rw-        365  Thu Sep 11 00:54:40 2025 documents.library-ms
drw-rw-rw-          0  Fri May 16 11:51:49 2025 Everything-1.4.1.1026.x64
-rw-rw-rw-    1827464  Fri May 16 11:51:49 2025 Everything-1.4.1.1026.x64.zip
drw-rw-rw-          0  Fri May 16 11:51:49 2025 KeePass-2.58
-rw-rw-rw-    3225346  Fri May 16 11:51:49 2025 KeePass-2.58.zip
-rw-rw-rw-     169963  Sat May 17 11:31:07 2025 Upgrade_Notice.pdf
# 
```

#### Paso 2: Acceso inicial

De todos los archivos lo unico interesante es el pdf... el cual contiene una lista de vulnerabilidades. Tambien examinamos el archivo con exiftool y encontramos otro usuario. 
Buscamos exploits publicos de las vulnerabilidades mas criticas:

* CVE-2025-24071

* Exploit 1 - [Public Exploit](https://github.com/ThemeHackers/CVE-2025-24071/tree/main) 

...Seguir buscando.. 

* Flow

1. Ejecutar o compilar

2. Cargar exploit en el share que podemos escribir, en este caso IT

3. Debemos levantar un servidor SMB para capturar cualquier intento de authenticacion


